-- Generated by LuaSTG Editor Sharp X 0.74.3
-- Mod name: PlantProject
_author = "Ryann1908"
_mod_version = 4096
_allow_practice = true
_allow_sc_practice = true
function math.lerp(a,b,x)
	return a + (b - a) * x
end
SetSplash(true)
-- MenuInputChecker
    function MenuInputChecker(name)
        while(true) do
            while(not KeyIsPressed(name))do
                coroutine.yield(false) --return false until the key is pressed
            end
            coroutine.yield(true) --return true once
            for i=0, 20 do
                coroutine.yield(false) --return false for 30 frames
                if (not KeyIsDown(name)) then
                    break --if the key is not being held down, break out of for (which will make you consequently restart
                end
            end
            while (KeyIsDown(name)) do
                coroutine.yield(true) -- return true once every 3 frames
                for i=0, 2 do
                    coroutine.yield(false) --return false for 3 frames
                end
            end
        end
    end

-- SetWorldUEX
    function SetWorldUEX(x, y, w, h, bound, m)
    	bound = bound or 32
    	m = m or 15
    	OriginalSetWorld(
    	--l,r,b,t,
    			(-w / 2), (w / 2), (-h / 2), (h / 2),
    	--bl,br,bb,bt
    			(-w / 2) - bound, (w / 2) + bound, (-h / 2) - bound, (h / 2) + bound,
    	--sl,sr,sb,st
    			(x - w/2), (x + w/2), (y - h/2), (y + h/2),
    	--pl,pr,pb,pt
    			(-w / 2), (w / 2), (-h / 2), (h / 2),
    	--world mask
    			m
    	)
    	SetBound(lstg.world.boundl, lstg.world.boundr, lstg.world.boundb, lstg.world.boundt)
    end

-- Wrap
    function Wrap(x, x_min, x_max)
    	return (((x - x_min) % (x_max - x_min)) + (x_max - x_min)) % (x_max - x_min) + x_min;
    end

-- Clamp
    function Clamp(val, lower, upper)
        assert(val and lower and upper, "not very useful error message here")
        if lower > upper then lower, upper = upper, lower end -- swap if boundaries supplied the wrong way
        return math.max(lower, math.min(upper, val))
    end

-- Interpolation
    function LerpDecel(a, b, x)
        local y = 1 - x
        return (a + (1 - y * y) * (b - a))
    end
    
    function Lerp(a, b, t)
        return a + (b - a) * t
    end

-- Death Weapon Alt
    death_weapon_alt = Class(object)
    
    function death_weapon_alt:init(x, y, dmg)
        self.x = x
        self.y = y
        self._dmg = dmg
        self.group = GROUP_GHOST
        self.hide = true
    end
    
    function death_weapon_alt:frame()
        if self.timer >= 90 then
            Del(self)
        end
        for i, o in ObjList(GROUP_ENEMY) do
            if o.colli == true then
                if Dist(self, o) < 40 and self.timer < 30 then
                    Damage(o, self._dmg)
                    if o.dmgsound == 1 then
                        if o.dmg_factor then
                            if o.hp > 100 then
                                PlaySound('damage00', 0.3, o.x / 200)
                            else
                                PlaySound('damage01', 0.6, o.x / 200)
                            end
                        else
                            if o.hp > o.maxhp * 0.2 then
                                PlaySound('damage00', 0.3, o.x / 200)
                            else
                                PlaySound('damage01', 0.8, o.x / 200)
                            end
                        end
                    end
                end
            end
        end
        for i, o in ObjList(GROUP_NONTJT) do
            if o.colli == true then
                if Dist(self, o) < 40 and self.timer < 30 then
                    Damage(o, self._dmg)
                    if o.dmgsound == 1 then
                        if o.dmg_factor then
                            if o.hp > 100 then
                                PlaySound('damage00', 0.3, o.x / 200)
                            else
                                PlaySound('damage01', 0.6, o.x / 200)
                            end
                        else
                            if o.hp > o.maxhp * 0.2 then
                                PlaySound('damage00', 0.3, o.x / 200)
                            else
                                PlaySound('damage01', 0.8, o.x / 200)
                            end
                        end
                    end
                end
            end
        end
    end

-- Format Score
    function FormatScore(num)
        local str = string.format('%012d', num)
        return string.format('%s,%s,%s,%s',
                str:sub(1,3), str:sub(4,6),str:sub(7,9),str:sub(10,12))
    end

Include'Vector.lua'
-- archive space: MUSIC\
local function fromsample(n)
    return n/44100
end
MusicRecord('bgm:'..'TitleTheme','MUSIC\\TitleTheme.ogg',fromsample(4696650),fromsample(3704400))
MusicRecord('bgm:'..'Act0Theme','MUSIC\\Act0Theme.ogg',0,0)
MusicRecord('bgm:'..'Act1Theme','MUSIC\\Act1Theme.ogg',0,0)
MusicRecord('bgm:'..'Act2Theme','MUSIC\\Act2Theme.ogg',0,0)
MusicRecord('bgm:'..'Act3Theme','MUSIC\\Act3Theme.ogg',0,0)
MusicRecord('bgm:'..'Act1BossTheme','MUSIC\\Act1BossTheme.ogg',0,0)
MusicRecord('bgm:'..'Act2BossTheme','MUSIC\\Act2BossTheme.ogg',0,0)
MusicRecord('bgm:'..'Act3BossTheme','MUSIC\\Act3BossTheme.ogg',0,0)
MusicRecord('bgm:'..'StaffRollTheme','MUSIC\\StaffRollTheme.ogg',0,0)
LoadSound('se:'..'se_ufo','MUSIC\\se_ufo.wav')
-- archive space: 
lstg.LoadFont('font:'..'trocchi','font\\trocchi.fnt',true)
--- Load Font Image "trocchi"
lstg.LoadFont('font:'..'simplymono','font\\simplymono.fnt',true)
--- Load Font Image "simplymono"
-- archive space: TITLE\
_LoadImageFromFile('image:'..'BaseDrop','TITLE\\BaseDrop.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'TitleBackgroundSun','TITLE\\TitleBackgroundSun.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'TitleBackgroundSunRay','TITLE\\TitleBackgroundSunRay.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'TitleLogo','TITLE\\TitleLogo.png',true,0,0,false,0)
SetImageCenter("image:TitleBackgroundSunRay",1200,70)
LoadTexture('texture:'..'TitleBackgroundFog','TITLE\\TitleBackgroundFog.png',true)
SetTextureSamplerState("texture:TitleBackgroundFog", "point+wrap")
_LoadImageFromFile('image:'..'TitleBackgroundCliff','TITLE\\TitleBackgroundCliff.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'TitleBackgroundMountains','TITLE\\TitleBackgroundMountains.png',true,0,0,false,0)
_LoadImageGroupFromFile('image:'..'TitleSelections','TITLE\\TitleSelections.png',true,4,1,0,0,false)
_LoadImageFromFile('image:'..'TitleSelectionsHighlight','TITLE\\TitleSelectionsHighlight.png',true,0,0,false,0)
LoadTexture('texture:'..'TitleBackgroundClouds','TITLE\\TitleBackgroundClouds.png',true)
SetTextureSamplerState("texture:TitleBackgroundClouds", "point+wrap")
_LoadImageFromFile('image:'..'TitleBackgroundStone','TITLE\\TitleBackgroundStone.png',true,0,0,false,0)
_LoadImageGroupFromFile('image:'..'TitleLeaves','TITLE\\TitleLeaves.png',true,9,1,0,0,false)
_LoadImageFromFile('image:'..'ShopSlot','TITLE\\ShopSlot.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'ShopSlotSeller','TITLE\\ShopSlotSeller.png',true,0,0,false,0)
_LoadImageGroupFromFile('image:'..'ShrubsCards','TITLE\\ShrubsCards.png',true,8,1,0,0,false)
for i = 1, 8 do
	CopyImage("image:ShrubsCardsAlt" .. i, "image:ShrubsCards" .. i)
end
_LoadImageGroupFromFile('image:'..'ShrubsCardsGray','TITLE\\ShrubsCardsGray.png',true,8,1,0,0,false)
_LoadImageFromFile('image:'..'ShopBoard','TITLE\\ShopBoard.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'YuukaShop','TITLE\\YuukaShop.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'ShopBoardDesc','TITLE\\ShopBoardDesc.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'YuukaTalkBox','TITLE\\YuukaTalkBox.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'ActSelectRibbon','TITLE\\ActSelectRibbon.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'ActSelectShadow','TITLE\\ActSelectShadow.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'InventoryBoard','TITLE\\InventoryBoard.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'EquippedBoard','TITLE\\EquippedBoard.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'PlantedBoard','TITLE\\PlantedBoard.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'TitleShadowCircle','TITLE\\TitleShadowCircle.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'TitleBGMLabel','TITLE\\TitleBGMLabel.png',true,0,0,false,0)
-- archive space: 
-- archive space: BACKGROUNDS\
_LoadImageFromFile('image:'..'BG_Eternity_1','BACKGROUNDS\\BG_Eternity_1.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'BG_Eternity_2','BACKGROUNDS\\BG_Eternity_2.png',true,0,0,false,0)
_editor_class["EternityBG"]=Class(_spellcard_background)
_editor_class["EternityBG"].init=function(self)
    _spellcard_background.init(self)
    _spellcard_background.AddLayer(self,"image:BG_Eternity_2",true,0,0,0,0.4,-0.4,0,"",1/2.25-0.2,1/2.25-0.2,
        function(self)
            self.task={}
            self.a = 80
        end,
        function(self)
            task.Do(self)
        end,
        function(self)
        end
    )
    _spellcard_background.AddLayer(self,"image:BG_Eternity_1",true,0,0,0,0,0.4,0,"",1/2.25-0.2,1/2.25-0.2,
        function(self)
            self.task={}
        end,
        function(self)
            task.Do(self)
        end,
        function(self)
        end
    )
end
_LoadImageFromFile('image:'..'BG_Isaki_1','BACKGROUNDS\\BG_Isaki_1.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'BG_Isaki_2','BACKGROUNDS\\BG_Isaki_2.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'BG_Isaki_3','BACKGROUNDS\\BG_Isaki_3.png',true,0,0,false,0)
_editor_class["IsakiBG"]=Class(_spellcard_background)
_editor_class["IsakiBG"].init=function(self)
    _spellcard_background.init(self)
    _spellcard_background.AddLayer(self,"image:BG_Isaki_3",true,0,0,0,0,0.35,0,"mul+add",1/2.25 - 0.2,1/2.25 - 0.2,
        function(self)
            self.task={}
        end,
        function(self)
            task.Do(self)
        end,
        function(self)
        end
    )
    _spellcard_background.AddLayer(self,"image:BG_Isaki_2",false,0,0,0,0,0,0.1,"mul+rev",1/2.25 - 0.15,1/2.25 - 0.15,
        function(self)
            self.task={}
        end,
        function(self)
            task.Do(self)
        end,
        function(self)
        end
    )
    _spellcard_background.AddLayer(self,"image:BG_Isaki_1",false,0,0,0,0,0,0,"",1/2.25,1/2.25,
        function(self)
            self.task={}
        end,
        function(self)
            task.Do(self)
        end,
        function(self)
        end
    )
end
_LoadImageFromFile('image:'..'BG_Karen_1','BACKGROUNDS\\BG_Karen_1.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'BG_Karen_2','BACKGROUNDS\\BG_Karen_2.png',true,0,0,false,0)
_editor_class["KarenBG"]=Class(_spellcard_background)
_editor_class["KarenBG"].init=function(self)
    _spellcard_background.init(self)
    _spellcard_background.AddLayer(self,"image:BG_Karen_2",true,0,0,0,0,0.4,0,"mul+add",1,1,
        function(self)
            self.task={}
            self.a = 55
        end,
        function(self)
            task.Do(self)
        end,
        function(self)
        end
    )
    _spellcard_background.AddLayer(self,"image:BG_Karen_1",false,0,0,0,0,0,0,"",1/2.25,1/2.25,
        function(self)
            self.task={}
        end,
        function(self)
            task.Do(self)
        end,
        function(self)
        end
    )
end
_LoadImageFromFile('image:'..'BG_Reimu_1','BACKGROUNDS\\BG_Reimu_1.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'BG_Reimu_2','BACKGROUNDS\\BG_Reimu_2.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'BG_Reimu_3','BACKGROUNDS\\BG_Reimu_3.png',true,0,0,false,0)
_editor_class["ReimuBG"]=Class(_spellcard_background)
_editor_class["ReimuBG"].init=function(self)
    _spellcard_background.init(self)
    _spellcard_background.AddLayer(self,"image:BG_Reimu_3",false,0,0,0,0,0,0.2,"mul+add",1/2.25,1/2.25,
        function(self)
            self.task={}
            self.a = 55
        end,
        function(self)
            task.Do(self)
        end,
        function(self)
        end
    )
    _spellcard_background.AddLayer(self,"image:BG_Reimu_2",true,0,0,0,0,0.4,0,"mul+add",1/2.25,1/2.25,
        function(self)
            self.task={}
            self.a = 55
        end,
        function(self)
            task.Do(self)
        end,
        function(self)
        end
    )
    _spellcard_background.AddLayer(self,"image:BG_Reimu_1",false,0,0,0,0,0,0,"",1/2.25,1/2.25,
        function(self)
            self.task={}
        end,
        function(self)
            task.Do(self)
        end,
        function(self)
        end
    )
end
_LoadImageFromFile('image:'..'BG_Kichi_1','BACKGROUNDS\\BG_Kichi_1.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'BG_Kichi_2','BACKGROUNDS\\BG_Kichi_2.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'BG_Kichi_3','BACKGROUNDS\\BG_Kichi_3.png',true,0,0,false,0)
_editor_class["KichiBG"]=Class(_spellcard_background)
_editor_class["KichiBG"].init=function(self)
    _spellcard_background.init(self)
    _spellcard_background.AddLayer(self,"image:BG_Kichi_3",true,0,0,0,0,0.4,0,"mul+add",1/2.25,1/2.25,
        function(self)
            self.task={}
            self.a = 25
        end,
        function(self)
            task.Do(self)
        end,
        function(self)
        end
    )
    _spellcard_background.AddLayer(self,"image:BG_Kichi_2",false,0,0,0,0,0,0.2,"mul+add",1,1,
        function(self)
            self.task={}
            self.a = 35
        end,
        function(self)
            task.Do(self)
        end,
        function(self)
        end
    )
    _spellcard_background.AddLayer(self,"image:BG_Kichi_1",false,0,0,0,0,0,0,"",1/2.25,1/2.25,
        function(self)
            self.task={}
        end,
        function(self)
            task.Do(self)
        end,
        function(self)
        end
    )
end
-- archive space: 
-- archive space: PORTRAITS\ISAKI\
_LoadImageFromFile('image:'..'Isaki_Shadow','PORTRAITS\\ISAKI\\Isaki_Shadow.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Isaki_Highlight','PORTRAITS\\ISAKI\\Isaki_Highlight.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Isaki_Cutin','PORTRAITS\\ISAKI\\Isaki_Cutin.png',true,0,0,false,0)
_LoadImageGroupFromFile('image:'..'Isaki_','PORTRAITS\\ISAKI\\Isaki_.png',true,3,1,0,0,false)
-- archive space: 
-- archive space: PORTRAITS\ETERNITY\
_LoadImageFromFile('image:'..'Eternity_Shadow','PORTRAITS\\ETERNITY\\Eternity_Shadow.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Eternity_Highlight','PORTRAITS\\ETERNITY\\Eternity_Highlight.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Eternity_Cutin','PORTRAITS\\ETERNITY\\Eternity_Cutin.png',true,0,0,false,0)
_LoadImageGroupFromFile('image:'..'Eternity_','PORTRAITS\\ETERNITY\\Eternity_.png',true,3,1,0,0,false)
-- archive space: 
-- archive space: PORTRAITS\MARISA\
_LoadImageGroupFromFile('image:'..'Marisa_','PORTRAITS\\MARISA\\Marisa_.png',true,6,1,0,0,false)
-- archive space: 
-- archive space: PORTRAITS\KICHI\
_LoadImageFromFile('image:'..'Kichi_Shadow','PORTRAITS\\KICHI\\Kichi_Shadow.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Kichi_Highlight','PORTRAITS\\KICHI\\Kichi_Highlight.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Kichi_Cutin','PORTRAITS\\KICHI\\Kichi_Cutin.png',true,0,0,false,0)
_LoadImageGroupFromFile('image:'..'Kichi_','PORTRAITS\\KICHI\\Kichi_.png',true,5,1,0,0,false)
-- archive space: 
-- archive space: PORTRAITS\KAREN\
_LoadImageFromFile('image:'..'Karen_Shadow','PORTRAITS\\KAREN\\Karen_Shadow.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Karen_Highlight','PORTRAITS\\KAREN\\Karen_Highlight.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Karen_Cutin','PORTRAITS\\KAREN\\Karen_Cutin.png',true,0,0,false,0)
_LoadImageGroupFromFile('image:'..'Karen_','PORTRAITS\\KAREN\\Karen_.png',true,3,1,0,0,false)
-- archive space: 
-- archive space: PORTRAITS\REIMU\
_LoadImageFromFile('image:'..'Reimu_Shadow','PORTRAITS\\REIMU\\Reimu_Shadow.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Reimu_Highlight','PORTRAITS\\REIMU\\Reimu_Highlight.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Reimu_Cutin','PORTRAITS\\REIMU\\Reimu_Cutin.png',true,0,0,false,0)
_LoadImageGroupFromFile('image:'..'Reimu_','PORTRAITS\\REIMU\\Reimu_.png',true,4,1,0,0,false)
-- archive space: 
-- archive space: SPRITES\GENERAL\
_LoadImageFromFile('image:'..'ShrubShadow','SPRITES\\GENERAL\\ShrubShadow.png',true,0,0,false,0)
SetImageCenter("image:ShrubShadow",0,1008)
_LoadImageGroupFromFile('image:'..'ShrubsShooters','SPRITES\\GENERAL\\ShrubsShooters.png',true,8,1,0,0,false)
for _=1,8 do
    SetImageCenter("image:ShrubsShooters" .. _,456,312)
end
_LoadImageGroupFromFile('image:'..'UIElements','SPRITES\\GENERAL\\UIElements.png',true,4,2,0,0,false)
_LoadImageFromFile('image:'..'HeartIcon','SPRITES\\GENERAL\\HeartIcon.png',true,0,0,false,0)
_LoadImageGroupFromFile('image:'..'SongLabel','SPRITES\\GENERAL\\SongLabel.png',true,1,8,0,0,false)
_LoadImageGroupFromFile('image:'..'TutorialCard','SPRITES\\GENERAL\\TutorialCard.png',true,4,1,0,0,false)
_LoadImageFromFile('image:'..'StageClear','SPRITES\\GENERAL\\StageClear.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'SeedIcon','SPRITES\\GENERAL\\SeedIcon.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Title_Isaki','SPRITES\\GENERAL\\Title_Isaki.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Title_Eternity','SPRITES\\GENERAL\\Title_Eternity.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Title_Karen','SPRITES\\GENERAL\\Title_Karen.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Title_Reimu','SPRITES\\GENERAL\\Title_Reimu.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Title_Kichi','SPRITES\\GENERAL\\Title_Kichi.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'KarenRadius','SPRITES\\GENERAL\\KarenRadius.png',true,0,0,false,0)
LoadAniFromFile('ani:'..'UFO','SPRITES\\GENERAL\\UFO.png',true,4,1,8,0,0,false)
SetTextureSamplerState('ani:UFO',"point+clamp")
_LoadImageFromFile('image:'..'ReimuBall','SPRITES\\GENERAL\\ReimuBall.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'EnemyProgressBar','SPRITES\\GENERAL\\EnemyProgressBar.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'EnemyProgressBarIndicator','SPRITES\\GENERAL\\EnemyProgressBarIndicator.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'LifeProgressBar','SPRITES\\GENERAL\\LifeProgressBar.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'LifeProgressBarIndicator','SPRITES\\GENERAL\\LifeProgressBarIndicator.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'StaffRoll','SPRITES\\GENERAL\\StaffRoll.png',true,0,0,false,0)
SetImageCenter("image:StaffRoll",1920/2, 0)
_LoadImageFromFile('image:'..'StaffRollBackgroundOne','SPRITES\\GENERAL\\StaffRollBackgroundOne.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'StaffRollBackgroundTwo','SPRITES\\GENERAL\\StaffRollBackgroundTwo.png',true,0,0,false,0)
CopyImage("altwhite", "white")
-- archive space: 
-- archive space: SPRITES\MARISA\
_LoadImageFromFile('image:'..'arml','SPRITES\\MARISA\\arml.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'armr','SPRITES\\MARISA\\armr.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'broom','SPRITES\\MARISA\\broom.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'hair','SPRITES\\MARISA\\hair.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'hat','SPRITES\\MARISA\\hat.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'hattop','SPRITES\\MARISA\\hattop.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'legl','SPRITES\\MARISA\\legl.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'legr','SPRITES\\MARISA\\legr.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'skirt','SPRITES\\MARISA\\skirt.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'torso','SPRITES\\MARISA\\torso.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'waist_ribbon','SPRITES\\MARISA\\waist_ribbon.png',true,0,0,false,0)
MarisaWigNode=(64)
_LoadImageGroupFromFile('image:'..'wig','SPRITES\\MARISA\\wig.png',false,1,MarisaWigNode,0,0,false)
SetTextureSamplerState("image:wig", "linear+wrap")
_LoadImageGroupFromFile('image:'..'Marisa_Shot','SPRITES\\MARISA\\Marisa_Shot.png',true,4,1,0,0,false)
_LoadImageFromFile('image:'..'Hakkero','SPRITES\\MARISA\\Hakkero.png',true,0,0,false,0)
_LoadImageGroupFromFile('image:'..'Fire_Shot','SPRITES\\MARISA\\Fire_Shot.png',true,4,1,0,0,false)
_LoadImageGroupFromFile('image:'..'Earth_Shot','SPRITES\\MARISA\\Earth_Shot.png',true,4,1,0,0,false)
_LoadImageGroupFromFile('image:'..'Ice_Shot','SPRITES\\MARISA\\Ice_Shot.png',true,4,1,0,0,false)
_LoadImageFromFile('image:'..'Lightning_Ray','SPRITES\\MARISA\\Lightning_Ray.png',true,0,0,false,0)
SetImageCenter("image:Lightning_Ray",0, 32)
_LoadImageGroupFromFile('image:'..'Poison_Shot','SPRITES\\MARISA\\Poison_Shot.png',true,4,1,0,0,false)
_LoadImageGroupFromFile('image:'..'Water_Shot','SPRITES\\MARISA\\Water_Shot.png',true,4,1,0,0,false)
_LoadImageGroupFromFile('image:'..'Wind_Shot','SPRITES\\MARISA\\Wind_Shot.png',true,4,1,0,0,false)
_LoadImageGroupFromFile('image:'..'Metal_Shot','SPRITES\\MARISA\\Metal_Shot.png',true,4,1,0,0,false)
-- archive space: 
_editor_class["Base_Drop"]=Class(_object)
_editor_class["Base_Drop"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_TOP-5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.hscale, self.vscale = 1 / 2.25, 1 / 2.25
    self.positions = {
    	[0] = { screen.width,       screen.height - 480 },
    	{ screen.width,       screen.height - 480 }, 
    	{ screen.width - 853, screen.height - 480 }, 
    	{ screen.width,       screen.height       }, 
    	{ screen.width - 853, screen.height       }
    }
    if lstg.var.skipIntro then
    	self.positionIndex = 1
    else
    	self.positionIndex = 0
    end
    
    BaseDrop = self
    last=New(_editor_class["Background_Sun"],0,0,_)
    _connect(self,last,0,false)
    last=New(_editor_class["Title_Logo"],0,0,_)
    _connect(self,last,0,false)
    last=New(_editor_class["Background_Fog"],0,0,_)
    _connect(self,last,0,false)
    last=New(_editor_class["Title_Mountains"],0,0,_)
    _connect(self,last,0,false)
    last=New(_editor_class["Title_Sky"],0,0,_)
    _connect(self,last,0,false)
    last=New(_editor_class["Title_Cliff"],0,0,_)
    _connect(self,last,0,false)
    last=New(_editor_class["Title_BGM"],self.x,self.y,_)
    _connect(self,last,0,false)
    last=New(_editor_class["MainMenu_Manager"],0,0,_)
    _connect(self,last,0,false)
    last=New(_editor_class["Shop_Manager"],0,0,_)
    _connect(self,last,0,false)
    last=New(_editor_class["Act_Select"],0,0,_)
    _connect(self,last,0,false)
    last=New(_editor_class["Loadout_Select"],0,0,_)
    _connect(self,last,0,false)
    if not lstg.var.skipIntro then
        last=New(_editor_class["Blackout_Fade"],self.x,self.y,_)
        last=New(_editor_class["Blackout_Overlay"],self.x,self.y,_)
    else
        last=New(_editor_class["Blackout_Fade"],self.x,self.y,_)
        LoadMusicRecord("bgm:TitleTheme")
        _play_music("bgm:TitleTheme")
    end
end
_editor_class["Base_Drop"].frame=function(self)
    if KeyIsPressed"shoot" then
    	--self.positionIndex = self.positionIndex + 1
    	--self.positionIndex = Wrap(self.positionIndex, 1, 5)
    end
    
    self.x = LerpDecel(self.x, self.positions[self.positionIndex][1], 0.1)
    self.y = LerpDecel(self.y, self.positions[self.positionIndex][2], 0.1)
    self.class.base.frame(self)
end
_editor_class["Base_Drop"].render=function(self)
    SetViewMode'ui'
    self.class.base.render(self)
    SetViewMode'world'
end
_editor_class["Background_Sun"]=Class(_object)
_editor_class["Background_Sun"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="image:TitleBackgroundSun"
    self.layer=LAYER_TOP+1
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.omiga = 0.15
    self.hscale, self.vscale = 1 / 2.25, 1 / 2.25
    do local ang,_d_ang=(0),(360/5) for _=1,5 do
        last=New(_editor_class["Background_Sun_Ray"],self.x,self.y,-0.1)
        last.rot = ang
        _connect(self,last,0,false)
    ang=ang+_d_ang end end
    do local ang,_d_ang=((360/5) / 2),(360/5) for _=1,5 do
        last=New(_editor_class["Background_Sun_Ray"],self.x,self.y,0.1)
        last.rot = ang
        _connect(self,last,0,false)
    ang=ang+_d_ang end end
end
_editor_class["Background_Sun"].frame=function(self)
    self.class.base.frame(self)
    _set_rel_pos(self,-175, 400,self.rot,false)
end
_editor_class["Background_Sun"].render=function(self)
    SetViewMode'ui'
    self.class.base.render(self)
    SetViewMode'world'
end
_editor_class["Background_Sun_Ray"]=Class(_object)
_editor_class["Background_Sun_Ray"].init=function(self,_x,_y,omiga)
    self.x,self.y=_x,_y
    self.img="image:TitleBackgroundSunRay"
    self.layer=LAYER_TOP
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.omiga = omiga
    self.hscale, self.vscale = 1 / 2.25, 1 / 2.25
    _object.set_color(self,"",55,255,255,255)
end
_editor_class["Background_Sun_Ray"].frame=function(self)
    self.class.base.frame(self)
    _set_rel_pos(self,0, 0,self.rot,false)
end
_editor_class["Background_Sun_Ray"].render=function(self)
    SetViewMode'ui'
    self.class.base.render(self)
    SetViewMode'world'
end
_editor_class["Title_Logo"]=Class(_object)
_editor_class["Title_Logo"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="image:TitleLogo"
    self.layer=LAYER_TOP+100
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.hscale, self.vscale = 1 / 2.25, 1 / 2.25
end
_editor_class["Title_Logo"].frame=function(self)
    self.class.base.frame(self)
    _set_rel_pos(self,-525, 250 + (sin(self.timer) * 6),self.rot,false)
end
_editor_class["Title_Logo"].render=function(self)
    SetViewMode'ui'
    self.class.base.render(self)
    SetViewMode'world'
end
_editor_class["Background_Fog"]=Class(_object)
_editor_class["Background_Fog"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_TOP-1
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.hscale, self.vscale = 1 / 2.25, 1 / 2.25
    _object.set_color(self,"",0,255,255,255)
    self.addx = 0
end
_editor_class["Background_Fog"].frame=function(self)
    self.class.base.frame(self)
    _set_rel_pos(self,0,0,self.rot,false)
    self.addx = self.addx + 1
end
_editor_class["Background_Fog"].render=function(self)
    SetViewMode'ui'
    local tex_name = "texture:TitleBackgroundFog"
    local tex_width, tex_height = GetTextureSize(tex_name)
    tex_width, tex_height = tex_width, tex_height
    
    local top_left =     {0   + self.x - 853, 480 + self.y + 30}
    local top_right =    {853 + self.x - 853, 480 + self.y + 30}
    local bottom_right = {853 + self.x - 853, 0   + self.y + 30}
    local bottom_left =  {0   + self.x - 853, 0   + self.y + 30}
    
    local col = Color(255, 255, 255, 255)
    
    local tl, tr, br, bl = top_left, top_right, bottom_right, bottom_left
    local tw, th = tex_width, tex_height
    
    RenderTexture(tex_name, "",
                 {tl[1], tl[2], 1, 0  + self.addx, 0,  col},
                 {tr[1], tr[2], 1, tw + self.addx, 0,  col},
                 {br[1], br[2], 1, tw + self.addx, th, col},
                 {bl[1], bl[2], 1, 0  + self.addx, th, col}
                 )
                 
    top_left =     {0   + self.x, 480 + self.y + 30}
    top_right =    {853 + self.x, 480 + self.y + 30}
    bottom_right = {853 + self.x, 0   + self.y + 30}
    bottom_left =  {0   + self.x, 0   + self.y + 30}
    
    col = Color(255, 255, 255, 255)
    
    tl, tr, br, bl = top_left, top_right, bottom_right, bottom_left
    tw, th = tex_width, tex_height
    
    RenderTexture(tex_name, "",
                 {tl[1], tl[2], 1, 0  + self.addx, 0,  col},
                 {tr[1], tr[2], 1, tw + self.addx, 0,  col},
                 {br[1], br[2], 1, tw + self.addx, th, col},
                 {bl[1], bl[2], 1, 0  + self.addx, th, col}
                 )
    SetViewMode'world'
end
_editor_class["Title_Mountains"]=Class(_object)
_editor_class["Title_Mountains"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="image:TitleBackgroundStone"
    self.layer=LAYER_TOP-2
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.hscale, self.vscale = 1 / 2.25, 1 / 2.25
end
_editor_class["Title_Mountains"].frame=function(self)
    self.class.base.frame(self)
    _set_rel_pos(self,0,0,self.rot,false)
end
_editor_class["Title_Mountains"].render=function(self)
    SetViewMode'ui'
    self.class.base.render(self)
    SetViewMode'world'
end
_editor_class["Title_Sky"]=Class(_object)
_editor_class["Title_Sky"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="image:TitleBackgroundMountains"
    self.layer=LAYER_TOP-3
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.hscale, self.vscale = 1 / 2.25, 1 / 2.25
    self.addx = 0
end
_editor_class["Title_Sky"].frame=function(self)
    self.class.base.frame(self)
    _set_rel_pos(self,0,0,self.rot,false)
    self.addx = self.addx + 0.4
end
_editor_class["Title_Sky"].render=function(self)
    SetViewMode'ui'
    self.class.base.render(self)
    local tex_name = "texture:TitleBackgroundClouds"
    local tex_width, tex_height = GetTextureSize(tex_name)
    tex_width, tex_height = tex_width, tex_height
    
    local top_left =     {0   + self.x - 853, 480 + self.y + 30}
    local top_right =    {1706 + self.x - 853, 480 + self.y + 30}
    local bottom_right = {1706 + self.x - 853, 0   + self.y + 30}
    local bottom_left =  {0   + self.x - 853, 0   + self.y + 30}
    
    local col = Color(255, 255, 255, 255)
    
    local tl, tr, br, bl = top_left, top_right, bottom_right, bottom_left
    local tw, th = tex_width, tex_height
    
    RenderTexture(tex_name, "",
                 {tl[1], tl[2], 1, 0  + self.addx, 0,  col},
                 {tr[1], tr[2], 1, tw + self.addx, 0,  col},
                 {br[1], br[2], 1, tw + self.addx, th, col},
                 {bl[1], bl[2], 1, 0  + self.addx, th, col}
                 )
    SetViewMode'world'
end
_editor_class["Title_Cliff"]=Class(_object)
_editor_class["Title_Cliff"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="image:TitleBackgroundCliff"
    self.layer=LAYER_TOP
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.hscale, self.vscale = 1 / 2.25, 1 / 2.25
    for _=1,160 do
        last=New(_editor_class["Title_Leaf"],ran:Int(-500, 853*2), ran:Float(700, 900),{ran:Int(-1400, 853*2), ran:Float(700, -900)})
    end
end
_editor_class["Title_Cliff"].frame=function(self)
    self.class.base.frame(self)
    _set_rel_pos(self,0,0,self.rot,false)
    if self.timer % 17 == 0 then
        last=New(_editor_class["Title_Leaf"],853*2 + 35, ran:Float(700, 900),{0,0})
    else
    end
end
_editor_class["Title_Cliff"].render=function(self)
    SetViewMode'ui'
    self.class.base.render(self)
    SetViewMode'world'
end
_editor_class["Title_BGM"]=Class(_object)
_editor_class["Title_BGM"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="image:TitleBGMLabel"
    self.layer=LAYER_TOP
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.hscale, self.vscale = 1 / 2.25, 1 / 2.25
    self.posx = -800
    lasttask=task.New(self,function()
        while BaseDrop.positionIndex ~= 1 do
            task._Wait(1)
        end
        do
            local _beg_posx=-800 local posx=_beg_posx  local _w_posx=0 local _end_posx=-670 local _d_w_posx=90/(60-1)
            for _=1,60 do
                self.posx = posx
                task._Wait(1)
                _w_posx=_w_posx+_d_w_posx posx=(_end_posx-_beg_posx)*sin(_w_posx)+(_beg_posx)
            end
        end
        task._Wait(60*4)
        do
            local _beg_alp=255 local alp=_beg_alp  local _w_alp=0 local _end_alp=0 local _d_w_alp=90/(60-1)
            for _=1,60 do
                _object.set_color(self,"",alp,255,255,255)
                task._Wait(1)
                _w_alp=_w_alp+_d_w_alp alp=(_end_alp-_beg_alp)*sin(_w_alp)+(_beg_alp)
            end
        end
        _del(self,true)
    end)
end
_editor_class["Title_BGM"].frame=function(self)
    self.class.base.frame(self)
    _set_rel_pos(self,self.posx,15,self.rot,false)
end
_editor_class["Title_BGM"].render=function(self)
    SetViewMode'ui'
    self.class.base.render(self)
    SetViewMode'world'
end
_editor_class["Title_Leaf"]=Class(_object)
_editor_class["Title_Leaf"].init=function(self,_x,_y,posaddon)
    self.x,self.y=_x,_y
    self.img="image:TitleLeaves" .. ran:Int(1, 9)
    self.layer=LAYER_TOP
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.scale = ran:Float(-0.3, -0.45)
    self.xspeed = ran:Float(1, 2)
    self.yspeed = ran:Float(1, 0.1)
    self.posaddon = posaddon
    self.hscale, self.vscale = (1 / 2.25) + self.scale, (1 / 2.25) + self.scale
    self.vx, self.vy = ran:Float(-1, -2), ran:Float(-1, -0.1)
    self.omiga = ran:Float(-1, 1)
end
_editor_class["Title_Leaf"].frame=function(self)
    self.x = BaseDrop.x - self.timer * self.xspeed + 853 * 2 - self.posaddon[1]
    self.y = BaseDrop.y - self.timer * self.yspeed + 853 - self.posaddon[2]
    if self.x <= -853 then
        _del(self,true)
    else
    end
    self.class.base.frame(self)
end
_editor_class["Title_Leaf"].render=function(self)
    SetViewMode'ui'
    self.class.base.render(self)
    SetViewMode'world'
end
_editor_class["SeedNotificator"]=Class(_object)
_editor_class["SeedNotificator"].init=function(self,_x,_y,seedAmount)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_TOP+100
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    PlaySound("bonus",0.8,self.x/256,false)
    self.seedAmount = seedAmount
    self.alpha = 255
    lasttask=task.New(self,function()
        for _=1,seedAmount/20 do
            PlaySound("hyz_chargeup",0.8,self.x/256,false)
            last=New(_editor_class["SeedPellets"],self.x,self.y,_)
            table.insert(BaseDrop._servants, last)
            last._master = BaseDrop
            task._Wait(5)
        end
        task._Wait(60)
        do
            local _beg_alp=255 local alp=_beg_alp  local _w_alp=0 local _end_alp=0 local _d_w_alp=90/(30-1)
            for _=1,30 do
                self.alpha = alp
                task._Wait(1)
                _w_alp=_w_alp+_d_w_alp alp=(_end_alp-_beg_alp)*sin(_w_alp)+(_beg_alp)
            end
        end
    end)
end
_editor_class["SeedNotificator"].frame=function(self)
    _set_rel_pos(self,0,0,self.rot,false)
    self.class.base.frame(self)
end
_editor_class["SeedNotificator"].render=function(self)
    SetViewMode'ui'
    SetImageState("image:SeedIcon","",Color(self.alpha,255,255,255))
    Render("image:SeedIcon",self.x - 800, self.y + 440,0,1/2.25 - 0.15, 1/2.25 - 0.15,0.5)
    SetFontState("font:trocchi","",Color(self.alpha,255,241,185))
    lstg.RenderText("font:trocchi","+" .. self.seedAmount .. " Seeds",self.x - 770, self.y + 441,1/2.25 - 0.2,4)
    SetFontState("font:trocchi","",Color(255,255,255,255))
    self.class.base.render(self)
    SetViewMode'world'
end
_editor_class["SeedPellets"]=Class(_object)
_editor_class["SeedPellets"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_TOP+101
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.posx = -800
    self.posy = 440
    self.alpha = 255
    lasttask=task.New(self,function()
        do
            local _beg_alp=255 local alp=_beg_alp  local _w_alp=0 local _end_alp=0 local _d_w_alp=90/(50-1)
            for _=1,50 do
                self.alpha = alp
                task._Wait(1)
                _w_alp=_w_alp+_d_w_alp alp=(_end_alp-_beg_alp)*sin(_w_alp)+(_beg_alp)
            end
        end
    end)
    lasttask=task.New(self,function()
        do
            local _beg_posx=-800 local posx=_beg_posx  local _w_posx=0 local _end_posx=700 local _d_w_posx=90/(50-1)
            local _beg_posy=440 local posy=_beg_posy  local _w_posy=0 local _end_posy=200 local _d_w_posy=90/(50-1)
            for _=1,50 do
                self.posx = posx
                self.posy = posy
                task._Wait(1)
                _w_posx=_w_posx+_d_w_posx posx=(_end_posx-_beg_posx)*sin(_w_posx)+(_beg_posx)
                _w_posy=_w_posy+_d_w_posy posy=(_end_posy-_beg_posy)*sin(_w_posy)+(_beg_posy)
            end
        end
        _del(self,true)
    end)
end
_editor_class["SeedPellets"].frame=function(self)
    _set_rel_pos(self,0,0,self.rot,false)
    self.class.base.frame(self)
end
_editor_class["SeedPellets"].render=function(self)
    SetViewMode'ui'
    SetImageState("image:SeedIcon","",Color(self.alpha,255,255,255))
    Render("image:SeedIcon",self.x + self.posx, self.y + self.posy,0,1/2.25 - 0.2, 1/2.25 - 0.2,0.5)
    self.class.base.render(self)
    SetViewMode'world'
end
--[[ No Comments]]

_editor_class["MainMenu_Manager"]=Class(_object)
_editor_class["MainMenu_Manager"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_TOP+5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.hscale, self.vscale = 1 / 2.25, 1 / 2.25
    self.selectionIndex = 1
    self.selectionOptionsIndex = 1
    self.selectionsPosition = {
    	{-115, 200 - 50},
    	{-115, 150 + 15 - 50},
    	{-115, 100 + 30 - 50},
    	{-115, 50 + 45 - 50}
    }
    
    self.optionsIn = false
    self.resolutions = {
    	{640, 360},
    	{853, 480},
    	{1024, 576},
    	{1280, 720},
    	{1366, 768},
    	{1600, 900},
    	{1920, 1080}
    }
    self.resolutionPick = 1;
    self.windowed = setting.windowed or true;
    self.vsync = setting.vsync or true;
    self.bgm = setting.bgmvolume
    self.sfx = setting.sevolume
    self.optionsText = {
    	"Resolution: " .. self.resolutions[self.resolutionPick][1] .. "x" .. self.resolutions[self.resolutionPick][2],
    	"\nWindowed: " .. tostring(self.windowed),
    	"\n\nVsync: " .. tostring(self.vsync),
    	"\n\n\nBGM Volume: " .. self.bgm,
    	"\n\n\n\nSFX Volume: " .. self.sfx,
    	"\n\n\n\n\nSave and Apply"
    }
    
    self.selectionPositionRefX = {0, 0, 0, 0}
    self.selectionOptionsPositionRefX = {0, 0, 0, 0, 0, 0}
    self.selectionHighlightRefY = 150
    
    self.images = {
    	"image:TitleSelections1",
    	"image:TitleSelections2",
    	"image:TitleSelections3",
    	"image:TitleSelections4"
    }
    
    self.waitTimer = 10
end
_editor_class["MainMenu_Manager"].frame=function(self)
    self.class.base.frame(self)
    _set_rel_pos(self,0,0,self.rot,false)
    if BaseDrop.positionIndex == 1 then
    	self.waitTimer = self.waitTimer - 1
    	if self.waitTimer <= 0 then
    		if self.optionsIn == false then
    			if GetKeyState(KEY.J) then
    				lstg.var.equipCard = {}
    				lstg.var.plantCard = {}
    				lstg.var.equipCard[1] = 1
    				lstg.var.equipCard[2] = 1
    				for i = 1, 4 do
    					lstg.var.plantCard[i] = 0
    				end
    				stage.group.Start(stage.groups['ActJudge'], 0)
    			end
    			if is_up_held then
    				self.selectionIndex = Wrap(self.selectionIndex - 1, 1, 5)
    				PlaySound("select00",0.1,0,false)
    			end
    			
    			if is_down_held then
    				self.selectionIndex = Wrap(self.selectionIndex + 1, 1, 5)
    				PlaySound("select00",0.1,0,false)
    			end
    			
    			if KeyIsPressed"shoot" then
    				if (self.selectionIndex == 1) then
    					BaseDrop.positionIndex = 3
    				end
    				if (self.selectionIndex == 2) then
    					BaseDrop.positionIndex = 2
    				end
    				if (self.selectionIndex == 3) then 
    					self.selectionOptionsIndex = 1
    					self.optionsIn = true;
    				end
    				if (self.selectionIndex == 4) then
    					stage.QuitGame()
    				end
    				PlaySound("ok00",0.1,0,false)
    			end
    		else
    			if is_up_held then
    				self.selectionOptionsIndex = Wrap(self.selectionOptionsIndex - 1, 1, 7)
    				PlaySound("select00",0.1,0,false)
    			end
    			
    			if is_down_held then
    				self.selectionOptionsIndex = Wrap(self.selectionOptionsIndex + 1, 1, 7)
    				PlaySound("select00",0.1,0,false)
    			end
    			
    			if self.selectionOptionsIndex == 1 then
    				if is_left_held then self.resolutionPick = Wrap(self.resolutionPick - 1, 1, 8); PlaySound("select00",0.1,0,false) end
    				if is_right_held then self.resolutionPick = Wrap(self.resolutionPick + 1, 1, 8); PlaySound("select00",0.1,0,false) end
    			elseif self.selectionOptionsIndex == 2 then
    				if is_left_held then self.windowed = not self.windowed; PlaySound("select00",0.1,0,false) end
    				if is_right_held then self.windowed = not self.windowed; PlaySound("select00",0.1,0,false) end
    			elseif self.selectionOptionsIndex == 3 then
    				if is_left_held then self.vsync = not self.vsync; PlaySound("select00",0.1,0,false) end
    				if is_right_held then self.vsync = not self.vsync; PlaySound("select00",0.1,0,false) end
    			elseif self.selectionOptionsIndex == 4 then
    				if is_left_held and KeyIsPressed"slow" then
    					self.bgm = Wrap(self.bgm - 1, 0, 101); PlaySound("select00",0.1,0,false)
    				elseif is_left_held then
    					self.bgm = Wrap(self.bgm - 10, 0, 101); PlaySound("select00",0.1,0,false)
    				end
    				if is_right_held and KeyIsPressed"slow" then
    					self.bgm = Wrap(self.bgm + 1, 0, 101); PlaySound("select00",0.1,0,false)
    				elseif is_right_held then
    					self.bgm = Wrap(self.bgm + 10, 0, 101); PlaySound("select00",0.1,0,false)
    				end
    			elseif self.selectionOptionsIndex == 5 then
    				if is_left_held and KeyIsPressed"slow" then
    					self.sfx = Wrap(self.sfx - 1, 0, 101); PlaySound("select00",0.1,0,false)
    				elseif is_left_held then
    					self.sfx = Wrap(self.sfx - 10, 0, 101); PlaySound("select00",0.1,0,false)
    				end
    				if is_right_held and KeyIsPressed"slow" then
    					self.bgm = Wrap(self.sfx + 1, 0, 101); PlaySound("select00",0.1,0,false)
    				elseif is_right_held then
    					self.sfx = Wrap(self.sfx + 10, 0, 101); PlaySound("select00",0.1,0,false)
    				end
    			end
    			
    			if KeyIsPressed"shoot" then
    				if self.selectionOptionsIndex == 1 then
    					self.resolutionPick = Wrap(self.resolutionPick + 1, 1, 8)
    				elseif self.selectionOptionsIndex == 2 then
    					self.windowed = not self.windowed
    				elseif self.selectionOptionsIndex == 3 then
    					self.vsync = not self.vsync
    				elseif self.selectionOptionsIndex == 4 then
    					self.bgm = Wrap(self.bgm + 10, 0, 101)
    				elseif self.selectionOptionsIndex == 5 then
    					self.sfx = Wrap(self.sfx + 10, 0, 101)
    				elseif self.selectionOptionsIndex == 6 then
    					setting.resx = self.resolutions[self.resolutionPick][1]
    					setting.resy = self.resolutions[self.resolutionPick][2]
    					setting.windowed = self.windowed
    					setting.vsync = self.vsync
    					setting.bgmvolume = self.bgm
    					setting.sevolume = self.sfx
    					SetBGMVolume(setting.bgmvolume * 0.01)
    					SetSEVolume(setting.sevolume * 0.01)
    					saveConfigure()
    					ChangeVideoMode(setting.resx, setting.resy, setting.windowed, setting.vsync)
    					ResetScreen()
    					self.optionsIn = false
    				end
    				PlaySound("ok00",0.1,0,false)
    			end
    		end
    		
    		self.optionsText = {
    			"Resolution: " .. self.resolutions[self.resolutionPick][1] .. "x" .. self.resolutions[self.resolutionPick][2],
    			"\nWindowed: " .. tostring(self.windowed),
    			"\n\nVsync: " .. tostring(self.vsync),
    			"\n\n\nBGM Volume: " .. self.bgm,
    			"\n\n\n\nSFX Volume: " .. self.sfx,
    			"\n\n\n\n\nSave and Apply"
    		}
    	end
    	
    else
    	self.waitTimer = 10
    end
end
_editor_class["MainMenu_Manager"].render=function(self)
    SetViewMode'ui'
    self.class.base.render(self)
    if self.optionsIn == false then
    	self.selectionHighlightRefY = LerpDecel(self.selectionHighlightRefY, self.selectionsPosition[self.selectionIndex][2], 0.2)
    	Render("image:TitleSelectionsHighlight",
    			self.selectionsPosition[self.selectionIndex][1] + self.x - 41,
    			self.selectionHighlightRefY + self.y,
    			0, self.hscale, self.vscale)
    else
    	self.selectionHighlightRefY = LerpDecel(self.selectionHighlightRefY, 185 - ((self.selectionOptionsIndex - 1) * 28.5), 0.2)
    	Render("image:TitleSelectionsHighlight",
    			self.x - 115 - 41,
    			self.selectionHighlightRefY + self.y,
    			0, self.hscale, self.vscale)
    end
    
    		
    for i = 1, 4 do
    	if self.optionsIn == false then
    		if i == self.selectionIndex then
    			self.selectionPositionRefX[i] = LerpDecel(self.selectionPositionRefX[i], 15, 0.2)
    			SetImageState(self.images[i], "", Color(255, 255, 255, 255))
    			Render(self.images[i],
    				self.selectionsPosition[i][1] + self.x - self.selectionPositionRefX[i],
    				self.selectionsPosition[i][2] + self.y,
    				0, self.hscale, self.vscale)
    		else
    			self.selectionPositionRefX[i] = LerpDecel(self.selectionPositionRefX[i], 0, 0.2)
    			SetImageState(self.images[i], "", Color(155, 255, 255, 255))
    			Render(self.images[i],
    				self.selectionsPosition[i][1] + self.x - self.selectionPositionRefX[i],
    				self.selectionsPosition[i][2] + self.y,
    				0, self.hscale, self.vscale)
    		end
    	else
    		self.selectionPositionRefX[i] = LerpDecel(self.selectionPositionRefX[i], -200, 0.2)
    		SetImageState(self.images[i], "", Color(155, 255, 255, 255))
    		Render(self.images[i],
    			self.selectionsPosition[i][1] + self.x - self.selectionPositionRefX[i],
    			self.selectionsPosition[i][2] + self.y,
    			0, self.hscale, self.vscale)
    	end
    end
    
    if BaseDrop.positionIndex == 1 then
    	for i = 1, 6 do
    		if self.optionsIn == true then
    			if i == self.selectionOptionsIndex then
    				self.selectionOptionsPositionRefX[i] = LerpDecel(self.selectionOptionsPositionRefX[i], 15, 0.2)
    				SetFontState("font:trocchi", "", Color(255,255,255,255))
    				lstg.RenderText("font:trocchi", self.optionsText[i], -50 + self.x - self.selectionOptionsPositionRefX[i], self.y + 200, self.hscale - 0.2, 2)
    			else
    				self.selectionOptionsPositionRefX[i] = LerpDecel(self.selectionOptionsPositionRefX[i], 0, 0.2)
    				SetFontState("font:trocchi", "", Color(100,255,255,255))
    				lstg.RenderText("font:trocchi", self.optionsText[i], -50 + self.x - self.selectionOptionsPositionRefX[i], self.y + 200, self.hscale - 0.2, 2)
    			end
    		else
    			self.selectionOptionsPositionRefX[i] = LerpDecel(self.selectionOptionsPositionRefX[i], -350, 0.2)
    			SetFontState("font:trocchi", "", Color(100,255,255,255))
    			lstg.RenderText("font:trocchi", self.optionsText[i], -50 + self.x - self.selectionOptionsPositionRefX[i], self.y + 200, self.hscale - 0.2, 2)
    		end
    	end
    end
    SetViewMode'world'
end
_editor_class["Shop_Manager"]=Class(_object)
_editor_class["Shop_Manager"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_TOP+5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.hscale, self.vscale = 1 / 2.25, 1 / 2.25
    self.selectionIndex = 1
    self.slotCardOffset = {}
    for i = 1, 16 do
    	table.insert(self.slotCardOffset, i, 0)
    end
    
    --print("start " .. tostring(scoredata.ownedCards[1]))
    --scoredata.ownedCards = scoredata.ownedCards or {0,0,0,0,0,0,0,0}
    scoredata.seedAmount = scoredata.seedAmount or 1000
    if not scoredata.ownedCards then scoredata.ownedCards = {0,0,0,0,0,0,0,0} end
    if scoredata.seedAmount == nil then scoredata.seedAmount = 750 end
    if not scoredata.prevSeedAmount then scoredata.prevSeedAmount = 750 end
    if scoredata.prevSeedAmount < scoredata.seedAmount then
    	last=New(_editor_class["SeedNotificator"], self.x, self.y, scoredata.seedAmount - scoredata.prevSeedAmount)
    	table.insert(BaseDrop._servants, last)
    	last._master = BaseDrop
    end
    scoredata.prevSeedAmount = scoredata.seedAmount
    -- Earth, Water, Fire, Ice, Poison, Lightning, Wind, Metal
    print("end " .. tostring(scoredata.ownedCards[1]))
    
    self.shrubNames = {
    	"Verdantia Seraphlora",
    	"Etheria Aquaroot",
    	"Euphoric Emberbloom",
    	"Celestia Crystalily",
    	"Mystical Shadowvine",
    	"Luminous Glowfern",
    	"Whispering Willowspire",
    	"Arcane Shimmerthorn"
    }
    
    self.shrubDmg = {
    	{0, 10, 10, "Max"},
    	{0, 23, 30, "Max"},
    	{0, 14, 13, "Max"},
    	{0, 19, 8, "Max"},
    	{0, 25, 20, "Max"},
    	{0, 25, 32, "Max"},
    	{0, 16, 20, "Max"},
    	{0, 15, 25, "Max"},
    }
    
    self.shrubDesc = {
    	[0] = "aaa",
    	"The basic plant. \nNothing much special, but packs decent strength \nat high levels.",
    	"The water plant. \nSplish splash! A little weak, but splashes \nenemies in area.",
    	"The fire plant. \nFerocious, but small ranged. \nGreat damage but weak reach.",
    	"The ice plant. \nGood penetration when planted, but with a small \nrange. Has a circular range when equipped.",
    	"The poison plant. \nPoisons all lanes when planted, and leaves a \ntrail of poison behind when equipped.",
    	"The lightning plant. \nA strong thunder penetrates ahead when equipped \nand planted, but weakens when planted.",
    	"The wind plant. \nSlows enemies down when planted, and has \nincredible reach when equipped.",
    	"The metal plant. \nQuite dull, but is a heavy tank. \nPretty destructive on single targets.",
    }
    
    self.shrubInfoCosts = {
    	{100, 300, 350, 0}, -- prices > earth (first is buy price)
    	{150, 350, 380, 0}, -- prices > water (first is buy price)
    	{170, 375, 400, 0}, -- prices > fire (first is buy price)
    	{120, 320, 380, 0}, -- prices > ice (first is buy price)
    	{130, 340, 360, 0}, -- prices > poison (first is buy price)
    	{130, 300, 340, 0}, -- prices > lightning (first is buy price)
    	{110, 310, 340, 0}, -- prices > wind (first is buy price)
    	{130, 360, 390, 0}  -- prices > metal (first is buy price)
    } -- shrub types
    
    self.yuukaTalk = {
    	"Welcome to my stand! There's \nquite a bit of variety I'd say.",
    	"If you'd like, I could help you \nout by enhancing these things.",
    	"Honestly, it's kinda boring \nrunning this...",
    	"These shrubs are so peculiar.\nI wonder why they're all over...",
    	"The earth shrub's the most \nnatural looking one, I guess.",
    	"The water shrub's all slimy! I \nnever tried drinking it, though.",
    	"The fire shrub's pretty hot.\nBe careful not to burn yourself.",
    	"The ice shrub's super spiky.\nIt could burn you too, beware.",
    	"The poison shrub has such a\ngood smell...",
    	"The lightning shrub is tingly.\nIt's quite hard to harvest.",
    	"The wind shrub is so curvy.\nIt keeps escaping my grasp.",
    	"The metal plant is the heaviest.\nI can barely hold it."
    }
    
    self.yuukaTalkIndex = ran:Int(1, #self.yuukaTalk)
    
    if not scoredata.shrubLevelUp then scoredata.shrubLevelUp = {1, 1, 1, 1, 1, 1, 1, 1} end
end
_editor_class["Shop_Manager"].frame=function(self)
    self.class.base.frame(self)
    _set_rel_pos(self,0,0,self.rot,false)
    if BaseDrop.positionIndex == 2 then
    	if is_up_held then
    		self.selectionIndex = Wrap(self.selectionIndex - 1, 1, 17)
    		PlaySound("select00",0.1,0,false)
    	end
    	
    	if is_down_held then
    		self.selectionIndex = Wrap(self.selectionIndex + 1, 1, 17)
    		PlaySound("select00",0.1,0,false)
    	end
    	
    	if is_left_held then
    		self.selectionIndex = Wrap(self.selectionIndex - 4, 1, 17)
    		PlaySound("select00",0.1,0,false)
    	end
    	
    	if is_right_held then
    		self.selectionIndex = Wrap(self.selectionIndex + 4, 1, 17)
    		PlaySound("select00",0.1,0,false)
    	end
    	
    	if BaseDrop.x < 20 then
    		if KeyIsPressed"shoot" then
    			if scoredata.seedAmount >= self.shrubInfoCosts[Wrap(self.selectionIndex, 1, 9)][1] then
    				scoredata.ownedCards[Wrap(self.selectionIndex, 1, 9)] = scoredata.ownedCards[Wrap(self.selectionIndex, 1, 9)] + 1
    				scoredata.seedAmount = scoredata.seedAmount - self.shrubInfoCosts[Wrap(self.selectionIndex, 1, 9)][1]
    				scoredata.prevSeedAmount = scoredata.seedAmount
    				PlaySound("ok00",0.1,0,false)
    				PlaySound("astralup",0.8,0,false)
    				PlaySound("nice",0.8,0,false)
    				PlaySound("item01",0.8,0,false)
    			else
    				PlaySound("invalid", 0.1, 0, false)
    			end
    		end
    		if KeyIsPressed"special" and scoredata.shrubLevelUp[Wrap(self.selectionIndex, 1, 9)] < 3 then
    			if scoredata.seedAmount >= self.shrubInfoCosts[Wrap(self.selectionIndex, 1, 9)][scoredata.shrubLevelUp[Wrap(self.selectionIndex, 1, 9)] + 1] then
    				scoredata.shrubLevelUp[Wrap(self.selectionIndex, 1, 9)] = scoredata.shrubLevelUp[Wrap(self.selectionIndex, 1, 9)] + 1
    				scoredata.seedAmount = scoredata.seedAmount - self.shrubInfoCosts[Wrap(self.selectionIndex, 1, 9)][scoredata.shrubLevelUp[Wrap(self.selectionIndex, 1, 9)]]
    				scoredata.prevSeedAmount = scoredata.seedAmount
    				PlaySound("ok00",0.1,0,false)
    				PlaySound("astralup",0.8,0,false)
    				PlaySound("nice",0.8,0,false)
    				PlaySound("item01",0.8,0,false)
    			else
    				PlaySound("invalid", 0.1, 0, false)
    			end
    		end
    	end
    	
    	if KeyIsPressed"spell" then
    		BaseDrop.positionIndex = 1
    		PlaySound("cancel00",0.1,0,false)
    	end
    end
    
    if self.timer % (60*10) == 0 then
    	self.yuukaTalkIndex = ran:Int(1, #self.yuukaTalk)
    end
    
end
_editor_class["Shop_Manager"].render=function(self)
    SetViewMode'ui'
    self.class.base.render(self)
     Render("image:ShopBoard", self.x + 240, self.y + 240, 0, self.hscale, self.vscale)
    
    local offsetX = 0;
    local offsetY = 0;
    
    for i = 1, 16 do
    	if self.selectionIndex == i then
    		self.slotCardOffset[i] = LerpDecel(self.slotCardOffset[i], 20, 0.3)	
    	else
    		self.slotCardOffset[i] = LerpDecel(self.slotCardOffset[i], 0, 0.3)	
    	end
    end
    
    for i = 1, 8 do
    	if i <= 4 then offsetX = 0; offsetY = 0 else offsetX = 100; offsetY = -400; end
    	if self.selectionIndex == i then
    		SetImageState("image:ShopSlotSeller", "", Color(255, 255, 255, 255))
    		SetImageState("image:ShrubsCards" .. i, "", Color(255, 255, 255, 255))
    		Render("image:ShopSlotSeller", self.x + 82 + offsetX, self.y + 380 - (100 * (i - 1)) - offsetY, 0, self.hscale, self.vscale)
    		Render("image:ShrubsCards" .. i, self.x + 82 + offsetX, self.y + 380 - (100 * (i - 1)) - offsetY - 20 + self.slotCardOffset[i], 0, self.hscale - 0.2, self.vscale - 0.2)
    	else
    		SetImageState("image:ShopSlotSeller", "", Color(255, 100, 100, 100))
    		SetImageState("image:ShrubsCards" .. i, "", Color(255, 100, 100, 100))
    		Render("image:ShopSlotSeller", self.x + 82 + offsetX, self.y + 380 - (100 * (i - 1)) - offsetY, self.hscale, self.vscale)
    		Render("image:ShrubsCards" .. i, self.x + 82 + offsetX, self.y + 380 - (100 * (i - 1)) - offsetY - 20 + self.slotCardOffset[i], 0, self.hscale - 0.2, self.vscale - 0.2)
    	end
    	
    end
    
    for i = 1, 8 do
    	if i <= 4 then offsetX = 200; offsetY = 0 else offsetX = 300; offsetY = -400; end
    	if self.selectionIndex == i+8 then
    		SetImageState("image:ShopSlot", "", Color(255, 255, 255, 255))
    		SetImageState("image:ShrubsCardsAlt" .. i, "", Color(255, 255, 255, 255))
    		SetImageState("image:ShrubsCardsGray" .. i, "", Color(255, 255, 255, 255))
    		Render("image:ShopSlot", self.x + 100 + offsetX, self.y + 380 - (100 * (i - 1)) - offsetY, 0, self.hscale, self.vscale)
    		if scoredata.ownedCards[i] > 0 then
    			Render("image:ShrubsCardsAlt" .. i, self.x + 100 + offsetX, self.y + 380 - (100 * (i - 1)) - offsetY - 20 + self.slotCardOffset[i+8], 0, self.hscale - 0.2, self.vscale - 0.2)
    		else
    			Render("image:ShrubsCardsGray" .. i, self.x + 100 + offsetX, self.y + 380 - (100 * (i - 1)) - offsetY - 20 + self.slotCardOffset[i+8], 0, self.hscale - 0.2, self.vscale - 0.2)
    		end
    		SetFontState("font:trocchi", "", Color(255, 255, 255, 255))
    		RenderText("font:trocchi", "x" .. tostring(scoredata.ownedCards[i]), self.x + 98 + offsetX + 20, self.y + 380 - (100 * (i - 1)) - offsetY - 20 + self.slotCardOffset[i+8] + 60, self.hscale - 0.2, 2)
    	else
    		SetImageState("image:ShopSlot", "", Color(255, 100, 100, 100))
    		SetImageState("image:ShrubsCardsAlt" .. i, "", Color(255, 100, 100, 100))
    		SetImageState("image:ShrubsCardsGray" .. i, "", Color(255, 100, 100, 100))
    		Render("image:ShopSlot", self.x + 98 + offsetX, self.y + 380 - (100 * (i - 1)) - offsetY, 0, self.hscale, self.vscale)
    		if scoredata.ownedCards[i] > 0 then
    			Render("image:ShrubsCardsAlt" .. i, self.x + 98 + offsetX, self.y + 380 - (100 * (i - 1)) - offsetY - 20 + self.slotCardOffset[i+8], 0, self.hscale - 0.2, self.vscale - 0.2)
    		else
    			Render("image:ShrubsCardsGray" .. i, self.x + 98 + offsetX, self.y + 380 - (100 * (i - 1)) - offsetY - 20 + self.slotCardOffset[i+8], 0, self.hscale - 0.2, self.vscale - 0.2)
    		end
    		SetFontState("font:trocchi", "", Color(155, 255, 255, 255))
    		RenderText("font:trocchi", "x" .. tostring(scoredata.ownedCards[i]), self.x + 98 + offsetX + 20, self.y + 380 - (100 * (i - 1)) - offsetY - 20 + self.slotCardOffset[i+8] + 60, self.hscale - 0.2, 2)
    	end
    	
    end
    
    SetFontState("font:trocchi", "", Color(255, 255, 255, 255))
    RenderText("font:trocchi", "Available Shrubs", self.x + 34, self.y + 465, self.hscale - 0.2, 2)
    RenderText("font:trocchi", "Owned Shrubs", self.x + 265, self.y + 465, self.hscale - 0.2, 2)
    
    Render("image:YuukaShop", self.x + 680, self.y + 200 + (sin(self.timer) * 6), 0, self.hscale, self.vscale)
    Render("image:ShopBoardDesc", self.x + 700, self.y + 10, 0, self.hscale, self.vscale)
    
    lstg.RenderText("font:trocchi", self.shrubNames[Wrap(self.selectionIndex, 1, 9)], self.x + 670, self.y + 222, self.hscale - 0.2, 5)
    lstg.RenderText("font:trocchi",
    "Current Level: ".. scoredata.shrubLevelUp[Wrap(self.selectionIndex, 1, 9)] ..
    "\nAttack DMG: " .. self.shrubDmg[Wrap(self.selectionIndex, 1, 9)][scoredata.shrubLevelUp[Wrap(self.selectionIndex, 1, 9)]] .. "%>" .. self.shrubDmg[Wrap(self.selectionIndex, 1, 9)][scoredata.shrubLevelUp[Wrap(self.selectionIndex, 1, 9)] + 1] .. "%" ..
    "\nPress Shoot to Buy\nPress Special to Upgrade" ..
    "\n\n" .. self.shrubDesc[Wrap(self.selectionIndex, 1, 9)]
    , self.x + 500, self.y + 190, self.hscale - 0.3, 0)
    
    if (scoredata.shrubLevelUp[Wrap(self.selectionIndex, 1, 9)] < 3) then
    	SetFontState("font:trocchi","",Color(255,255,222,169))
    	lstg.RenderText("font:trocchi", "Your Seeds: " .. scoredata.seedAmount, self.x + 680, self.y + 190, self.hscale - 0.3, 0)
    	SetFontState("font:trocchi","",Color(255,255,255,255))
    	lstg.RenderText("font:trocchi",
    	"\nBuy Price: " .. self.shrubInfoCosts[Wrap(self.selectionIndex, 1, 9)][1] ..
    	"\nUpgrade Price: " .. self.shrubInfoCosts[Wrap(self.selectionIndex, 1, 9)][Clamp(scoredata.shrubLevelUp[Wrap(self.selectionIndex, 1, 9)] + 1, 1, 3)]
    	, self.x + 680, self.y + 190, self.hscale - 0.3, 0)
    else
    	SetFontState("font:trocchi","",Color(255,255,222,169))
    	lstg.RenderText("font:trocchi", "Your Seeds: " .. scoredata.seedAmount, self.x + 680, self.y + 190, self.hscale - 0.3, 0)
    	SetFontState("font:trocchi","",Color(255,255,255,255))
    	lstg.RenderText("font:trocchi",
    	"\nBuy Price: " .. self.shrubInfoCosts[Wrap(self.selectionIndex, 1, 9)][1] ..
    	"\nUpgrade Price: " .. "Max"
    	, self.x + 680, self.y + 190, self.hscale - 0.3, 0)
    end
    
    
    Render("image:YuukaTalkBox", self.x + 669, self.y + 280, 0, self.hscale, self.vscale)
    
    lstg.RenderText("font:trocchi", self.yuukaTalk[self.yuukaTalkIndex], self.x + 496, self.y + 302, self.hscale - 0.25, 0)
    SetViewMode'world'
end
_editor_class["Act_Select"]=Class(_object)
_editor_class["Act_Select"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_TOP+5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.hscale, self.vscale = 1 / 2.25, 1 / 2.25
    ActSelect = self
    self.selectionIndex = 1
    self.actText = {
    	"Tutorial",
    	"Act 1",
    	"Act 2",
    	"Act 3"
    }
    self.actShadows = {
    	{{"image:Isaki_Shadow", "image:Isaki_Highlight"}, {"image:Eternity_Shadow", "image:Eternity_Highlight"}},
    	{{"image:Reimu_Shadow", "image:Reimu_Highlight"}, {"image:Karen_Shadow", "image:Karen_Highlight"}},
    	{{"image:Kichi_Shadow", "image:Kichi_Highlight"}, {"img_void", "img_void"}},
    }
    self.actName = {
    	"Tutorial Act\nFragant Floral Poetry",
    	"Act 1\nForest Melodies Ensemble",
    	"Act 2\nBlossoming Petal Reverie",
    	"Act 3\nArboreal Echoes Mirage"
    }
    
    if not scoredata.clearCount then
    	scoredata.clearCount = {
    		{0, 0},
    		{0, 0},
    		{0, 0}
    	}
    end
    
    if not scoredata.attemptCount then
    	scoredata.attemptCount = {0, 0, 0}
    end
end
_editor_class["Act_Select"].frame=function(self)
    self.class.base.frame(self)
    _set_rel_pos(self,0,0,self.rot,false)
    if BaseDrop.positionIndex == 3 then
    	if is_up_held then
    		self.selectionIndex = Wrap(self.selectionIndex - 1, 1, 5)
    		PlaySound("select00",0.1,0,false)
    	end
    	
    	if is_down_held then
    		self.selectionIndex = Wrap(self.selectionIndex + 1, 1, 5)
    		PlaySound("select00",0.1,0,false)
    	end
    	
    	if BaseDrop.y > 470 and BaseDrop.x > 840 then
    		if KeyIsPressed"shoot" then
    			PlaySound("ok00",0.1,0,false)
    			if self.selectionIndex == 1 then
    				lstg.var.equipCard = {}
    				lstg.var.plantCard = {}
    				lstg.var.equipCard[1] = 1
    				lstg.var.equipCard[2] = 1
    				for i = 1, 4 do
    					lstg.var.plantCard[i] = 0
    				end
    				lstg.var.selectedStage = ActSelect.selectionIndex
    				stage.group.Start(stage.groups['Act' .. ActSelect.selectionIndex - 1], 0)
    			else
    				if self.selectionIndex == 2 then
    					BaseDrop.positionIndex = 4
    				elseif self.selectionIndex == 3 then
    					if (scoredata.clearCount[1][1] + scoredata.clearCount[1][2]) >= 2 then
    						BaseDrop.positionIndex = 4
    					else
    					 	PlaySound("invalid",0.1,0,false)
    					end
    				elseif self.selectionIndex == 4 then
    					if (scoredata.clearCount[2][1] + scoredata.clearCount[2][2]) >= 2 then
    						BaseDrop.positionIndex = 4
    					else
    					 	PlaySound("invalid",0.1,0,false)
    					end
    				end
    			end
    			
    		end
    	end
    	
    	if KeyIsPressed"spell" then
    		BaseDrop.positionIndex = 1
    		PlaySound("cancel00",0.1,0,false)
    	end
    end
end
_editor_class["Act_Select"].render=function(self)
    SetViewMode'ui'
    self.class.base.render(self)
    Render("image:TitleShadowCircle", self.x, self.y - 480 * 1.5, self.timer * 0.1, self.hscale, self.vscale)
    Render("image:TitleShadowCircle", self.x - 853, self.y - 480 * 1.5, self.timer * -0.1, self.hscale, self.vscale)
    Render("image:TitleShadowCircle", self.x + 853, self.y - 480 * 1.5, self.timer * -0.1, self.hscale, self.vscale)
    
    Render("image:ActSelectShadow", self.x - 743, self.y - 240, 0, self.hscale + 0.1, self.vscale)
    Render("image:ActSelectRibbon", self.x - 743, self.y - 50  + (sin(self.timer) * 6), 0, self.hscale, self.vscale)
    Render("image:ActSelectRibbon", self.x - 743, self.y + 50 - 480  - (sin(self.timer) * 6), 180, self.hscale, self.vscale)
    
    for i = 1, 4 do
    	if self.selectionIndex == i then
    		SetFontState("font:trocchi", "", Color(255,255,255,255))
    		lstg.RenderText("font:trocchi", self.actText[i], self.x - 743, self.y - 240 - (60 * i) + (35 * 4.3), self.hscale - 0.15, 5)
    	else
    		SetFontState("font:trocchi", "", Color(200,155,155,155))
    		lstg.RenderText("font:trocchi", self.actText[i], self.x - 743, self.y - 240 - (60 * i) + (35 * 4.3), self.hscale - 0.15, 5)
    	end
    	
    end
    
    SetFontState("font:trocchi", "", Color(255,255,255,255))
    if not scoredata.hiscore then scoredata.hiscore = {} end
    if self.selectionIndex > 1 then
    	lstg.RenderText("font:trocchi",
    	"Attempt Times\n" .. scoredata.attemptCount[self.selectionIndex-1] ..
    	"\nClear Times\n" .. (scoredata.clearCount[self.selectionIndex-1][1] + scoredata.clearCount[self.selectionIndex-1][2]) ..
    	"\nHigh Score\n" .. (scoredata.hiscore["Scene@Act" .. self.selectionIndex-1 .. "@Marisa"] or 0)
    	, self.x - 120, self.y - 100, self.hscale - 0.25, 5)
    
    	if scoredata.clearCount[self.selectionIndex-1][1] > 0 then
    		Render(self.actShadows[self.selectionIndex-1][1][2], self.x - 420, self.y - 240 + (sin(self.timer) * 6), 0, self.hscale, self.vscale)
    	else
    		Render(self.actShadows[self.selectionIndex-1][1][1], self.x - 420, self.y - 240 + (sin(self.timer) * 6), 0, self.hscale, self.vscale)
    	end
    	
    	if scoredata.clearCount[self.selectionIndex-1][2] > 0 then
    		Render(self.actShadows[self.selectionIndex-1][2][2], self.x - 380, self.y - 240 + (sin(self.timer) * 6), 0, self.hscale, self.vscale)
    	else
    		Render(self.actShadows[self.selectionIndex-1][2][1], self.x - 380, self.y - 240 + (sin(self.timer) * 6), 0, self.hscale, self.vscale)
    	end
    end
    
    lstg.RenderText("font:trocchi", self.actName[self.selectionIndex], self.x - 420, self.y - 340 + (sin(self.timer) * 6), self.hscale - 0.15, 5)
    SetViewMode'world'
end
_editor_class["Loadout_Select"]=Class(_object)
_editor_class["Loadout_Select"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_TOP+5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.hscale, self.vscale = 1 / 2.25, 1 / 2.25
    self.selectionIndex = 1
    self.selections = {
    	"Start Scene",
    	"Equip Shrub",
    	"Plant Shrub"
    }
    self.menuType = 1
    self.inputDelay = 0
    self.selectionIndexInventory = 1
    self.selectionIndexEquip = 1
    self.selectionIndexPlant = 1
    self.equippedPlants = {0, 0}
    self.plantedPlants = {0, 0, 0, 0, 0, 0, 0, 0}
    self.slotCardOffsetEquip = {0, 0}
    self.slotCardOffsetInventory = {0, 0, 0, 0, 0, 0, 0, 0}
    self.slotCardOffsetPlant = {0, 0, 0, 0, 0, 0}
    self.takeOff = false
    self.wiglerp = 0
    SetImageState("image:arml", "", Color(255,255,255,255))
    SetImageState("image:armr", "", Color(255,255,255,255))
    SetImageState("image:broom", "", Color(255,255,255,255))
    SetImageState("image:hat", "", Color(255,255,255,255))
    SetImageState("image:hattop", "", Color(255,255,255,255))
    SetImageState("image:legl", "", Color(255,255,255,255))
    SetImageState("image:legr", "", Color(255,255,255,255))
    SetImageState("image:skirt", "", Color(255,255,255,255))
    SetImageState("image:torso", "", Color(255,255,255,255))
    for i = 1, MarisaWigNode do
    	SetImageState("image:wig" .. i, "", Color(255,255,255,255))
    end
end
_editor_class["Loadout_Select"].frame=function(self)
    self.class.base.frame(self)
    _set_rel_pos(self,0,0,self.rot,false)
    if BaseDrop.positionIndex == 4 then
    	if self.menuType == 1 then -- Main selections ----------------
    		if is_up_held then
    			self.selectionIndex = Wrap(self.selectionIndex - 1, 1, 4)
    			PlaySound("select00",0.1,0,false)
    		end
    		
    		if is_down_held then
    			self.selectionIndex = Wrap(self.selectionIndex + 1, 1, 4)
    			PlaySound("select00",0.1,0,false)
    		end
    		
    		if BaseDrop.x < 20 then
    			if KeyIsPressed"shoot" then
    				if self.selectionIndex == 1 then
    					lstg.var.equipCard = {}
    					lstg.var.plantCard = {}
    					lstg.var.equipCard[1] = self.equippedPlants[1]
    					lstg.var.equipCard[2] = self.equippedPlants[2]
    					for i = 1, #self.plantedPlants do
    						lstg.var.plantCard[i] = self.plantedPlants[i]
    					end
    					lstg.var.selectedStage = ActSelect.selectionIndex
    					scoredata.attemptCount[ActSelect.selectionIndex - 1] = scoredata.attemptCount[ActSelect.selectionIndex - 1] + 1
    					stage.group.Start(stage.groups['Act' .. ActSelect.selectionIndex - 1], 0)
    				elseif self.selectionIndex == 2 then
    					self.menuType = 2
    				elseif self.selectionIndex == 3 then
    					self.menuType = 3
    				end
    				self.inputDelay = 5
    				PlaySound("ok00",0.1,0,false)
    			end
    		end
    		
    		if KeyIsPressed"spell" then
    			BaseDrop.positionIndex = 3
    			PlaySound("cancel00",0.1,0,false)
    		end
    	end
    	
    	------------------------------------------------------------------------
    	
    	if self.menuType == 2 then -- Equip shrubs ----------------
    		if is_left_held then
    			self.selectionIndexEquip = Wrap(self.selectionIndexEquip - 1, 1, 3)
    			PlaySound("select00",0.1,0,false)
    		end
    		
    		if is_right_held then
    			self.selectionIndexEquip = Wrap(self.selectionIndexEquip + 1, 1, 3)
    			PlaySound("select00",0.1,0,false)
    		end
    		
    		if KeyIsPressed"shoot" and self.inputDelay <= 0 then
    			self.menuType = 4
    			self.menuSlot = self.selectionIndexEquip
    			self.lastMenu = 2
    			self.inputDelay = 5
    			PlaySound("ok00",0.1,0,false)
    		end
    		
    		if KeyIsPressed"spell" then
    			self.menuType = 1
    			PlaySound("cancel00",0.1,0,false)
    		end
    	end
    	
    	------------------------------------------------------------------------
    	
    	if self.menuType == 3 then -- Plant shrubs ----------------
    		if is_left_held then
    			if ActSelect.selectionIndex == 1 or ActSelect.selectionIndex == 2 then
    				self.selectionIndexPlant = Wrap(self.selectionIndexPlant - 1, 1, 5)
    			elseif ActSelect.selectionIndex == 3 then
    				self.selectionIndexPlant = Wrap(self.selectionIndexPlant - 1, 1, 6)
    			elseif ActSelect.selectionIndex == 4 then
    				self.selectionIndexPlant = Wrap(self.selectionIndexPlant - 1, 1, 7)
    			end
    			PlaySound("select00",0.1,0,false)
    		end
    		
    		if is_right_held then
    			if ActSelect.selectionIndex == 1 or ActSelect.selectionIndex == 2 then
    				self.selectionIndexPlant = Wrap(self.selectionIndexPlant + 1, 1, 5)
    			elseif ActSelect.selectionIndex == 3 then
    				self.selectionIndexPlant = Wrap(self.selectionIndexPlant + 1, 1, 6)
    			elseif ActSelect.selectionIndex == 4 then
    				self.selectionIndexPlant = Wrap(self.selectionIndexPlant + 1, 1, 7)
    			end
    			PlaySound("select00",0.1,0,false)
    		end
    		
    		if KeyIsPressed"shoot" and self.inputDelay <= 0 then
    			self.menuType = 4
    			self.menuSlot = self.selectionIndexPlant
    			self.lastMenu = 3
    			self.inputDelay = 5
    			PlaySound("ok00",0.1,0,false)
    		end
    		
    		if KeyIsPressed"spell" then
    			self.menuType = 1
    			PlaySound("cancel00",0.1,0,false)
    		end
    	end
    	
    	------------------------------------------------------------------------
    	
    	if self.menuType == 4 then -- Inventory ----------------
    		if is_left_held then
    			self.selectionIndexInventory = Wrap(self.selectionIndexInventory - 1, 1, 9)
    			PlaySound("select00",0.1,0,false)
    		end
    		
    		if is_right_held then
    			self.selectionIndexInventory = Wrap(self.selectionIndexInventory + 1, 1, 9)
    			PlaySound("select00",0.1,0,false)
    		end
    		
    		if KeyIsPressed"shoot" and self.inputDelay <= 0 then
    			if scoredata.ownedCards[self.selectionIndexInventory] > 0 or (self.plantedPlants[self.selectionIndexPlant] == self.selectionIndexInventory and self.lastMenu == 3) or (self.equippedPlants[self.selectionIndexEquip] == self.selectionIndexInventory and self.lastMenu == 2) then
    				if self.lastMenu == 2 then
    					if self.equippedPlants[self.selectionIndexEquip] > 0 then
    						scoredata.ownedCards[self.equippedPlants[self.selectionIndexEquip]] = scoredata.ownedCards[self.equippedPlants[self.selectionIndexEquip]] + 1
    						if self.equippedPlants[self.selectionIndexEquip] == self.selectionIndexInventory then
    							self.equippedPlants[self.selectionIndexEquip] = 0
    							self.takeOff = true
    						end
    					end
    					if self.equippedPlants[self.selectionIndexEquip] ~= self.selectionIndexInventory and self.takeOff == false then
    						self.equippedPlants[self.selectionIndexEquip] = self.selectionIndexInventory
    						scoredata.ownedCards[self.selectionIndexInventory] = scoredata.ownedCards[self.selectionIndexInventory] - 1
    					else
    						self.equippedPlants[self.selectionIndexEquip] = 0
    					end
    					
    				end
    				if self.lastMenu == 3 then
    					if self.plantedPlants[self.selectionIndexPlant] > 0 then
    						scoredata.ownedCards[self.plantedPlants[self.selectionIndexPlant]] = scoredata.ownedCards[self.plantedPlants[self.selectionIndexPlant]] + 1
    						if self.plantedPlants[self.selectionIndexPlant] == self.selectionIndexInventory then
    							self.plantedPlants[self.selectionIndexPlant] = 0
    							self.takeOff = true
    						end
    					end
    					if self.plantedPlants[self.selectionIndexPlant] ~= self.selectionIndexInventory and self.takeOff == false then
    						self.plantedPlants[self.selectionIndexPlant] = self.selectionIndexInventory
    						scoredata.ownedCards[self.selectionIndexInventory] = scoredata.ownedCards[self.selectionIndexInventory] - 1
    					else
    						self.plantedPlants[self.selectionIndexPlant] = 0
    					end
    					
    				end
    				self.menuType = self.lastMenu
    				PlaySound("ok00",0.1,0,false)
    				self.takeOff = false
    			else
    				PlaySound("invalid",0.1,0,false)
    			end
    			self.inputDelay = 5
    		end
    		
    		if KeyIsPressed"spell" then
    			self.menuType = self.lastMenu
    			PlaySound("cancel00",0.1,0,false)
    		end
    	end
    	
    end
    
    self.inputDelay = self.inputDelay - 1
end
_editor_class["Loadout_Select"].render=function(self)
    SetViewMode'ui'
    self.class.base.render(self)
    SetImageState("image:Marisa_1", "", Color(255,255,255,255))
    
    Render("image:Marisa_1", self.x + 853/2, self.y - 280 + (sin(self.timer) * 6), 0, self.hscale - 0.29, self.vscale - 0.29)
    
    Render("image:InventoryBoard", self.x + 400, self.y - 405, 0, self.hscale, self.vscale)
    Render("image:EquippedBoard", self.x + 120, self.y - 260, 0, self.hscale, self.vscale)
    Render("image:PlantedBoard", self.x + 690, self.y - 160, 0, self.hscale, self.vscale)
    
    self.mPos = {}
    self.mPos.x = 690
    self.mPos.y = 130 - (sin(self.timer) * 3)
    Render("image:legl",   self.x - 4 + self.mPos.x, self.y - 16 - self.mPos.y,  0 - (sin(self.timer) * 6),     self.hscale - 0.2, self.vscale - 0.2)
    Render("image:legr",   self.x + 4 + self.mPos.x, self.y - 16 - self.mPos.y,  0 + (sin(self.timer) * 6),     self.hscale - 0.2, self.vscale - 0.2)
    Render("image:broom",  self.x + self.mPos.x,     self.y - 14 - self.mPos.y,  0,                             self.hscale - 0.2, self.vscale - 0.2)
    Render("image:torso",  self.x + self.mPos.x,     self.y - 12 - self.mPos.y,  0,                             self.hscale - 0.2, self.vscale - 0.2)
    Render("image:arml",   self.x - 5 + self.mPos.x, self.y - 4 - self.mPos.y,  0,                             self.hscale - 0.2, self.vscale - 0.2)
    Render("image:armr",   self.x + 5 + self.mPos.x, self.y - 4 - self.mPos.y,  0,                             self.hscale - 0.2, self.vscale - 0.2)
    Render("image:skirt",  self.x + self.mPos.x,     self.y - 16 - self.mPos.y,  0 + (sin(self.timer * 3) * 8), self.hscale - 0.2, self.vscale - 0.2)
    --Render("image:hair",   self.x + self.mPos.x,     self.y + 10 - self.mPos.y, 0 + (sin(self.timer * 6) * 6), self.hscale - 0.2, self.vscale - 0.2)
    
    local n = MarisaWigNode
    local wigsizew, wigsizeh = 72 * self.hscale * 0.65, 168 * self.vscale * 0.65
    local anchor = Vector(0,18) + Vector.fromAngle(-90+self.wiglerp) * 29 * self.hscale
    local wigflow, wigspeed, wigstrength, wigstrengthmove, wigmove = 40, 5, 60, 16, 2
    local pos = Vector(0,0)
    local prevpos = Vector(0,0)
    local prevnormal = Vector(-1,0)
    local prevang = -90 - 5 * self.wiglerp
    local ang = 0
    for i=1,n do
    	local t = i/n
    	local fxt = 1-math.pow(1-t,2)
    	local wigstr = LerpDecel(wigstrength/n,wigstrengthmove/n,math.abs(self.wiglerp))
    	ang = prevang + fxt * wigstr * sin(fxt * wigflow + self.timer * wigspeed)
    	ang = ang + wigmove * self.wiglerp * fxt
    	local pos = prevpos + wigsizeh/n * Vector.fromAngle(ang)
    	local off = (pos-prevpos).normalized
    	local normal = off:perpendicular()
    	local finalpos = Vector(self.x + self.mPos.x,self.y + 10 - self.mPos.y) + anchor + pos
    	local finalprev = Vector(self.x + self.mPos.x,self.y + 10 - self.mPos.y) + anchor + prevpos
    	
    	local vlt = finalprev - prevnormal * wigsizew
    	local vrt = finalprev + prevnormal * wigsizew
    	local vrb = finalpos  + normal * wigsizew
    	local vlb = finalpos  - normal * wigsizew
    	Render4V("image:wig"..i,
    			vlt.x, vlt.y,0,
    			vrt.x, vrt.y,0,
    			vrb.x, vrb.y,0,
    			vlb.x, vlb.y,0)
    	
    	prevpos = pos
    	prevnormal = normal
    	prevang = ang
    end
    
    Render("image:hat",    self.x + self.mPos.x,     self.y + 14 - self.mPos.y, 0,                             self.hscale - 0.2, self.vscale - 0.2)
    Render("image:hattop", self.x + self.mPos.x,     self.y + 24 - self.mPos.y, 0 + (sin(self.timer) * 10),    self.hscale - 0.2, self.vscale - 0.2)
    
    SetImageState("image:ShopSlotSeller", "", Color(255, 255, 255, 255))
    if (ActSelect.selectionIndex == 1) then
    	for i = 1, 4 do
    		if self.selectionIndexPlant == i and self.menuType == 3 then
    			self.slotCardOffsetPlant[i] = LerpDecel(self.slotCardOffsetPlant[i], 20, 0.3)	
    			SetImageState("image:ShopSlotSeller", "", Color(255, 255, 255, 255))
    			if self.plantedPlants[i] > 0 then SetImageState("image:ShrubsCards" .. self.plantedPlants[i], "", Color(255, 255, 255, 255)) end
    		else
    			self.slotCardOffsetPlant[i] = LerpDecel(self.slotCardOffsetPlant[i], 0, 0.3)	
    			SetImageState("image:ShopSlotSeller", "", Color(255, 100, 100, 100))
    			if self.plantedPlants[i] > 0 then SetImageState("image:ShrubsCards" .. self.plantedPlants[i], "", Color(255, 100, 100, 100)) end
    		end
    		Render("image:ShopSlotSeller", self.x + 560 + 40 + ((i - 1) * 60), self.y - 250, 0, self.hscale - 0.2, self.vscale - 0.2)
    		if self.plantedPlants[i] > 0 then Render("image:ShrubsCards" .. self.plantedPlants[i], self.x + 560 + 40 + ((i - 1) * 60), self.y - 270 + self.slotCardOffsetPlant[i], 0, self.hscale - 0.3, self.vscale - 0.3) end
    	end
    end
    if (ActSelect.selectionIndex == 2) then
    	for i = 1, 4 do
    		if self.selectionIndexPlant == i and self.menuType == 3 then
    			self.slotCardOffsetPlant[i] = LerpDecel(self.slotCardOffsetPlant[i], 20, 0.3)
    			SetImageState("image:ShopSlotSeller", "", Color(255, 255, 255, 255))
    			if self.plantedPlants[i] > 0 then SetImageState("image:ShrubsCards" .. self.plantedPlants[i], "", Color(255, 255, 255, 255)) end
    		else
    			self.slotCardOffsetPlant[i] = LerpDecel(self.slotCardOffsetPlant[i], 0, 0.3)	
    			SetImageState("image:ShopSlotSeller", "", Color(255, 100, 100, 100))
    			if self.plantedPlants[i] > 0 then SetImageState("image:ShrubsCards" .. self.plantedPlants[i], "", Color(255, 100, 100, 100)) end
    		end
    		Render("image:ShopSlotSeller", self.x + 560 + 40 + ((i - 1) * 60), self.y - 250, 0, self.hscale - 0.2, self.vscale - 0.2)
    		if self.plantedPlants[i] > 0 then Render("image:ShrubsCards" .. self.plantedPlants[i], self.x + 560 + 40 + ((i - 1) * 60), self.y - 270 + self.slotCardOffsetPlant[i], 0, self.hscale - 0.3, self.vscale - 0.3) end
    	end
    end
    if (ActSelect.selectionIndex == 3) then
    	for i = 1, 5 do
    		if self.selectionIndexPlant == i and self.menuType == 3 then
    			self.slotCardOffsetPlant[i] = LerpDecel(self.slotCardOffsetPlant[i], 20, 0.3)
    			SetImageState("image:ShopSlotSeller", "", Color(255, 255, 255, 255))
    			if self.plantedPlants[i] > 0 then SetImageState("image:ShrubsCards" .. self.plantedPlants[i], "", Color(255, 255, 255, 255)) end
    		else
    			self.slotCardOffsetPlant[i] = LerpDecel(self.slotCardOffsetPlant[i], 0, 0.3)
    			SetImageState("image:ShopSlotSeller", "", Color(255, 100, 100, 100))
    			if self.plantedPlants[i] > 0 then SetImageState("image:ShrubsCards" .. self.plantedPlants[i], "", Color(255, 100, 100, 100)) end
    		end
    		Render("image:ShopSlotSeller", self.x + 560 + 40 + ((i - 1) * 45), self.y - 250, 0, self.hscale - 0.2, self.vscale - 0.2)
    		if self.plantedPlants[i] > 0 then Render("image:ShrubsCards" .. self.plantedPlants[i], self.x + 560 + 40 + ((i - 1) * 45), self.y - 270 + self.slotCardOffsetPlant[i], 0, self.hscale - 0.3, self.vscale - 0.3) end
    	end
    end
    if (ActSelect.selectionIndex == 4) then
    	for i = 1, 6 do
    		if self.selectionIndexPlant == i and self.menuType == 3 then
    			self.slotCardOffsetPlant[i] = LerpDecel(self.slotCardOffsetPlant[i], 20, 0.3)
    			SetImageState("image:ShopSlotSeller", "", Color(255, 255, 255, 255))
    			if self.plantedPlants[i] > 0 then SetImageState("image:ShrubsCards" .. self.plantedPlants[i], "", Color(255, 255, 255, 255)) end
    		else
    			self.slotCardOffsetPlant[i] = LerpDecel(self.slotCardOffsetPlant[i], 0, 0.3)
    			SetImageState("image:ShopSlotSeller", "", Color(255, 100, 100, 100))
    			if self.plantedPlants[i] > 0 then SetImageState("image:ShrubsCards" .. self.plantedPlants[i], "", Color(255, 100, 100, 100)) end
    		end
    		Render("image:ShopSlotSeller", self.x + 560 + 40 + ((i - 1) * 36), self.y - 250, 0, self.hscale - 0.2, self.vscale - 0.2)
    		if self.plantedPlants[i] > 0 then Render("image:ShrubsCards" .. self.plantedPlants[i], self.x + 560 + 40 + ((i - 1) * 36), self.y - 270 + self.slotCardOffsetPlant[i], 0, self.hscale - 0.3, self.vscale - 0.3) end
    	end
    end
    
    lstg.RenderText("font:trocchi", "Equipped", self.x + 120, self.y - 217, self.hscale - 0.2, 5)
    lstg.RenderText("font:trocchi", "Inventory", self.x + 400, self.y - 352, self.hscale - 0.2, 5)
    lstg.RenderText("font:trocchi", "Field Shrubs", self.x + 690, self.y - 70, self.hscale - 0.2, 5)
    
    for i = 1, 3 do
    	if self.selectionIndex == i and self.menuType == 1 then
    		SetFontState("font:trocchi", "", Color(255,255,255,255))
    		lstg.RenderText("font:trocchi", self.selections[i], self.x + 40, self.y - (40 * i), self.hscale - 0.15, 0)
    	else
    		SetFontState("font:trocchi", "", Color(155,155,155,155))
    		lstg.RenderText("font:trocchi", self.selections[i], self.x + 40, self.y - (40 * i), self.hscale - 0.15, 0)
    	end
    end
    
    for i = 1, 8 do
    	if self.selectionIndexInventory == i and self.menuType == 4 then
    		self.slotCardOffsetInventory[i] = LerpDecel(self.slotCardOffsetInventory[i], 20, 0.3)	
    		SetImageState("image:ShrubsCards" .. i, "", Color(255, 255, 255, 255))
    		SetImageState("image:ShopSlot", "", Color(255, 255, 255, 255))
    		SetFontState("font:trocchi", "", Color(255,255,255,255))
    	else
    		self.slotCardOffsetInventory[i] = LerpDecel(self.slotCardOffsetInventory[i], 0, 0.3)	
    		SetImageState("image:ShrubsCards" .. i, "", Color(255, 100, 100, 100))
    		SetImageState("image:ShopSlot", "", Color(255, 100, 100, 100))
    		SetFontState("font:trocchi", "", Color(155,155,155,155))
    	end
    	Render("image:ShopSlot", self.x + 40 + (i * 80), self.y - 410, 0, self.hscale - 0.1, self.vscale - 0.1)
    	Render("image:ShrubsCards" .. i, self.x + 40 + (i * 80), self.y - 430 + self.slotCardOffsetInventory[i], 0, self.hscale - 0.235, self.vscale - 0.235)
    	lstg.RenderText("font:trocchi", "x" .. scoredata.ownedCards[i], self.x + 58 + (i * 80), self.y - 364 + self.slotCardOffsetInventory[i], self.hscale - 0.15, 0)
    end
    
    for i = 1, 2 do
    	if self.selectionIndexEquip == i and self.menuType == 2 then
    		self.slotCardOffsetEquip[i] = LerpDecel(self.slotCardOffsetEquip[i], 20, 0.3)	
    		SetImageState("image:ShopSlot", "", Color(255, 255, 255, 255))
    	else
    		self.slotCardOffsetEquip[i] = LerpDecel(self.slotCardOffsetEquip[i], 0, 0.3)	
    		SetImageState("image:ShopSlot", "", Color(255, 100, 100, 100))
    	end
    	Render("image:ShopSlot", self.x + 45 + (i * 50), self.y - 265, 0, self.hscale - 0.2, self.vscale - 0.2)
    	if self.equippedPlants[i] > 0 then
    		if self.selectionIndexEquip == i and self.menuType == 2 then
    			SetImageState("image:ShrubsCards" .. self.equippedPlants[i], "", Color(255, 255, 255, 255))
    		else
    			SetImageState("image:ShrubsCards" .. self.equippedPlants[i], "", Color(255, 100, 100, 100))
    		end
    		Render("image:ShrubsCards" .. self.equippedPlants[i], self.x + 45 + (i * 50), self.y - 285 + self.slotCardOffsetEquip[i], 0, self.hscale - 0.3, self.vscale - 0.3)
    	end
    end
    
    SetViewMode'world'
end
_editor_class["Blackout_Overlay"]=Class(_object)
_editor_class["Blackout_Overlay"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="white"
    self.layer=LAYER_TOP+99
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.hscale, self.vscale = 853, 480
    if lstg.var.skipIntro then
        _object.set_color(self,"",0,0,0,0)
    else
        _object.set_color(self,"",255,0,0,0)
    end
    self.turnOff = false
    self.alp = 255
    lstg.var.skipIntro = lstg.var.skipIntro or false
    self.stopRepeat = false
    lasttask=task.New(self,function()
        while self.turnOff == false do
            task._Wait(1)
        end
        do
            local _beg_alp=255 local alp=_beg_alp  local _w_alp=0 local _end_alp=0 local _d_w_alp=90/(30-1)
            for _=1,30 do
                _object.set_color(self,"",alp,0,0,0)
                self.alp = alp
                task._Wait(1)
                _w_alp=_w_alp+_d_w_alp alp=(_end_alp-_beg_alp)*sin(_w_alp)+(_beg_alp)
            end
        end
        _del(self,true)
    end)
end
_editor_class["Blackout_Overlay"].frame=function(self)
    if (KeyIsPressed"shoot" and self.turnOff == false) or (lstg.var.skipIntro == true and self.stopRepeat == false) then
        BaseDrop.positionIndex = 1
        self.turnOff = true
        lstg.var.skipIntro = true
        self.stopRepeat = true
        PlaySound("ok00",0.1,self.x/256,false)
        PlaySound("changeitem",1,self.x/256,false)
        LoadMusicRecord("bgm:TitleTheme")
        _play_music("bgm:TitleTheme")
    end
    self.class.base.frame(self)
end
_editor_class["Blackout_Overlay"].render=function(self)
    SetViewMode'ui'
    self.class.base.render(self)
    SetFontState("font:trocchi","",Color(self.alp,255,255,255))
    lstg.RenderText("font:trocchi","Press Shoot\nKey",700,240,1/2.25 - 0.2,5)
    SetFontState("font:trocchi","",Color(self.alp - 50,255,255,255))
    lstg.RenderText("font:trocchi","Touhou Project" .. "\n" ..
"Unofficial Project Shrine Maiden" .. "\n",screen.width/2, screen.height/2 + 150,1/2.25 - 0.3,5)
    lstg.RenderText("font:trocchi","This game is a work of fiction. All characters and organizations that appear have passed into fantasy." .. "\n" ..
"Please enjoy your stay." .. "\n" ..
"\n" ..
"Contact info within game files." .. "\n" ..
"\n" ..
"Presented by: Ryann1908, v1.0",screen.width/2, screen.height/2 - 175,1/2.25 - 0.35,5)
    SetViewMode'world'
end
_editor_class["Blackout_Fade"]=Class(_object)
_editor_class["Blackout_Fade"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="white"
    self.layer=LAYER_TOP+101
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.hscale, self.vscale = 853, 480
    _object.set_color(self,"",255,0,0,0)
    self.turnOff = false
    self.alp = 255
    lasttask=task.New(self,function()
        do
            local _beg_alp=255 local alp=_beg_alp  local _w_alp=0 local _end_alp=0 local _d_w_alp=90/(15-1)
            for _=1,15 do
                _object.set_color(self,"",alp,0,0,0)
                self.alp = alp
                task._Wait(1)
                _w_alp=_w_alp+_d_w_alp alp=(_end_alp-_beg_alp)*sin(_w_alp)+(_beg_alp)
            end
        end
        _del(self,true)
    end)
end
_editor_class["Blackout_Fade"].frame=function(self)
    self.class.base.frame(self)
end
_editor_class["Blackout_Fade"].render=function(self)
    SetViewMode'ui'
    self.class.base.render(self)
    SetViewMode'world'
end
_editor_class["UI_Manager"]=Class(_object)
_editor_class["UI_Manager"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_TOP+10
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.hscale, self.vscale = 1/2.25, 1/2.25
    lstg.var.selectedShrub = 1
    lstg.var.lifePoint = 0
    lstg.var.nextFormation = 0
    self.repeatSlot = 0
    self.nextLife = 100
    self.currentLife = 1
    self.lifeLerpPos = 0
    
    if lstg.var.selectedStage == 1 then
    	self.nextWave = 3
    elseif lstg.var.selectedStage == 2 then
    	self.nextWave = 7
    elseif lstg.var.selectedStage == 3 then
    	self.nextWave = 9
    else
    	self.nextWave = 10
    end
    
    self.lifeScores = {100, 150, 200, 250, 300, 350, 400, 450, 500, 550, 600, 650, 700, 750}
    
end
_editor_class["UI_Manager"].frame=function(self)
    if KeyIsPressed"spell" then
    	lstg.var.selectedShrub = Wrap(lstg.var.selectedShrub + 1, 1, 3)
    	PlaySound("select00",0.1,0,false)
    end
    self.nextLife = self.lifeScores[self.currentLife] - lstg.var.lifePoint
    
    if lstg.var.lifePoint >= self.lifeScores[self.currentLife] then
    	self.currentLife = self.currentLife + 1
    	lstg.var.lifePoint = 0
    	PlaySound("extend",1,0,false)
    	lstg.var.lifeleft = lstg.var.lifeleft + 1
    end
    
    self.lifeLerpPos = ( (self.nextLife - 0) / (self.lifeScores[self.currentLife] - 0) ) * (1 - 0) + 0
    self.enemyLerpPos = ( (lstg.var.nextFormation - 0) / (self.nextWave - 0) ) * (1 - 0) + 0
    self.class.base.frame(self)
end
_editor_class["UI_Manager"].render=function(self)
    SetViewMode'ui'
    self.class.base.render(self)
    --[[ --- High Score]]
    
    --[[ ]]
    
    Render("image:UIElements1",753, 440,0,self.hscale, self.vscale,0.5)
    SetFontState("font:simplymono","",Color(255,200,200,200))
    lstg.RenderText("font:simplymono",FormatScore(max(lstg.tmpvar.hiscore or 0, lstg.var.score or 0)),753, 440-25,self.hscale - 0.25,5)
    --[[ ]]
    
    --[[ --- Score]]
    
    --[[ ]]
    
    Render("image:UIElements2",753, 440-50,0,self.hscale, self.vscale,0.5)
    SetFontState("font:simplymono","",Color(255,255,255,255))
    lstg.RenderText("font:simplymono",FormatScore(lstg.var.score or 0),753, 440-50-25,self.hscale - 0.25,5)
    --[[ ]]
    
    --[[ --- Lives]]
    
    --[[ ]]
    
    Render("image:UIElements3",753, 440-100,0,self.hscale, self.vscale,0.5)
    for _=1,lstg.var.lifeleft do
        Render("image:HeartIcon",753 - (22 * (lstg.var.lifeleft - 1))/2 + (22 * (_ - 1)), 440-100-25,0,self.hscale - 0.385, self.vscale - 0.385,0.5)
    end
    --[[ ]]
    
    --[[ --- Point Item]]
    
    --[[ ]]
    
    Render("image:UIElements4",753, 440-150,0,self.hscale, self.vscale,0.5)
    SetFontState("font:simplymono","",Color(255,190,190,255))
    lstg.RenderText("font:simplymono",lstg.var.pointrate or 0,753, 440-150-25,self.hscale - 0.25,5)
    --[[ ]]
    
    --[[ --- Graze]]
    
    --[[ ]]
    
    Render("image:UIElements5",753, 440-200,0,self.hscale, self.vscale,0.5)
    SetFontState("font:simplymono","",Color(255,255,255,255))
    lstg.RenderText("font:simplymono",lstg.var.graze or 0,753, 440-200-25,self.hscale - 0.25,5)
    --[[ ]]
    
    --[[ --- Seeds]]
    
    --[[ ]]
    
    Render("image:UIElements8",753, 440-250,0,self.hscale, self.vscale,0.5)
    SetFontState("font:simplymono","",Color(255,255,230,180))
    lstg.RenderText("font:simplymono",scoredata.seedAmount,753, 440-250-25,self.hscale - 0.25,5)
    --[[ ]]
    
    --[[ --- Equipped Shrubs]]
    
    --[[ ]]
    
    Render("image:UIElements6",100, 440,0,self.hscale, self.vscale,0.5)
    SetImageState("image:ShopSlot","",Color(255,255,255,255))
    if lstg.var.selectedShrub == 1 then
        SetImageState("image:ShopSlot","",Color(255,255,255,255))
    else
        SetImageState("image:ShopSlot","",Color(255,100,100,100))
    end
    Render("image:ShopSlot",100 - 30, 440 - 50,0,self.hscale  - 0.15, self.vscale - 0.15,0.5)
    if lstg.var.selectedShrub == 2 then
        SetImageState("image:ShopSlot","",Color(255,255,255,255))
    else
        SetImageState("image:ShopSlot","",Color(255,100,100,100))
    end
    Render("image:ShopSlot",100 + 30, 440 - 50,0,self.hscale  - 0.15, self.vscale - 0.15,0.5)
    if lstg.var.equipCard[1] ~= 0 then
        if lstg.var.selectedShrub == 1 then
            SetImageState("image:ShrubsCards" .. lstg.var.equipCard[1],"",Color(255,255,255,255))
        else
            SetImageState("image:ShrubsCards" .. lstg.var.equipCard[1],"",Color(255,100,100,100))
        end
        Render("image:ShrubsCards" .. lstg.var.equipCard[1],100 - 30, 440 - 50,0,self.hscale  - 0.275, self.vscale - 0.275,0.5)
    end
    if lstg.var.equipCard[2] ~= 0 then
        if lstg.var.selectedShrub == 2 then
            SetImageState("image:ShrubsCards" .. lstg.var.equipCard[2],"",Color(255,255,255,255))
        else
            SetImageState("image:ShrubsCards" .. lstg.var.equipCard[2],"",Color(255,100,100,100))
        end
        Render("image:ShrubsCards" .. lstg.var.equipCard[2],100 + 30, 440 - 50,0,self.hscale  - 0.275, self.vscale - 0.275,0.5)
    end
    --[[ ]]
    
    --[[ --- Planted Shrubs]]
    
    --[[ ]]
    
    Render("image:UIElements7",100, 440-100,0,self.hscale, self.vscale,0.5)
    
        local offsetX = 0;
        local offsetY = 0;
        
        if lstg.var.selectedStage == 1 or lstg.var.selectedStage == 2 then
        	self.repeatSlot = 4
        elseif lstg.var.selectedStage == 3 then
        	self.repeatSlot = 5
        elseif lstg.var.selectedStage == 4 then
        	self.repeatSlot = 6
        end
        
        for i = 1, self.repeatSlot do
        	if i % 2 ~= 0 then
        		offsetX = 0
        	else
        		offsetX = 60
        	end
        	if i > 4 then
        		offsetY = 120
        	elseif i > 2 then
        		offsetY = 60
        	end
        	SetImageState("image:ShopSlotSeller", "", Color(255, 255, 255, 255))
        	Render("image:ShopSlotSeller", 70 + offsetX, 440 - 150 - offsetY, self.hscale - 0.15, self.vscale - 0.15)
        	if lstg.var.plantCard[i] ~= 0 then
        		SetImageState("image:ShrubsCards" .. lstg.var.plantCard[i], "", Color(255, 255, 255, 255))
        		Render("image:ShrubsCards" .. lstg.var.plantCard[i], 70 + offsetX, 440 - 150 - offsetY, 0, self.hscale  - 0.275, self.vscale - 0.275)
        	end
        end
    
    --[[ ]]
    
    --[[ --- Progress Bars]]
    
    --[[ ]]
    
    Render("image:LifeProgressBar",100, 440-355,0,self.hscale, self.vscale,0.5)
    SetFontState("font:trocchi","",Color(225,200,215,255))
    lstg.RenderText("font:trocchi","Next Life: " .. self.nextLife,100, 440-355,self.hscale - 0.325,5)
    Render("image:EnemyProgressBar",100, 440-395,0,self.hscale, self.vscale,0.5)
    SetFontState("font:trocchi","",Color(225,255,216,200))
    lstg.RenderText("font:trocchi","Waves Left: " .. self.nextWave - lstg.var.nextFormation,100, 440-395,self.hscale - 0.325,5)
    --[[ ]]
    
    Render("image:LifeProgressBarIndicator",math.lerp(170, 30, self.lifeLerpPos), 440-355,0,self.hscale, self.vscale,0.5)
    Render("image:EnemyProgressBarIndicator",math.lerp(30, 170, self.enemyLerpPos), 440-395,0,self.hscale, self.vscale,0.5)
    --[[ ]]
    
    --[[ --- Logo and FPS]]
    
    --[[ ]]
    
    Render("image:TitleLogo",753, 440-350 + (sin(self.timer) * 4),0,self.hscale - 0.275, self.vscale - 0.275,0.5)
    SetFontState("font:trocchi","",Color(255,255,255,255))
    lstg.RenderText("font:trocchi",string.format("%.1ffps", GetFPS()),800, 20,self.hscale - 0.3,0)
    SetViewMode'world'
end
_editor_class["Plant_Manager"]=Class(_object)
_editor_class["Plant_Manager"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_BG+5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.hscale, self.vscale = 1/2.25, 1/2.25
    lasttask=task.New(self,function()
        do
            local _h_scaling=(1-(0.8))/2 local _t_scaling=(1+(0.8))/2 local scaling=_h_scaling*sin(1)+_t_scaling local _w_scaling=1 local _d_w_scaling=2.8
            for _=1,_infinite do
                self.scaling = scaling
                task._Wait(1)
                _w_scaling=_w_scaling+_d_w_scaling scaling=_h_scaling*sin(_w_scaling)+_t_scaling
            end
        end
    end)
    PlantManager = self
    
    self.shadowColor = {
    	[0] = Color(255, 255, 255, 255),
    	Color(255, 83, 244, 147),
    	Color(255, 84, 84, 242),
    	Color(255, 239, 120, 83),
    	Color(255, 82, 216, 246),
    	Color(255, 179, 83, 239),
    	Color(255, 239, 211, 83),
    	Color(255, 160, 205, 239),
    	Color(255, 180, 176, 196),
    }
    
    self.plantShot = {
    	_editor_class["Earth_Shrub_Shot"],
    	_editor_class["Water_Shrub_Shot"],
    	_editor_class["Fire_Shrub_Shot"],
    	_editor_class["Ice_Shrub_Shot"],
    	_editor_class["Poison_Shrub_Shot"],
    	_editor_class["Lightning_Shrub_Shot"],
    	_editor_class["Wind_Shrub_Shot"],
    	_editor_class["Metal_Shrub_Shot"]
    }
    
    function self.HighlightPlant(loopAmount, plantIndex)
    	for i = 1, loopAmount do
    		if lstg.var.plantCard[i] ~= 0 then
    			if i == plantIndex then
    				SetImageState("image:ShrubsShooters" .. lstg.var.plantCard[i], "", Color(200, 255, 255, 255))
    			else
    				SetImageState("image:ShrubsShooters" .. lstg.var.plantCard[i], "", Color(100, 155, 155, 155))
    			end
    		end
    	end
    end
    
    lstg.var.highlightedPlant = 1
    
    function self.PlayerWithinRange(plantIndex)
    	if lstg.var.selectedStage == 1 or lstg.var.selectedStage == 2 then
    		if player.x > -224 and player.x < -224/2 and plantIndex == 1 then
    			lstg.var.highlightedPlant = plantIndex
    			return true
    		end
    		if player.x > -224/2 and player.x < 0 and plantIndex == 2 then
    			lstg.var.highlightedPlant = plantIndex
    			return true
    		end
    		if player.x > 0 and player.x < 224/2 and plantIndex == 3 then
    			lstg.var.highlightedPlant = plantIndex
    			return true
    		end
    		if player.x > 224/2 and player.x < 224 and plantIndex == 4 then
    			lstg.var.highlightedPlant = plantIndex
    			return true
    		end
    		return false
    	end
    	if lstg.var.selectedStage == 3 then
    		if player.x > -224 and player.x < -134 and plantIndex == 1 then
    			lstg.var.highlightedPlant = plantIndex
    			return true
    		end
    		if player.x > -134 and player.x < -44 and plantIndex == 2 then
    			lstg.var.highlightedPlant = plantIndex
    			return true
    		end
    		if player.x > -44 and player.x < 46 and plantIndex == 3 then
    			lstg.var.highlightedPlant = plantIndex
    			return true
    		end
    		if player.x > 46 and player.x < 136 and plantIndex == 4 then
    			lstg.var.highlightedPlant = plantIndex
    			return true
    		end
    		if player.x > 136 and player.x < 224 and plantIndex == 5 then
    			lstg.var.highlightedPlant = plantIndex
    			return true
    		end
    		return false
    	end
    	if lstg.var.selectedStage == 4 then
    		if player.x > -224 and player.x < -149.4 and plantIndex == 1 then
    			lstg.var.highlightedPlant = plantIndex
    			return true
    		end
    		if player.x > -149.4 and player.x < -74.8 and plantIndex == 2 then
    			lstg.var.highlightedPlant = plantIndex
    			return true
    		end
    		if player.x > -74.8 and player.x < -0.2 and plantIndex == 3 then
    			lstg.var.highlightedPlant = plantIndex
    			return true
    		end
    		if player.x > -0.2 and player.x < 74.4 and plantIndex == 4 then
    			lstg.var.highlightedPlant = plantIndex
    			return true
    		end
    		if player.x > 74.4 and player.x < 149 and plantIndex == 5 then
    			lstg.var.highlightedPlant = plantIndex
    			return true
    		end
    		if player.x > 149 and player.x < 224 and plantIndex == 6 then
    			lstg.var.highlightedPlant = plantIndex
    			return true
    		end
    		return false
    	end
    end
end
_editor_class["Plant_Manager"].frame=function(self)
    self.class.base.frame(self)
    if lstg.var.selectedStage == 1 or lstg.var.selectedStage == 2 then
    	for i = 1, 4 do
    		if lstg.var.plantCard[i] ~= 0 then
    			New(self.plantShot[lstg.var.plantCard[i]], -224 + 112/2 + (112 * (i - 1)), -240,_)
    		end
    	end
    	if self.timer % 280 == 0 and self.timer > 60*2 and lstg.var.selectedStage == 2 and player.dialog == false then
    		last=New(_editor_class["PlantEnemy"],-224 + 112/2 + (112 * ran:Int(1, 4) - 112), 240,_)
    	end
    elseif lstg.var.selectedStage == 3 then
    	for i = 1, 5 do
    		if lstg.var.plantCard[i] ~= 0 then
    			New(self.plantShot[lstg.var.plantCard[i]], -224 + 89.6/2 + (89.6 * (i - 1)), -240,_)
    		end
    	end
    	if self.timer % 260 == 0 and self.timer > 60*2 and player.dialog == false then
    		last=New(_editor_class["PlantEnemy"],-224 + 89.6/2 + (89.6 * ran:Int(1, 5) - 89.6), 240,_)
    	end
    elseif lstg.var.selectedStage == 4 then
    	for i = 1, 6 do
    		if lstg.var.plantCard[i] ~= 0 then
    			New(self.plantShot[lstg.var.plantCard[i]], -224 + 74.6/2 + (74.6 * (i - 1)), -240,_)
    		end
    	end
    	if self.timer % 240 == 0 and self.timer > 60*2 and player.dialog == false then
    		last=New(_editor_class["PlantEnemy"],-224 + 74.6/2 + (74.6 * ran:Int(1, 5) - 74.6), 240,_)
    	end
    end
end
_editor_class["Plant_Manager"].render=function(self)
    if lstg.var.selectedStage == 1 or lstg.var.selectedStage == 2 then
    	for i = 1, 4 do
    		SetImageState("image:ShrubShadow", "", self.shadowColor[lstg.var.plantCard[i]])
    		Render("image:ShrubShadow", -224 + ((i - 1) * 224/2), -224, 0, self.hscale, self.vscale)
    		self.PlayerWithinRange(i)
    		if lstg.var.plantCard[i] ~= 0 then
    			if self.PlayerWithinRange(i) then
    				SetImageState("image:ShrubsShooters" .. lstg.var.plantCard[i], "", Color(200, 255, 255, 255))
    			else
    				SetImageState("image:ShrubsShooters" .. lstg.var.plantCard[i], "", Color(100, 155, 155, 155))
    			end
    			Render("image:ShrubsShooters" .. lstg.var.plantCard[i], -224 + 224/2 + ((i - 1) * 224/2) - 2, -245, 0, self.hscale * 0.528, self.vscale * 0.528 * self.scaling)
    		end
    	end
    elseif lstg.var.selectedStage == 3 then
    	for i = 1, 5 do
    		SetImageState("image:ShrubShadow", "", self.shadowColor[lstg.var.plantCard[i]])
    		Render("image:ShrubShadow", -224 + ((i - 1) * 224/2.5), -224, 0, self.hscale - (0.2/2.25), self.vscale)
    		self.PlayerWithinRange(i)
    		if lstg.var.plantCard[i] ~= 0 then
    			if self.PlayerWithinRange(i) then
    				SetImageState("image:ShrubsShooters" .. lstg.var.plantCard[i], "", Color(200, 255, 255, 255))
    			else
    				SetImageState("image:ShrubsShooters" .. lstg.var.plantCard[i], "", Color(100, 155, 155, 155))
    			end
    			Render("image:ShrubsShooters" .. lstg.var.plantCard[i], -224 + 90 + ((i - 1) * 90) + 8, -245, 0, self.hscale * 0.528, self.vscale * 0.528 * self.scaling)
    		end
    	end
    elseif lstg.var.selectedStage == 4 then
    	for i = 1, 6 do
    		SetImageState("image:ShrubShadow", "", self.shadowColor[lstg.var.plantCard[i]])
    		Render("image:ShrubShadow", -224 + ((i - 1) * 224/3), -224, 0, self.hscale - (0.325/2.25), self.vscale)
    		self.PlayerWithinRange(i)
    		if lstg.var.plantCard[i] ~= 0 then
    			if self.PlayerWithinRange(i) then
    				SetImageState("image:ShrubsShooters" .. lstg.var.plantCard[i], "", Color(200, 255, 255, 255))
    			else
    				SetImageState("image:ShrubsShooters" .. lstg.var.plantCard[i], "", Color(100, 155, 155, 155))
    			end
    			Render("image:ShrubsShooters" .. lstg.var.plantCard[i], -224 + 74.6 + ((i - 1) * 74.6) + 17, -245, 0, self.hscale * 0.528, self.vscale * 0.528 * self.scaling)
    		end
    	end
    end
    
    self.class.base.render(self)
end
_editor_class["Stage_Sections"]=Class(_object)
_editor_class["Stage_Sections"].init=function(self,_x,_y,amount, stageIndex, forceFormation)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_TOP
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    StageManager = self
    self.hasFinished = false
    self.formationQueueNext = false
    self.formations = {
    	{1, 2, 3, 4, 5, 6},
    	{1, 2, 3, 4, 5, 6, 7, 8, 9, 10},
    	{1, 2, 3, 4, 5, 6, 11, 12, 13, 14},
    	{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18}
    }
    self.waveText = {
    	"Scarlet Slash", "Maroon Carousel", "Ginger Entanglement", "Scintillant Sparkling",
    	"Classical Dreamstrings", "Dreamy Orthodoxy", "Enchanting Wheel", "Parallel Walkaround",
    	"Scaly Admission", "Bubbling Treasures", "Linear Multiplication", "Descending Zigzagness",
    	"Crisscross Dancing", "Wavy Toxicness", "Electric Stringlaners", "Yin Yang Sutra",
    	"Maleficent Rays", "Sawmill Crushing",
    }
    lstg.var.finishStage = false
    self.lastNum = 1
    function self.finishFormation()
        self.formationQueueNext = true
        lstg.var.nextFormation = lstg.var.nextFormation + 1
    end
    function self.startFormation(formationIndex)
        last=New(_editor_class["Section_Announcer"],self.x,self.y,self.waveText[formationIndex])
        if formationIndex == 1 then
            do local posy,_d_posy=(40),(-35) for _=1,8 do
                last=New(EnemySimple,7,40,240,160 + posy,{0,3,2},1,false,true,false,function(self)
                    task.New(self,function()
                        task.BezierMoveTo(60,MOVE_DECEL,self.x - 50, self.y - 6, self.x - 80, self.y - 30)
                        task._Wait(15)
                        PlaySound("tan00",0.1,self.x/256,false)
                        last_list=_create_bullet_group(arrow_big,COLOR_RED,self.x,self.y,7,0,2,2,0,45,true,0,true,true,0,false,self)
                        task._Wait(60)
                        task.MoveTo(self.x, 260,120,MOVE_ACCEL)
                        _del(self,true)
                    end)
                end)
                last=New(EnemySimple,7,40,-240,160 + posy,{0,3,2},1,false,true,false,function(self)
                    task.New(self,function()
                        task.BezierMoveTo(60,MOVE_DECEL,self.x + 50, self.y - 6, self.x + 80, self.y - 30)
                        task._Wait(15)
                        PlaySound("tan00",0.1,self.x/256,false)
                        last_list=_create_bullet_group(arrow_big,COLOR_RED,self.x,self.y,6,0,2,2,0,45,true,0,true,true,0,false,self)
                        task._Wait(60)
                        task.MoveTo(self.x, 260,120,MOVE_ACCEL)
                        _del(self,true)
                    end)
                end)
                task._Wait(15)
            posy=posy+_d_posy end end
            last=New(EnemySimple,14,120,0, 240,{0,5,3},1,false,true,false,function(self)
                task.New(self,function()
                    task.MoveTo(0,120,60,MOVE_DECEL)
                    for _=1,5 do
                        PlaySound("kira00",0.1,self.x/256,false)
                        do local a,_d_a=(Angle(self, player)),(360/15) for _=1,15 do
                            last_list=_create_bullet_group(ball_mid_c,COLOR_RED,self.x + 25 * cos(a),self.y + 25 * sin(a),3,0,3,3,a,15,false,0,true,true,0,false,self)
                            last_list=_create_bullet_group(ball_mid_c,COLOR_DEEP_RED,self.x + 25 * cos(a),self.y + 25 * sin(a),3,0,1,1,a,15,false,0,true,true,0,false,self)
                        a=a+_d_a end end
                        task._Wait(20)
                    end
                    task._Wait(60)
                    task.MoveTo(0,250,180,MOVE_ACCEL)
                    _del(self,true)
                end)
            end)
            task._Wait(140)
            for _=1,15 do
                last=New(EnemySimple,23,30,240, 200,{0,2,1},1,false,true,false,function(self)
                    task.New(self,function()
                        task.BezierMoveTo(100,MOVE_ACC_DEC,-40, 140, -120, 60)
                        PlaySound("kira01",0.1,self.x/256,false)
                        last_list=_create_bullet_group(grain_b,COLOR_RED,self.x,self.y,3,0,4,4,0,40,true,0,true,true,0,false,self)
                        task.CRMoveTo(180,MOVE_ACCEL,-40, 20, -80, 90, 40, 240)
                        _del(self,true)
                    end)
                end)
                last=New(EnemySimple,23,30,-240, 200,{0,2,1},1,false,true,false,function(self)
                    task.New(self,function()
                        task.BezierMoveTo(100,MOVE_ACC_DEC,40, 140, 120, 60)
                        PlaySound("kira01",0.1,self.x/256,false)
                        last_list=_create_bullet_group(grain_b,COLOR_RED,self.x,self.y,3,0,4,4,0,60,true,0,true,true,0,false,self)
                        task.CRMoveTo(180,MOVE_ACCEL,40, 20, 80, 90, -40, 240)
                        _del(self,true)
                    end)
                end)
                task._Wait(15)
            end
            task._Wait(60*3.75)
            self.finishFormation()
        end
        if formationIndex == 2 then
            for _=1,2 do
                task._Wait(45)
                last=New(EnemySimple,14,180,0, 240,{0,15,3},1,false,true,false,function(self)
                    task.New(self,function()
                        self.x = 0
                        self.y = 249
                        self.bound = false
                        lasttask=task.New(self,function()
                            task._Wait(30)
                            do local b,_d_b,c,_d_c,d,_d_d=(0),(360/3),(40),(25),(2),(1) for _=1,3 do
                                PlaySound("option",0.1,self.x/256,false)
                                do local a,_d_a=(b),(360/5) for _=1,5 do
                                    last=New(EnemySimple,23,15,self.x+c*cos(a),self.y+c*sin(a),{0,1,1},1,false,true,false,function(self)
                                        task.New(self,function()
                                            self.rotspeed = b
                                            self.rs = d
                                            self.dist = c
                                            self.off = a
                                            lasttask=task.New(self,function()
                                                for _=1,_infinite do
                                                    last_list=_create_bullet_group(ball_small,COLOR_RED,self.x,self.y,7,0,3,3,0,360,true,0,true,true,0,false,self)
                                                    PlaySound("tan00",0.1,self.x/256,false)
                                                    task._Wait(120)
                                                end
                                            end)
                                            lasttask=task.New(self,function()
                                                for _=1,_infinite do
                                                    self.rotspeed = self.rotspeed + self.rs
                                                    _set_rel_pos(self,self.dist*cos(self.rotspeed + self.off),self.dist*sin(self.rotspeed + self.off),self.rot,false)
                                                    task._Wait(1)
                                                end
                                            end)
                                        end)
                                    end)
                                    _connect(self,last,0,true)
                                    task._Wait(1)
                                a=a+_d_a end end
                                task._Wait(60)
                            b=b+_d_b c=c+_d_c d=d+_d_d end end
                        end)
                        lasttask=task.New(self,function()
                            task.MoveTo(0,100,60,MOVE_ACC_DEC)
                            task.MoveTo(-100,100,60,MOVE_ACC_DEC)
                            task._Wait(60)
                            New(boss_cast_ef,self.x,self.y,360,255,0,0,60,2,false)
                            task._Wait(60)
                            PlaySound("kira00",0.1,self.x/256,false)
                            last_list=_create_bullet_group(ball_huge,COLOR_RED,self.x,self.y,25,0,2,2,0,360,true,0,true,true,0,false,self)
                            task._Wait(60)
                            task.MoveTo(self.x,-360,290,MOVE_ACCEL)
                            _del(self,true)
                        end)
                    end)
                end)
                task._Wait(60*3.75)
                last=New(EnemySimple,14,180,0, 240,{0,15,3},1,false,true,false,function(self)
                    task.New(self,function()
                        self.x = 0
                        self.y = 249
                        self.bound = false
                        lasttask=task.New(self,function()
                            task._Wait(30)
                            do local b,_d_b,c,_d_c,d,_d_d=(0),(360/3),(40),(25),(2),(1) for _=1,3 do
                                PlaySound("option",0.1,self.x/256,false)
                                do local a,_d_a=(b),(360/5) for _=1,5 do
                                    last=New(EnemySimple,23,15,self.x+c*cos(a),self.y+c*sin(a),{0,1,1},1,false,true,false,function(self)
                                        task.New(self,function()
                                            self.rotspeed = b
                                            self.rs = d
                                            self.dist = c
                                            self.off = a
                                            lasttask=task.New(self,function()
                                                for _=1,_infinite do
                                                    last_list=_create_bullet_group(ball_small,COLOR_RED,self.x,self.y,7,0,3,3,0,360,true,0,true,true,0,false,self)
                                                    PlaySound("tan00",0.1,self.x/256,false)
                                                    task._Wait(120)
                                                end
                                            end)
                                            lasttask=task.New(self,function()
                                                for _=1,_infinite do
                                                    self.rotspeed = self.rotspeed + self.rs
                                                    _set_rel_pos(self,self.dist*cos(self.rotspeed + self.off),self.dist*sin(self.rotspeed + self.off),self.rot,false)
                                                    task._Wait(1)
                                                end
                                            end)
                                        end)
                                    end)
                                    _connect(self,last,0,true)
                                    task._Wait(1)
                                a=a+_d_a end end
                                task._Wait(60)
                            b=b+_d_b c=c+_d_c d=d+_d_d end end
                        end)
                        lasttask=task.New(self,function()
                            task.MoveTo(0,100,60,MOVE_ACC_DEC)
                            task.MoveTo(100,100,60,MOVE_ACC_DEC)
                            task._Wait(60)
                            New(boss_cast_ef,self.x,self.y,360,255,0,0,60,2,false)
                            task._Wait(60)
                            PlaySound("kira00",0.1,self.x/256,false)
                            last_list=_create_bullet_group(ball_huge,COLOR_RED,self.x,self.y,25,0,2,2,0,360,true,0,true,true,0,false,self)
                            task._Wait(60)
                            task.MoveTo(self.x,-360,290,MOVE_ACCEL)
                            _del(self,true)
                        end)
                    end)
                end)
                task._Wait(60*3.75)
            end
            task._Wait(60*3)
            self.finishFormation()
        end
        if formationIndex == 3 then
            last=New(EnemySimple,9,50,0, 254,{0,10,4},(60*3.7),false,true,false,function(self)
                task.New(self,function()
                    task.MoveTo(0,120,60,MOVE_DECEL)
                    for _=1,(60*4)/60 do
                        PlaySound("tan00",0.1,self.x/256,false)
                        last_list=_create_bullet_group(ball_huge,COLOR_ORANGE,self.x,self.y,15,0,3,3,0,360,true,0,true,true,0,false,self)
                        for k, unit in ipairs(last_list) do
                            _object.set_color(unit,"mul+add",255,255,255,255)
                        end
                        do local a,_d_a=(Angle(self, player)),(360/15) for _=1,15 do
                            last_list=_create_bullet_group(arrow_big,COLOR_ORANGE,self.x,self.y,5,0,2,4,a,360,false,0,true,true,0,false,self)
                            for k, unit in ipairs(last_list) do
                                _object.set_color(unit,"mul+add",255,255,255,255)
                            end
                        a=a+_d_a end end
                        task._Wait(60)
                    end
                    task._Wait(60)
                    task.MoveTo(0,256,90,MOVE_ACCEL)
                    _del(self,true)
                end)
            end)
            task._Wait(60)
            for _=1,(60*4)/60 do
                last=New(EnemySimple,1,30,240,200,{0,2,1},1,false,true,false,function(self)
                    task.New(self,function()
                        lasttask=task.New(self,function()
                            for _=1,_infinite do
                                last_list=_create_bullet_group(arrow_small,COLOR_ORANGE,self.x,self.y,5,0,3,3,0,70,true,0,true,true,0,false,self)
                                PlaySound("kira00",0.1,self.x/256,false)
                                task._Wait(60)
                            end
                        end)
                        task.CRMoveTo(60*4,MODE_NORMAL,110, 100, 0, 180, -110, 110, -240, 200)
                        _del(self,true)
                    end)
                end)
                last=New(EnemySimple,1,30,-240,200,{0,2,1},1,false,true,false,function(self)
                    task.New(self,function()
                        lasttask=task.New(self,function()
                            for _=1,_infinite do
                                last_list=_create_bullet_group(arrow_small,COLOR_ORANGE,self.x,self.y,5,0,3,3,0,70,true,0,true,true,0,false,self)
                                PlaySound("kira00",0.1,self.x/256,false)
                                task._Wait(30)
                            end
                        end)
                        task.CRMoveTo(60*4,MODE_NORMAL,-110, 100, 0, 180, 110, 110, 240, 200)
                        _del(self,true)
                    end)
                end)
                task._Wait(60)
            end
            task._Wait(120)
            do
                local _beg_posx=-150 local posx=_beg_posx local _end_posx=150 local _d_posx=(_end_posx-_beg_posx)/(8-1)
                for _=1,8 do
                    last=New(EnemySimple,7,50,posx, 254,{0,2,1},1,false,true,false,function(self)
                        task.New(self,function()
                            task.MoveTo(self.x, 150,60,MOVE_DECEL)
                            PlaySound("kira00",0.1,self.x/256,false)
                            local starang=(Angle(self, player))
                            do local rot,_d_rot,dist,_d_dist=(starang),(360/60),(30*2),(5*2) for _=1,60 do
                                if dist > 60*2 then
                                	dist = 30*2
                                end
                                if dist < 45*2 then
                                    last=New(_straight,butterfly,COLOR_ORANGE,self.x + (dist-25) * cos(rot),self.y + (dist-25) * sin(rot),2,rot,false,0,true,true,0,false,0,0,0,false)
                                end
                            rot=rot+_d_rot dist=dist+_d_dist end end
                            do local rot,_d_rot,dist,_d_dist=(starang),(-360/60),(30*2),(5*2) for _=1,60 do
                                if dist > 60*2 then
                                	dist = 30*2
                                end
                                if dist < 45*2 then
                                    last=New(_straight,butterfly,COLOR_ORANGE,self.x + (dist-25) * cos(rot),self.y + (dist-25) * sin(rot),2,rot,false,0,true,true,0,false,0,0,0,false)
                                end
                            rot=rot+_d_rot dist=dist+_d_dist end end
                            task._Wait(60)
                            task.MoveTo(self.x, 256,90,MOVE_ACC_DEC)
                            _del(self,true)
                        end)
                    end)
                    task._Wait(15)
                    posx=posx+_d_posx
                end
            end
            task._Wait(60)
            do
                local _beg_posx=150 local posx=_beg_posx local _end_posx=-150 local _d_posx=(_end_posx-_beg_posx)/(8-1)
                for _=1,8 do
                    last=New(EnemySimple,7,50,posx, 254,{0,2,1},1,false,true,false,function(self)
                        task.New(self,function()
                            task.MoveTo(self.x, 150,60,MOVE_DECEL)
                            PlaySound("kira00",0.1,self.x/256,false)
                            local starang=(Angle(self, player))
                            do local rot,_d_rot,dist,_d_dist=(starang),(360/60),(30*2),(5*2) for _=1,60 do
                                if dist > 60*2 then
                                	dist = 30*2
                                end
                                if dist < 45*2 then
                                    last=New(_straight,butterfly,COLOR_ORANGE,self.x + (dist-25) * cos(rot),self.y + (dist-25) * sin(rot),2,rot,false,0,true,true,0,false,0,0,0,false)
                                end
                            rot=rot+_d_rot dist=dist+_d_dist end end
                            do local rot,_d_rot,dist,_d_dist=(starang),(-360/60),(30*2),(5*2) for _=1,60 do
                                if dist > 60*2 then
                                	dist = 30*2
                                end
                                if dist < 45*2 then
                                    last=New(_straight,butterfly,COLOR_ORANGE,self.x + (dist-25) * cos(rot),self.y + (dist-25) * sin(rot),2,rot,false,0,true,true,0,false,0,0,0,false)
                                end
                            rot=rot+_d_rot dist=dist+_d_dist end end
                            task._Wait(60)
                            task.MoveTo(self.x, 256,90,MOVE_ACC_DEC)
                            _del(self,true)
                        end)
                    end)
                    task._Wait(15)
                    posx=posx+_d_posx
                end
            end
            last=New(EnemySimple,9,100,0, -254,{0,10,5},60,false,true,false,function(self)
                task.New(self,function()
                    self.colli = false
                    lasttask=task.New(self,function()
                        do
                            local _beg_alp=0 local alp=_beg_alp  local _w_alp=-90 local _end_alp=255 local _d_w_alp=180/(110-1)
                            for _=1,110 do
                                _object.set_color(self,"",alp,255,255,255)
                                task._Wait(1)
                                _w_alp=_w_alp+_d_w_alp alp=(_end_alp-_beg_alp)/2*sin(_w_alp)+((_end_alp+_beg_alp)/2)
                            end
                        end
                        self.colli = true
                    end)
                    task.MoveTo(0,120,120,MOVE_ACC_DEC)
                    New(boss_cast_ef,self.x,self.y,360,255,0,0,60,2,false)
                    task._Wait(60)
                    do
                        local r=Angle(self, player) local _d_r=(360/8)
                        local nEdges=5 local _d_nEdges=(1)
                        for _=1,8 do
                            --[[ increment of angle for different polygons]]
                            
                            --[[ nEdges]]
                            
                            do
                                local _beg_jr=0 local jr=_beg_jr local _end_jr=360 local _d_jr=(_end_jr-_beg_jr)/(nEdges)
                                for _=1,nEdges do
                                    --[[ iterate a circle and give it nEdges chops, store angles into jr]]
                                    
                                    --[[ nBullets per edge - 1 (because vertices should be counted only once)]]
                                    
                                    do
                                        local _beg_kvx=cos(r+jr) local kvx=_beg_kvx local _end_kvx=cos(r+jr+_d_jr) local _d_kvx=(_end_kvx-_beg_kvx)/(5)
                                        local _beg_kvy=sin(r+jr) local kvy=_beg_kvy local _end_kvy=sin(r+jr+_d_jr) local _d_kvy=(_end_kvy-_beg_kvy)/(5)
                                        for _=1,5 do
                                            --[[ iterate in the edge.]]
                                            
                                            last=New(_straight,arrow_mid,COLOR_ORANGE,self.x,self.y,3,0,false,0,true,true,0,false,0,0,0,false)
                                            last.navi = true
                                            last.vx, last.vy = 3*kvx, 3*kvy
                                            _object.set_color(last,"mul+add",255,255,255,255)
                                            kvx=kvx+_d_kvx
                                            kvy=kvy+_d_kvy
                                        end
                                    end
                                    jr=jr+_d_jr
                                end
                            end
                            PlaySound("tan00",0.1,self.x/256,false)
                            task._Wait(15)
                            r=r+_d_r
                            nEdges=nEdges+_d_nEdges
                        end
                    end
                    task._Wait(60)
                    task.MoveTo(self.x, self.y + 200,90,MOVE_ACCEL)
                    _del(self,true)
                end)
            end)
            _object.set_color(last,"",0,255,255,255)
            task._Wait(120)
            last=New(EnemySimple,9,100,-60, -254,{0,10,5},60,false,true,false,function(self)
                task.New(self,function()
                    self.colli = false
                    lasttask=task.New(self,function()
                        do
                            local _beg_alp=0 local alp=_beg_alp  local _w_alp=-90 local _end_alp=255 local _d_w_alp=180/(110-1)
                            for _=1,110 do
                                _object.set_color(self,"",alp,255,255,255)
                                task._Wait(1)
                                _w_alp=_w_alp+_d_w_alp alp=(_end_alp-_beg_alp)/2*sin(_w_alp)+((_end_alp+_beg_alp)/2)
                            end
                        end
                        self.colli = true
                    end)
                    task.MoveTo(-60,120,120,MOVE_ACC_DEC)
                    New(boss_cast_ef,self.x,self.y,360,255,0,0,60,2,false)
                    task._Wait(60)
                    do
                        local r=Angle(self, player) local _d_r=(360/8)
                        local nEdges=5 local _d_nEdges=(1)
                        for _=1,8 do
                            --[[ increment of angle for different polygons]]
                            
                            --[[ nEdges]]
                            
                            do
                                local _beg_jr=0 local jr=_beg_jr local _end_jr=360 local _d_jr=(_end_jr-_beg_jr)/(nEdges)
                                for _=1,nEdges do
                                    --[[ iterate a circle and give it nEdges chops, store angles into jr]]
                                    
                                    --[[ nBullets per edge - 1 (because vertices should be counted only once)]]
                                    
                                    do
                                        local _beg_kvx=cos(r+jr) local kvx=_beg_kvx local _end_kvx=cos(r+jr+_d_jr) local _d_kvx=(_end_kvx-_beg_kvx)/(5)
                                        local _beg_kvy=sin(r+jr) local kvy=_beg_kvy local _end_kvy=sin(r+jr+_d_jr) local _d_kvy=(_end_kvy-_beg_kvy)/(5)
                                        for _=1,5 do
                                            --[[ iterate in the edge.]]
                                            
                                            last=New(_straight,arrow_mid,COLOR_ORANGE,self.x,self.y,3,0,false,0,true,true,0,false,0,0,0,false)
                                            last.navi = true
                                            last.vx, last.vy = 3*kvx, 3*kvy
                                            _object.set_color(last,"mul+add",255,255,255,255)
                                            kvx=kvx+_d_kvx
                                            kvy=kvy+_d_kvy
                                        end
                                    end
                                    jr=jr+_d_jr
                                end
                            end
                            PlaySound("tan00",0.1,self.x/256,false)
                            task._Wait(15)
                            r=r+_d_r
                            nEdges=nEdges+_d_nEdges
                        end
                    end
                    task._Wait(60)
                    task.MoveTo(self.x, self.y + 200,90,MOVE_ACCEL)
                    _del(self,true)
                end)
            end)
            _object.set_color(last,"",0,255,255,255)
            last=New(EnemySimple,9,100,60, -254,{0,10,5},60,false,true,false,function(self)
                task.New(self,function()
                    self.colli = false
                    lasttask=task.New(self,function()
                        do
                            local _beg_alp=0 local alp=_beg_alp  local _w_alp=-90 local _end_alp=255 local _d_w_alp=180/(110-1)
                            for _=1,110 do
                                _object.set_color(self,"",alp,255,255,255)
                                task._Wait(1)
                                _w_alp=_w_alp+_d_w_alp alp=(_end_alp-_beg_alp)/2*sin(_w_alp)+((_end_alp+_beg_alp)/2)
                            end
                        end
                        self.colli = true
                    end)
                    task.MoveTo(60,120,120,MOVE_ACC_DEC)
                    New(boss_cast_ef,self.x,self.y,360,255,0,0,60,2,false)
                    task._Wait(60)
                    do
                        local r=Angle(self, player) local _d_r=(360/8)
                        local nEdges=5 local _d_nEdges=(1)
                        for _=1,8 do
                            --[[ increment of angle for different polygons]]
                            
                            --[[ nEdges]]
                            
                            do
                                local _beg_jr=0 local jr=_beg_jr local _end_jr=360 local _d_jr=(_end_jr-_beg_jr)/(nEdges)
                                for _=1,nEdges do
                                    --[[ iterate a circle and give it nEdges chops, store angles into jr]]
                                    
                                    --[[ nBullets per edge - 1 (because vertices should be counted only once)]]
                                    
                                    do
                                        local _beg_kvx=cos(r+jr) local kvx=_beg_kvx local _end_kvx=cos(r+jr+_d_jr) local _d_kvx=(_end_kvx-_beg_kvx)/(5)
                                        local _beg_kvy=sin(r+jr) local kvy=_beg_kvy local _end_kvy=sin(r+jr+_d_jr) local _d_kvy=(_end_kvy-_beg_kvy)/(5)
                                        for _=1,5 do
                                            --[[ iterate in the edge.]]
                                            
                                            last=New(_straight,arrow_mid,COLOR_ORANGE,self.x,self.y,3,0,false,0,true,true,0,false,0,0,0,false)
                                            last.navi = true
                                            last.vx, last.vy = 3*kvx, 3*kvy
                                            _object.set_color(last,"mul+add",255,255,255,255)
                                            kvx=kvx+_d_kvx
                                            kvy=kvy+_d_kvy
                                        end
                                    end
                                    jr=jr+_d_jr
                                end
                            end
                            PlaySound("tan00",0.1,self.x/256,false)
                            task._Wait(15)
                            r=r+_d_r
                            nEdges=nEdges+_d_nEdges
                        end
                    end
                    task._Wait(60)
                    task.MoveTo(self.x, self.y + 200,90,MOVE_ACCEL)
                    _del(self,true)
                end)
            end)
            _object.set_color(last,"",0,255,255,255)
            task._Wait(60*6)
            self.finishFormation()
        end
        if formationIndex == 4 then
            for _=1,8 do
                last=New(EnemySimple,8,70,ran:Int(-160, 160),240,{0,5,2},1,false,true,false,function(self)
                    task.New(self,function()
                        lasttask=task.New(self,function()
                            do
                                local _beg_time=6 local time=_beg_time  local _w_time=0 local _end_time=1 local _d_w_time=90/(50-1)
                                local ang_add=0 local _d_ang_add=(5)
                                local _beg_off=40 local off=_beg_off  local _w_off=-90 local _end_off=-20 local _d_w_off=180/(50-1)
                                for _=1,50 do
                                    PlaySound("tan00",0.1,self.x/256,false)
                                    do local ang,_d_ang=(ang_add),(360/5) for _=1,5 do
                                        last_list=_create_bullet_group(grain_b,COLOR_ROYAL_BLUE,self.x + off * cos(ang),self.y + off * sin(ang),2,0,3,3,ang,360,false,0,true,true,0,false,self)
                                    ang=ang+_d_ang end end
                                    task._Wait(time)
                                    _w_time=_w_time+_d_w_time time=(_end_time-_beg_time)*sin(_w_time)+(_beg_time)
                                    ang_add=ang_add+_d_ang_add
                                    _w_off=_w_off+_d_w_off off=(_end_off-_beg_off)/2*sin(_w_off)+((_end_off+_beg_off)/2)
                                end
                            end
                        end)
                        task.MoveTo(self.x, self.y-ran:Int(60, 100),60,MOVE_DECEL)
                        task._Wait(60)
                        task.MoveTo(self.x, 255,90,MOVE_ACCEL)
                        _del(self,true)
                    end)
                end)
                task._Wait(120)
            end
            task._Wait(60*2)
            self.finishFormation()
        end
        if formationIndex == 5 then
            for _=1,2 do
                for _=1,10 do
                    last=New(EnemySimple,3,10,150, 255,{0,1,1},1,false,true,false,function(self)
                        task.New(self,function()
                            lasttask=task.New(self,function()
                                task._Wait(ran:Int(40,120))
                                PlaySound("kira00",0.1,self.x/256,false)
                                last_list=_create_bullet_group(ball_small,COLOR_BLUE,self.x,self.y,9,0,3,3,0,10,true,0,true,true,0,false,self)
                                last_list=_create_bullet_group(ball_small,COLOR_BLUE,self.x,self.y,9,0,2,2,0,10,true,0,true,true,0,false,self)
                                last_list=_create_bullet_group(ball_small,COLOR_BLUE,self.x,self.y,9,0,1,1,0,10,true,0,true,true,0,false,self)
                            end)
                            task.CRMoveTo(360-30,MODE_NORMAL,150-20, 0, -250, 0)
                            _del(self,true)
                        end)
                    end)
                    last=New(EnemySimple,3,10,120, 255,{0,1,1},1,false,true,false,function(self)
                        task.New(self,function()
                            lasttask=task.New(self,function()
                                task._Wait(ran:Int(40,120))
                                PlaySound("kira00",0.1,self.x/256,false)
                                last_list=_create_bullet_group(ball_small,COLOR_BLUE,self.x,self.y,9,0,3,3,0,10,true,0,true,true,0,false,self)
                                last_list=_create_bullet_group(ball_small,COLOR_BLUE,self.x,self.y,9,0,2,2,0,10,true,0,true,true,0,false,self)
                                last_list=_create_bullet_group(ball_small,COLOR_BLUE,self.x,self.y,9,0,1,1,0,10,true,0,true,true,0,false,self)
                            end)
                            task.CRMoveTo(360-30,MODE_NORMAL,110-20, 30, -250, 30)
                            _del(self,true)
                        end)
                    end)
                    task._Wait(30)
                end
                for _=1,10 do
                    last=New(EnemySimple,3,10,-150, 255,{0,1,1},1,false,true,false,function(self)
                        task.New(self,function()
                            lasttask=task.New(self,function()
                                task._Wait(ran:Int(40,120))
                                PlaySound("kira00",0.1,self.x/256,false)
                                last_list=_create_bullet_group(ball_small,COLOR_BLUE,self.x,self.y,9,0,3,3,0,10,true,0,true,true,0,false,self)
                                last_list=_create_bullet_group(ball_small,COLOR_BLUE,self.x,self.y,9,0,2,2,0,10,true,0,true,true,0,false,self)
                                last_list=_create_bullet_group(ball_small,COLOR_BLUE,self.x,self.y,9,0,1,1,0,10,true,0,true,true,0,false,self)
                            end)
                            task.CRMoveTo(360-30,MODE_NORMAL,-150+20, 0, 250, 0)
                            _del(self,true)
                        end)
                    end)
                    last=New(EnemySimple,3,10,-120, 255,{0,1,1},1,false,true,false,function(self)
                        task.New(self,function()
                            lasttask=task.New(self,function()
                                task._Wait(ran:Int(40,120))
                                PlaySound("kira00",0.1,self.x/256,false)
                                last_list=_create_bullet_group(ball_small,COLOR_BLUE,self.x,self.y,9,0,3,3,0,10,true,0,true,true,0,false,self)
                                last_list=_create_bullet_group(ball_small,COLOR_BLUE,self.x,self.y,9,0,2,2,0,10,true,0,true,true,0,false,self)
                                last_list=_create_bullet_group(ball_small,COLOR_BLUE,self.x,self.y,9,0,1,1,0,10,true,0,true,true,0,false,self)
                            end)
                            task.CRMoveTo(360-30,MODE_NORMAL,-110+20, 30, 250, 30)
                            _del(self,true)
                        end)
                    end)
                    task._Wait(30)
                end
            end
            task._Wait(60*3)
            self.finishFormation()
        end
        if formationIndex == 6 then
            last=New(EnemySimple,9,200,0, 240,{0,15,5},60,false,true,false,function(self)
                task.New(self,function()
                    lasttask=task.New(self,function()
                        task._Wait(60)
                        for _=1,_infinite do
                            last_list=_create_bullet_group(grain_a,COLOR_DEEP_PURPLE,self.x,self.y,21,0,1,1,0,360,true,0,true,true,0,false,self)
                            PlaySound("old_kira00",0.1,self.x/256,false)
                            task._Wait(120)
                        end
                    end)
                    lasttask=task.New(self,function()
                        task._Wait(60)
                        do local ang,_d_ang=(0),(25) for _=1,_infinite do
                            lasttask=task.New(self,function()
                                do local ang2,_d_ang2=(ang),(360/(12/2)) for _=1,12 do
                                    self.bulx = self.x + 20 * cos(ang)
                                    self.buly = self.y + 20 * sin(ang)
                                    last=New(_straight,ball_big,COLOR_DEEP_PURPLE,self.bulx + 30 * cos(ang2),self.buly + 30 * sin(ang2),3,ang,false,0,true,true,0,false,0,0,0,false)
                                    PlaySound("kira00",0.1,self.x/256,false)
                                    task._Wait(1)
                                ang2=ang2+_d_ang2 end end
                            end)
                            lasttask=task.New(self,function()
                                do local ang2,_d_ang2=(ang),(-360/(12/2)) for _=1,12 do
                                    self.bulx = self.x + 20 * cos(ang+180)
                                    self.buly = self.y + 20 * sin(ang+180)
                                    last=New(_straight,ball_big,COLOR_DEEP_PURPLE,self.bulx + 30 * cos(ang2),self.buly + 30 * sin(ang2),3,ang+180,false,0,true,true,0,false,0,0,0,false)
                                    PlaySound("kira00",0.1,self.x/256,false)
                                    task._Wait(1)
                                ang2=ang2+_d_ang2 end end
                            end)
                            task._Wait(30)
                        ang=ang+_d_ang end end
                    end)
                    task.MoveTo(0,140,60,MOVE_DECEL)
                    lasttask=task.New(self,function()
                        task._Wait(60*9)
                        do
                            local _beg_posy=140 local posy=_beg_posy local _end_posy=240 local _w_posy=0  local _d_w_posy=1/(90-1)
                            for _=1,90 do
                                self.y = posy
                                task._Wait(1)
                                _w_posy=_w_posy+_d_w_posy posy=(_end_posy-_beg_posy)*_w_posy^2+_beg_posy
                            end
                        end
                        _del(self,true)
                    end)
                    do
                        local _h_posx=(100-(-100))/2 local _t_posx=(100+(-100))/2 local posx=_h_posx*sin(0)+_t_posx local _w_posx=0 local _d_w_posx=1.5
                        for _=1,_infinite do
                            self.x,self.y=posx, self.y
                            task._Wait(1)
                            _w_posx=_w_posx+_d_w_posx posx=_h_posx*sin(_w_posx)+_t_posx
                        end
                    end
                end)
            end)
            task._Wait(30)
            for _=1,8 do
                last=New(EnemySimple,26,10,-240, 100,{0,1,1},1,false,true,false,function(self)
                    task.New(self,function()
                        lasttask=task.New(self,function()
                            for _=1,_infinite do
                                last_list=_create_bullet_group(grain_a,COLOR_DEEP_PURPLE,self.x,self.y,3,0,3,4,0,0,true,0,true,true,0,false,self)
                                PlaySound("tan00",0.1,self.x/256,false)
                                task._Wait(33)
                            end
                        end)
                        task.MoveTo(240, 50,60*3,MOVE_NORMAL)
                        _del(self,true)
                    end)
                end)
                task._Wait(45)
                last=New(EnemySimple,26,10,240, 100,{0,1,1},1,false,true,false,function(self)
                    task.New(self,function()
                        lasttask=task.New(self,function()
                            for _=1,_infinite do
                                last_list=_create_bullet_group(grain_a,COLOR_DEEP_PURPLE,self.x,self.y,3,0,3,4,0,0,true,0,true,true,0,false,self)
                                PlaySound("tan00",0.1,self.x/256,false)
                                task._Wait(33)
                            end
                        end)
                        task.MoveTo(-240, 50,60*3,MOVE_NORMAL)
                        _del(self,true)
                    end)
                end)
                task._Wait(45)
            end
            task._Wait(60*3)
            self.finishFormation()
        end
        if formationIndex == 7 then
            do
                local _beg_posx=160 local posx=_beg_posx local _end_posx=-160 local _d_posx=(_end_posx-_beg_posx)/(5-1)
                for _=1,5 do
                    last=New(EnemySimple,9,90,posx, 240,{0,14,4},1,false,true,false,function(self)
                        task.New(self,function()
                            task.MoveTo(self.x, 120,90,MOVE_DECEL)
                            for _=1,2 do
                                do local ang,_d_ang=(ran:Int(0, 360)),(360/15) for _=1,15 do
                                    last=New(_straight,ball_big,COLOR_RED,self.x,self.y,5,ang,false,0,true,true,0,false,0,0,0,false)
                                    PlaySound("tan00",0.1,self.x/256,false)
                                    lasttask=task.New(last,function()
                                        local self=task.GetSelf()
                                        lasttask=task.New(self,function()
                                            _object.set_color(self,"mul+add",255,255,255,255)
                                            SetV2(self,5,ang,true,false)
                                            task._Wait(5)
                                            do local s,_d_s=(5),(-1.65) for _=1,4 do
                                                SetV2(self,s,ang,true,false)
                                                task._Wait(3)
                                            s=s+_d_s end end
                                            _set_a(self,0.05,self.rot-90,false)
                                            PlaySound("kira00",0.1,self.x/256,false)
                                            task._Wait(60)
                                            PlaySound("kira01",0.1,self.x/256,false)
                                            do local a,_d_a,b,_d_b=(0),(4),(1),(0.4) for _=1,5 do
                                                last_list=_create_bullet_group(ball_mid,COLOR_RED,self.x,self.y,1,0,b,b,self.rot-a-90,360,false,0,true,true,0,false,self)
                                            a=a+_d_a b=b+_d_b end end
                                            _kill(self,false)
                                        end)
                                    end)
                                    task._Wait(5)
                                ang=ang+_d_ang end end
                                do local ang,_d_ang=(ran:Int(0, 360)),(-360/15) for _=1,15 do
                                    last=New(_straight,ball_big,COLOR_BLUE,self.x,self.y,5,ang,false,0,true,true,0,false,0,0,0,false)
                                    PlaySound("tan00",0.1,self.x/256,false)
                                    lasttask=task.New(last,function()
                                        local self=task.GetSelf()
                                        lasttask=task.New(self,function()
                                            _object.set_color(self,"mul+add",255,255,255,255)
                                            SetV2(self,5,ang,true,false)
                                            task._Wait(5)
                                            do local s,_d_s=(5),(-1.65) for _=1,4 do
                                                SetV2(self,s,ang,true,false)
                                                task._Wait(3)
                                            s=s+_d_s end end
                                            _set_a(self,0.05,self.rot-90,false)
                                            PlaySound("kira00",0.1,self.x/256,false)
                                            task._Wait(60)
                                            PlaySound("kira01",0.1,self.x/256,false)
                                            do local a,_d_a,b,_d_b=(0),(4),(1),(0.4) for _=1,5 do
                                                last_list=_create_bullet_group(ball_mid,COLOR_BLUE,self.x,self.y,1,0,b,b,self.rot-a+90,360,false,0,true,true,0,false,self)
                                            a=a+_d_a b=b+_d_b end end
                                            _kill(self,false)
                                        end)
                                    end)
                                    task._Wait(5)
                                ang=ang+_d_ang end end
                                task._Wait(60)
                            end
                            task._Wait(60)
                            task.MoveTo(self.x, 240,60,MOVE_ACCEL)
                            _del(self,true)
                        end)
                    end)
                    task._Wait(60)
                    posx=posx+_d_posx
                end
            end
            do
                local _beg_posx=-160 local posx=_beg_posx local _end_posx=160 local _d_posx=(_end_posx-_beg_posx)/(5-1)
                for _=1,5 do
                    last=New(EnemySimple,9,90,posx, 240,{0,14,4},1,false,true,false,function(self)
                        task.New(self,function()
                            task.MoveTo(self.x, 120,90,MOVE_DECEL)
                            for _=1,2 do
                                do local ang,_d_ang=(ran:Int(0, 360)),(360/15) for _=1,15 do
                                    last=New(_straight,ball_big,COLOR_RED,self.x,self.y,5,ang,false,0,true,true,0,false,0,0,0,false)
                                    PlaySound("tan00",0.1,self.x/256,false)
                                    lasttask=task.New(last,function()
                                        local self=task.GetSelf()
                                        lasttask=task.New(self,function()
                                            _object.set_color(self,"mul+add",255,255,255,255)
                                            SetV2(self,5,ang,true,false)
                                            task._Wait(5)
                                            do local s,_d_s=(5),(-1.65) for _=1,4 do
                                                SetV2(self,s,ang,true,false)
                                                task._Wait(3)
                                            s=s+_d_s end end
                                            _set_a(self,0.05,self.rot-90,false)
                                            PlaySound("kira00",0.1,self.x/256,false)
                                            task._Wait(60)
                                            PlaySound("kira01",0.1,self.x/256,false)
                                            do local a,_d_a,b,_d_b=(0),(4),(1),(0.4) for _=1,5 do
                                                last_list=_create_bullet_group(ball_mid,COLOR_RED,self.x,self.y,1,0,b,b,self.rot-a-90,360,false,0,true,true,0,false,self)
                                            a=a+_d_a b=b+_d_b end end
                                            _kill(self,false)
                                        end)
                                    end)
                                    task._Wait(5)
                                ang=ang+_d_ang end end
                                do local ang,_d_ang=(ran:Int(0, 360)),(-360/15) for _=1,15 do
                                    last=New(_straight,ball_big,COLOR_BLUE,self.x,self.y,5,ang,false,0,true,true,0,false,0,0,0,false)
                                    PlaySound("tan00",0.1,self.x/256,false)
                                    lasttask=task.New(last,function()
                                        local self=task.GetSelf()
                                        lasttask=task.New(self,function()
                                            _object.set_color(self,"mul+add",255,255,255,255)
                                            SetV2(self,5,ang,true,false)
                                            task._Wait(5)
                                            do local s,_d_s=(5),(-1.65) for _=1,4 do
                                                SetV2(self,s,ang,true,false)
                                                task._Wait(3)
                                            s=s+_d_s end end
                                            _set_a(self,0.05,self.rot-90,false)
                                            PlaySound("kira00",0.1,self.x/256,false)
                                            task._Wait(60)
                                            PlaySound("kira01",0.1,self.x/256,false)
                                            do local a,_d_a,b,_d_b=(0),(4),(1),(0.4) for _=1,5 do
                                                last_list=_create_bullet_group(ball_mid,COLOR_BLUE,self.x,self.y,1,0,b,b,self.rot-a+90,360,false,0,true,true,0,false,self)
                                            a=a+_d_a b=b+_d_b end end
                                            _kill(self,false)
                                        end)
                                    end)
                                    task._Wait(5)
                                ang=ang+_d_ang end end
                                task._Wait(60)
                            end
                            task._Wait(60)
                            task.MoveTo(self.x, 240,60,MOVE_ACCEL)
                            _del(self,true)
                        end)
                    end)
                    task._Wait(60)
                    posx=posx+_d_posx
                end
            end
            task._Wait(60*14)
            self.finishFormation()
        end
        if formationIndex == 8 then
            for _=1,18 do
                last=New(EnemySimple,8,40,240, 140,{0,3,2},1,false,true,false,function(self)
                    task.New(self,function()
                        task.BezierMoveTo(120,MOVE_DECEL,200, -100, 120, -180)
                        PlaySound("tan00",0.1,self.x/256,false)
                        last_list=_create_bullet_group(arrow_mid,COLOR_BLUE,self.x,self.y,5,0,3,3,-90 - 20,40,false,0,true,true,0,false,self)
                        for _,unit in ipairs(last_list) do
                            _set_g(unit,-0.04)
                            unit.navi = true
                        end
                        task.CRMoveTo(480,MOVE_ACCEL,40, 50, 190, 90, -20, 240)
                        _del(self,true)
                    end)
                end)
                last=New(EnemySimple,8,40,-240, 140,{0,3,2},1,false,true,false,function(self)
                    task.New(self,function()
                        task.BezierMoveTo(120,MOVE_DECEL,-200, -100, -120, -180)
                        PlaySound("tan00",0.1,self.x/256,false)
                        last_list=_create_bullet_group(arrow_mid,COLOR_BLUE,self.x,self.y,5,0,3,3,-90 + 20,40,false,0,true,true,0,false,self)
                        for _,unit in ipairs(last_list) do
                            _set_g(unit,-0.04)
                            unit.navi = true
                        end
                        task.CRMoveTo(480,MOVE_ACCEL,-40, 50, -190, 90, 20, 240)
                        _del(self,true)
                    end)
                end)
                last=New(EnemySimple,7,40,60, 240,{0,3,2},1,false,true,false,function(self)
                    task.New(self,function()
                        lasttask=task.New(self,function()
                            task._Wait(60*2)
                            PlaySound("tan01",0.1,self.x/256,false)
                            last_list=_create_bullet_group(ball_mid_c,COLOR_RED,self.x,self.y,11,0,2,2,0,360,true,0,true,true,0,false,self)
                        end)
                        task.CRMoveTo(60*3.25,MOVE_DECEL,140, 60, 0, 120, -240, 0 )
                        _del(self,true)
                    end)
                end)
                last=New(EnemySimple,7,40,-60, 240,{0,3,2},1,false,true,false,function(self)
                    task.New(self,function()
                        lasttask=task.New(self,function()
                            task._Wait(60*2)
                            PlaySound("tan01",0.1,self.x/256,false)
                            last_list=_create_bullet_group(ball_mid_c,COLOR_RED,self.x,self.y,11,0,2,2,0,360,true,0,true,true,0,false,self)
                        end)
                        task.CRMoveTo(60*3.25,MOVE_DECEL,-140, 60, 0, 120, 240, 0)
                        _del(self,true)
                    end)
                end)
                task._Wait(45)
            end
            task._Wait(60*5)
            self.finishFormation()
        end
        if formationIndex == 9 then
            lasttask=task.New(self,function()
                task._Wait(60*5)
                for _=1,25 do
                    last=New(EnemySimple,ran:Int(5, 6),20,40, 240,{0,3,1},1,false,true,false,function(self)
                        task.New(self,function()
                            lasttask=task.New(self,function()
                                task.CRMoveTo(60*3,MOVE_ACC_DEC,80, 100, 240, -100)
                                _del(self,true)
                            end)
                            for _=1,_infinite do
                                last_list=_create_bullet_group(ellipse,COLOR_DEEP_RED,self.x,self.y,4,0,3,3,90,180,false,0,true,true,0,false,self)
                                for _,unit in ipairs(last_list) do
                                    _set_g(unit,0.035)
                                    unit.navi = true
                                end
                                PlaySound("tan00",0.1,self.x/256,false)
                                task._Wait(60)
                            end
                        end)
                    end)
                    last=New(EnemySimple,ran:Int(5, 6),20,-40, 240,{0,3,1},1,false,true,false,function(self)
                        task.New(self,function()
                            lasttask=task.New(self,function()
                                task.CRMoveTo(60*3,MOVE_ACC_DEC,-80, 100, -240, -100)
                                _del(self,true)
                            end)
                            for _=1,_infinite do
                                last_list=_create_bullet_group(ellipse,COLOR_DEEP_RED,self.x,self.y,4,0,3,3,90,180,false,0,true,true,0,false,self)
                                for _,unit in ipairs(last_list) do
                                    _set_g(unit,0.035)
                                    unit.navi = true
                                end
                                PlaySound("tan00",0.1,self.x/256,false)
                                task._Wait(60)
                            end
                        end)
                    end)
                    task._Wait(30)
                end
            end)
            for _=1,3 do
                last=New(EnemySimple,7,200,240, 140,{0,10,2},1,false,true,false,function(self)
                    task.New(self,function()
                        task.MoveTo(120, 120,60,MOVE_DECEL)
                        task._Wait(30)
                        for _=1,5 do
                            last_list=_create_bullet_group(arrow_big,COLOR_RED,self.x,self.y,11,0,1,1,0,360,true,0,true,true,0,false,self)
                            PlaySound("kira00",0.1,self.x/256,false)
                            task._Wait(30)
                        end
                        task.MoveTo(120-45/2,120-45/2,45,MOVE_ACC_DEC)
                        for _=1,5 do
                            last_list=_create_bullet_group(arrow_big,COLOR_RED,self.x,self.y,13,0,1,1,0,360,true,0,true,true,0,false,self)
                            PlaySound("kira00",0.1,self.x/256,false)
                            task._Wait(30)
                        end
                        task.MoveTo(120-90/2,120-90/2,45,MOVE_ACC_DEC)
                        task._Wait(60)
                        task.MoveTo(20, 240,90,MOVE_ACCEL)
                        for _=1,3 do
                            last_list=_create_bullet_group(arrow_big,COLOR_RED,self.x,self.y,13,0,2,2,0,360,true,0,true,true,0,false,self)
                            PlaySound("kira00",0.1,self.x/256,false)
                            task._Wait(30)
                        end
                        _del(self,true)
                    end)
                end)
                last=New(EnemySimple,7,200,-240, 140,{0,10,2},1,false,true,false,function(self)
                    task.New(self,function()
                        task.MoveTo(-120, 120,60,MOVE_DECEL)
                        task._Wait(30)
                        for _=1,5 do
                            last_list=_create_bullet_group(arrow_big,COLOR_RED,self.x,self.y,11,0,1,1,0,360,true,0,true,true,0,false,self)
                            PlaySound("kira00",0.1,self.x/256,false)
                            task._Wait(30)
                        end
                        task.MoveTo(-120+45/2,120-45/2,45,MOVE_ACC_DEC)
                        for _=1,5 do
                            last_list=_create_bullet_group(arrow_big,COLOR_RED,self.x,self.y,13,0,1,1,0,360,true,0,true,true,0,false,self)
                            PlaySound("kira00",0.1,self.x/256,false)
                            task._Wait(30)
                        end
                        task.MoveTo(-120+90/2,120-90/2,45,MOVE_ACC_DEC)
                        task._Wait(60)
                        task.MoveTo(-20, 240,90,MOVE_ACCEL)
                        for _=1,3 do
                            last_list=_create_bullet_group(arrow_big,COLOR_RED,self.x,self.y,13,0,2,2,0,360,true,0,true,true,0,false,self)
                            PlaySound("kira00",0.1,self.x/256,false)
                            task._Wait(30)
                        end
                        _del(self,true)
                    end)
                end)
                task._Wait(200)
            end
            task._Wait(120)
            for _=1,10 do
                last=New(EnemySimple,25,25,-240, 180,{0,2,4},1,false,true,true,function(self)
                    task.New(self,function()
                        lasttask=task.New(self,function()
                            task._Wait(30)
                            for _=1,7 do
                                last_list=_create_bullet_group(arrow_big,COLOR_BLUE,self.x,self.y,2,0,2,2,-90-45,15,false,0,true,true,0,false,self)
                                last_list=_create_bullet_group(arrow_big,COLOR_BLUE,self.x,self.y,2,0,2,2,45,15,false,0,true,true,0,false,self)
                                PlaySound("kira01",0.1,self.x/256,false)
                                task._Wait(30)
                            end
                        end)
                        task.MoveTo(240, 80,120,MOVE_NORMAL)
                        _del(self,true)
                    end)
                end)
                task._Wait(20)
            end
            task._Wait(60)
            for _=1,10 do
                last=New(EnemySimple,25,25,240, 180,{0,2,4},1,false,true,false,function(self)
                    task.New(self,function()
                        lasttask=task.New(self,function()
                            task._Wait(30)
                            for _=1,7 do
                                last_list=_create_bullet_group(arrow_big,COLOR_BLUE,self.x,self.y,2,0,2,2,-90+45,15,false,0,true,true,0,false,self)
                                last_list=_create_bullet_group(arrow_big,COLOR_BLUE,self.x,self.y,2,0,2,2,90+45,15,false,0,true,true,0,false,self)
                                PlaySound("kira01",0.1,self.x/256,false)
                                task._Wait(30)
                            end
                        end)
                        task.MoveTo(-240, 80,120,MOVE_NORMAL)
                        _del(self,true)
                    end)
                end)
                task._Wait(20)
            end
            task._Wait(60)
            do
                local _beg_posx=200 local posx=_beg_posx local _end_posx=-200 local _d_posx=(_end_posx-_beg_posx)/(10-1)
                for _=1,10 do
                    last=New(EnemySimple,24,30,posx, 240,{0,3,1},1,false,true,false,function(self)
                        task.New(self,function()
                            task.MoveTo(self.x, 200,60,MOVE_DECEL)
                            PlaySound("kira02",0.1,self.x/256,false)
                            last_list=_create_bullet_group(arrow_big,COLOR_GREEN,self.x,self.y,10,0,4,4,0,25,true,0,true,true,0,false,self)
                            task._Wait(60)
                            task.MoveTo(self.x, 240,60,MOVE_ACCEL)
                            _del(self,true)
                        end)
                    end)
                    task._Wait(15)
                    posx=posx+_d_posx
                end
            end
            task._Wait(60)
            do
                local _beg_posx=-200 local posx=_beg_posx local _end_posx=200 local _d_posx=(_end_posx-_beg_posx)/(10-1)
                for _=1,10 do
                    last=New(EnemySimple,24,30,posx, 240,{0,3,1},1,false,true,false,function(self)
                        task.New(self,function()
                            task.MoveTo(self.x, 200,60,MOVE_DECEL)
                            PlaySound("kira02",0.1,self.x/256,false)
                            last_list=_create_bullet_group(arrow_big,COLOR_GREEN,self.x,self.y,10,0,4,4,0,25,true,0,true,true,0,false,self)
                            task._Wait(60)
                            task.MoveTo(self.x, 240,60,MOVE_ACCEL)
                            _del(self,true)
                        end)
                    end)
                    task._Wait(15)
                    posx=posx+_d_posx
                end
            end
            task._Wait(60*3)
            self.finishFormation()
        end
        if formationIndex == 10 then
            last=New(EnemySimple,8,60,-240, 0,{0,5,1},1,false,true,false,function(self)
                task.New(self,function()
                    task.MoveTo(-100,80,60,MOVE_DECEL)
                    do local i,_d_i=(90+45),(-35) for _=1,7 do
                        PlaySound("kira00",0.1,self.x/256,false)
                        last=New(_straight,ball_huge,COLOR_ROYAL_BLUE,self.x,self.y,6,i,false,0,true,true,0,false,0,0,0,false)
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            do
                                local _beg_vel=6 local vel=_beg_vel  local _w_vel=0 local _end_vel=0 local _d_w_vel=90/(45-1)
                                for _=1,45 do
                                    SetV2(self,vel,self.rot,true,false)
                                    task._Wait(1)
                                    _w_vel=_w_vel+_d_w_vel vel=(_end_vel-_beg_vel)*sin(_w_vel)+(_beg_vel)
                                end
                            end
                            last_list=_create_bullet_group(ball_mid,COLOR_ROYAL_BLUE,self.x,self.y,22,0,2,2,0,360,true,0,true,true,0,false,self)
                            PlaySound("don00",0.1,self.x/256,false)
                            PlaySound("kira00",0.1,self.x/256,false)
                            _del(self,true)
                        end)
                        task._Wait(5)
                    i=i+_d_i end end
                    task._Wait(30)
                    task.MoveTo(self.x, 240,90,MOVE_ACCEL)
                    _del(self,true)
                end)
            end)
            last=New(EnemySimple,8,60,240, 0,{0,5,1},1,false,true,false,function(self)
                task.New(self,function()
                    task.MoveTo(100,80,60,MOVE_DECEL)
                    do local i,_d_i=(90-45),(35) for _=1,7 do
                        PlaySound("kira00",0.1,self.x/256,false)
                        last=New(_straight,ball_huge,COLOR_ROYAL_BLUE,self.x,self.y,6,i,false,0,true,true,0,false,0,0,0,false)
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            do
                                local _beg_vel=6 local vel=_beg_vel  local _w_vel=0 local _end_vel=0 local _d_w_vel=90/(45-1)
                                for _=1,45 do
                                    SetV2(self,vel,self.rot,true,false)
                                    task._Wait(1)
                                    _w_vel=_w_vel+_d_w_vel vel=(_end_vel-_beg_vel)*sin(_w_vel)+(_beg_vel)
                                end
                            end
                            last_list=_create_bullet_group(ball_mid,COLOR_ROYAL_BLUE,self.x,self.y,22,0,2,2,0,360,true,0,true,true,0,false,self)
                            PlaySound("don00",0.1,self.x/256,false)
                            PlaySound("kira00",0.1,self.x/256,false)
                            _del(self,true)
                        end)
                        task._Wait(5)
                    i=i+_d_i end end
                    task._Wait(30)
                    task.MoveTo(self.x, 240,90,MOVE_ACCEL)
                    _del(self,true)
                end)
            end)
            task._Wait(60)
            last=New(EnemySimple,7,60,-240, 200,{0,5,1},1,false,true,false,function(self)
                task.New(self,function()
                    task.MoveTo(-100,140,60,MOVE_DECEL)
                    do local i,_d_i=(90+45),(-35) for _=1,7 do
                        PlaySound("kira00",0.1,self.x/256,false)
                        last=New(_straight,ball_huge,COLOR_RED,self.x,self.y,6,i,false,0,true,true,0,false,0,0,0,false)
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            do
                                local _beg_vel=6 local vel=_beg_vel  local _w_vel=0 local _end_vel=0 local _d_w_vel=90/(45-1)
                                for _=1,45 do
                                    SetV2(self,vel,self.rot,true,false)
                                    task._Wait(1)
                                    _w_vel=_w_vel+_d_w_vel vel=(_end_vel-_beg_vel)*sin(_w_vel)+(_beg_vel)
                                end
                            end
                            last_list=_create_bullet_group(ball_mid,COLOR_RED,self.x,self.y,33,0,1,1,0,360,true,0,true,true,0,false,self)
                            PlaySound("don00",0.1,self.x/256,false)
                            PlaySound("kira00",0.1,self.x/256,false)
                            _del(self,true)
                        end)
                        task._Wait(5)
                    i=i+_d_i end end
                    task._Wait(30)
                    task.MoveTo(self.x, 240,90,MOVE_ACCEL)
                    _del(self,true)
                end)
            end)
            last=New(EnemySimple,7,60,240, 200,{0,5,1},1,false,true,false,function(self)
                task.New(self,function()
                    task.MoveTo(100,140,60,MOVE_DECEL)
                    do local i,_d_i=(90-45),(35) for _=1,7 do
                        PlaySound("kira00",0.1,self.x/256,false)
                        last=New(_straight,ball_huge,COLOR_RED,self.x,self.y,6,i,false,0,true,true,0,false,0,0,0,false)
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            do
                                local _beg_vel=6 local vel=_beg_vel  local _w_vel=0 local _end_vel=0 local _d_w_vel=90/(45-1)
                                for _=1,45 do
                                    SetV2(self,vel,self.rot,true,false)
                                    task._Wait(1)
                                    _w_vel=_w_vel+_d_w_vel vel=(_end_vel-_beg_vel)*sin(_w_vel)+(_beg_vel)
                                end
                            end
                            last_list=_create_bullet_group(ball_mid,COLOR_RED,self.x,self.y,33,0,1,1,0,360,true,0,true,true,0,false,self)
                            PlaySound("don00",0.1,self.x/256,false)
                            PlaySound("kira00",0.1,self.x/256,false)
                            _del(self,true)
                        end)
                        task._Wait(5)
                    i=i+_d_i end end
                    task._Wait(30)
                    task.MoveTo(self.x, 240,90,MOVE_ACCEL)
                    _del(self,true)
                end)
            end)
            task._Wait(120)
            last=New(EnemySimple,7,60,-240, 240,{0,5,1},1,false,true,false,function(self)
                task.New(self,function()
                    task.MoveTo(-100,180,60,MOVE_DECEL)
                    do local i,_d_i=(90+45),(35) for _=1,12 do
                        PlaySound("kira00",0.1,self.x/256,false)
                        last=New(_straight,ball_huge,COLOR_GREEN,self.x,self.y,8,i,false,0,true,true,0,false,0,0,0,false)
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            do
                                local _beg_vel=8 local vel=_beg_vel  local _w_vel=0 local _end_vel=0 local _d_w_vel=90/(45-1)
                                for _=1,45 do
                                    SetV2(self,vel,self.rot,true,false)
                                    task._Wait(1)
                                    _w_vel=_w_vel+_d_w_vel vel=(_end_vel-_beg_vel)*sin(_w_vel)+(_beg_vel)
                                end
                            end
                            last_list=_create_bullet_group(ball_mid,COLOR_GREEN,self.x,self.y,22,0,4,4,0,360,true,0,true,true,0,false,self)
                            PlaySound("don00",0.1,self.x/256,false)
                            PlaySound("kira00",0.1,self.x/256,false)
                            _del(self,true)
                        end)
                        task._Wait(5)
                    i=i+_d_i end end
                    task._Wait(30)
                    task.MoveTo(self.x, 240,90,MOVE_ACCEL)
                    _del(self,true)
                end)
            end)
            last=New(EnemySimple,7,60,240, 240,{0,5,1},1,false,true,false,function(self)
                task.New(self,function()
                    task.MoveTo(100,180,60,MOVE_DECEL)
                    do local i,_d_i=(90-45),(-35) for _=1,12 do
                        PlaySound("kira00",0.1,self.x/256,false)
                        last=New(_straight,ball_huge,COLOR_GREEN,self.x,self.y,8,i,false,0,true,true,0,false,0,0,0,false)
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            do
                                local _beg_vel=8 local vel=_beg_vel  local _w_vel=0 local _end_vel=0 local _d_w_vel=90/(45-1)
                                for _=1,45 do
                                    SetV2(self,vel,self.rot,true,false)
                                    task._Wait(1)
                                    _w_vel=_w_vel+_d_w_vel vel=(_end_vel-_beg_vel)*sin(_w_vel)+(_beg_vel)
                                end
                            end
                            last_list=_create_bullet_group(ball_mid,COLOR_GREEN,self.x,self.y,22,0,4,4,0,360,true,0,true,true,0,false,self)
                            PlaySound("don00",0.1,self.x/256,false)
                            PlaySound("kira00",0.1,self.x/256,false)
                            _del(self,true)
                        end)
                        task._Wait(5)
                    i=i+_d_i end end
                    task._Wait(30)
                    task.MoveTo(self.x, 240,90,MOVE_ACCEL)
                    _del(self,true)
                end)
            end)
            task._Wait(60*2)
            for _=1,15 do
                last=New(EnemySimple,26,15,240, 120,{0,2,1},1,false,true,false,function(self)
                    task.New(self,function()
                        lasttask=task.New(self,function()
                            task.MoveTo(-240, 120,120,MOVE_NORMAL)
                            _del(self,true)
                        end)
                        for _=1,_infinite do
                            PlaySound("kira01",0.1,self.x/256,false)
                            last_list=_create_bullet_group(grain_a,COLOR_DEEP_PURPLE,self.x,self.y,3,0,3,4,0,0,true,0,true,true,0,false,self)
                            task._Wait(15)
                        end
                    end)
                end)
                task._Wait(10)
            end
            for _=1,15 do
                last=New(EnemySimple,26,15,-240, 120,{0,2,1},1,false,true,false,function(self)
                    task.New(self,function()
                        lasttask=task.New(self,function()
                            task.MoveTo(240, 120,120,MOVE_NORMAL)
                            _del(self,true)
                        end)
                        for _=1,_infinite do
                            PlaySound("kira01",0.1,self.x/256,false)
                            last_list=_create_bullet_group(grain_a,COLOR_DEEP_PURPLE,self.x,self.y,3,0,3,4,0,0,true,0,true,true,0,false,self)
                            task._Wait(15)
                        end
                    end)
                end)
                task._Wait(10)
            end
            task._Wait(60*2)
            self.finishFormation()
        end
        if formationIndex == 11 then
            last=New(EnemySimple,7,150,-240, 200,{0,3,1},1,false,true,false,function(self)
                task.New(self,function()
                    task.MoveTo(-160, 120,60,MOVE_DECEL)
                    do
                        local _beg_ang=45 local ang=_beg_ang local _end_ang=-90-45 local _d_ang=(_end_ang-_beg_ang)/(15-1)
                        for _=1,15 do
                            last=New(_straight,ball_light,COLOR_DEEP_RED,self.x,self.y,5,ang,false,0,true,true,0,false,0,0,0,false)
                            lasttask=task.New(last,function()
                                local self=task.GetSelf()
                                do
                                    local _beg_vel=5 local vel=_beg_vel  local _w_vel=-90 local _end_vel=0 local _d_w_vel=180/(45-1)
                                    for _=1,45 do
                                        SetV2(self,vel,self.rot,true,false)
                                        task._Wait(1)
                                        _w_vel=_w_vel+_d_w_vel vel=(_end_vel-_beg_vel)/2*sin(_w_vel)+((_end_vel+_beg_vel)/2)
                                    end
                                end
                                for _=1,7 do
                                    PlaySound("kira01",0.1,self.x/256,false)
                                    last_list=_create_bullet_group(ball_mid_c,COLOR_RED,self.x,self.y,5,0,3,4,self.rot,0,false,0,true,true,0,false,self)
                                    task._Wait(30)
                                end
                                _del(self,true)
                            end)
                            PlaySound("tan00",0.1,self.x/256,false)
                            task._Wait(5)
                            ang=ang+_d_ang
                        end
                    end
                    task._Wait(60)
                    task.MoveTo(-20,240,90,MOVE_ACCEL)
                    _del(self,true)
                end)
            end)
            last=New(EnemySimple,7,150,240, 200,{0,3,1},1,false,true,false,function(self)
                task.New(self,function()
                    task.MoveTo(160, 120,60,MOVE_DECEL)
                    do
                        local _beg_ang=-180 - 45 local ang=_beg_ang local _end_ang=-90+45 local _d_ang=(_end_ang-_beg_ang)/(15-1)
                        for _=1,15 do
                            last=New(_straight,ball_light,COLOR_DEEP_RED,self.x,self.y,5,ang,false,0,true,true,0,false,0,0,0,false)
                            lasttask=task.New(last,function()
                                local self=task.GetSelf()
                                do
                                    local _beg_vel=5 local vel=_beg_vel  local _w_vel=-90 local _end_vel=0 local _d_w_vel=180/(45-1)
                                    for _=1,45 do
                                        SetV2(self,vel,self.rot,true,false)
                                        task._Wait(1)
                                        _w_vel=_w_vel+_d_w_vel vel=(_end_vel-_beg_vel)/2*sin(_w_vel)+((_end_vel+_beg_vel)/2)
                                    end
                                end
                                for _=1,7 do
                                    PlaySound("kira01",0.1,self.x/256,false)
                                    last_list=_create_bullet_group(ball_mid_c,COLOR_RED,self.x,self.y,5,0,3,4,self.rot,0,false,0,true,true,0,false,self)
                                    task._Wait(30)
                                end
                                _del(self,true)
                            end)
                            PlaySound("tan00",0.1,self.x/256,false)
                            task._Wait(5)
                            ang=ang+_d_ang
                        end
                    end
                    task._Wait(60)
                    task.MoveTo(20,240,90,MOVE_ACCEL)
                    _del(self,true)
                end)
            end)
            task._Wait(60*2)
            last=New(EnemySimple,8,150,-240, 200,{0,3,1},1,false,true,false,function(self)
                task.New(self,function()
                    task.MoveTo(-160, 160,60,MOVE_DECEL)
                    do
                        local _beg_ang=45 local ang=_beg_ang local _end_ang=-90-45 local _d_ang=(_end_ang-_beg_ang)/(22-1)
                        for _=1,22 do
                            last=New(_straight,ball_light,COLOR_BLUE,self.x,self.y,5,ang,false,0,true,true,0,false,0,0,0,false)
                            lasttask=task.New(last,function()
                                local self=task.GetSelf()
                                do
                                    local _beg_vel=5 local vel=_beg_vel  local _w_vel=-90 local _end_vel=0 local _d_w_vel=180/(45-1)
                                    for _=1,45 do
                                        SetV2(self,vel,self.rot,true,false)
                                        task._Wait(1)
                                        _w_vel=_w_vel+_d_w_vel vel=(_end_vel-_beg_vel)/2*sin(_w_vel)+((_end_vel+_beg_vel)/2)
                                    end
                                end
                                for _=1,7 do
                                    PlaySound("kira01",0.1,self.x/256,false)
                                    last_list=_create_bullet_group(ball_mid_c,COLOR_BLUE,self.x,self.y,5,0,1,2,self.rot,0,false,0,true,true,0,false,self)
                                    task._Wait(30)
                                end
                                _del(self,true)
                            end)
                            PlaySound("tan00",0.1,self.x/256,false)
                            task._Wait(5)
                            ang=ang+_d_ang
                        end
                    end
                    task._Wait(60)
                    task.MoveTo(-20,240,90,MOVE_ACCEL)
                    _del(self,true)
                end)
            end)
            last=New(EnemySimple,8,150,240, 200,{0,3,1},1,false,true,false,function(self)
                task.New(self,function()
                    task.MoveTo(160, 160,60,MOVE_DECEL)
                    do
                        local _beg_ang=-180 - 45 local ang=_beg_ang local _end_ang=-90+45 local _d_ang=(_end_ang-_beg_ang)/(22-1)
                        for _=1,22 do
                            last=New(_straight,ball_light,COLOR_BLUE,self.x,self.y,5,ang,false,0,true,true,0,false,0,0,0,false)
                            lasttask=task.New(last,function()
                                local self=task.GetSelf()
                                do
                                    local _beg_vel=5 local vel=_beg_vel  local _w_vel=-90 local _end_vel=0 local _d_w_vel=180/(45-1)
                                    for _=1,45 do
                                        SetV2(self,vel,self.rot,true,false)
                                        task._Wait(1)
                                        _w_vel=_w_vel+_d_w_vel vel=(_end_vel-_beg_vel)/2*sin(_w_vel)+((_end_vel+_beg_vel)/2)
                                    end
                                end
                                for _=1,7 do
                                    PlaySound("kira01",0.1,self.x/256,false)
                                    last_list=_create_bullet_group(ball_mid_c,COLOR_BLUE,self.x,self.y,5,0,1,2,self.rot,0,false,0,true,true,0,false,self)
                                    task._Wait(30)
                                end
                                _del(self,true)
                            end)
                            PlaySound("tan00",0.1,self.x/256,false)
                            task._Wait(5)
                            ang=ang+_d_ang
                        end
                    end
                    task._Wait(60)
                    task.MoveTo(20,240,90,MOVE_ACCEL)
                    _del(self,true)
                end)
            end)
            task._Wait(60*2)
            do
                local _beg_posx=-200 local posx=_beg_posx local _end_posx=200 local _d_posx=(_end_posx-_beg_posx)/(16-1)
                for _=1,16 do
                    last=New(EnemySimple,8,25,posx, 240,{0,4,1},1,false,true,false,function(self)
                        task.New(self,function()
                            task.MoveTo(self.x, 200,60,MOVE_DECEL)
                            PlaySound("kira02",0.1,self.x/256,false)
                            last_list=_create_bullet_group(ball_mid_c,COLOR_DEEP_GREEN,self.x,self.y,25,0,2,7,-90,0,false,0,true,true,0,false,self)
                            for _,unit in ipairs(last_list) do
                                _set_g(unit,-0.045)
                            end
                            task._Wait(60)
                            task.MoveTo(self.x, 240,60,MOVE_ACCEL)
                            _del(self,true)
                        end)
                    end)
                    posx=posx+_d_posx
                end
            end
            task._Wait(60*2)
            do
                local _beg_posx=-200 local posx=_beg_posx local _end_posx=200 local _d_posx=(_end_posx-_beg_posx)/(15-1)
                for _=1,15 do
                    last=New(EnemySimple,8,25,posx, 240,{0,4,1},1,false,true,false,function(self)
                        task.New(self,function()
                            task.MoveTo(self.x, 200,60,MOVE_DECEL)
                            PlaySound("kira02",0.1,self.x/256,false)
                            last_list=_create_bullet_group(ball_mid_c,COLOR_DEEP_GREEN,self.x,self.y,25,0,2,7,-90,0,false,0,true,true,0,false,self)
                            for _,unit in ipairs(last_list) do
                                _set_g(unit,-0.045)
                            end
                            task._Wait(60)
                            task.MoveTo(self.x, 240,60,MOVE_ACCEL)
                            _del(self,true)
                        end)
                    end)
                    posx=posx+_d_posx
                end
            end
            task._Wait(60*4)
            last=New(EnemySimple,7,150,240, 120,{0,3,1},1,false,true,false,function(self)
                task.New(self,function()
                    task.MoveTo(80,80,60,MOVE_DECEL)
                    PlaySound("kira00",0.1,self.x/256,false)
                    do local ang,_d_ang=(Angle(self, player)),(360/5) for _=1,5 do
                        last_list=_create_bullet_group(star_big,COLOR_DEEP_PURPLE,self.x,self.y,5,0,1,3,ang,0,false,0,true,true,0,false,self)
                        for _,unit in ipairs(last_list) do
                            lasttask=task.New(unit,function()
                                local self=task.GetSelf()
                                task._Wait(45)
                                PlaySound("kira01",0.1,self.x/256,false)
                                last_list=_create_bullet_group(star_small,COLOR_PURPLE,self.x, self.y,5,0,1,3,self.rot+90,0,false,0,true,true,0,false,self)
                                last_list=_create_bullet_group(star_small,COLOR_PURPLE,self.x, self.y,5,0,1,3,self.rot-90,0,false,0,true,true,0,false,self)
                            end)
                        end
                    ang=ang+_d_ang end end
                    task._Wait(60)
                    task.MoveTo(20,240,90,MOVE_ACCEL)
                    _del(self,true)
                end)
            end)
            last=New(EnemySimple,7,150,-240, 120,{0,3,1},1,false,true,false,function(self)
                task.New(self,function()
                    task.MoveTo(-80,80,60,MOVE_DECEL)
                    PlaySound("kira00",0.1,self.x/256,false)
                    do local ang,_d_ang=(Angle(self, player)),(360/5) for _=1,5 do
                        last_list=_create_bullet_group(star_big,COLOR_DEEP_PURPLE,self.x,self.y,5,0,1,3,ang,0,false,0,true,true,0,false,self)
                        for _,unit in ipairs(last_list) do
                            lasttask=task.New(unit,function()
                                local self=task.GetSelf()
                                task._Wait(45)
                                PlaySound("kira01",0.1,self.x/256,false)
                                last_list=_create_bullet_group(star_small,COLOR_PURPLE,self.x, self.y,5,0,1,3,self.rot+90,0,false,0,true,true,0,false,self)
                                last_list=_create_bullet_group(star_small,COLOR_PURPLE,self.x, self.y,5,0,1,3,self.rot-90,0,false,0,true,true,0,false,self)
                            end)
                        end
                    ang=ang+_d_ang end end
                    task._Wait(60)
                    task.MoveTo(-20,240,90,MOVE_ACCEL)
                    _del(self,true)
                end)
            end)
            task._Wait(60*2)
            last=New(EnemySimple,7,150,240, 120,{0,3,1},1,false,true,false,function(self)
                task.New(self,function()
                    task.MoveTo(120,120,60,MOVE_DECEL)
                    PlaySound("kira00",0.1,self.x/256,false)
                    do local ang,_d_ang=(Angle(self, player)),(360/5) for _=1,5 do
                        last_list=_create_bullet_group(star_big,COLOR_DEEP_PURPLE,self.x,self.y,5,0,1,3,ang,0,false,0,true,true,0,false,self)
                        for _,unit in ipairs(last_list) do
                            lasttask=task.New(unit,function()
                                local self=task.GetSelf()
                                task._Wait(45)
                                PlaySound("kira01",0.1,self.x/256,false)
                                last_list=_create_bullet_group(star_small,COLOR_PURPLE,self.x, self.y,5,0,1,3,self.rot+90,0,false,0,true,true,0,false,self)
                                last_list=_create_bullet_group(star_small,COLOR_PURPLE,self.x, self.y,5,0,1,3,self.rot-90,0,false,0,true,true,0,false,self)
                            end)
                        end
                    ang=ang+_d_ang end end
                    task._Wait(60)
                    task.MoveTo(20,240,90,MOVE_ACCEL)
                    _del(self,true)
                end)
            end)
            last=New(EnemySimple,7,150,-240, 120,{0,3,1},1,false,true,false,function(self)
                task.New(self,function()
                    task.MoveTo(-120,120,60,MOVE_DECEL)
                    PlaySound("kira00",0.1,self.x/256,false)
                    do local ang,_d_ang=(Angle(self, player)),(360/5) for _=1,5 do
                        last_list=_create_bullet_group(star_big,COLOR_DEEP_PURPLE,self.x,self.y,5,0,1,3,ang,0,false,0,true,true,0,false,self)
                        for _,unit in ipairs(last_list) do
                            lasttask=task.New(unit,function()
                                local self=task.GetSelf()
                                task._Wait(45)
                                PlaySound("kira01",0.1,self.x/256,false)
                                last_list=_create_bullet_group(star_small,COLOR_PURPLE,self.x, self.y,5,0,1,3,self.rot+90,0,false,0,true,true,0,false,self)
                                last_list=_create_bullet_group(star_small,COLOR_PURPLE,self.x, self.y,5,0,1,3,self.rot-90,0,false,0,true,true,0,false,self)
                            end)
                        end
                    ang=ang+_d_ang end end
                    task._Wait(60)
                    task.MoveTo(-20,240,90,MOVE_ACCEL)
                    _del(self,true)
                end)
            end)
            task._Wait(60*2)
            last=New(EnemySimple,7,150,240, 120,{0,3,1},1,false,true,false,function(self)
                task.New(self,function()
                    task.MoveTo(150,150,60,MOVE_DECEL)
                    PlaySound("kira00",0.1,self.x/256,false)
                    do local ang,_d_ang=(Angle(self, player)),(360/10) for _=1,10 do
                        last_list=_create_bullet_group(star_big,COLOR_DEEP_PURPLE,self.x,self.y,5,0,1,3,ang,0,false,0,true,true,0,false,self)
                        for _,unit in ipairs(last_list) do
                            lasttask=task.New(unit,function()
                                local self=task.GetSelf()
                                task._Wait(45)
                                PlaySound("kira01",0.1,self.x/256,false)
                                last_list=_create_bullet_group(star_small,COLOR_PURPLE,self.x, self.y,5,0,1,3,self.rot+90,0,false,0,true,true,0,false,self)
                                last_list=_create_bullet_group(star_small,COLOR_PURPLE,self.x, self.y,5,0,1,3,self.rot-90,0,false,0,true,true,0,false,self)
                            end)
                        end
                    ang=ang+_d_ang end end
                    task._Wait(60)
                    task.MoveTo(20,240,90,MOVE_ACCEL)
                    _del(self,true)
                end)
            end)
            last=New(EnemySimple,7,150,-240, 120,{0,3,1},1,false,true,false,function(self)
                task.New(self,function()
                    task.MoveTo(-150,150,60,MOVE_DECEL)
                    PlaySound("kira00",0.1,self.x/256,false)
                    do local ang,_d_ang=(Angle(self, player)),(360/10) for _=1,10 do
                        last_list=_create_bullet_group(star_big,COLOR_DEEP_PURPLE,self.x,self.y,5,0,1,3,ang,0,false,0,true,true,0,false,self)
                        for _,unit in ipairs(last_list) do
                            lasttask=task.New(unit,function()
                                local self=task.GetSelf()
                                task._Wait(45)
                                PlaySound("kira01",0.1,self.x/256,false)
                                last_list=_create_bullet_group(star_small,COLOR_PURPLE,self.x, self.y,5,0,1,3,self.rot+90,0,false,0,true,true,0,false,self)
                                last_list=_create_bullet_group(star_small,COLOR_PURPLE,self.x, self.y,5,0,1,3,self.rot-90,0,false,0,true,true,0,false,self)
                            end)
                        end
                    ang=ang+_d_ang end end
                    task._Wait(60)
                    task.MoveTo(-20,240,90,MOVE_ACCEL)
                    _del(self,true)
                end)
            end)
            task._Wait(60*5)
            self.finishFormation()
        end
        if formationIndex == 12 then
            last=New(EnemySimple,9,250,-240, 180,{0,15,5},1,false,true,false,function(self)
                task.New(self,function()
                    lasttask=task.New(self,function()
                        task.Basis2MoveTo(60*7,MOVE_NORMAL,200, 160, -200, 120, 140, 60, -240, 0)
                        _del(self,true)
                    end)
                    for _=1,_infinite do
                        for _=1,6 do
                            PlaySound("kira00",0.1,self.x/256,false)
                            do local i,_d_i=(4),(-0.5) for _=1,5 do
                                last_list=_create_bullet_group(arrow_big,COLOR_ORANGE,self.x,self.y,5,0,i,i,-90,360,false,0,true,true,0,false,self)
                            i=i+_d_i end end
                            task._Wait(10)
                        end
                        task._Wait(40)
                    end
                end)
            end)
            last=New(EnemySimple,9,250,240, 180,{0,15,5},1,false,true,false,function(self)
                task.New(self,function()
                    lasttask=task.New(self,function()
                        task.Basis2MoveTo(60*7,MOVE_NORMAL,-200, 160, 200, 120, -140, 60, 240, 0)
                        _del(self,true)
                    end)
                    for _=1,_infinite do
                        for _=1,6 do
                            PlaySound("kira00",0.1,self.x/256,false)
                            do local i,_d_i=(4),(-0.5) for _=1,5 do
                                last_list=_create_bullet_group(arrow_big,COLOR_ORANGE,self.x,self.y,5,0,i,i,-90,360,false,0,true,true,0,false,self)
                            i=i+_d_i end end
                            task._Wait(10)
                        end
                        task._Wait(40)
                    end
                end)
            end)
            task._Wait(60)
            for _=1,15 do
                last=New(EnemySimple,8,50,ran:Int(120, 180), 240,{0,7,2},1,false,true,false,function(self)
                    task.New(self,function()
                        task.MoveTo(self.x, 160,60,MOVE_DECEL)
                        PlaySound("kira02",0.1,self.x/256,false)
                        last_list=_create_bullet_group(ball_light,COLOR_ROYAL_BLUE,self.x,self.y,7,0,0.1,0.1,ran:Int(0, 360),360,false,0,true,true,0,false,self)
                        for _,unit in ipairs(last_list) do
                            _set_a(unit,0.025,unit.rot,false)
                            _forbid_v(unit,4,'original','original')
                        end
                        task.MoveTo(self.x, 240,60,MOVE_ACCEL)
                        _del(self,true)
                    end)
                end)
                last=New(EnemySimple,8,50,ran:Int(-120, -180), 240,{0,7,2},1,false,true,false,function(self)
                    task.New(self,function()
                        task.MoveTo(self.x, 160,60,MOVE_DECEL)
                        PlaySound("kira02",0.1,self.x/256,false)
                        last_list=_create_bullet_group(ball_light,COLOR_ROYAL_BLUE,self.x,self.y,7,0,0.1,0.1,ran:Int(0, 360),360,false,0,true,true,0,false,self)
                        for _,unit in ipairs(last_list) do
                            _set_a(unit,0.025,unit.rot,false)
                            _forbid_v(unit,4,'original','original')
                        end
                        task.MoveTo(self.x, 240,60,MOVE_ACCEL)
                        _del(self,true)
                    end)
                end)
                task._Wait(20)
            end
            task._Wait(60*2)
            last=New(EnemySimple,9,250,-240, 180,{0,15,5},1,false,true,false,function(self)
                task.New(self,function()
                    lasttask=task.New(self,function()
                        task.Basis2MoveTo(60*9,MOVE_NORMAL,200, 160, -200, 120, 140, 60, -240, 0)
                        _del(self,true)
                    end)
                    for _=1,_infinite do
                        for _=1,8 do
                            PlaySound("kira00",0.1,self.x/256,false)
                            do local i,_d_i=(4),(-0.5) for _=1,5 do
                                last_list=_create_bullet_group(arrow_big,COLOR_ORANGE,self.x,self.y,7,0,i,i,-90,360,false,0,true,true,0,false,self)
                            i=i+_d_i end end
                            task._Wait(4)
                        end
                        task._Wait(20)
                    end
                end)
            end)
            last=New(EnemySimple,9,250,240, 180,{0,15,5},1,false,true,false,function(self)
                task.New(self,function()
                    lasttask=task.New(self,function()
                        task.Basis2MoveTo(60*9,MOVE_NORMAL,-200, 160, 200, 120, -140, 60, 240, 0)
                        _del(self,true)
                    end)
                    for _=1,_infinite do
                        for _=1,8 do
                            PlaySound("kira00",0.1,self.x/256,false)
                            do local i,_d_i=(4),(-0.5) for _=1,5 do
                                last_list=_create_bullet_group(arrow_big,COLOR_ORANGE,self.x,self.y,7,0,i,i,-90,360,false,0,true,true,0,false,self)
                            i=i+_d_i end end
                            task._Wait(4)
                        end
                        task._Wait(20)
                    end
                end)
            end)
            task._Wait(60*9)
            last=New(EnemySimple,9,250,-240, 180,{0,15,5},1,false,true,false,function(self)
                task.New(self,function()
                    lasttask=task.New(self,function()
                        task.Basis2MoveTo(60*9,MOVE_NORMAL,200, 160, -200, 120, 140, 60, -240, 0)
                        _del(self,true)
                    end)
                    for _=1,_infinite do
                        for _=1,8 do
                            PlaySound("kira00",0.1,self.x/256,false)
                            do local i,_d_i=(4),(-0.5) for _=1,5 do
                                last_list=_create_bullet_group(arrow_big,COLOR_BLUE,self.x,self.y,7,0,i,i,-90+45,360,false,0,true,true,0,false,self)
                            i=i+_d_i end end
                            task._Wait(4)
                        end
                        task._Wait(20)
                    end
                end)
            end)
            last=New(EnemySimple,9,250,240, 180,{0,15,5},1,false,true,false,function(self)
                task.New(self,function()
                    lasttask=task.New(self,function()
                        task.Basis2MoveTo(60*9,MOVE_NORMAL,-200, 160, 200, 120, -140, 60, 240, 0)
                        _del(self,true)
                    end)
                    for _=1,_infinite do
                        for _=1,8 do
                            PlaySound("kira00",0.1,self.x/256,false)
                            do local i,_d_i=(4),(-0.5) for _=1,5 do
                                last_list=_create_bullet_group(arrow_big,COLOR_BLUE,self.x,self.y,7,0,i,i,-90-45,360,false,0,true,true,0,false,self)
                            i=i+_d_i end end
                            task._Wait(4)
                        end
                        task._Wait(20)
                    end
                end)
            end)
            task._Wait(60*10)
            self.finishFormation()
        end
        if formationIndex == 13 then
            lasttask=task.New(self,function()
                task._Wait(120)
                last=New(EnemySimple,ran:Int(7, 8),70,140, 240,{0,8,2},1,false,true,true,function(self)
                    task.New(self,function()
                        lasttask=task.New(self,function()
                            task.MoveTo(self.x, 120,120,MOVE_DECEL)
                            task._Wait(60)
                            task.MoveTo(self.x - 120, 240,120,MOVE_ACCEL)
                            _del(self,true)
                        end)
                        do local i,_d_i=(90),(5) for _=1,60 do
                            PlaySound("tan00",0.1,self.x/256,false)
                            last_list=_create_bullet_group(square,COLOR_ROYAL_BLUE,self.x,self.y,4,0,3,3,i,360,false,0,true,true,0,false,self)
                            last_list=_create_bullet_group(square,COLOR_ROYAL_BLUE,self.x,self.y,4,0,3,3,-i,360,false,0,true,true,0,false,self)
                            task._Wait(8)
                        i=i+_d_i end end
                    end)
                end)
                last=New(EnemySimple,ran:Int(7, 8),70,-140, 240,{0,8,2},1,false,true,true,function(self)
                    task.New(self,function()
                        lasttask=task.New(self,function()
                            task.MoveTo(self.x, 120,120,MOVE_DECEL)
                            task._Wait(60)
                            task.MoveTo(self.x + 120, 240,120,MOVE_ACCEL)
                            _del(self,true)
                        end)
                        do local i,_d_i=(90),(5) for _=1,60 do
                            PlaySound("tan00",0.1,self.x/256,false)
                            last_list=_create_bullet_group(square,COLOR_ROYAL_BLUE,self.x,self.y,4,0,3,3,i,360,false,0,true,true,0,false,self)
                            last_list=_create_bullet_group(square,COLOR_ROYAL_BLUE,self.x,self.y,4,0,3,3,-i,360,false,0,true,true,0,false,self)
                            task._Wait(8)
                        i=i+_d_i end end
                    end)
                end)
                task._Wait(60*4)
                last=New(EnemySimple,ran:Int(7, 8),70,60, 240,{0,8,2},1,false,true,true,function(self)
                    task.New(self,function()
                        lasttask=task.New(self,function()
                            task.MoveTo(self.x, 120,120,MOVE_DECEL)
                            task._Wait(60)
                            task.MoveTo(self.x - 120, 240,120,MOVE_ACCEL)
                            _del(self,true)
                        end)
                        do local i,_d_i=(90),(5) for _=1,60 do
                            PlaySound("tan00",0.1,self.x/256,false)
                            last_list=_create_bullet_group(square,COLOR_BLUE,self.x,self.y,4,0,2,2,i,360,false,0,true,true,0,false,self)
                            last_list=_create_bullet_group(square,COLOR_BLUE,self.x,self.y,4,0,2,2,-i,360,false,0,true,true,0,false,self)
                            task._Wait(8)
                        i=i+_d_i end end
                    end)
                end)
                last=New(EnemySimple,ran:Int(7, 8),70,-60, 240,{0,8,2},1,false,true,true,function(self)
                    task.New(self,function()
                        lasttask=task.New(self,function()
                            task.MoveTo(self.x, 120,120,MOVE_DECEL)
                            task._Wait(60)
                            task.MoveTo(self.x + 120, 240,120,MOVE_ACCEL)
                            _del(self,true)
                        end)
                        do local i,_d_i=(90),(5) for _=1,60 do
                            PlaySound("tan00",0.1,self.x/256,false)
                            last_list=_create_bullet_group(square,COLOR_BLUE,self.x,self.y,4,0,2,2,i,360,false,0,true,true,0,false,self)
                            last_list=_create_bullet_group(square,COLOR_BLUE,self.x,self.y,4,0,2,2,-i,360,false,0,true,true,0,false,self)
                            task._Wait(8)
                        i=i+_d_i end end
                    end)
                end)
                task._Wait(60*4)
                last=New(EnemySimple,ran:Int(7, 8),70,30, 240,{0,8,2},1,false,true,true,function(self)
                    task.New(self,function()
                        lasttask=task.New(self,function()
                            task.MoveTo(self.x, 120,120,MOVE_DECEL)
                            task._Wait(60)
                            task.MoveTo(self.x - 120, 240,120,MOVE_ACCEL)
                            _del(self,true)
                        end)
                        do local i,_d_i=(90),(5) for _=1,60 do
                            PlaySound("tan00",0.1,self.x/256,false)
                            last_list=_create_bullet_group(square,COLOR_DEEP_PURPLE,self.x,self.y,6,0,1,1,i,360,false,0,true,true,0,false,self)
                            last_list=_create_bullet_group(square,COLOR_DEEP_PURPLE,self.x,self.y,6,0,1,1,-i,360,false,0,true,true,0,false,self)
                            task._Wait(8)
                        i=i+_d_i end end
                    end)
                end)
                last=New(EnemySimple,ran:Int(7, 8),70,-30, 240,{0,8,2},1,false,true,true,function(self)
                    task.New(self,function()
                        lasttask=task.New(self,function()
                            task.MoveTo(self.x, 120,120,MOVE_DECEL)
                            task._Wait(60)
                            task.MoveTo(self.x + 120, 240,120,MOVE_ACCEL)
                            _del(self,true)
                        end)
                        do local i,_d_i=(90),(5) for _=1,60 do
                            PlaySound("tan00",0.1,self.x/256,false)
                            last_list=_create_bullet_group(square,COLOR_DEEP_PURPLE,self.x,self.y,6,0,1,1,i,360,false,0,true,true,0,false,self)
                            last_list=_create_bullet_group(square,COLOR_DEEP_PURPLE,self.x,self.y,6,0,1,1,-i,360,false,0,true,true,0,false,self)
                            task._Wait(8)
                        i=i+_d_i end end
                    end)
                end)
            end)
            for _=1,30 do
                last=New(EnemySimple,ran:Int(1, 4),15,ran:Int(-180,180), 240,{0,4,2},1,false,true,false,function(self)
                    task.New(self,function()
                        lasttask=task.New(self,function()
                            if self.x > 0 then
                                task.CRMoveTo(120,MODE_NORMAL,self.x, 120, self.x + 40, ran:Int(-40, 120), 240, 0)
                                _del(self,true)
                            else
                                task.CRMoveTo(120,MODE_NORMAL,self.x, 120, self.x - 40, ran:Int(-40, 120), -240, 0)
                                _del(self,true)
                            end
                        end)
                        task._Wait(30)
                        do local col,_d_col=(ran:Int(1, 14)),(0) for _=1,_infinite do
                            PlaySound("kira00",0.1,self.x/256,false)
                            local ang=(ran:Int(-15, 15))
                            do local i,_d_i=(ran:Int(0, 360)),(360/15) for _=1,15 do
                                last=New(_straight,ball_mid_c,col,self.x + 30 * cos(i),self.y + 30 * sin(i),2.5,ang,true,0,true,true,0,false,0,0,0,false)
                            i=i+_d_i end end
                            task._Wait(60)
                        col=col+_d_col end end
                    end)
                end)
                task._Wait(35)
            end
            task._Wait(60*4.5)
            self.finishFormation()
        end
        if formationIndex == 14 then
            do
                local _beg_posx=-140 local posx=_beg_posx local _end_posx=140 local _d_posx=(_end_posx-_beg_posx)/(6-1)
                for _=1,6 do
                    last=New(EnemySimple,14,80,posx, 240,{0,15,5},90,false,true,false,function(self)
                        task.New(self,function()
                            SetV2(self,1,-90,false,false)
                            lasttask=task.New(self,function()
                                do
                                    local _h_ang=(20-(-20))/2 local _t_ang=(20+(-20))/2 local ang=_h_ang*sin(0)+_t_ang local _w_ang=0 local _d_w_ang=10
                                    for _=1,_infinite do
                                        last=New(_straight,ball_mid_b,COLOR_DEEP_PURPLE,self.x + 35 * cos(90 - 45 + ang),self.y + 35 * sin(90 - 45 + ang),3,90 - 45 + ang,false,0,true,true,0,false,0,0,0,false)
                                        last=New(_straight,ball_mid_b,COLOR_DEEP_PURPLE,self.x + 35 * cos(45 + 90 + ang),self.y + 35 * sin(45 + 90 + ang),3,45 + 90 + ang,false,0,true,true,0,false,0,0,0,false)
                                        last=New(_straight,ball_mid_b,COLOR_DEEP_PURPLE,self.x + 35 * cos(-45 + ang),self.y + 35 * sin(-45 + ang),3,-45 + ang,false,0,true,true,0,false,0,0,0,false)
                                        last=New(_straight,ball_mid_b,COLOR_DEEP_PURPLE,self.x + 35 * cos(-45 - 90 + ang),self.y + 35 * sin(-45 - 90 + ang),3,-45 - 90 + ang,false,0,true,true,0,false,0,0,0,false)
                                        task._Wait(5)
                                        PlaySound("tan00",0.1,self.x/256,false)
                                        _w_ang=_w_ang+_d_w_ang ang=_h_ang*sin(_w_ang)+_t_ang
                                    end
                                end
                            end)
                            lasttask=task.New(self,function()
                                do
                                    for _=1,_infinite do
                                        PlaySound("tan01",0.1,self.x/256,false)
                                        last_list=_create_bullet_group(ball_mid_b,COLOR_DEEP_PURPLE,self.x,self.y,25,0,2,2,0,360,true,0,true,true,0,false,self)
                                        task._Wait(60)
                                    end
                                end
                            end)
                        end)
                    end)
                    task._Wait(60*2)
                    posx=posx+_d_posx
                end
            end
            do
                local _beg_posx=140 local posx=_beg_posx local _end_posx=-140 local _d_posx=(_end_posx-_beg_posx)/(6-1)
                for _=1,6 do
                    last=New(EnemySimple,14,80,posx, 240,{0,15,5},90,false,true,false,function(self)
                        task.New(self,function()
                            SetV2(self,1,-90,false,false)
                            lasttask=task.New(self,function()
                                do
                                    local _h_ang=(20-(-20))/2 local _t_ang=(20+(-20))/2 local ang=_h_ang*sin(0)+_t_ang local _w_ang=0 local _d_w_ang=10
                                    for _=1,_infinite do
                                        last=New(_straight,ball_mid_b,COLOR_DEEP_PURPLE,self.x + 35 * cos(90 - 45 + ang),self.y + 35 * sin(90 - 45 + ang),3,90 - 45 + ang,false,0,true,true,0,false,0,0,0,false)
                                        last=New(_straight,ball_mid_b,COLOR_DEEP_PURPLE,self.x + 35 * cos(45 + 90 + ang),self.y + 35 * sin(45 + 90 + ang),3,45 + 90 + ang,false,0,true,true,0,false,0,0,0,false)
                                        last=New(_straight,ball_mid_b,COLOR_DEEP_PURPLE,self.x + 35 * cos(-45 + ang),self.y + 35 * sin(-45 + ang),3,-45 + ang,false,0,true,true,0,false,0,0,0,false)
                                        last=New(_straight,ball_mid_b,COLOR_DEEP_PURPLE,self.x + 35 * cos(-45 - 90 + ang),self.y + 35 * sin(-45 - 90 + ang),3,-45 - 90 + ang,false,0,true,true,0,false,0,0,0,false)
                                        task._Wait(5)
                                        PlaySound("tan00",0.1,self.x/256,false)
                                        _w_ang=_w_ang+_d_w_ang ang=_h_ang*sin(_w_ang)+_t_ang
                                    end
                                end
                            end)
                            lasttask=task.New(self,function()
                                do
                                    for _=1,_infinite do
                                        PlaySound("tan01",0.1,self.x/256,false)
                                        last_list=_create_bullet_group(ball_mid_b,COLOR_DEEP_PURPLE,self.x,self.y,25,0,2,2,0,360,true,0,true,true,0,false,self)
                                        task._Wait(60)
                                    end
                                end
                            end)
                        end)
                    end)
                    task._Wait(60*2)
                    posx=posx+_d_posx
                end
            end
            task._Wait(60*3)
            self.finishFormation()
        end
        if formationIndex == 15 then
            do local p,_d_p=(0),(120) for _=1,4 do
                last=New(EnemySimple,9,100,240, 240 - p,{0,22,6},1,false,true,false,function(self)
                    task.New(self,function()
                        lasttask=task.New(self,function()
                            for _=1,_infinite do
                                PlaySound("tan01",0.1,self.x/256,false)
                                last_list=_create_bullet_group(arrow_big,COLOR_GOLDEN_YELLOW,self.x,self.y,22,0,4,4,45,60,false,0,true,true,0,false,self)
                                for _,unit in ipairs(last_list) do
                                    _object.set_color(unit,"mul+add",255,255,255,255)
                                end
                                task._Wait(8)
                            end
                        end)
                        SetV2(self,2,-90 - 45,false,false)
                        task._Wait(60)
                        do local i,_d_i=(25),(25) for _=1,3 do
                            last=New(EnemySimple,4,10,self.x + i * cos(0 + 20),self.y + i * sin(0 + 20),{0,0,0},1,false,true,false,function(self)
                                task.New(self,function()
                                    SetV2(self,2,-90 - 45,false,false)
                                    for _=1,_infinite do
                                        PlaySound("tan00",0.1,self.x/256,false)
                                        last_list=_create_bullet_group(ball_mid_c,COLOR_YELLOW,self.x,self.y,15,0,2,2,0,360,true,0,true,true,0,false,self)
                                        task._Wait(60)
                                    end
                                end)
                            end)
                            _connect(self,last,0,true)
                            last=New(EnemySimple,4,10,self.x + i * cos(90 - 20),self.y + i * sin(90 - 20),{0,0,0},1,false,true,false,function(self)
                                task.New(self,function()
                                    SetV2(self,2,-90 - 45,false,false)
                                    for _=1,_infinite do
                                        PlaySound("tan00",0.1,self.x/256,false)
                                        last_list=_create_bullet_group(ball_mid_c,COLOR_YELLOW,self.x,self.y,15,0,2,2,0,360,true,0,true,true,0,false,self)
                                        task._Wait(60)
                                    end
                                end)
                            end)
                            _connect(self,last,0,true)
                            task._Wait(45)
                        i=i+_d_i end end
                    end)
                end)
                task._Wait(120)
            p=p+_d_p end end
            do local p,_d_p=(0),(120) for _=1,4 do
                last=New(EnemySimple,9,100,-240, 240 - p,{0,22,6},1,false,true,false,function(self)
                    task.New(self,function()
                        lasttask=task.New(self,function()
                            for _=1,_infinite do
                                PlaySound("tan01",0.1,self.x/256,false)
                                last_list=_create_bullet_group(arrow_big,COLOR_GOLDEN_YELLOW,self.x,self.y,22,0,4,4,45 + 90,60,false,0,true,true,0,false,self)
                                for _,unit in ipairs(last_list) do
                                    _object.set_color(unit,"mul+add",255,255,255,255)
                                end
                                task._Wait(8)
                            end
                        end)
                        SetV2(self,2,-90 + 45,false,false)
                        task._Wait(60)
                        do local i,_d_i=(25),(25) for _=1,3 do
                            last=New(EnemySimple,4,10,self.x + i * cos(0 + 20 + 90),self.y + i * sin(0 + 20 + 90),{0,0,0},1,false,true,false,function(self)
                                task.New(self,function()
                                    SetV2(self,2,-90 + 45,false,false)
                                    for _=1,_infinite do
                                        PlaySound("tan00",0.1,self.x/256,false)
                                        last_list=_create_bullet_group(ball_mid_c,COLOR_YELLOW,self.x,self.y,15,0,2,2,0,360,true,0,true,true,0,false,self)
                                        task._Wait(60)
                                    end
                                end)
                            end)
                            _connect(self,last,0,true)
                            last=New(EnemySimple,4,10,self.x + i * cos(90 - 20 + 90),self.y + i * sin(90 - 20 + 90),{0,0,0},1,false,true,false,function(self)
                                task.New(self,function()
                                    SetV2(self,2,-90 + 45,false,false)
                                    for _=1,_infinite do
                                        PlaySound("tan00",0.1,self.x/256,false)
                                        last_list=_create_bullet_group(ball_mid_c,COLOR_YELLOW,self.x,self.y,15,0,2,2,0,360,true,0,true,true,0,false,self)
                                        task._Wait(60)
                                    end
                                end)
                            end)
                            _connect(self,last,0,true)
                            task._Wait(45)
                        i=i+_d_i end end
                    end)
                end)
                task._Wait(120)
            p=p+_d_p end end
            do local p,_d_p=(0),(120) for _=1,4 do
                last=New(EnemySimple,9,60,240, 240 - p,{0,22,6},1,false,true,false,function(self)
                    task.New(self,function()
                        lasttask=task.New(self,function()
                            for _=1,_infinite do
                                PlaySound("tan01",0.1,self.x/256,false)
                                last_list=_create_bullet_group(arrow_big,COLOR_GOLDEN_YELLOW,self.x,self.y,7,0,4,4,45,60,false,0,true,true,0,false,self)
                                for _,unit in ipairs(last_list) do
                                    _object.set_color(unit,"mul+add",255,255,255,255)
                                end
                                task._Wait(24)
                            end
                        end)
                        SetV2(self,2,-90 - 45,false,false)
                        task._Wait(60)
                        do local i,_d_i=(25),(25) for _=1,3 do
                            last=New(EnemySimple,4,10,self.x + i * cos(0 + 20),self.y + i * sin(0 + 20),{0,0,0},1,false,true,false,function(self)
                                task.New(self,function()
                                    SetV2(self,2,-90 - 45,false,false)
                                    for _=1,_infinite do
                                        PlaySound("tan00",0.1,self.x/256,false)
                                        last_list=_create_bullet_group(ball_mid_c,COLOR_YELLOW,self.x,self.y,5,0,2,2,0,360,true,0,true,true,0,false,self)
                                        task._Wait(60)
                                    end
                                end)
                            end)
                            _connect(self,last,0,true)
                            last=New(EnemySimple,4,10,self.x + i * cos(90 - 20),self.y + i * sin(90 - 20),{0,0,0},1,false,true,false,function(self)
                                task.New(self,function()
                                    SetV2(self,2,-90 - 45,false,false)
                                    for _=1,_infinite do
                                        PlaySound("tan00",0.1,self.x/256,false)
                                        last_list=_create_bullet_group(ball_mid_c,COLOR_YELLOW,self.x,self.y,5,0,2,2,0,360,true,0,true,true,0,false,self)
                                        task._Wait(60)
                                    end
                                end)
                            end)
                            _connect(self,last,0,true)
                            task._Wait(45)
                        i=i+_d_i end end
                    end)
                end)
                last=New(EnemySimple,9,60,-240, 240 - p,{0,22,6},1,false,true,false,function(self)
                    task.New(self,function()
                        lasttask=task.New(self,function()
                            for _=1,_infinite do
                                PlaySound("tan01",0.1,self.x/256,false)
                                last_list=_create_bullet_group(arrow_big,COLOR_GOLDEN_YELLOW,self.x,self.y,7,0,4,4,45 + 90,60,false,0,true,true,0,false,self)
                                for _,unit in ipairs(last_list) do
                                    _object.set_color(unit,"mul+add",255,255,255,255)
                                end
                                task._Wait(24)
                            end
                        end)
                        SetV2(self,2,-90 + 45,false,false)
                        task._Wait(60)
                        do local i,_d_i=(25),(25) for _=1,3 do
                            last=New(EnemySimple,4,10,self.x + i * cos(0 + 20 + 90),self.y + i * sin(0 + 20 + 90),{0,0,0},1,false,true,false,function(self)
                                task.New(self,function()
                                    SetV2(self,2,-90 + 45,false,false)
                                    for _=1,_infinite do
                                        PlaySound("tan00",0.1,self.x/256,false)
                                        last_list=_create_bullet_group(ball_mid_c,COLOR_YELLOW,self.x,self.y,5,0,2,2,0,360,true,0,true,true,0,false,self)
                                        task._Wait(60)
                                    end
                                end)
                            end)
                            _connect(self,last,0,true)
                            last=New(EnemySimple,4,10,self.x + i * cos(90 - 20 + 90),self.y + i * sin(90 - 20 + 90),{0,0,0},1,false,true,false,function(self)
                                task.New(self,function()
                                    SetV2(self,2,-90 + 45,false,false)
                                    for _=1,_infinite do
                                        PlaySound("tan00",0.1,self.x/256,false)
                                        last_list=_create_bullet_group(ball_mid_c,COLOR_YELLOW,self.x,self.y,5,0,2,2,0,360,true,0,true,true,0,false,self)
                                        task._Wait(60)
                                    end
                                end)
                            end)
                            _connect(self,last,0,true)
                            task._Wait(45)
                        i=i+_d_i end end
                    end)
                end)
                task._Wait(60*3)
            p=p+_d_p end end
            self.finishFormation()
        end
        if formationIndex == 16 then
            lasttask=task.New(self,function()
                for _=1,6 do
                    last=New(EnemySimple,24,9999,ran:Int(-160, 160), 280,{0,0,0},1,false,false,false,function(self)
                        task.New(self,function()
                            _object.set_color(self,"mul+add",200,215,215,215)
                            PlaySound("boon01",0.1,self.x/256,false)
                            self.y = 340
                            SetV2(self,ran:Float(4.1, 5),-90,false,false)
                            lasttask=task.New(self,function()
                                do
                                    local _beg_scale=1 local scale=_beg_scale  local _w_scale=0 local _end_scale=2.5 local _d_w_scale=90/(45-1)
                                    for _=1,45 do
                                        self.hscale, self.vscale = scale, scale
                                        task._Wait(1)
                                        _w_scale=_w_scale+_d_w_scale scale=(_end_scale-_beg_scale)*sin(_w_scale)+(_beg_scale)
                                    end
                                end
                            end)
                            lasttask=task.New(self,function()
                                task._Wait(60)
                                self.bound = true
                            end)
                            lasttask=task.New(self,function()
                                for _=1,_infinite do
                                    last_list=_create_bullet_group(ellipse,COLOR_DEEP_GREEN,self.x + ran:Int(-50, 50), self.y + ran:Int(30, 55),3,0,ran:Int(2,3),ran:Int(2,3),ran:Int(90 - 5, 90 + 5),0,false,0,true,true,0,false,self)
                                    PlaySound("kira00",0.1,self.x/256,false)
                                    task._Wait(5)
                                end
                            end)
                        end)
                    end)
                    misc.ShakeScreen(35,2)
                    task._Wait(60)
                end
            end)
            for _=1,10 do
                last=New(EnemySimple,26,30,140, 250,{0,7,1},1,false,true,false,function(self)
                    task.New(self,function()
                        SetV2(self,3,-90,false,false)
                        task._Wait(60)
                        PlaySound("kira01",0.1,self.x/256,false)
                        last_list=_create_bullet_group(ball_mid,COLOR_PURPLE,self.x,self.y,20,0,2,2,0,360,true,0,true,true,0,false,self)
                    end)
                end)
                last=New(EnemySimple,26,30,-140, 250,{0,7,1},1,false,true,false,function(self)
                    task.New(self,function()
                        SetV2(self,3,-90,false,false)
                        task._Wait(60)
                        PlaySound("kira01",0.1,self.x/256,false)
                        last_list=_create_bullet_group(ball_mid,COLOR_PURPLE,self.x,self.y,20,0,2,2,0,360,true,0,true,true,0,false,self)
                    end)
                end)
                task._Wait(30)
            end
            task._Wait(60)
            for _=1,6 do
                last=New(EnemySimple,25,35,ran:Int(120, 140), 240,{0,6,1},1,false,true,false,function(self)
                    task.New(self,function()
                        self.colli = false
                        lasttask=task.New(self,function()
                            task.MoveTo(ran:Int(120, 140),-190,120,MOVE_ACC_DEC)
                            self.colli = true
                            task.CRMoveTo(360,MOVE_NORMAL,ran:Int(80, 180), -50, ran:Int(80, 180), 0, ran:Int(80, 180), 50, ran:Int(80, 180), 100, ran:Int(80, 180), 260)
                        end)
                        lasttask=task.New(self,function()
                            do
                                local _beg_colA=47 local colA=_beg_colA  local _w_colA=-90 local _end_colA=255 local _d_w_colA=180/(120-1)
                                local _beg_colB=50 local colB=_beg_colB  local _w_colB=-90 local _end_colB=255 local _d_w_colB=180/(120-1)
                                local _beg_colC=86 local colC=_beg_colC  local _w_colC=-90 local _end_colC=255 local _d_w_colC=180/(120-1)
                                local _beg_colD=0 local colD=_beg_colD  local _w_colD=-90 local _end_colD=255 local _d_w_colD=180/(120-1)
                                local _beg_size=0.4 local size=_beg_size  local _w_size=-90 local _end_size=1 local _d_w_size=180/(120-1)
                                for _=1,120 do
                                    self.hscale, self.vscale = size, size
                                    _object.set_color(self,"",colD,colA,colB,colC)
                                    task._Wait(1)
                                    _w_colA=_w_colA+_d_w_colA colA=(_end_colA-_beg_colA)/2*sin(_w_colA)+((_end_colA+_beg_colA)/2)
                                    _w_colB=_w_colB+_d_w_colB colB=(_end_colB-_beg_colB)/2*sin(_w_colB)+((_end_colB+_beg_colB)/2)
                                    _w_colC=_w_colC+_d_w_colC colC=(_end_colC-_beg_colC)/2*sin(_w_colC)+((_end_colC+_beg_colC)/2)
                                    _w_colD=_w_colD+_d_w_colD colD=(_end_colD-_beg_colD)/2*sin(_w_colD)+((_end_colD+_beg_colD)/2)
                                    _w_size=_w_size+_d_w_size size=(_end_size-_beg_size)/2*sin(_w_size)+((_end_size+_beg_size)/2)
                                end
                            end
                            for _=1,3 do
                                PlaySound("kira00",0.1,self.x/256,false)
                                last_list=_create_bullet_group(grain_a,COLOR_BLUE,self.x,self.y,13,0,2,2,0,360,false,0,true,true,0,false,self)
                                last_list=_create_bullet_group(grain_a,COLOR_BLUE,self.x,self.y,8,0,1,1,0,360,false,0,true,true,0,true,self)
                                task._Wait(15)
                            end
                        end)
                    end)
                end)
                last=New(EnemySimple,25,35,-ran:Int(120, 140), 240,{0,6,1},1,false,true,false,function(self)
                    task.New(self,function()
                        self.colli = false
                        lasttask=task.New(self,function()
                            task.MoveTo(-ran:Int(120, 140),-190,120,MOVE_ACC_DEC)
                            self.colli = true
                            task.CRMoveTo(360,MOVE_NORMAL,-ran:Int(80, 180), -50, -ran:Int(80, 180), 0, -ran:Int(80, 180), 50, -ran:Int(80, 180), 100, -ran:Int(80, 180), 260)
                        end)
                        lasttask=task.New(self,function()
                            do
                                local _beg_colA=47 local colA=_beg_colA  local _w_colA=-90 local _end_colA=255 local _d_w_colA=180/(120-1)
                                local _beg_colB=50 local colB=_beg_colB  local _w_colB=-90 local _end_colB=255 local _d_w_colB=180/(120-1)
                                local _beg_colC=86 local colC=_beg_colC  local _w_colC=-90 local _end_colC=255 local _d_w_colC=180/(120-1)
                                local _beg_colD=0 local colD=_beg_colD  local _w_colD=-90 local _end_colD=255 local _d_w_colD=180/(120-1)
                                local _beg_size=0.4 local size=_beg_size  local _w_size=-90 local _end_size=1 local _d_w_size=180/(120-1)
                                for _=1,120 do
                                    self.hscale, self.vscale = size, size
                                    _object.set_color(self,"",colD,colA,colB,colC)
                                    task._Wait(1)
                                    _w_colA=_w_colA+_d_w_colA colA=(_end_colA-_beg_colA)/2*sin(_w_colA)+((_end_colA+_beg_colA)/2)
                                    _w_colB=_w_colB+_d_w_colB colB=(_end_colB-_beg_colB)/2*sin(_w_colB)+((_end_colB+_beg_colB)/2)
                                    _w_colC=_w_colC+_d_w_colC colC=(_end_colC-_beg_colC)/2*sin(_w_colC)+((_end_colC+_beg_colC)/2)
                                    _w_colD=_w_colD+_d_w_colD colD=(_end_colD-_beg_colD)/2*sin(_w_colD)+((_end_colD+_beg_colD)/2)
                                    _w_size=_w_size+_d_w_size size=(_end_size-_beg_size)/2*sin(_w_size)+((_end_size+_beg_size)/2)
                                end
                            end
                            for _=1,3 do
                                PlaySound("kira00",0.1,self.x/256,false)
                                last_list=_create_bullet_group(grain_a,COLOR_BLUE,self.x,self.y,13,0,2,2,180,360,false,0,true,true,0,false,self)
                                last_list=_create_bullet_group(grain_a,COLOR_BLUE,self.x,self.y,8,0,1,1,180,360,false,0,true,true,0,true,self)
                                task._Wait(15)
                            end
                        end)
                    end)
                end)
                task._Wait(90)
            end
            task._Wait(60*5)
            self.finishFormation()
        end
        if formationIndex == 17 then
            last=New(EnemySimple,7,70,240, 140,{0,9,2},1,false,true,false,function(self)
                task.New(self,function()
                    lasttask=task.New(self,function()
                        task.MoveTo(-120,120,60,MOVE_DECEL)
                        task._Wait(60)
                        task.MoveTo(self.x, 240,90,MOVE_ACCEL)
                        _del(self,true)
                    end)
                    for _=1,10 do
                        last=New(_editor_class["N17Laser"],self.x,self.y,_)
                        last_list=_create_bullet_group(ball_light,COLOR_RED,self.x,self.y,10,0,2,2,0,360,true,0,true,true,0,false,self)
                        PlaySound("kira01",0.1,self.x/256,false)
                        task._Wait(5)
                    end
                    task._Wait(60)
                    do
                        local _beg_ang=0 local ang=_beg_ang local _end_ang=180 local _d_ang=(_end_ang-_beg_ang)/(8-1)
                        for _=1,8 do
                            PlaySound("kira00",0.1,self.x/256,false)
                            last=New(_straight,ball_light,COLOR_RED,self.x,self.y,2,ang,false,0,true,true,0,false,0.1,ang,0,false)
                            lasttask=task.New(last,function()
                                local self=task.GetSelf()
                                task._Wait(25)
                                last=New(_editor_class["N17Laser"],self.x,self.y,_)
                                last_list=_create_bullet_group(ball_small,COLOR_RED,self.x,self.y,10,0,2,2,0,360,true,0,true,true,0,false,self)
                                PlaySound("kira01",0.1,self.x/256,false)
                                _del(self,true)
                            end)
                            task._Wait(5)
                            ang=ang+_d_ang
                        end
                    end
                end)
            end)
            task._Wait(120)
            last=New(EnemySimple,7,70,-240, 140,{0,9,2},1,false,true,false,function(self)
                task.New(self,function()
                    lasttask=task.New(self,function()
                        task.MoveTo(120,120,60,MOVE_DECEL)
                        task._Wait(60)
                        task.MoveTo(self.x, 240,90,MOVE_ACCEL)
                        _del(self,true)
                    end)
                    for _=1,10 do
                        last=New(_editor_class["N17Laser"],self.x,self.y,_)
                        last_list=_create_bullet_group(ball_light,COLOR_RED,self.x,self.y,10,0,2,2,0,360,true,0,true,true,0,false,self)
                        PlaySound("kira01",0.1,self.x/256,false)
                        task._Wait(5)
                    end
                    task._Wait(60)
                    do
                        local _beg_ang=180 local ang=_beg_ang local _end_ang=0 local _d_ang=(_end_ang-_beg_ang)/(8-1)
                        for _=1,8 do
                            PlaySound("kira00",0.1,self.x/256,false)
                            last=New(_straight,ball_light,COLOR_RED,self.x,self.y,2,ang,false,0,true,true,0,false,0.1,ang,0,false)
                            lasttask=task.New(last,function()
                                local self=task.GetSelf()
                                task._Wait(25)
                                last=New(_editor_class["N17Laser"],self.x,self.y,_)
                                last_list=_create_bullet_group(ball_small,COLOR_RED,self.x,self.y,10,0,2,2,0,360,true,0,true,true,0,false,self)
                                PlaySound("kira01",0.1,self.x/256,false)
                                _del(self,true)
                            end)
                            task._Wait(5)
                            ang=ang+_d_ang
                        end
                    end
                end)
            end)
            task._Wait(120)
            last=New(EnemySimple,14,190,0, 240,{0,15,4},1,false,true,false,function(self)
                task.New(self,function()
                    task.MoveTo(0,120,60,MOVE_DECEL)
                    PlaySound("tan00",0.1,self.x/256,false)
                    for _=1,3 do
                        do local ang,_d_ang=(Angle(self, player)),(360/32) for _=1,32 do
                            last=New(_straight,ball_huge,COLOR_RED,self.x,self.y,2,ang,false,0,true,true,0,false,0,0,0,false)
                            lasttask=task.New(last,function()
                                local self=task.GetSelf()
                                task._Wait(25)
                                last=New(_editor_class["N17Laser_2"],self.x,self.y,self.rot)
                            end)
                        ang=ang+_d_ang end end
                        task._Wait(60)
                    end
                    task.MoveTo(0,240,60,MOVE_ACCEL)
                    _del(self,true)
                end)
            end)
            task._Wait(60*2.75)
            for _=1,12 do
                last=New(EnemySimple,14,70,ran:Int(-170, 170), 224,{0,0,6},1,false,true,false,function(self)
                    task.New(self,function()
                        do
                            local _beg_vy=-4 local vy=_beg_vy  local _w_vy=-90 local _end_vy=-1 local _d_w_vy=180/(45-1)
                            for _=1,45 do
                                self.vy = vy
                                task._Wait(1)
                                _w_vy=_w_vy+_d_w_vy vy=(_end_vy-_beg_vy)/2*sin(_w_vy)+((_end_vy+_beg_vy)/2)
                            end
                        end
                        local starang=(Angle(self, player))
                        PlaySound("kira02",0.1,self.x/256,false)
                        last_list=_create_bullet_group(ball_small,COLOR_DEEP_RED,self.x,self.y,35,0,1,1,0,360,true,0,true,true,0,false,self)
                        PlaySound("kira00",0.1,self.x/256,false)
                        do local rot,_d_rot,dist,_d_dist=(starang),(360/60),(30*2),(5*2) for _=1,60 do
                            if dist > 60*2 then
                            	dist = 30*2
                            end
                            if dist < 45*2 then
                                last=New(_straight,arrow_big,COLOR_DEEP_RED,self.x + dist * cos(rot),self.y + dist * sin(rot),2,rot,false,0,true,true,0,false,0,0,0,false)
                            end
                        rot=rot+_d_rot dist=dist+_d_dist end end
                        do local rot,_d_rot,dist,_d_dist=(starang),(-360/60),(30*2),(5*2) for _=1,60 do
                            if dist > 60*2 then
                            	dist = 30*2
                            end
                            if dist < 45*2 then
                                last=New(_straight,arrow_big,COLOR_DEEP_RED,self.x + dist * cos(rot),self.y + dist * sin(rot),2,rot,false,0,true,true,0,false,0,0,0,false)
                            end
                        rot=rot+_d_rot dist=dist+_d_dist end end
                    end)
                end)
                task._Wait(60)
            end
            task._Wait(60*5)
            self.finishFormation()
        end
        if formationIndex == 18 then
            do
                local _beg_posx=-120 local posx=_beg_posx local _end_posx=120 local _d_posx=(_end_posx-_beg_posx)/(2-1)
                for _=1,2 do
                    last=New(EnemySimple,14,150,posx, 240,{0,8,4},30,false,true,false,function(self)
                        task.New(self,function()
                            lasttask=task.New(self,function()
                                for _=1,20 do
                                    last=New(_editor_class["N18Laser"],self.x,self.y,90, 2)
                                    _connect(self,last,0,true)
                                    last=New(_editor_class["N18Laser"],self.x,self.y,90, -2)
                                    _connect(self,last,0,true)
                                    task._Wait(5)
                                end
                                lasttask=task.New(self,function()
                                    for _=1,_infinite do
                                        PlaySound("kira00",0.1,self.x/256,false)
                                        do local ang,_d_ang=(-90),(360/7) for _=1,7 do
                                            last=New(_editor_class["N18Bullet"],self.x + 40 * cos(ang), self.y + 40 * sin(ang),ang, 1)
                                            _connect(self,last,0,true)
                                            last=New(_editor_class["N18Bullet"],self.x + 40 * cos(ang), self.y + 40 * sin(ang),ang, -1)
                                            _connect(self,last,0,true)
                                        ang=ang+_d_ang end end
                                        task._Wait(60)
                                        PlaySound("kira00",0.1,self.x/256,false)
                                        do local ang,_d_ang=(90),(360/7) for _=1,7 do
                                            last=New(_editor_class["N18Bullet"],self.x + 40 * cos(ang), self.y + 40 * sin(ang),ang, 1)
                                            _connect(self,last,0,true)
                                            last=New(_editor_class["N18Bullet"],self.x + 40 * cos(ang), self.y + 40 * sin(ang),ang, -1)
                                            _connect(self,last,0,true)
                                        ang=ang+_d_ang end end
                                        task._Wait(60)
                                    end
                                end)
                            end)
                            task.MoveTo(self.x, -240,60*7,MOVE_NORMAL)
                            _del(self,true)
                        end)
                    end)
                    posx=posx+_d_posx
                end
            end
            task._Wait(60*6)
            last=New(EnemySimple,14,180,0, 240,{0,8,4},30,false,true,false,function(self)
                task.New(self,function()
                    lasttask=task.New(self,function()
                        for _=1,20 do
                            last=New(_editor_class["N18Laser"],self.x,self.y,90, 2)
                            _connect(self,last,0,true)
                            last=New(_editor_class["N18Laser"],self.x,self.y,90, -2)
                            _connect(self,last,0,true)
                            task._Wait(5)
                        end
                        lasttask=task.New(self,function()
                            for _=1,_infinite do
                                PlaySound("kira00",0.1,self.x/256,false)
                                do local ang,_d_ang=(-90),(360/7) for _=1,7 do
                                    last=New(_editor_class["N18Bullet"],self.x + 40 * cos(ang), self.y + 40 * sin(ang),ang, 1)
                                    _connect(self,last,0,true)
                                    last=New(_editor_class["N18Bullet"],self.x + 40 * cos(ang), self.y + 40 * sin(ang),ang, -1)
                                    _connect(self,last,0,true)
                                ang=ang+_d_ang end end
                                task._Wait(60)
                                PlaySound("kira00",0.1,self.x/256,false)
                                do local ang,_d_ang=(90),(360/7) for _=1,7 do
                                    last=New(_editor_class["N18Bullet"],self.x + 40 * cos(ang), self.y + 40 * sin(ang),ang, 1)
                                    _connect(self,last,0,true)
                                    last=New(_editor_class["N18Bullet"],self.x + 40 * cos(ang), self.y + 40 * sin(ang),ang, -1)
                                    _connect(self,last,0,true)
                                ang=ang+_d_ang end end
                                task._Wait(60)
                            end
                        end)
                    end)
                    task.MoveTo(self.x, -240,60*7,MOVE_NORMAL)
                    _del(self,true)
                end)
            end)
            task._Wait(60*6)
            do
                local _beg_posx=-120 local posx=_beg_posx local _end_posx=120 local _d_posx=(_end_posx-_beg_posx)/(2-1)
                for _=1,2 do
                    last=New(EnemySimple,14,170,posx, 240,{0,8,4},30,false,true,false,function(self)
                        task.New(self,function()
                            lasttask=task.New(self,function()
                                for _=1,20 do
                                    last=New(_editor_class["N18Laser"],self.x,self.y,90, 2)
                                    _connect(self,last,0,true)
                                    last=New(_editor_class["N18Laser"],self.x,self.y,90, -2)
                                    _connect(self,last,0,true)
                                    task._Wait(5)
                                end
                                lasttask=task.New(self,function()
                                    for _=1,_infinite do
                                        PlaySound("kira00",0.1,self.x/256,false)
                                        do local ang,_d_ang=(-90),(360/7) for _=1,7 do
                                            last=New(_editor_class["N18Bullet"],self.x + 40 * cos(ang), self.y + 40 * sin(ang),ang, 1)
                                            _connect(self,last,0,true)
                                            last=New(_editor_class["N18Bullet"],self.x + 40 * cos(ang), self.y + 40 * sin(ang),ang, -1)
                                            _connect(self,last,0,true)
                                        ang=ang+_d_ang end end
                                        task._Wait(60)
                                        PlaySound("kira00",0.1,self.x/256,false)
                                        do local ang,_d_ang=(90),(360/7) for _=1,7 do
                                            last=New(_editor_class["N18Bullet"],self.x + 40 * cos(ang), self.y + 40 * sin(ang),ang, 1)
                                            _connect(self,last,0,true)
                                            last=New(_editor_class["N18Bullet"],self.x + 40 * cos(ang), self.y + 40 * sin(ang),ang, -1)
                                            _connect(self,last,0,true)
                                        ang=ang+_d_ang end end
                                        task._Wait(60)
                                    end
                                end)
                            end)
                            task.MoveTo(self.x, -240,60*7,MOVE_NORMAL)
                            _del(self,true)
                        end)
                    end)
                    posx=posx+_d_posx
                end
            end
            task._Wait(60*8.5)
            self.finishFormation()
        end
        --[[ ]]
        
    end
    lasttask=task.New(self,function()
        for _=1,amount do
            if forceFormation then
                self.startFormation(self.formations[4][forceFormation])
            else
                local rngNum = ran:Int(1, #self.formations[stageIndex])
                if rngNum ~= self.lastNum then
                	self.startFormation(self.formations[stageIndex][rngNum])
                else
                	self.startFormation(self.formations[stageIndex][Wrap(rngNum + 1, 1, #self.formations[stageIndex])])
                end
                self.lastNum = rngNum
            end
            while self.formationQueueNext == false do
                task._Wait(1)
            end
            self.formationQueueNext = false
        end
        lstg.var.finishStage = true
    end)
end
_editor_class["Section_Announcer"]=Class(_object)
_editor_class["Section_Announcer"].init=function(self,_x,_y,waveText)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_ENEMY-5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.x,self.y=0,250
    self.waveText = waveText
    PlaySound("noise",1,self.x/256,false)
    lasttask=task.New(self,function()
        do
            local _beg_pos=250 local pos=_beg_pos local _end_pos=160 local _w_pos=0 local _d_w_pos=1/(45-1)
            local _beg_col=0 local col=_beg_col local _end_col=255 local _w_col=0 local _d_w_col=1/(45-1)
            for _=1,45 do
                _object.set_color(self,"",col,255,255,255)
                self.x,self.y=0,pos
                task._Wait(1)
                _w_pos=_w_pos+_d_w_pos pos=(_beg_pos-_end_pos)*(_w_pos-1)^2+_end_pos
                _w_col=_w_col+_d_w_col col=(_beg_col-_end_col)*(_w_col-1)^2+_end_col
            end
        end
        task._Wait(30)
        do
            local _beg_pos=160 local pos=_beg_pos local _end_pos=120 local _w_pos=0  local _d_w_pos=1/(30-1)
            local _beg_col=255 local col=_beg_col local _end_col=0 local _w_col=0  local _d_w_col=1/(30-1)
            for _=1,30 do
                _object.set_color(self,"",col,255,255,255)
                self.x,self.y=0,pos
                task._Wait(1)
                _w_pos=_w_pos+_d_w_pos pos=(_end_pos-_beg_pos)*_w_pos^2+_beg_pos
                _w_col=_w_col+_d_w_col col=(_end_col-_beg_col)*_w_col^2+_beg_col
            end
        end
        _del(self,true)
    end)
end
_editor_class["Section_Announcer"].render=function(self)
    SetFontState("font:trocchi","",Color(self._a - 35,255,225,145))
    lstg.RenderText("font:trocchi","Enemy Wave Incoming",self.x,self.y,1/2.25 - 0.2,5)
    SetFontState("font:trocchi","",Color(self._a - 35,255,255,255))
    lstg.RenderText("font:trocchi",self.waveText,self.x,self.y-25,1/2.25 - 0.275,5)
    self.class.base.render(self)
end
_editor_class["Spell_Cutin"]=Class(_object)
_editor_class["Spell_Cutin"].init=function(self,_x,_y,char)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_TOP-1
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.x=280
    self.y=15
    self.vscale=1/2.25
    self.hscale=1/2.25
    self.img = "image:" .. char .. "_Cutin"
    _object.set_color(self,"",0,255,255,255)
    lasttask=task.New(self,function()
        New(tasker, function()
            lasttask=task.New(self,function()
                do
                    local _beg_speed=9.5 local speed=_beg_speed  local _w_speed=-90 local _end_speed=0.8 local _d_w_speed=180/(46-1)
                    for _=1,46 do
                        SetV2(self,speed,190,false,false)
                        task._Wait(1)
                        _w_speed=_w_speed+_d_w_speed speed=(_end_speed-_beg_speed)/2*sin(_w_speed)+((_end_speed+_beg_speed)/2)
                    end
                end
                task._Wait(60)
                do
                    local _beg_speed=0.8 local speed=_beg_speed  local _w_speed=-90 local _end_speed=7 local _d_w_speed=90/(46-1)
                    for _=1,46 do
                        SetV2(self,speed,190,false,false)
                        task._Wait(1)
                        _w_speed=_w_speed+_d_w_speed speed=(_end_speed-_beg_speed)*sin(_w_speed)+(_end_speed)
                    end
                end
                _del(self,true)
            end)
            lasttask=task.New(self,function()
                do
                    local _beg_alpha_a=0 local alpha_a=_beg_alpha_a  local _w_alpha_a=0 local _end_alpha_a=255 local _d_w_alpha_a=90/(46-1)
                    local _beg_alpha_b=0 local alpha_b=_beg_alpha_b  local _w_alpha_b=-90 local _end_alpha_b=255 local _d_w_alpha_b=180/(46-1)
                    for _=1,46 do
                        _object.set_color(self,"",alpha_b,alpha_a,alpha_a,alpha_a)
                        task._Wait(1)
                        _w_alpha_a=_w_alpha_a+_d_w_alpha_a alpha_a=(_end_alpha_a-_beg_alpha_a)*sin(_w_alpha_a)+(_beg_alpha_a)
                        _w_alpha_b=_w_alpha_b+_d_w_alpha_b alpha_b=(_end_alpha_b-_beg_alpha_b)/2*sin(_w_alpha_b)+((_end_alpha_b+_beg_alpha_b)/2)
                    end
                end
                task._Wait(60)
                do
                    local _beg_alpha_a=255 local alpha_a=_beg_alpha_a  local _w_alpha_a=0 local _end_alpha_a=200 local _d_w_alpha_a=90/(46-1)
                    local _beg_alpha_b=255 local alpha_b=_beg_alpha_b  local _w_alpha_b=-90 local _end_alpha_b=0 local _d_w_alpha_b=180/(46-1)
                    for _=1,46 do
                        _object.set_color(self,"",alpha_b,alpha_a,alpha_a,alpha_a)
                        task._Wait(1)
                        _w_alpha_a=_w_alpha_a+_d_w_alpha_a alpha_a=(_end_alpha_a-_beg_alpha_a)*sin(_w_alpha_a)+(_beg_alpha_a)
                        _w_alpha_b=_w_alpha_b+_d_w_alpha_b alpha_b=(_end_alpha_b-_beg_alpha_b)/2*sin(_w_alpha_b)+((_end_alpha_b+_beg_alpha_b)/2)
                    end
                end
            end)
        end)
    end)
end
_editor_class["SongDisplayer"]=Class(_object)
_editor_class["SongDisplayer"].init=function(self,_x,_y,boss)
    self.x,self.y=_x,_y
    self.img="image:SongLabel1"
    self.layer=LAYER_TOP+5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.bound = false
    self.hscale, self.vscale = 1/2.25, 1/2.25
    self.x,self.y=224, -224 + 50/2.25
    if boss then
        if lstg.var.selectedStage == 1 then
            self.img="img_void"
        elseif lstg.var.selectedStage == 2 then
            self.img="image:SongLabel3"
        elseif lstg.var.selectedStage == 3 then
            self.img="image:SongLabel5"
        elseif lstg.var.selectedStage == 4 then
            self.img="image:SongLabel7"
        else
        end
    else
        if lstg.var.selectedStage == 1 then
            self.img="image:SongLabel1"
        elseif lstg.var.selectedStage == 2 then
            self.img="image:SongLabel2"
        elseif lstg.var.selectedStage == 3 then
            self.img="image:SongLabel4"
        elseif lstg.var.selectedStage == 4 then
            self.img="image:SongLabel6"
        else
        end
    end
    lasttask=task.New(self,function()
        do
            local _beg_alp=0 local alp=_beg_alp  local _w_alp=0 local _end_alp=255 local _d_w_alp=90/(30-1)
            for _=1,30 do
                _object.set_color(self,"",alp,255,255,255)
                task._Wait(1)
                _w_alp=_w_alp+_d_w_alp alp=(_end_alp-_beg_alp)*sin(_w_alp)+(_beg_alp)
            end
        end
        task._Wait(120+60*1.5)
        do
            local _beg_alp=255 local alp=_beg_alp  local _w_alp=-90 local _end_alp=0 local _d_w_alp=90/(30-1)
            for _=1,30 do
                _object.set_color(self,"",alp,255,255,255)
                task._Wait(1)
                _w_alp=_w_alp+_d_w_alp alp=(_end_alp-_beg_alp)*sin(_w_alp)+(_end_alp)
            end
        end
    end)
    lasttask=task.New(self,function()
        task.MoveTo(0, -224 + 50/2.25,60,MOVE_DECEL)
        task._Wait(90+60*1.5)
        task.MoveTo(-224, -224 + 50/2.25,60,MOVE_ACCEL)
        _del(self,true)
    end)
end
_editor_class["TutorialHandler"]=Class(_object)
_editor_class["TutorialHandler"].init=function(self,_x,_y,cardNum)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_TOP
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.cardProgress = 224
    self.x,self.y=75, 0
    self.hscale, self.vscale = 1/2.25, 1/2.25
    self.img="image:TutorialCard" .. cardNum
    lasttask=task.New(self,function()
        if cardNum == 1 then
            do
                local _beg_rect=224 local rect=_beg_rect local _end_rect=-224 local _d_rect=(_end_rect-_beg_rect)/(60*5-1)
                for _=1,60*5 do
                    self.cardProgress = rect
                    task._Wait(1)
                    rect=rect+_d_rect
                end
            end
        elseif cardNum == 2 then
            do
                local _beg_rect=224 local rect=_beg_rect local _end_rect=-224 local _d_rect=(_end_rect-_beg_rect)/(60*11-1)
                for _=1,60*11 do
                    self.cardProgress = rect
                    task._Wait(1)
                    rect=rect+_d_rect
                end
            end
        elseif cardNum == 3 then
            do
                local _beg_rect=224 local rect=_beg_rect local _end_rect=-224 local _d_rect=(_end_rect-_beg_rect)/(60*16-1)
                for _=1,60*16 do
                    self.cardProgress = rect
                    task._Wait(1)
                    rect=rect+_d_rect
                end
            end
        elseif cardNum == 4 then
            do
                local _beg_rect=224 local rect=_beg_rect local _end_rect=-224 local _d_rect=(_end_rect-_beg_rect)/(60*17-1)
                for _=1,60*17 do
                    self.cardProgress = rect
                    task._Wait(1)
                    rect=rect+_d_rect
                end
            end
        else
        end
    end)
    lasttask=task.New(self,function()
        do
            local _beg_alp=0 local alp=_beg_alp  local _w_alp=0 local _end_alp=255 local _d_w_alp=90/(30-1)
            for _=1,30 do
                _object.set_color(self,"",alp,255,255,255)
                task._Wait(1)
                _w_alp=_w_alp+_d_w_alp alp=(_end_alp-_beg_alp)*sin(_w_alp)+(_beg_alp)
            end
        end
        if cardNum == 1 then
            task._Wait(60*4)
        elseif cardNum == 2 then
            task._Wait(60*10)
        elseif cardNum == 3 then
            task._Wait(60*15)
        elseif cardNum == 4 then
            task._Wait(60*16)
        else
        end
        do
            local _beg_alp=255 local alp=_beg_alp  local _w_alp=-90 local _end_alp=0 local _d_w_alp=90/(30-1)
            for _=1,30 do
                _object.set_color(self,"",alp,255,255,255)
                task._Wait(1)
                _w_alp=_w_alp+_d_w_alp alp=(_end_alp-_beg_alp)*sin(_w_alp)+(_end_alp)
            end
        end
    end)
    lasttask=task.New(self,function()
        task.MoveTo(0, 0,30,MOVE_DECEL)
        if cardNum == 1 then
            task._Wait(60*4)
        elseif cardNum == 2 then
            task._Wait(60*10)
        elseif cardNum == 3 then
            task._Wait(60*15)
        elseif cardNum == 4 then
            task._Wait(60*16)
        else
        end
        task.MoveTo(-75, 0,30,MOVE_ACCEL)
        _del(self,true)
    end)
end
_editor_class["TutorialHandler"].render=function(self)
    SetImageState("white","",Color(255,33,164,106))
    RenderRect("white",-224,self.cardProgress,220,224)
    self.class.base.render(self)
end
_editor_class["StageClearDisplayer"]=Class(_object)
_editor_class["StageClearDisplayer"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="image:StageClear"
    self.layer=LAYER_TOP+5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.hscale, self.vscale = 1/2.25, 1/2.25
    _object.set_color(self,"",0,255,255,255)
    PlaySound("cardget",1,self.x/256,false)
    self.x,self.y=0,-100
    if not scoredata.credits then scoredata.credits = false end
    lasttask=task.New(self,function()
        do
            local _beg_alp=0 local alp=_beg_alp  local _w_alp=0 local _end_alp=255 local _d_w_alp=90/(30-1)
            for _=1,30 do
                _object.set_color(self,"",alp,255,255,255)
                task._Wait(1)
                _w_alp=_w_alp+_d_w_alp alp=(_end_alp-_beg_alp)*sin(_w_alp)+(_beg_alp)
            end
        end
    end)
    lasttask=task.New(self,function()
        task.MoveTo(0,0,60,MOVE_DECEL)
        task._Wait(190)
        do
            New(mask_fader,'close')
            task.New(self,function()
            	local _,bgm=EnumRes('bgm')
            	for i=1,30 do
            		for _,v in pairs(bgm) do
            			if GetMusicState(v)=='playing' then
            				SetBGMVolume(v,1-i/30)
            			end
            		end
            		task.Wait()
            	end
            end)
            task.Wait(30)
            if lstg.var.selectedStage == 4 and scoredata.credits == false then
            	scoredata.credits = true
            	stage.group.Start(stage.groups['StaffRoll'], 0)
            else
            	stage.group.FinishStage()
            end
        end
    end)
end
_editor_class["CharacterTitle"]=Class(_object)
_editor_class["CharacterTitle"].init=function(self,_x,_y,char)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_TOP+999
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.hscale, self.vscale = 1/2.25, 0
    self.img = "image:Title_" .. char
    lasttask=task.New(self,function()
        do
            local _beg_sizey=0 local sizey=_beg_sizey  local _w_sizey=-90 local _end_sizey=1/2.25 local _d_w_sizey=180/(20-1)
            for _=1,20 do
                self.hscale, self.vscale = 1/2.25, sizey
                task._Wait(1)
                _w_sizey=_w_sizey+_d_w_sizey sizey=(_end_sizey-_beg_sizey)/2*sin(_w_sizey)+((_end_sizey+_beg_sizey)/2)
            end
        end
        task._Wait(190)
        do
            local _beg_sizey=1/2.25 local sizey=_beg_sizey  local _w_sizey=-90 local _end_sizey=0 local _d_w_sizey=180/(60-1)
            local _beg_sizex=1/2.25 local sizex=_beg_sizex  local _w_sizex=-90 local _end_sizex=1/1.5 local _d_w_sizex=180/(60-1)
            local _beg_col=255 local col=_beg_col  local _w_col=-90 local _end_col=0 local _d_w_col=180/(60-1)
            for _=1,60 do
                self.hscale, self.vscale = sizex, sizey
                _object.set_color(self,"",col,255,255,255)
                task._Wait(1)
                _w_sizey=_w_sizey+_d_w_sizey sizey=(_end_sizey-_beg_sizey)/2*sin(_w_sizey)+((_end_sizey+_beg_sizey)/2)
                _w_sizex=_w_sizex+_d_w_sizex sizex=(_end_sizex-_beg_sizex)/2*sin(_w_sizex)+((_end_sizex+_beg_sizex)/2)
                _w_col=_w_col+_d_w_col col=(_end_col-_beg_col)/2*sin(_w_col)+((_end_col+_beg_col)/2)
            end
        end
        _del(self,true)
    end)
end
_editor_class["CharacterTitle"].render=function(self)
    SetViewMode'ui'
    self.class.base.render(self)
    SetViewMode'world'
end
_editor_class["StaffRollManager"]=Class(_object)
_editor_class["StaffRollManager"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="image:StaffRoll"
    self.layer=LAYER_TOP+5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.hscale, self.vscale = 1/2.25, 1/2.25
    self.vx, self.vy = 0, 1
    SetImageState("image:StaffRollBackgroundTwo","mul+add",Color(50,255,255,255))
    SetImageState("altwhite","",Color(255,0,0,0))
    lasttask=task.New(self,function()
        do
            local _beg_col=255 local col=_beg_col  local _w_col=0 local _end_col=0 local _d_w_col=90/(60-1)
            for _=1,60 do
                SetImageState("altwhite","",Color(col,0,0,0))
                task._Wait(1)
                _w_col=_w_col+_d_w_col col=(_end_col-_beg_col)*sin(_w_col)+(_beg_col)
            end
        end
        while self.y < 1700 do
            task._Wait(1)
        end
        do
            local _beg_col=0 local col=_beg_col  local _w_col=-90 local _end_col=255 local _d_w_col=90/(60*3-1)
            for _=1,60*3 do
                SetImageState("altwhite","",Color(col,0,0,0))
                task._Wait(1)
                _w_col=_w_col+_d_w_col col=(_end_col-_beg_col)*sin(_w_col)+(_end_col)
            end
        end
        
            New(mask_fader,'close')
            _stop_music()
            task.Wait(30)
            stage.group.FinishGroup()
            for _=1,_infinite do
                SetImageState("altwhite","",Color(255,0,0,0))
                task._Wait(1)
            end
        
    end)
end
_editor_class["StaffRollManager"].render=function(self)
    SetViewMode'ui'
    Render("image:StaffRollBackgroundOne",screen.width/2, screen.height/2,0,self.hscale, self.vscale,0.5)
    Render("image:StaffRollBackgroundTwo",screen.width/2, screen.height/2,self.timer * 0.1,self.hscale + 0.05, self.vscale + 0.05,0.5)
    self.class.base.render(self)
    Render("altwhite",screen.width/2, screen.height/2,0,1920, 1080,0.5)
    SetViewMode'world'
end
_editor_class["DebugENM"]=Class(enemy)
_editor_class["DebugENM"].init=function(self,_x,_y,_)
    enemy.init(self,9,10000,false,true,false)
    self.x,self.y=_x,_y
    self.drop={0,0,0}
    task.New(self,function() self.protect=true task.Wait(1) self.protect=false end)
    self.x, self.y = 0, 144
    self.layer = LAYER_TOP + 999
    self.hp = 10000
    self.damage_frames = {}
    for i=1, 60 do
        self.damage_frames[i] = 0
    end
end
_editor_class["DebugENM"].frame=function(self)
    local damage_frame = 10000 - self.hp
    for i=59, 1, -1 do
         self.damage_frames[i+1] = self.damage_frames[i]
    end
    self.damage_frames[1] = damage_frame
    local average_damage = 0
    for i=1, 60 do
        average_damage = average_damage + self.damage_frames[i]
    end
    self.average_damage = average_damage
    self.class.base.frame(self)
    self.hp = 10000
end
_editor_class["DebugENM"].render=function(self)
    SetViewMode'ui'
    lstg.RenderText('menu', 'AVG DMG = ' .. self.average_damage ..  ' \n', 445, 160, 0.425, 0)
    SetViewMode'world'
    self.class.base.render(self)
end
_editor_class["PlantEnemy"]=Class(enemy)
_editor_class["PlantEnemy"].init=function(self,_x,_y,_)
    enemy.init(self,14,30,false,true,true)
    self.x,self.y=_x,_y
    self.drop={0,ran:Int(12, 18),0}
    task.New(self,function() self.protect=true task.Wait(1) self.protect=false end)
    if lstg.var.stage_name == "Scene@ActJudge" then Del(self) end
    self.bound = false
    _object.set_color(self,"",115,255,255,255)
    if lstg.var.selectedStage == 1 or lstg.var.selectedStage == 2 then
        self.hscale, self.vscale = 2, 2
    elseif lstg.var.selectedStage == 3 then
        self.hscale, self.vscale = 1.65, 1.65
    elseif lstg.var.selectedStage == 4 then
        self.hscale, self.vscale = 1.35, 1.35
    end
    self.type = ran:Int(1, 100)
    if self.type < 40 then
    	self.type = 1
    elseif self.type < 65 then
    	self.type = 2
    elseif self.type < 80 and (lstg.var.selectedStage == 3 or lstg.var.selectedStage == 4) then
    	self.type = 3
    elseif self.type <= 100 and lstg.var.selectedStage == 4 then
    	self.type = 4
    else
    	self.type = ran:Int(1, 2)
    end
    if self.type == 1 then
        enemy.init(self,ran:Int(1, 4),30,false,true,true)
        self.vx, self.vy = 0, -1
    elseif self.type == 2 then
        enemy.init(self,ran:Int(7, 8),45,false,true,true)
        self.vx, self.vy = 0, -1
    elseif self.type == 3 then
        enemy.init(self,9,55,false,true,true)
        self.vx, self.vy = 0, -1
    elseif self.type == 4 then
        enemy.init(self,14,65,false,true,true)
        self.vx, self.vy = 0, -0.9
    else
    end
end
_editor_class["PlantEnemy"].frame=function(self)
    self.class.base.frame(self)
    if self.y <= -240 then
        if lstg.var.selectedStage == 1 or lstg.var.selectedStage == 2 then
            if self.x > -224 and self.x < -224/2 and lstg.var.plantCard[1] ~= 0 then
                PlaySound("down",0.1,self.x/256,false)
                PlaySound("don00",0.1,self.x/256,false)
                lstg.var.plantCard[1] = 0
                _del(self,true)
                return
            end
            if self.x > -224/2 and self.x < 0 and lstg.var.plantCard[2] ~= 0 then
                PlaySound("down",0.1,self.x/256,false)
                PlaySound("don00",0.1,self.x/256,false)
                lstg.var.plantCard[2] = 0
                _del(self,true)
                return
            end
            if self.x > 0 and self.x < 224/2 and lstg.var.plantCard[3] ~= 0 then
                PlaySound("down",0.1,self.x/256,false)
                PlaySound("don00",0.1,self.x/256,false)
                lstg.var.plantCard[3] = 0
                _del(self,true)
                return
            end
            if self.x > 224/2 and self.x < 224 and lstg.var.plantCard[4] ~= 0 then
                PlaySound("down",0.1,self.x/256,false)
                PlaySound("don00",0.1,self.x/256,false)
                lstg.var.plantCard[4] = 0
                _del(self,true)
                return
            end
            PlaySound("pldead00", 0.5)
            PlaySound("down",0.1,self.x/256,false)
            PlaySound("don00",0.1,self.x/256,false)
            PlaySound("hyz_eterase",0.1,self.x/256,false)
            player.death = 100            _del(self,true)
        else
        end
        if lstg.var.selectedStage == 3 then
            if self.x > -224 and self.x < -224 + 89.6 and lstg.var.plantCard[1] ~= 0 then
                PlaySound("down",0.1,self.x/256,false)
                PlaySound("don00",0.1,self.x/256,false)
                lstg.var.plantCard[1] = 0
                _del(self,true)
                return
            end
            if self.x > -224 + 89.6 and self.x < -224 + 89.6*2 and lstg.var.plantCard[2] ~= 0 then
                PlaySound("down",0.1,self.x/256,false)
                PlaySound("don00",0.1,self.x/256,false)
                lstg.var.plantCard[2] = 0
                _del(self,true)
                return
            end
            if self.x > -224 + 89.6*2 and self.x < -224 + 89.6*3 and lstg.var.plantCard[3] ~= 0 then
                PlaySound("down",0.1,self.x/256,false)
                PlaySound("don00",0.1,self.x/256,false)
                lstg.var.plantCard[3] = 0
                _del(self,true)
                return
            end
            if self.x > -224 + 89.6*3 and self.x < -224 + 89.6*4 and lstg.var.plantCard[4] ~= 0 then
                PlaySound("down",0.1,self.x/256,false)
                PlaySound("don00",0.1,self.x/256,false)
                lstg.var.plantCard[4] = 0
                _del(self,true)
                return
            end
            if self.x > -224 + 89.6*4 and self.x < -224 + 89.6*5 and lstg.var.plantCard[5] ~= 0 then
                PlaySound("down",0.1,self.x/256,false)
                PlaySound("don00",0.1,self.x/256,false)
                lstg.var.plantCard[5] = 0
                _del(self,true)
                return
            end
            PlaySound("pldead00", 0.5)
            PlaySound("down",0.1,self.x/256,false)
            PlaySound("don00",0.1,self.x/256,false)
            PlaySound("hyz_eterase",0.1,self.x/256,false)
            player.death = 100            _del(self,true)
        else
        end
        if lstg.var.selectedStage == 4 then
            if self.x > -224 and self.x < -224 + 74.6 and lstg.var.plantCard[1] ~= 0 then
                PlaySound("down",0.1,self.x/256,false)
                PlaySound("don00",0.1,self.x/256,false)
                lstg.var.plantCard[1] = 0
                _del(self,true)
                return
            end
            if self.x > -224 + 74.6 and self.x < -224 + 74.6*2 and lstg.var.plantCard[2] ~= 0 then
                PlaySound("down",0.1,self.x/256,false)
                PlaySound("don00",0.1,self.x/256,false)
                lstg.var.plantCard[2] = 0
                _del(self,true)
                return
            end
            if self.x > -224 + 74.6*2 and self.x < -224 + 74.6*3 and lstg.var.plantCard[3] ~= 0 then
                PlaySound("down",0.1,self.x/256,false)
                PlaySound("don00",0.1,self.x/256,false)
                lstg.var.plantCard[3] = 0
                _del(self,true)
                return
            end
            if self.x > -224 + 74.6*3 and self.x < -224 + 74.6*4 and lstg.var.plantCard[4] ~= 0 then
                PlaySound("down",0.1,self.x/256,false)
                PlaySound("don00",0.1,self.x/256,false)
                lstg.var.plantCard[4] = 0
                _del(self,true)
                return
            end
            if self.x > -224 + 74.6*4 and self.x < -224 + 74.6*5 and lstg.var.plantCard[5] ~= 0 then
                PlaySound("down",0.1,self.x/256,false)
                PlaySound("don00",0.1,self.x/256,false)
                lstg.var.plantCard[5] = 0
                _del(self,true)
                return
            end
            if self.x > -224 + 74.6*5 and self.x < -224 + 74.6*6 and lstg.var.plantCard[5] ~= 0 then
                PlaySound("down",0.1,self.x/256,false)
                PlaySound("don00",0.1,self.x/256,false)
                lstg.var.plantCard[5] = 0
                _del(self,true)
                return
            end
            PlaySound("pldead00", 0.5)
            PlaySound("down",0.1,self.x/256,false)
            PlaySound("don00",0.1,self.x/256,false)
            PlaySound("hyz_eterase",0.1,self.x/256,false)
            player.death = 100            _del(self,true)
        else
        end
    else
    end
end
_editor_class["N17Laser"]=Class(laser)
_editor_class["N17Laser"].init=function(self,_x,_y,_)
    laser.init(self,COLOR_RED,_x,_y,0,128,512,128,8,8,0)
    laser.ChangeImage(self,4)
    SetV2(self,0,0,true,true)
    lasttask=task.New(self,function()
        laser._TurnHalfOn(self,15,true)
        task._Wait(60)
        laser._TurnOn(self,15,true,true)
        task._Wait(60)
        laser._TurnOff(self,15,true)
        _del(self,true)
    end)
end
_editor_class["N17Laser_2"]=Class(laser)
_editor_class["N17Laser_2"].init=function(self,_x,_y,ang)
    laser.init(self,COLOR_RED,_x,_y,0,12,72,12,8,0,0)
    
    lasttask=task.New(self,function()
        SetV2(self,2,ang,true,false)
        laser.grow(self,30,true,false)
        laser._TurnOn(self,30,true,true)
    end)
end
_editor_class["N18Laser"]=Class(laser)
_editor_class["N18Laser"].init=function(self,_x,_y,ang, add)
    laser.init(self,COLOR_RED,_x,_y,0,32,64,32,8,0,0)
    
    SetV2(self,0,ang,true,false)
    lasttask=task.New(self,function()
        laser.grow(self,30,true,false)
        laser._TurnOn(self,30,true,false)
        for _=1,_infinite do
            _set_rel_pos(self,0,0,self.rot,false)
            SetV2(self,0,self.rot + add,true,false)
            task._Wait(1)
        end
    end)
end
_editor_class["N18Bullet"]=Class(bullet)
_editor_class["N18Bullet"].init=function(self,_x,_y,ang, pos)
bullet.init(self,square,COLOR_RED,true,true)
self.x,self.y=_x,_y
    SetV2(self,1.7,ang,true,false)
    lasttask=task.New(self,function()
        task._Wait(15)
        PlaySound("nice",0.3,self.x/256,false)
        SetV2(self,1.7,self.rot - 20 * pos,true,false)
        task._Wait(15)
        PlaySound("nice",0.3,self.x/256,false)
        SetV2(self,1.7,self.rot + 60 * pos,true,false)
        task._Wait(15)
        PlaySound("nice",0.3,self.x/256,false)
        SetV2(self,1.7,self.rot - 100 * pos,true,false)
        PlaySound("kira01",0.1,self.x/256,false)
        last_list=_create_bullet_group(ball_small,COLOR_RED,self.x,self.y,3,0,2,2,self.rot-180,15,false,0,true,true,0,false,self)
    end)
end
_editor_class["Base_Shot"]=Class(_object)
_editor_class["Base_Shot"].init=function(self,_x,_y,_)
    player_bullet_straight.init(self,"image:Marisa_Shot1",_x,_y,16,90,2)
    self.hp = 10
    self._blend, self._a, self._r, self._g, self._b = "", 255, 255, 255, 255
    self._servants = {}
    self.hscale, self.vscale = 1/4, 1/4
    _object.set_color(self,"mul+add",55,255,255,255)
    self.a, self.b, self.rect = 16, 8,false
end
_editor_class["Base_Shot"].frame=function(self)
    task.Do(self)
    player_bullet_straight.frame(self)
    self.class.base.frame(self)
end
_editor_class["Base_Shot"].render=function(self)
    player_bullet_straight.render(self)
    self.class.base.render(self)
end
_editor_class["Base_Shot"].colli=function(self)
    self.class.base.colli(self)
end
_editor_class["Base_Shot"].kill=function(self)
    last=New(_editor_class["Shot_Effect"],self.x,self.y,self.rot, "image:Marisa_Shot")
end
_editor_class["Base_Shot"].del=function(self)
    self.class.base.del(self)
end
_editor_class["Earth_Shot"]=Class(_object)
_editor_class["Earth_Shot"].init=function(self,_x,_y,speed)
    player_bullet_straight.init(self,"image:Earth_Shot1",_x,_y,speed,90,1)
    self.hp = 10
    self._blend, self._a, self._r, self._g, self._b = "", 255, 255, 255, 255
    self._servants = {}
    self.hscale, self.vscale = 1/4, 1/4
    _object.set_color(self,"mul+add",55,255,255,255)
    self.a, self.b, self.rect = 16, 8,false
    if scoredata.shrubLevelUp[1] == 1 then
        self.dmg = 1.1
    end
    if scoredata.shrubLevelUp[1] == 2 then
        self.dmg = 1.3
    end
    if scoredata.shrubLevelUp[1] == 3 then
        self.dmg = 1.5
    end
end
_editor_class["Earth_Shot"].frame=function(self)
    task.Do(self)
    player_bullet_straight.frame(self)
    self.class.base.frame(self)
end
_editor_class["Earth_Shot"].render=function(self)
    player_bullet_straight.render(self)
    self.class.base.render(self)
end
_editor_class["Earth_Shot"].colli=function(self)
    self.class.base.colli(self)
end
_editor_class["Earth_Shot"].kill=function(self)
    last=New(_editor_class["Shot_Effect"],self.x,self.y,self.rot, "image:Earth_Shot")
end
_editor_class["Earth_Shot"].del=function(self)
    self.class.base.del(self)
end
_editor_class["Water_Shot"]=Class(_object)
_editor_class["Water_Shot"].init=function(self,_x,_y,speed)
    player_bullet_straight.init(self,"image:Water_Shot1",_x,_y,speed,90,0.05)
    self.hp = 10
    self._blend, self._a, self._r, self._g, self._b = "", 255, 255, 255, 255
    self._servants = {}
    self.hscale, self.vscale = 1/4, 1/4
    _object.set_color(self,"mul+add",55,255,255,255)
    self.a, self.b, self.rect = 16, 8,false
    SetV2(self,speed,90 + ran:Int(5, -5),true,false)
    if scoredata.shrubLevelUp[2] == 1 then
        self.dmg = 0.04
    end
    if scoredata.shrubLevelUp[2] == 2 then
        self.dmg = 0.07
    end
    if scoredata.shrubLevelUp[2] == 3 then
        self.dmg = 0.12
    end
end
_editor_class["Water_Shot"].frame=function(self)
    task.Do(self)
    player_bullet_straight.frame(self)
    self.class.base.frame(self)
end
_editor_class["Water_Shot"].render=function(self)
    player_bullet_straight.render(self)
    self.class.base.render(self)
end
_editor_class["Water_Shot"].colli=function(self)
    self.class.base.colli(self)
end
_editor_class["Water_Shot"].kill=function(self)
    last=New(_editor_class["Shot_Effect"],self.x,self.y,self.rot, "image:Water_Shot", 1/1)
    for _=1,8 do
        last=New(_editor_class["Shot_Effect"],self.x + ran:Int(-10, 10),self.y + ran:Int(-10, 10),self.rot, "image:Water_Shot", 1/3)
    end
    New(death_weapon_alt, self.x, self.y, self.dmg)
end
_editor_class["Water_Shot"].del=function(self)
    self.class.base.del(self)
end
_editor_class["Fire_Shot"]=Class(_object)
_editor_class["Fire_Shot"].init=function(self,_x,_y,speed)
    player_bullet_straight.init(self,"image:Fire_Shot1",_x,_y,speed,ran:Int(60, 180-60),1.1)
    self.hp = 10
    self._blend, self._a, self._r, self._g, self._b = "", 255, 255, 255, 255
    self._servants = {}
    self.hscale, self.vscale = 1/4, 1/4
    _object.set_color(self,"mul+add",55,255,255,255)
    self.a, self.b, self.rect = 16, 8,false
    lasttask=task.New(self,function()
        do
            local _beg_mov=speed local mov=_beg_mov local _end_mov=0 local _w_mov=0 local _d_w_mov=1/(80-1)
            for _=1,80 do
                SetV2(self,mov,self.rot,true,false)
                task._Wait(1)
                _w_mov=_w_mov+_d_w_mov mov=(_beg_mov-_end_mov)*(_w_mov-1)^2+_end_mov
            end
        end
        _del(self,true)
    end)
    if scoredata.shrubLevelUp[3] == 1 then
        self.dmg = 1.1
    end
    if scoredata.shrubLevelUp[3] == 2 then
        self.dmg = 1.3
    end
    if scoredata.shrubLevelUp[3] == 3 then
        self.dmg = 1.5
    end
end
_editor_class["Fire_Shot"].frame=function(self)
    task.Do(self)
    player_bullet_straight.frame(self)
    self.class.base.frame(self)
end
_editor_class["Fire_Shot"].render=function(self)
    player_bullet_straight.render(self)
    self.class.base.render(self)
end
_editor_class["Fire_Shot"].colli=function(self)
    self.class.base.colli(self)
end
_editor_class["Fire_Shot"].kill=function(self)
    last=New(_editor_class["Shot_Effect"],self.x,self.y,self.rot, "image:Fire_Shot")
end
_editor_class["Fire_Shot"].del=function(self)
    self.class.base.del(self)
end
_editor_class["Ice_Shot"]=Class(_object)
_editor_class["Ice_Shot"].init=function(self,_x,_y,angle)
    player_bullet_straight.init(self,"image:Ice_Shot1",_x,_y,16,angle,2)
    self.hp = 10
    self._blend, self._a, self._r, self._g, self._b = "", 255, 255, 255, 255
    self._servants = {}
    self.hscale, self.vscale = 1/4, 1/4
    _object.set_color(self,"mul+add",55,255,255,255)
    self.a, self.b, self.rect = 16, 8,false
    lasttask=task.New(self,function()
        do
            local _beg_mov=16 local mov=_beg_mov local _end_mov=0 local _w_mov=0 local _d_w_mov=1/(60-1)
            for _=1,60 do
                SetV2(self,mov,self.rot,true,false)
                task._Wait(1)
                _w_mov=_w_mov+_d_w_mov mov=(_beg_mov-_end_mov)*(_w_mov-1)^2+_end_mov
            end
        end
        _del(self,true)
    end)
    if scoredata.shrubLevelUp[4] == 1 then
        self.dmg = 1.8-0.6
    end
    if scoredata.shrubLevelUp[4] == 2 then
        self.dmg = 2.1-0.6
    end
    if scoredata.shrubLevelUp[4] == 3 then
        self.dmg = 2.25-0.6
    end
end
_editor_class["Ice_Shot"].frame=function(self)
    task.Do(self)
    player_bullet_straight.frame(self)
    self.class.base.frame(self)
end
_editor_class["Ice_Shot"].render=function(self)
    player_bullet_straight.render(self)
    self.class.base.render(self)
end
_editor_class["Ice_Shot"].colli=function(self)
    self.class.base.colli(self)
end
_editor_class["Ice_Shot"].kill=function(self)
    last=New(_editor_class["Shot_Effect"],self.x,self.y,self.rot, "image:Ice_Shot")
end
_editor_class["Ice_Shot"].del=function(self)
    self.class.base.del(self)
end
_editor_class["Poison_Shot"]=Class(_object)
_editor_class["Poison_Shot"].init=function(self,_x,_y,angle)
    player_bullet_straight.init(self,"image:Poison_Shot1",_x,_y,5,angle,0.6)
    self.hp = 10
    self._blend, self._a, self._r, self._g, self._b = "", 255, 255, 255, 255
    self._servants = {}
    self.hscale, self.vscale = 1/4, 1/4
    _object.set_color(self,"mul+add",55,255,255,255)
    self.a, self.b, self.rect = 16, 8,false
    lasttask=task.New(self,function()
        do
            local _beg_mov=5 local mov=_beg_mov local _end_mov=0 local _w_mov=0 local _d_w_mov=1/(60-1)
            for _=1,60 do
                SetV2(self,mov,self.rot,true,false)
                task._Wait(1)
                _w_mov=_w_mov+_d_w_mov mov=(_beg_mov-_end_mov)*(_w_mov-1)^2+_end_mov
            end
        end
        task._Wait(120)
        _del(self,true)
    end)
    if scoredata.shrubLevelUp[5] == 1 then
        self.dmg = 0.6
    end
    if scoredata.shrubLevelUp[5] == 2 then
        self.dmg = 0.8
    end
    if scoredata.shrubLevelUp[5] == 3 then
        self.dmg = 1
    end
end
_editor_class["Poison_Shot"].frame=function(self)
    task.Do(self)
    player_bullet_straight.frame(self)
    self.class.base.frame(self)
end
_editor_class["Poison_Shot"].render=function(self)
    player_bullet_straight.render(self)
    self.class.base.render(self)
end
_editor_class["Poison_Shot"].colli=function(self)
    self.class.base.colli(self)
end
_editor_class["Poison_Shot"].kill=function(self)
    last=New(_editor_class["Shot_Effect"],self.x,self.y,self.rot, "image:Poison_Shot")
end
_editor_class["Poison_Shot"].del=function(self)
    self.class.base.del(self)
end
_editor_class["Lightning_Shot"]=Class(_object)
_editor_class["Lightning_Shot"].init=function(self,_x,_y,angle)
    player_bullet_straight.init(self,"image:Lightning_Ray",_x,_y,0,angle,0.035)
    self.hp = 10
    self._blend, self._a, self._r, self._g, self._b = "", 255, 255, 255, 255
    self._servants = {}
    self.hscale, self.vscale = 1/2, 1/4
    _object.set_color(self,"mul+add",35,255,255,255)
    self.a, self.b, self.rect = 448, 8,false
    self.killflag = true
    lasttask=task.New(self,function()
        do
            local _beg_scale=1/2 local scale=_beg_scale local _end_scale=0 local _w_scale=0 local _d_w_scale=1/(30-1)
            for _=1,30 do
                self.hscale, self.vscale = scale, 1/4
                task._Wait(1)
                _w_scale=_w_scale+_d_w_scale scale=(_beg_scale-_end_scale)*(_w_scale-1)^2+_end_scale
            end
        end
        _del(self,true)
    end)
    if scoredata.shrubLevelUp[6] == 1 then
        self.dmg = 0.06
    end
    if scoredata.shrubLevelUp[6] == 2 then
        self.dmg = 0.09
    end
    if scoredata.shrubLevelUp[6] == 3 then
        self.dmg = 0.14
    end
end
_editor_class["Lightning_Shot"].frame=function(self)
    task.Do(self)
    player_bullet_straight.frame(self)
    self.class.base.frame(self)
end
_editor_class["Lightning_Shot"].render=function(self)
    player_bullet_straight.render(self)
    self.class.base.render(self)
end
_editor_class["Lightning_Shot"].colli=function(self)
    self.class.base.colli(self)
end
_editor_class["Lightning_Shot"].kill=function(self)
end
_editor_class["Lightning_Shot"].del=function(self)
    self.class.base.del(self)
end
_editor_class["Wind_Shot"]=Class(_object)
_editor_class["Wind_Shot"].init=function(self,_x,_y,angle)
    player_bullet_straight.init(self,"image:Wind_Shot1",_x,_y,16,angle,0.4)
    self.hp = 10
    self._blend, self._a, self._r, self._g, self._b = "", 255, 255, 255, 255
    self._servants = {}
    self.hscale, self.vscale = 1/4, 1/4
    _object.set_color(self,"mul+add",55,255,255,255)
    self.a, self.b, self.rect = 16, 8,false
    if scoredata.shrubLevelUp[7] == 1 then
        self.dmg = 0.4
    end
    if scoredata.shrubLevelUp[7] == 2 then
        self.dmg = 0.5
    end
    if scoredata.shrubLevelUp[7] == 3 then
        self.dmg = 0.7
    end
end
_editor_class["Wind_Shot"].frame=function(self)
    task.Do(self)
    player_bullet_straight.frame(self)
    self.class.base.frame(self)
end
_editor_class["Wind_Shot"].render=function(self)
    player_bullet_straight.render(self)
    self.class.base.render(self)
end
_editor_class["Wind_Shot"].colli=function(self)
    self.class.base.colli(self)
end
_editor_class["Wind_Shot"].kill=function(self)
    last=New(_editor_class["Shot_Effect"],self.x,self.y,self.rot, "image:Wind_Shot")
end
_editor_class["Wind_Shot"].del=function(self)
    self.class.base.del(self)
end
_editor_class["Metal_Shot"]=Class(_object)
_editor_class["Metal_Shot"].init=function(self,_x,_y,_)
    player_bullet_straight.init(self,"image:Metal_Shot1",_x,_y,10,90,30)
    self.hp = 10
    self._blend, self._a, self._r, self._g, self._b = "", 255, 255, 255, 255
    self._servants = {}
    self.hscale, self.vscale = 1/2.5, 1/2.5
    _object.set_color(self,"mul+add",100,255,255,255)
    self.a, self.b, self.rect = 24,12,false
    if scoredata.shrubLevelUp[8] == 1 then
        self.dmg = 48
    end
    if scoredata.shrubLevelUp[8] == 2 then
        self.dmg = 60
    end
    if scoredata.shrubLevelUp[8] == 3 then
        self.dmg = 82
    end
end
_editor_class["Metal_Shot"].frame=function(self)
    task.Do(self)
    player_bullet_straight.frame(self)
    self.class.base.frame(self)
end
_editor_class["Metal_Shot"].render=function(self)
    player_bullet_straight.render(self)
    self.class.base.render(self)
end
_editor_class["Metal_Shot"].colli=function(self)
    self.class.base.colli(self)
end
_editor_class["Metal_Shot"].kill=function(self)
    last=New(_editor_class["Shot_Effect"],self.x,self.y,self.rot, "image:Metal_Shot", 1/2.5)
    PlaySound("msl2",0.1,self.x/256,false)
end
_editor_class["Metal_Shot"].del=function(self)
    self.class.base.del(self)
end
_editor_class["Earth_Shrub_Shot"]=Class(_object)
_editor_class["Earth_Shrub_Shot"].init=function(self,_x,_y,_)
    player_bullet_straight.init(self,"image:Earth_Shot1",_x,_y,16,90,0)
    self.hp = 10
    self._blend, self._a, self._r, self._g, self._b = "", 255, 255, 255, 255
    self._servants = {}
    self.hide = true
    self.plantShot = true
    self.hscale, self.vscale = 1/2.5, 1/2.5
    _object.set_color(self,"mul+add",25,255,255,255)
    self.a, self.b, self.rect = 16, 8,false
    if PlantManager.timer % 16 ~= 0 then
        _del(self,true)
    else
        self.hide = false
        if scoredata.shrubLevelUp[1] == 1 then
        	self.dmg = 2.1
        elseif scoredata.shrubLevelUp[1] == 2 then
        	self.dmg = 2.275
        elseif scoredata.shrubLevelUp[1] == 3 then
        	self.dmg = 2.4
        end
    end
end
_editor_class["Earth_Shrub_Shot"].frame=function(self)
    task.Do(self)
    player_bullet_straight.frame(self)
    self.class.base.frame(self)
end
_editor_class["Earth_Shrub_Shot"].render=function(self)
    player_bullet_straight.render(self)
    self.class.base.render(self)
end
_editor_class["Earth_Shrub_Shot"].colli=function(self)
    self.class.base.colli(self)
end
_editor_class["Earth_Shrub_Shot"].kill=function(self)
    last=New(_editor_class["Shot_Effect"],self.x,self.y,self.rot, "image:Earth_Shot", 1/2.5)
end
_editor_class["Earth_Shrub_Shot"].del=function(self)
    self.class.base.del(self)
end
_editor_class["Water_Shrub_Shot"]=Class(_object)
_editor_class["Water_Shrub_Shot"].init=function(self,_x,_y,_)
    player_bullet_straight.init(self,"image:Water_Shot1",_x,_y,16,ran:Int(90-8, 90+8),0)
    self.hp = 10
    self._blend, self._a, self._r, self._g, self._b = "", 255, 255, 255, 255
    self._servants = {}
    self.hide = true
    self.plantShot = true
    self.hscale, self.vscale = 1/2.5, 1/2.5
    _object.set_color(self,"mul+add",25,255,255,255)
    self.a, self.b, self.rect = 16, 8,false
    if PlantManager.timer % 3 ~= 0 then
        _del(self,true)
    else
        self.hide = false
        if scoredata.shrubLevelUp[2] == 1 then
        	self.dmg = 0.023
        elseif scoredata.shrubLevelUp[2] == 2 then
        	self.dmg = 0.02375
        elseif scoredata.shrubLevelUp[2] == 3 then
        	self.dmg = 0.0245
        end
    end
end
_editor_class["Water_Shrub_Shot"].frame=function(self)
    task.Do(self)
    player_bullet_straight.frame(self)
    self.class.base.frame(self)
end
_editor_class["Water_Shrub_Shot"].render=function(self)
    player_bullet_straight.render(self)
    self.class.base.render(self)
end
_editor_class["Water_Shrub_Shot"].colli=function(self)
    self.class.base.colli(self)
end
_editor_class["Water_Shrub_Shot"].kill=function(self)
    last=New(_editor_class["Shot_Effect"],self.x,self.y,self.rot, "image:Water_Shot", 1/2.5, 30)
    for _=1,8 do
        last=New(_editor_class["Shot_Effect"],self.x + ran:Int(-10, 10),self.y + ran:Int(-10, 10),self.rot, "image:Water_Shot", 1/2, 30)
    end
    New(death_weapon_alt, self.x, self.y, self.dmg)
end
_editor_class["Water_Shrub_Shot"].del=function(self)
    self.class.base.del(self)
end
_editor_class["Fire_Shrub_Shot"]=Class(_object)
_editor_class["Fire_Shrub_Shot"].init=function(self,_x,_y,_)
    player_bullet_straight.init(self,"image:Fire_Shot1",_x,_y,18,ran:Int(90-30, 90+30),0)
    self.hp = 10
    self._blend, self._a, self._r, self._g, self._b = "", 255, 255, 255, 255
    self._servants = {}
    self.hide = true
    self.plantShot = true
    self.hscale, self.vscale = 1/2.5, 1/2.5
    _object.set_color(self,"mul+add",25,255,255,255)
    self.a, self.b, self.rect = 16, 8,false
    if PlantManager.timer % 2 ~= 0 then
        _del(self,true)
    else
        self.hide = false
        if scoredata.shrubLevelUp[3] == 1 then
        	self.dmg = 0.7
        elseif scoredata.shrubLevelUp[3] == 2 then
        	self.dmg = 0.8
        elseif scoredata.shrubLevelUp[3] == 3 then
        	self.dmg = 1
        end
    end
    lasttask=task.New(self,function()
        do
            local _beg_mov=18 local mov=_beg_mov local _end_mov=0 local _w_mov=0 local _d_w_mov=1/(80-1)
            for _=1,80 do
                SetV2(self,mov,self.rot,true,false)
                task._Wait(1)
                _w_mov=_w_mov+_d_w_mov mov=(_beg_mov-_end_mov)*(_w_mov-1)^2+_end_mov
            end
        end
        _del(self,true)
    end)
end
_editor_class["Fire_Shrub_Shot"].frame=function(self)
    task.Do(self)
    player_bullet_straight.frame(self)
    self.class.base.frame(self)
end
_editor_class["Fire_Shrub_Shot"].render=function(self)
    player_bullet_straight.render(self)
    self.class.base.render(self)
end
_editor_class["Fire_Shrub_Shot"].colli=function(self)
    self.class.base.colli(self)
end
_editor_class["Fire_Shrub_Shot"].kill=function(self)
    last=New(_editor_class["Shot_Effect"],self.x,self.y,self.rot, "image:Fire_Shot", 1/2.5, 30)
end
_editor_class["Fire_Shrub_Shot"].del=function(self)
    self.class.base.del(self)
end
_editor_class["Ice_Shrub_Shot"]=Class(_object)
_editor_class["Ice_Shrub_Shot"].init=function(self,_x,_y,_)
    player_bullet_straight.init(self,"image:Ice_Shot1",_x,_y,18,ran:Int(90-20, 90+20),0)
    self.hp = 10
    self._blend, self._a, self._r, self._g, self._b = "", 255, 255, 255, 255
    self._servants = {}
    self.hide = true
    self.killflag = true
    self.plantShot = true
    self.hscale, self.vscale = 1/2.5, 1/2.5
    _object.set_color(self,"mul+add",25,255,255,255)
    self.a, self.b, self.rect = 16, 8,false
    if PlantManager.timer % 5 ~= 0 then
        _del(self,true)
    else
        self.hide = false
        if scoredata.shrubLevelUp[4] == 1 then
        	self.dmg = 0.3
        elseif scoredata.shrubLevelUp[4] == 2 then
        	self.dmg = 0.345
        elseif scoredata.shrubLevelUp[4] == 3 then
        	self.dmg = 0.385
        end
    end
    lasttask=task.New(self,function()
        do
            local _beg_mov=18 local mov=_beg_mov local _end_mov=0 local _w_mov=0 local _d_w_mov=1/(120-1)
            for _=1,120 do
                SetV2(self,mov,self.rot,true,false)
                task._Wait(1)
                _w_mov=_w_mov+_d_w_mov mov=(_beg_mov-_end_mov)*(_w_mov-1)^2+_end_mov
            end
        end
        _del(self,true)
    end)
end
_editor_class["Ice_Shrub_Shot"].frame=function(self)
    task.Do(self)
    player_bullet_straight.frame(self)
    self.class.base.frame(self)
end
_editor_class["Ice_Shrub_Shot"].render=function(self)
    player_bullet_straight.render(self)
    self.class.base.render(self)
end
_editor_class["Ice_Shrub_Shot"].colli=function(self)
    self.class.base.colli(self)
end
_editor_class["Ice_Shrub_Shot"].kill=function(self)
    last=New(_editor_class["Shot_Effect"],self.x,self.y,self.rot, "image:Ice_Shot", 1/2.5, 30)
end
_editor_class["Ice_Shrub_Shot"].del=function(self)
    self.class.base.del(self)
end
_editor_class["Poison_Shrub_Shot"]=Class(_object)
_editor_class["Poison_Shrub_Shot"].init=function(self,_x,_y,_)
    player_bullet_straight.init(self,"image:Poison_Shot1",_x,_y,18,90 + ran:Int(60, 80) * ran:Sign(),0)
    self.hp = 10
    self._blend, self._a, self._r, self._g, self._b = "", 255, 255, 255, 255
    self._servants = {}
    self.hide = true
    self.plantShot = true
    self.hscale, self.vscale = 1/2.5, 1/2.5
    _object.set_color(self,"mul+add",25,255,255,255)
    self.a, self.b, self.rect = 16, 8,false
    if PlantManager.timer % 1 ~= 0 then
        _del(self,true)
    else
        self.hide = false
        if scoredata.shrubLevelUp[5] == 1 then
        	self.dmg = 0.5
        elseif scoredata.shrubLevelUp[5] == 2 then
        	self.dmg = 0.55
        elseif scoredata.shrubLevelUp[5] == 3 then
        	self.dmg = 0.675
        end
    end
    lasttask=task.New(self,function()
        do
            local _beg_mov=18 local mov=_beg_mov local _end_mov=0 local _w_mov=0 local _d_w_mov=1/(140-1)
            for _=1,140 do
                SetV2(self,mov,self.rot,true,false)
                task._Wait(1)
                _w_mov=_w_mov+_d_w_mov mov=(_beg_mov-_end_mov)*(_w_mov-1)^2+_end_mov
            end
        end
        _del(self,true)
    end)
end
_editor_class["Poison_Shrub_Shot"].frame=function(self)
    task.Do(self)
    player_bullet_straight.frame(self)
    self.class.base.frame(self)
end
_editor_class["Poison_Shrub_Shot"].render=function(self)
    player_bullet_straight.render(self)
    self.class.base.render(self)
end
_editor_class["Poison_Shrub_Shot"].colli=function(self)
    self.class.base.colli(self)
end
_editor_class["Poison_Shrub_Shot"].kill=function(self)
    last=New(_editor_class["Shot_Effect"],self.x,self.y,self.rot, "image:Poison_Shot", 1/2.5, 30)
end
_editor_class["Poison_Shrub_Shot"].del=function(self)
    self.class.base.del(self)
end
_editor_class["Lightning_Shrub_Shot"]=Class(_object)
_editor_class["Lightning_Shrub_Shot"].init=function(self,_x,_y,_)
    player_bullet_straight.init(self,"image:Lightning_Ray",_x,_y,70,90,0)
    self.hp = 10
    self._blend, self._a, self._r, self._g, self._b = "", 255, 255, 255, 255
    self._servants = {}
    self.hide = true
    self.x,self.y=self.x,self.y - 10
    self.plantShot = true
    self.killflag = true
    self.hscale, self.vscale = 1/2.5, 1/1.25
    _object.set_color(self,"mul+add",25,255,255,255)
    self.a, self.b, self.rect = 16, 8,false
    if PlantManager.timer % 3 ~= 0 then
        _del(self,true)
    else
        self.hide = false
        if scoredata.shrubLevelUp[6] == 1 then
        	self.dmg = 0.35
        elseif scoredata.shrubLevelUp[6] == 2 then
        	self.dmg = 0.375
        elseif scoredata.shrubLevelUp[6] == 3 then
        	self.dmg = 0.45
        end
    end
end
_editor_class["Lightning_Shrub_Shot"].frame=function(self)
    task.Do(self)
    player_bullet_straight.frame(self)
    self.class.base.frame(self)
end
_editor_class["Lightning_Shrub_Shot"].render=function(self)
    player_bullet_straight.render(self)
    self.class.base.render(self)
end
_editor_class["Lightning_Shrub_Shot"].colli=function(self)
    self.class.base.colli(self)
end
_editor_class["Lightning_Shrub_Shot"].kill=function(self)
    last=New(_editor_class["Shot_Effect"],self.x,self.y,self.rot, "image:Lightning_Shot", 1/2.5, 30)
end
_editor_class["Lightning_Shrub_Shot"].del=function(self)
    self.class.base.del(self)
end
_editor_class["Wind_Shrub_Shot"]=Class(_object)
_editor_class["Wind_Shrub_Shot"].init=function(self,_x,_y,_)
    player_bullet_straight.init(self,"image:Wind_Shot1",_x,_y,16,90 - 25 + (25 * ran:Int(0, 2)),0)
    self.hp = 10
    self._blend, self._a, self._r, self._g, self._b = "", 255, 255, 255, 255
    self._servants = {}
    self.hide = true
    self.plantShot = true
    self.windShot = true
    self.hscale, self.vscale = 1/2.5, 1/2.5
    _object.set_color(self,"mul+add",25,255,255,255)
    self.a, self.b, self.rect = 16, 8,false
    if PlantManager.timer % 3 ~= 0 then
        _del(self,true)
    else
        self.hide = false
        if scoredata.shrubLevelUp[7] == 1 then
        	self.dmg = 0.2
        elseif scoredata.shrubLevelUp[7] == 2 then
        	self.dmg = 0.3
        elseif scoredata.shrubLevelUp[7] == 3 then
        	self.dmg = 0.475
        end
    end
end
_editor_class["Wind_Shrub_Shot"].frame=function(self)
    task.Do(self)
    player_bullet_straight.frame(self)
    self.class.base.frame(self)
end
_editor_class["Wind_Shrub_Shot"].render=function(self)
    player_bullet_straight.render(self)
    self.class.base.render(self)
end
_editor_class["Wind_Shrub_Shot"].colli=function(self)
    self.class.base.colli(self)
end
_editor_class["Wind_Shrub_Shot"].kill=function(self)
    last=New(_editor_class["Shot_Effect"],self.x,self.y,self.rot, "image:Wind_Shot", 1/2.5)
end
_editor_class["Wind_Shrub_Shot"].del=function(self)
    self.class.base.del(self)
end
_editor_class["Metal_Shrub_Shot"]=Class(_object)
_editor_class["Metal_Shrub_Shot"].init=function(self,_x,_y,_)
    player_bullet_straight.init(self,"image:Metal_Shot1",_x,_y,16,90,0)
    self.hp = 10
    self._blend, self._a, self._r, self._g, self._b = "", 255, 255, 255, 255
    self._servants = {}
    self.hide = true
    self.plantShot = true
    self.hscale, self.vscale = 1/1.5, 1/1.5
    _object.set_color(self,"mul+add",25,255,255,255)
    self.a, self.b, self.rect = 16, 8,false
    if PlantManager.timer % 32 ~= 0 then
        _del(self,true)
    else
        self.hide = false
        if scoredata.shrubLevelUp[8] == 1 then
        	self.dmg = 4
        elseif scoredata.shrubLevelUp[8] == 2 then
        	self.dmg = 4.75
        elseif scoredata.shrubLevelUp[8] == 3 then
        	self.dmg = 5.75
        end
    end
end
_editor_class["Metal_Shrub_Shot"].frame=function(self)
    task.Do(self)
    player_bullet_straight.frame(self)
    self.class.base.frame(self)
end
_editor_class["Metal_Shrub_Shot"].render=function(self)
    player_bullet_straight.render(self)
    self.class.base.render(self)
end
_editor_class["Metal_Shrub_Shot"].colli=function(self)
    self.class.base.colli(self)
end
_editor_class["Metal_Shrub_Shot"].kill=function(self)
    last=New(_editor_class["Shot_Effect"],self.x,self.y,self.rot, "image:Metal_Shot", 1/1.5)
end
_editor_class["Metal_Shrub_Shot"].del=function(self)
    self.class.base.del(self)
end
_editor_class["Shot_Effect"]=Class(_object)
_editor_class["Shot_Effect"].init=function(self,_x,_y,ang, img, size, alpha)
    self.x,self.y=_x,_y
    self.img=img .. 1
    self.layer=LAYER_PLAYER_BULLET+5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    if size then
        self.hscale, self.vscale = size, size
    else
        self.hscale, self.vscale = 1/4, 1/4
    end
    self.hscale, self.vscale = 1/2.25, 1/2.25
    self.alpha = alpha or 155
    self.rot = ran:Int(-2, 2) + ang
    _object.set_color(self,"mul+add",self.alpha,255,255,255)
    lasttask=task.New(self,function()
        for _=1,4 do
            self.img = img .. _
            task._Wait(2)
        end
    end)
    lasttask=task.New(self,function()
        do
            local _beg_alp=self.alpha local alp=_beg_alp  local _w_alp=0 local _end_alp=0 local _d_w_alp=90/(10-1)
            for _=1,10 do
                _object.set_color(self,"mul+add",alp,255,255,255)
                task._Wait(4)
                _w_alp=_w_alp+_d_w_alp alp=(_end_alp-_beg_alp)*sin(_w_alp)+(_beg_alp)
            end
        end
        _del(self,true)
    end)
end
Marisa=Class(player_class)
Marisa.init=function(self)
    player_class.init(self)
    self.name = "Marisa"
    --[[ Add Option List Here]]
    
    LoadTexture('blank_void','blank_void.png')
    LoadImageGroup('blank_void','blank_void',0,0,32,48,8,3,0.5,0.5)
    self.imgs = {}
    self.A, self.B = 0.5,0.5
    for i = 1, 24 do self.imgs[i]='blank_void'..i end
    player.hspeed, player.lspeed = 4,2
    player.protect = 120
    self.hscale, self.vscale = 1/8, 1/8
    self.armllerp = 0
    self.armrlerp = 0
    self.legllerp = 0
    self.legrlerp = 0
    self.hairlerp = 0
    self.hatlerp = 0
    self.hattoplerp = 0
    self.skirtlerp = 0
    self.broomlerp = 0
    self.torsolerp = 0
    self.wiglerp = 0
    local equipcards = {0,0}
    if lstg.var.equipCard then
    	equipcards = {lstg.var.equipCard[1], lstg.var.equipCard[2]} 
    end
    self.options = equipcards
    self.optionPosition = {
    	{-30, 0, -15, 30},
    	{30, 0, 15, 30}
    }
    self.optionCurrentPosition = {
    	{0, 0},
    	{0, 0}
    }
    self.metalTimer = 0
    function self:optionFire(x, y, shrubIndex)
        if shrubIndex == 1 then
            do local speed,_d_speed=(10),(16) for _=1,2 do
                last=New(_editor_class["Earth_Shot"],x, y,speed)
            speed=speed+_d_speed end end
        elseif shrubIndex == 2 then
            last=New(_editor_class["Water_Shot"],x, y,10)
        elseif shrubIndex == 3 then
            for _=1,6 do
                last=New(_editor_class["Fire_Shot"],x, y,ran:Float(4, 12))
            end
        elseif shrubIndex == 4 then
            if x > player.x then
                do local ang,_d_ang=(0),(360/3) for _=1,3 do
                    last=New(_editor_class["Ice_Shot"],x, y,self.timer + ang)
                    last=New(_editor_class["Ice_Shot"],x, y,self.timer + ang + (360/3)/2)
                ang=ang+_d_ang end end
            else
                do local ang,_d_ang=(0),(360/3) for _=1,3 do
                    last=New(_editor_class["Ice_Shot"],x, y,-self.timer + ang + (360/3)/2)
                    last=New(_editor_class["Ice_Shot"],x, y,-self.timer + ang + (360/3)/2 + (360/3)/2)
                ang=ang+_d_ang end end
            end
        elseif shrubIndex == 5 then
            if x > player.x then
                do local ang,_d_ang=(0),(360/5) for _=1,5 do
                    last=New(_editor_class["Poison_Shot"],x, y,self.timer + ang)
                    last=New(_editor_class["Poison_Shot"],x, y,self.timer + ang + (360/3)/2)
                ang=ang+_d_ang end end
            else
                do local ang,_d_ang=(0),(360/5) for _=1,5 do
                    last=New(_editor_class["Poison_Shot"],x, y,-self.timer + ang + (360/3)/2)
                    last=New(_editor_class["Poison_Shot"],x, y,-self.timer + ang + (360/3)/2 + (360/3)/2)
                ang=ang+_d_ang end end
            end
        elseif shrubIndex == 6 then
            last=New(_editor_class["Lightning_Shot"],x, y,90)
            last=New(_editor_class["Lightning_Shot"],x, y,-90)
        elseif shrubIndex == 7 then
            do local a,_d_a=(90 - 15 * 3.5),(15) for _=1,8 do
                last=New(_editor_class["Wind_Shot"],x, y,a)
            a=a+_d_a end end
        elseif shrubIndex == 8 then
            if player.metalTimer == 0 then
                last=New(_editor_class["Metal_Shot"],x, y,_)
                player.metalTimer = 10
            else
                player.metalTimer = player.metalTimer - 1
            end
        else
        end
    end
    player.nextspell = 999999999
end
Marisa.frame=function(self)
    task.Do(self)    player_class.frame(self)
    if (KeyIsDown"left" and KeyIsDown"right") or not (KeyIsDown"left" or KeyIsDown"right") then
    	self.armllerp = LerpDecel(self.armllerp, 0, 0.1)
    	self.armrlerp = LerpDecel(self.armllerp, 0, 0.1)
    	self.legllerp = LerpDecel(self.legllerp, 0, 0.1)
    	self.legrlerp = LerpDecel(self.legrlerp, 0, 0.1)
    	self.hairlerp = LerpDecel(self.hairlerp, 0, 0.1)
    	self.wiglerp = LerpDecel(self.wiglerp, 0, 0.1)
    	self.hatlerp = LerpDecel(self.hatlerp, 0, 0.1)
    	self.hattoplerp = LerpDecel(self.hattoplerp, 0, 0.1)
    	self.skirtlerp = LerpDecel(self.skirtlerp, 0, 0.1)
    	self.broomlerp = LerpDecel(self.broomlerp, 0, 0.1)
    	self.torsolerp = LerpDecel(self.torsolerp, 0, 0.1)
    elseif KeyIsDown"left" then
    	self.armllerp = LerpDecel(self.armllerp, 15, 0.1)
    	self.armrlerp = LerpDecel(self.armrlerp, 15, 0.1)
    	self.legllerp = LerpDecel(self.legllerp, 20, 0.1)
    	self.legrlerp = LerpDecel(self.legrlerp, 20, 0.1)
    	self.hairlerp = LerpDecel(self.hairlerp, 20, 0.1)
    	self.wiglerp = LerpDecel(self.wiglerp, 1, 0.1)
    	self.hatlerp = LerpDecel(self.hatlerp, 15, 0.1)
    	self.hattoplerp = LerpDecel(self.hattoplerp, 20, 0.1)
    	self.skirtlerp = LerpDecel(self.skirtlerp, 30, 0.1)
    	self.broomlerp = LerpDecel(self.broomlerp, 15, 0.1)
    	self.torsolerp = LerpDecel(self.torsolerp, 15, 0.1)
    elseif KeyIsDown"right" then
    	self.armllerp = LerpDecel(self.armllerp, -15, 0.1)
    	self.armrlerp = LerpDecel(self.armrlerp, -15, 0.1)
    	self.legllerp = LerpDecel(self.legllerp, -20, 0.1)
    	self.legrlerp = LerpDecel(self.legrlerp, -20, 0.1)
    	self.hairlerp = LerpDecel(self.hairlerp, -20, 0.1)
    	self.wiglerp = LerpDecel(self.wiglerp, -1, 0.1)
    	self.hatlerp = LerpDecel(self.hatlerp, -15, 0.1)
    	self.hattoplerp = LerpDecel(self.hattoplerp, -20, 0.1)
    	self.skirtlerp = LerpDecel(self.skirtlerp, -30, 0.1)
    	self.broomlerp = LerpDecel(self.broomlerp, -15, 0.1)
    	self.torsolerp = LerpDecel(self.torsolerp, -15, 0.1)
    end
    local equipcards = {0,0}
    if lstg.var.equipCard then
    	equipcards = {lstg.var.equipCard[1], lstg.var.equipCard[2]} 
    end
    self.options = equipcards
    
    if KeyIsDown"slow" == false then
    	self.optionCurrentPosition[1][1] = LerpDecel(self.optionCurrentPosition[1][1], self.optionPosition[1][1], 0.1)
    	self.optionCurrentPosition[1][2] = LerpDecel(self.optionCurrentPosition[1][2], self.optionPosition[1][2], 0.1)
    	
    	self.optionCurrentPosition[2][1] = LerpDecel(self.optionCurrentPosition[2][1], self.optionPosition[2][1], 0.1)
    	self.optionCurrentPosition[2][2] = LerpDecel(self.optionCurrentPosition[2][2], self.optionPosition[2][2], 0.1)
    else
    	self.optionCurrentPosition[1][1] = LerpDecel(self.optionCurrentPosition[1][1], self.optionPosition[1][3], 0.1)
    	self.optionCurrentPosition[1][2] = LerpDecel(self.optionCurrentPosition[1][2], self.optionPosition[1][4], 0.1)
    	
    	self.optionCurrentPosition[2][1] = LerpDecel(self.optionCurrentPosition[2][1], self.optionPosition[2][3], 0.1)
    	self.optionCurrentPosition[2][2] = LerpDecel(self.optionCurrentPosition[2][2], self.optionPosition[2][4], 0.1)
    end
end
Marisa.render=function(self)
    player_class.render(self)
    SetImageState("image:Hakkero", "mul+add", Color(255, 255, 255, 255))
    if (scoredata.shrubLevelUp[lstg.var.equipCard[1]] == 3) then
    	Render("image:Hakkero", self.x + self.optionCurrentPosition[1][1], self.y + self.optionCurrentPosition[1][2], self.timer * -1, 1/2.2, 1/2.2)
    end
    if (scoredata.shrubLevelUp[lstg.var.equipCard[1]] == 2) then
    	Render("image:Hakkero", self.x + self.optionCurrentPosition[1][1], self.y + self.optionCurrentPosition[1][2], self.timer * -1, 1/2.6, 1/2.6)
    end
    
    if self.options[1] ~= 0 then
    	SetImageState("image:Hakkero", "", Color(255, 255, 255, 255))
    else
    	SetImageState("image:Hakkero", "", Color(100, 155, 155, 155))
    end
    
    Render("image:Hakkero", self.x + self.optionCurrentPosition[1][1], self.y + self.optionCurrentPosition[1][2], self.timer * -1, 1/3.75, 1/3.75)
    SetFontState("font:simplymono", "", Color(255, 255, 255, 255))
    lstg.RenderText("font:simplymono", tostring(scoredata.shrubLevelUp[lstg.var.equipCard[1]] or ""),
    				self.x + self.optionCurrentPosition[1][1], self.y + self.optionCurrentPosition[1][2], 0.1, 5)
    
    SetImageState("image:Hakkero", "mul+add", Color(255, 255, 255, 255))
    if (scoredata.shrubLevelUp[lstg.var.equipCard[2]] == 3) then
    	Render("image:Hakkero", self.x + self.optionCurrentPosition[2][1], self.y + self.optionCurrentPosition[2][2], self.timer * 1, 1/2.2, 1/2.2)
    end
    if (scoredata.shrubLevelUp[lstg.var.equipCard[2]] == 2) then
    	Render("image:Hakkero", self.x + self.optionCurrentPosition[2][1], self.y + self.optionCurrentPosition[2][2], self.timer * 1, 1/2.6, 1/2.6)
    end
    
    if self.options[2] ~= 0 then
    	SetImageState("image:Hakkero", "", Color(255, 255, 255, 255))
    else
    	SetImageState("image:Hakkero", "", Color(100, 155, 155, 155))
    end
    
    Render("image:Hakkero", self.x + self.optionCurrentPosition[2][1], self.y + self.optionCurrentPosition[2][2], self.timer * 1, 1/3.75, 1/3.75)
    SetFontState("font:simplymono", "", Color(255, 255, 255, 255))
    lstg.RenderText("font:simplymono", tostring(scoredata.shrubLevelUp[lstg.var.equipCard[2]] or ""),
    				self.x + self.optionCurrentPosition[2][1], self.y + self.optionCurrentPosition[2][2], 0.1, 5)
    
    local colorNormal = Color(255,255,255,255)
    local colorProtect = Color(255,50,50,255)
    local wigcolor = colorNormal
    
    if self.protect % 4 == 0 then
    	SetImageState("image:legl", "", colorNormal)
    	SetImageState("image:legr", "", colorNormal)
    	SetImageState("image:broom", "", colorNormal)
    	SetImageState("image:torso", "", colorNormal)
    	SetImageState("image:arml", "", colorNormal)
    	SetImageState("image:armr", "", colorNormal)
    	SetImageState("image:skirt", "", colorNormal)
    	SetImageState("image:hair", "", colorNormal)
    	SetImageState("image:hat", "", colorNormal)
    	SetImageState("image:hattop", "", colorNormal)
    	wigcolor = colorNormal
    else
    	SetImageState("image:legl", "", colorProtect)
    	SetImageState("image:legr", "", colorProtect)
    	SetImageState("image:broom", "", colorProtect)
    	SetImageState("image:torso", "", colorProtect)
    	SetImageState("image:arml", "", colorProtect)
    	SetImageState("image:armr", "", colorProtect)
    	SetImageState("image:skirt", "", colorProtect)
    	SetImageState("image:hair", "", colorProtect)
    	SetImageState("image:hat", "", colorProtect)
    	SetImageState("image:hattop", "", colorProtect)
    	wigcolor = colorProtect
    end
    
    
    --
    Render("image:legl", self.x - 2, self.y - 4, 0 - (sin(self.timer) * 6) + self.legllerp, self.hscale, self.vscale)
    Render("image:legr", self.x + 2, self.y - 4, 0 + (sin(self.timer) * 6) + self.legrlerp, self.hscale, self.vscale)
    Render("image:broom", self.x, self.y - 2, 0 + self.broomlerp, self.hscale, self.vscale)
    Render("image:torso", self.x, self.y + 2, 0 + self.torsolerp, self.hscale, self.vscale)
    Render("image:arml", self.x - 3, self.y + 4, 0 + self.armllerp, self.hscale, self.vscale)
    Render("image:armr", self.x + 3, self.y + 4, 0 + self.armrlerp, self.hscale, self.vscale)
    Render("image:skirt", self.x, self.y - 2, 0 + (sin(self.timer * 3) * 8) + self.skirtlerp, self.hscale, self.vscale)
    --Render("image:hair", self.x, self.y + 12, 0 + (sin(self.timer * 6) * 6) + self.hairlerp, self.hscale, self.vscale)
    
    local n = MarisaWigNode
    local wigsizew, wigsizeh = 72 * self.hscale * 1.1, 168 * self.vscale * 1.1 
    local anchor = Vector(0,18) + Vector.fromAngle(-90+self.hairlerp) * 29 * self.hscale
    local wigflow, wigspeed, wigstrength, wigstrengthmove, wigmove = 40, 5, 60, 16, 2
    local pos = Vector(0,0)
    local prevpos = Vector(0,0)
    local prevnormal = Vector(-1,0)
    local prevang = -90 - 5 * self.wiglerp
    local ang = 0
    for i=1,n do
    	local t = i/n
    	local fxt = 1-math.pow(1-t,2)
    	local wigstr = LerpDecel(wigstrength/n,wigstrengthmove/n,math.abs(self.wiglerp))
    	ang = prevang + fxt * wigstr * sin(fxt * wigflow + self.timer * wigspeed)
    	ang = ang + wigmove * self.wiglerp * fxt
    	local pos = prevpos + wigsizeh/n * Vector.fromAngle(ang)
    	local off = (pos-prevpos).normalized
    	local normal = off:perpendicular()
    	local finalpos = Vector(player.x,player.y) + anchor + pos
    	local finalprev = Vector(player.x,player.y) + anchor + prevpos
    	
    	local vlt = finalprev - prevnormal * wigsizew
    	local vrt = finalprev + prevnormal * wigsizew
    	local vrb = finalpos  + normal * wigsizew
    	local vlb = finalpos  - normal * wigsizew
    	SetImageState("image:wig"..i, "", wigcolor)
    	Render4V("image:wig"..i,
    			vlt.x, vlt.y,0,
    			vrt.x, vrt.y,0,
    			vrb.x, vrb.y,0,
    			vlb.x, vlb.y,0)
    	
    	prevpos = pos
    	prevnormal = normal
    	prevang = ang
    end
    
    Render("image:hat", self.x, self.y + 14, 0 + self.hatlerp, self.hscale, self.vscale)
    Render("image:hattop", self.x, self.y + 21, 0 + (sin(self.timer) * 10) + self.hattoplerp, self.hscale, self.vscale)
        for i = 1, 4 do
        if self.sp[i] and self.sp[i][3] > 0.5 then
            Render("leaf", self.supportx + self.sp[i][1], self.supporty + self.sp[i][2], self.timer * 3)
        end
    end
end
Marisa.shoot=function(self)
    if lstg.var.stage_name == "SceneStaff@StaffRoll" then
        player.nextshoot = 99999999
    else
        player.nextshoot = 4
        PlaySound("plst00",0.3,self.x/1024,false)
        last=New(_editor_class["Base_Shot"],self.x - 8,self.y + 4,_)
        last=New(_editor_class["Base_Shot"],self.x + 8,self.y + 4,_)
        self:optionFire(self.x + self.optionCurrentPosition[1][1], self.y + self.optionCurrentPosition[1][2], self.options[1])
        self:optionFire(self.x + self.optionCurrentPosition[2][1], self.y + self.optionCurrentPosition[2][2], self.options[2])
    end
end
Marisa.spell=function(self)
end
Marisa.special=function(self)
    if lstg.var.stage_name == "SceneStaff@StaffRoll" then
        player.nextsp = 9999
    else
        player.nextsp = 20
        PlaySound("slash",0.8,self.x/1024,false)
        local optionSel = lstg.var.equipCard[lstg.var.selectedShrub]
        local plantSel = lstg.var.plantCard[lstg.var.highlightedPlant]
        
        lstg.var.equipCard[lstg.var.selectedShrub] = plantSel
        lstg.var.plantCard[lstg.var.highlightedPlant] = optionSel
    end
end
table.insert(player_list, {'Marisa Kirisame','Marisa','Marisa'})_editor_class["Eternity"]=Class(boss)
_editor_class["Eternity"].cards={}
_editor_class["Eternity"].name="Eternity Larva"
_editor_class["Eternity"].bgm=""
_editor_class["Eternity"]._bg=nil
_editor_class["Eternity"].difficulty="All"
_editor_class["Eternity"].init=function(self,cards)
    boss.init(self,240,384,_editor_class["Eternity"].name,cards,New(_editor_class["EternityBG"]),_editor_class["Eternity"].difficulty)
    self._wisys = BossWalkImageSystem(self)
    self._wisys:SetImage("Eternity_Boss.png",3,4,{4,4,4},{1,2},6,16,16)
    self.hscale, self.vscale = 1/2.25, 1/2.25
end
_tmp_sc=boss.dialog.New(true)
function _tmp_sc:init()
    lstg.player.dialog=true
    _dialog_can_skip=true
    self.dialog_displayer=New(dialog_displayer)
    lasttask=task.New(self,function()
        boss.dialog.sentence(self,"image:Marisa_1","left",[===[What a crazy day, I can't believe these thingamajigs
can also be used as fancy shooters.]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Marisa_2","left",[===[I bet that if Patchy spent some time with Yuuka
they'd come up with some uber cool stuff.]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        boss.dialog.sentence(self,"img_void","right",[===[Hey, it's you again!]===],600,1,1,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
        task.MoveTo(0,120,60,MOVE_DECEL)
        boss.dialog.sentence(self,"image:Marisa_4","left",[===[Oh, right. Eternity Larva, isn't it?
Nice to see you again.]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        last=New(_editor_class["CharacterTitle"],540, 100,"Eternity")
        boss.dialog.sentence(self,"image:Eternity_2","right",[===[I was the epitome of flashiness during that wild summer!]===],600,0.15, 0.15,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Marisa_3","left",[===[Right, though the weather was all over the place.
Not so summer as you might remember.]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Eternity_1","right",[===[Well, at least now I can make things up
all bright and shiny. I love the heat!]===],600,0.15, 0.15,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Marisa_3","left",[===[Right, so... If you don't have anything
relevant to say, I'll be going.]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Eternity_1","right",[===[Wait, have you seen these strange sprouts around?]===],600,0.15, 0.15,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Marisa_2","left",[===[Oh, yeah. Talking about that, you'll be a
great excuse for me to try testing them out.]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        _stop_music()
        boss.dialog.sentence(self,"image:Eternity_3","right",[===[Huh? What do you mean?]===],600,0.15, 0.15,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Marisa_1","left",[===[You're the first one to show up that I can play with.
At least decently.]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        LoadMusicRecord("bgm:Act1BossTheme")
        _play_music("bgm:Act1BossTheme")
        last=New(_editor_class["SongDisplayer"],self.x,self.y,true)
        boss.dialog.sentence(self,"image:Marisa_2","left",[===[I've dealt with a couple fairies before, but you're
the best target so far, so have at it!]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
    end)
end
table.insert(_editor_class["Eternity"].cards,_tmp_sc)
_tmp_sc=boss.card.New("",2,5,60,1400,{0,50,15},false)
function _tmp_sc:before()
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task.MoveTo(0,120,60,MOVE_DECEL)
        New(boss_cast_ef,self.x,self.y,360,0,255,200,60,2,false)
        boss.cast(self,60)
        task._Wait(60)
        lasttask=task.New(self,function()
            for _=1,_infinite do
                last_list=_create_bullet_group(ball_mid,COLOR_RED,self.x + ran:Int(-100, 100),self.y + ran:Int(-20, 20),3,0,2,2,0,80,true,0,true,true,0,false,self)
                PlaySound("kira02",0.1,self.x/256,false)
                task._Wait(45)
            end
        end)
        lasttask=task.New(self,function()
            for _=1,_infinite do
                last_list=_create_bullet_group(ball_huge,COLOR_DEEP_GREEN,self.x,self.y,3,0,3,3,0,30,true,0,true,true,0,false,self)
                PlaySound("kira01",0.1,self.x/256,false)
                task._Wait(60*1.5)
            end
        end)
        for _=1,_infinite do
            boss.cast(self,60)
            do
                local _beg_ang=90-20 local ang=_beg_ang local _end_ang=-90+40 local _d_ang=(_end_ang-_beg_ang)/(20-1)
                local _beg_ang2=90-45 local ang2=_beg_ang2 local _end_ang2=-90+20 local _d_ang2=(_end_ang2-_beg_ang2)/(20-1)
                local _beg_ang3=90+20 local ang3=_beg_ang3 local _end_ang3=90-40 +180 local _d_ang3=(_end_ang3-_beg_ang3)/(20-1)
                local _beg_ang4=90+40 local ang4=_beg_ang4 local _end_ang4=90-20 +180 local _d_ang4=(_end_ang4-_beg_ang4)/(20-1)
                for _=1,20 do
                    PlaySound("kira01",0.1,self.x/256,false)
                    last_list=_create_bullet_group(kite,COLOR_DEEP_GREEN,self.x + 40 * cos(ang),self.y + 40 * sin(ang),6,0,6,6,ang,0,false,0,true,true,0,false,self)
                    for _,unit in ipairs(last_list) do
                        lasttask=task.New(unit,function()
                            local self=task.GetSelf()
                            do
                                local _beg_spd=6 local spd=_beg_spd  local _w_spd=0 local _end_spd=6 - (_ * 0.6) local _d_w_spd=90/(15-1)
                                for _=1,15 do
                                    SetV2(self,spd,self.rot,true,false)
                                    task._Wait(1)
                                    _w_spd=_w_spd+_d_w_spd spd=(_end_spd-_beg_spd)*sin(_w_spd)+(_beg_spd)
                                end
                            end
                        end)
                    end
                    last_list=_create_bullet_group(kite,COLOR_DEEP_GREEN,self.x + 40 * cos(ang2),self.y + 40 * sin(ang2),6,0,6,6,ang2,0,false,0,true,true,0,false,self)
                    for _,unit in ipairs(last_list) do
                        lasttask=task.New(unit,function()
                            local self=task.GetSelf()
                            do
                                local _beg_spd=6 local spd=_beg_spd  local _w_spd=0 local _end_spd=6 - (_ * 0.6) local _d_w_spd=90/(15-1)
                                for _=1,15 do
                                    SetV2(self,spd,self.rot,true,false)
                                    task._Wait(1)
                                    _w_spd=_w_spd+_d_w_spd spd=(_end_spd-_beg_spd)*sin(_w_spd)+(_beg_spd)
                                end
                            end
                        end)
                    end
                    last_list=_create_bullet_group(kite,COLOR_DEEP_GREEN,self.x + 40 * cos(ang3),self.y + 40 * sin(ang3),6,0,6,6,ang3,0,false,0,true,true,0,false,self)
                    for _,unit in ipairs(last_list) do
                        lasttask=task.New(unit,function()
                            local self=task.GetSelf()
                            do
                                local _beg_spd=6 local spd=_beg_spd  local _w_spd=0 local _end_spd=6 - (_ * 0.6) local _d_w_spd=90/(15-1)
                                for _=1,15 do
                                    SetV2(self,spd,self.rot,true,false)
                                    task._Wait(1)
                                    _w_spd=_w_spd+_d_w_spd spd=(_end_spd-_beg_spd)*sin(_w_spd)+(_beg_spd)
                                end
                            end
                        end)
                    end
                    last_list=_create_bullet_group(kite,COLOR_DEEP_GREEN,self.x + 40 * cos(ang4),self.y + 40 * sin(ang4),6,0,6,6,ang4,0,false,0,true,true,0,false,self)
                    for _,unit in ipairs(last_list) do
                        lasttask=task.New(unit,function()
                            local self=task.GetSelf()
                            do
                                local _beg_spd=6 local spd=_beg_spd  local _w_spd=0 local _end_spd=6 - (_ * 0.6) local _d_w_spd=90/(15-1)
                                for _=1,15 do
                                    SetV2(self,spd,self.rot,true,false)
                                    task._Wait(1)
                                    _w_spd=_w_spd+_d_w_spd spd=(_end_spd-_beg_spd)*sin(_w_spd)+(_beg_spd)
                                end
                            end
                        end)
                    end
                    task._Wait(3)
                    ang=ang+_d_ang
                    ang2=ang2+_d_ang2
                    ang3=ang3+_d_ang3
                    ang4=ang4+_d_ang4
                end
            end
            do
                local _beg_ang=70 local ang=_beg_ang local _end_ang=-90-35 local _d_ang=(_end_ang-_beg_ang)/(11-1)
                local _beg_ang2=90+20 local ang2=_beg_ang2 local _end_ang2=90+35 + 180 local _d_ang2=(_end_ang2-_beg_ang2)/(11-1)
                local _beg_time=3 local time=_beg_time  local _w_time=-90 local _end_time=1 local _d_w_time=180/(11-1)
                for _=1,11 do
                    PlaySound("kira00",0.1,self.x/256,false)
                    last_list=_create_bullet_group(kite,COLOR_GREEN,self.x + 40 * cos(ang),self.y + 40 * sin(ang),6,0,6,6,ang,0,false,0,true,true,0,false,self)
                    for _,unit in ipairs(last_list) do
                        lasttask=task.New(unit,function()
                            local self=task.GetSelf()
                            do
                                local _beg_spd=6 local spd=_beg_spd  local _w_spd=0 local _end_spd=6 - (_ * 0.6) local _d_w_spd=90/(15-1)
                                for _=1,15 do
                                    SetV2(self,spd,self.rot,true,false)
                                    task._Wait(1)
                                    _w_spd=_w_spd+_d_w_spd spd=(_end_spd-_beg_spd)*sin(_w_spd)+(_beg_spd)
                                end
                            end
                        end)
                    end
                    last_list=_create_bullet_group(kite,COLOR_GREEN,self.x + 40 * cos(ang2),self.y + 40 * sin(ang2),6,0,6,6,ang2,0,false,0,true,true,0,false,self)
                    for _,unit in ipairs(last_list) do
                        lasttask=task.New(unit,function()
                            local self=task.GetSelf()
                            do
                                local _beg_spd=6 local spd=_beg_spd  local _w_spd=0 local _end_spd=6 - (_ * 0.6) local _d_w_spd=90/(15-1)
                                for _=1,15 do
                                    SetV2(self,spd,self.rot,true,false)
                                    task._Wait(1)
                                    _w_spd=_w_spd+_d_w_spd spd=(_end_spd-_beg_spd)*sin(_w_spd)+(_beg_spd)
                                end
                            end
                        end)
                    end
                    task._Wait(time)
                    ang=ang+_d_ang
                    ang2=ang2+_d_ang2
                    _w_time=_w_time+_d_w_time time=(_end_time-_beg_time)/2*sin(_w_time)+((_end_time+_beg_time)/2)
                end
            end
            task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_DECEL,MOVE_RANDOM)
            task._Wait(60)
        end
    end)
end
function _tmp_sc:del()
end
_tmp_sc.perform=false
table.insert(_editor_class["Eternity"].cards,_tmp_sc)

_tmp_sc=boss.card.New("Sinusoidal Buoyancy \"Midsummer Frenzy\"",2,5,60,900,{0,40,15},false)

    _editor_class["EternityLaser1"]=Class(laser)
    _editor_class["EternityLaser1"].init=function(self,_x,_y,rot)
    laser.init(self,COLOR_DEEP_GREEN,_x,_y,0,128,512,128,8,0,0)
        
        PlaySound("boon00",0.1,self.x/256,false)
        lasttask=task.New(self,function()
            self.rot = rot
            laser._TurnHalfOn(self,15,true)
            task._Wait(45)
            PlaySound("kira00",0.1,self.x/256,false)
            last_list=_create_bullet_group(butterfly,COLOR_DEEP_GREEN,self.x,self.y,15,0,2,10,rot,0,false,0,true,true,0,false,self)
            laser._TurnOff(self,30,true)
            _del(self,true)
        end)
    end

function _tmp_sc:before()
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        last=New(_editor_class["Spell_Cutin"],self.x,self.y,"Eternity")
        task.MoveTo(0,122,60,MOVE_NORMAL)
        task._Wait(60)
        lasttask=task.New(self,function()
            do
                local _h_a=(100-(-100))/2 local _t_a=(100+(-100))/2 local a=_h_a*sin(0)+_t_a local _w_a=0 local _d_w_a=1.5
                for _=1,_infinite do
                    self.x,self.y=a,self.y
                    task._Wait(1)
                    _w_a=_w_a+_d_w_a a=_h_a*sin(_w_a)+_t_a
                end
            end
        end)
        lasttask=task.New(self,function()
            for _=1,_infinite do
                New(boss_cast_ef,self.x,self.y,360,0,255,200,60,2,false)
                task._Wait(60)
                do
                    local _h_ang=(15-(-15))/2 local _t_ang=(15+(-15))/2 local ang=_h_ang*sin(0)+_t_ang local _w_ang=0 local _d_w_ang=2
                    for _=1,10 do
                        last=New(_straight,ellipse,COLOR_DEEP_GREEN,self.x,self.y,6,ang + 20,false,0,true,true,0,false,0,0,0,false)
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            do
                                local _beg_spd=6 local spd=_beg_spd  local _w_spd=-90 local _end_spd=0 local _d_w_spd=180/(35-1)
                                for _=1,35 do
                                    SetV2(self,spd,self.rot,true,false)
                                    task._Wait(1)
                                    _w_spd=_w_spd+_d_w_spd spd=(_end_spd-_beg_spd)/2*sin(_w_spd)+((_end_spd+_beg_spd)/2)
                                end
                            end
                            do
                                local _beg_ang=self.rot local ang=_beg_ang local _end_ang=Angle(self, player) local _w_ang=0 local _d_w_ang=1/(15-1)
                                for _=1,15 do
                                    SetV2(self,0,ang,true,false)
                                    task._Wait(1)
                                    _w_ang=_w_ang+_d_w_ang ang=(_beg_ang-_end_ang)*(_w_ang-1)^2+_end_ang
                                end
                            end
                            do
                                local _beg_ang=self.rot - 40 local ang=_beg_ang local _end_ang=self.rot + 40 local _d_ang=(_end_ang-_beg_ang)/(3-1)
                                for _=1,3 do
                                    last=New(_editor_class["EternityLaser1"],self.x,self.y,ang)
                                    ang=ang+_d_ang
                                end
                            end
                            task._Wait(60)
                            _del(self,true)
                        end)
                        last=New(_straight,ellipse,COLOR_DEEP_GREEN,self.x,self.y,6,ang - 20 + 180,false,0,true,true,0,false,0,0,0,false)
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            do
                                local _beg_spd=6 local spd=_beg_spd  local _w_spd=-90 local _end_spd=0 local _d_w_spd=180/(35-1)
                                for _=1,35 do
                                    SetV2(self,spd,self.rot,true,false)
                                    task._Wait(1)
                                    _w_spd=_w_spd+_d_w_spd spd=(_end_spd-_beg_spd)/2*sin(_w_spd)+((_end_spd+_beg_spd)/2)
                                end
                            end
                            do
                                local _beg_ang=self.rot local ang=_beg_ang local _end_ang=Angle(self, player) local _w_ang=0 local _d_w_ang=1/(15-1)
                                for _=1,15 do
                                    SetV2(self,0,ang,true,false)
                                    task._Wait(1)
                                    _w_ang=_w_ang+_d_w_ang ang=(_beg_ang-_end_ang)*(_w_ang-1)^2+_end_ang
                                end
                            end
                            do
                                local _beg_ang=self.rot - 40 local ang=_beg_ang local _end_ang=self.rot + 40 local _d_ang=(_end_ang-_beg_ang)/(3-1)
                                for _=1,3 do
                                    last=New(_editor_class["EternityLaser1"],self.x,self.y,ang)
                                    ang=ang+_d_ang
                                end
                            end
                            task._Wait(60)
                            _del(self,true)
                        end)
                        task._Wait(5)
                        _w_ang=_w_ang+_d_w_ang ang=_h_ang*sin(_w_ang)+_t_ang
                    end
                end
                task._Wait(60)
            end
        end)
        lasttask=task.New(self,function()
            do
                local _h_ang=(15-(-15))/2 local _t_ang=(15+(-15))/2 local ang=_h_ang*sin(-15)+_t_ang local _w_ang=-15 local _d_w_ang=1.5
                local _h_ang2=(-15-(15))/2 local _t_ang2=(-15+(15))/2 local ang2=_h_ang2*sin(15)+_t_ang2 local _w_ang2=15 local _d_w_ang2=1.5
                local ang3=0 local _d_ang3=(3)
                for _=1,_infinite do
                    PlaySound("kira00",0.1,self.x/256,false)
                    do local ang4,_d_ang4=(90),(360/3) for _=1,3 do
                        last=New(_straight,kite,COLOR_DEEP_GREEN,self.x,self.y,3,ang + ang3 + ang4,false,0,true,true,0,false,0,0,0,false)
                        last=New(_straight,kite,COLOR_DEEP_GREEN,self.x,self.y,3,ang2 + ang3 + ang4,false,0,true,true,0,false,0,0,0,false)
                    ang4=ang4+_d_ang4 end end
                    do local ang4,_d_ang4=(90),(360/3) for _=1,3 do
                        last=New(_straight,kite,COLOR_DEEP_GREEN,self.x,self.y,3,ang - ang3 - ang4,false,0,true,true,0,false,0,0,0,false)
                        last=New(_straight,kite,COLOR_DEEP_GREEN,self.x,self.y,3,ang2 - ang3 - ang4,false,0,true,true,0,false,0,0,0,false)
                    ang4=ang4+_d_ang4 end end
                    task._Wait(10)
                    _w_ang=_w_ang+_d_w_ang ang=_h_ang*sin(_w_ang)+_t_ang
                    _w_ang2=_w_ang2+_d_w_ang2 ang2=_h_ang2*sin(_w_ang2)+_t_ang2
                    ang3=ang3+_d_ang3
                end
            end
        end)
    end)
end
function _tmp_sc:del()
end
_tmp_sc.perform=false
table.insert(_editor_class["Eternity"].cards,_tmp_sc)
table.insert(_sc_table,{"Eternity","Sinusoidal Buoyancy \"Midsummer Frenzy\"",_tmp_sc,#_editor_class["Eternity"].cards,false})
_tmp_sc=boss.card.New("Scatter Sign \"Scattering Metamorphosis\"",5,15,60,1200,{0,40,15},false)
function _tmp_sc:before()
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        last=New(_editor_class["Spell_Cutin"],self.x,self.y,"Eternity")
        task.MoveTo(0,120,60,MOVE_NORMAL)
        lasttask=task.New(self,function()
            for _=1,_infinite do
                task._Wait(60*12)
                PlaySound("tan00",0.1,self.x/256,false)
                last_list=_create_bullet_group(ball_huge,COLOR_GREEN,self.x,self.y,15,0,2,2,0,360,true,0,true,true,0,false,self)
            end
        end)
        for _=1,_infinite do
            New(boss_cast_ef,self.x,self.y,360,0,255,200,60,2,false)
            boss.cast(self,60)
            task._Wait(60)
            last=New(_straight,butterfly,COLOR_GREEN,self.x,self.y,0,0,false,0,true,false,0,false,0,0,0,false)
            last.navi = true
            lasttask=task.New(last,function()
                local self=task.GetSelf()
                lasttask=task.New(self,function()
                    task.Basis2MoveTo(60*3.5,MOVE_ACC_DEC,20, 200, 160, 180, 200, 0, 40, -240)
                    _del(self,true)
                end)
                task._Wait(5)
                for _=1,_infinite do
                    PlaySound("kira00",0.1,self.x/256,false)
                    last=New(_straight,ball_mid,COLOR_GREEN,self.x,self.y,0,self.rot,false,0,true,false,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        task._Wait(60*2)
                        PlaySound("kira01",0.1,self.x/256,false)
                        do local ang,_d_ang=(self.rot),(360/4) for _=1,4 do
                            last=New(_straight,ball_mid_c,COLOR_GREEN,self.x,self.y,5,ang,false,0,true,false,0,false,0,0,0,false)
                            lasttask=task.New(last,function()
                                local self=task.GetSelf()
                                do
                                    local _beg_spd=5 local spd=_beg_spd  local _w_spd=-90 local _end_spd=0 local _d_w_spd=180/(20-1)
                                    for _=1,20 do
                                        SetV2(self,spd,self.rot,true,false)
                                        task._Wait(1)
                                        _w_spd=_w_spd+_d_w_spd spd=(_end_spd-_beg_spd)/2*sin(_w_spd)+((_end_spd+_beg_spd)/2)
                                    end
                                end
                                task._Wait(60*2)
                                PlaySound("kira02",0.1,self.x/256,false)
                                do local ang2,_d_ang2=(self.rot),(360/3) for _=1,3 do
                                    last=New(_straight,ball_small,COLOR_DEEP_GREEN,self.x,self.y,4,ang2,false,0,true,false,0,false,0,0,0,false)
                                    lasttask=task.New(last,function()
                                        local self=task.GetSelf()
                                        do
                                            local _beg_spd=4 local spd=_beg_spd  local _w_spd=-90 local _end_spd=0 local _d_w_spd=180/(60-1)
                                            for _=1,60 do
                                                SetV2(self,spd,self.rot,true,false)
                                                task._Wait(1)
                                                _w_spd=_w_spd+_d_w_spd spd=(_end_spd-_beg_spd)/2*sin(_w_spd)+((_end_spd+_beg_spd)/2)
                                            end
                                        end
                                        task._Wait(60*2)
                                        last_list=_create_bullet_group(mildew,COLOR_DEEP_GREEN,self.x,self.y,2,0,1,1,self.rot,360,false,0,true,true,0,false,self)
                                        for _,unit in ipairs(last_list) do
                                            _object.set_color(unit,"mul+add",255,255,255,255)
                                        end
                                        PlaySound("kira02",0.1,self.x/256,false)
                                        _del(self,true)
                                    end)
                                ang2=ang2+_d_ang2 end end
                                _del(self,true)
                            end)
                            _del(self,true)
                        ang=ang+_d_ang end end
                        _del(self,true)
                    end)
                    task._Wait(6)
                end
            end)
            task._Wait(60*11)
            New(boss_cast_ef,self.x,self.y,360,0,255,200,60,2,false)
            boss.cast(self,60)
            task._Wait(60)
            last=New(_straight,butterfly,COLOR_GREEN,self.x,self.y,0,180,false,0,true,false,0,false,0,0,0,false)
            last.navi = true
            lasttask=task.New(last,function()
                local self=task.GetSelf()
                lasttask=task.New(self,function()
                    task.Basis2MoveTo(60*3.5,MOVE_ACC_DEC,-20, 200, -160, 180, -200, 0, -40, -240)
                    _del(self,true)
                end)
                task._Wait(5)
                for _=1,_infinite do
                    PlaySound("kira00",0.1,self.x/256,false)
                    last=New(_straight,ball_mid,COLOR_GREEN,self.x,self.y,0,self.rot,false,0,true,false,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        task._Wait(60*2)
                        PlaySound("kira01",0.1,self.x/256,false)
                        do local ang,_d_ang=(self.rot),(360/4) for _=1,4 do
                            last=New(_straight,ball_mid_c,COLOR_GREEN,self.x,self.y,5,ang,false,0,true,false,0,false,0,0,0,false)
                            lasttask=task.New(last,function()
                                local self=task.GetSelf()
                                do
                                    local _beg_spd=5 local spd=_beg_spd  local _w_spd=-90 local _end_spd=0 local _d_w_spd=180/(20-1)
                                    for _=1,20 do
                                        SetV2(self,spd,self.rot,true,false)
                                        task._Wait(1)
                                        _w_spd=_w_spd+_d_w_spd spd=(_end_spd-_beg_spd)/2*sin(_w_spd)+((_end_spd+_beg_spd)/2)
                                    end
                                end
                                task._Wait(60*2)
                                PlaySound("kira02",0.1,self.x/256,false)
                                do local ang2,_d_ang2=(self.rot),(360/3) for _=1,3 do
                                    last=New(_straight,ball_small,COLOR_DEEP_GREEN,self.x,self.y,4,ang2,false,0,true,false,0,false,0,0,0,false)
                                    lasttask=task.New(last,function()
                                        local self=task.GetSelf()
                                        do
                                            local _beg_spd=4 local spd=_beg_spd  local _w_spd=-90 local _end_spd=0 local _d_w_spd=180/(60-1)
                                            for _=1,60 do
                                                SetV2(self,spd,self.rot,true,false)
                                                task._Wait(1)
                                                _w_spd=_w_spd+_d_w_spd spd=(_end_spd-_beg_spd)/2*sin(_w_spd)+((_end_spd+_beg_spd)/2)
                                            end
                                        end
                                        task._Wait(60*2)
                                        last_list=_create_bullet_group(mildew,COLOR_DEEP_GREEN,self.x,self.y,2,0,1,1,self.rot,360,false,0,true,true,0,false,self)
                                        for _,unit in ipairs(last_list) do
                                            _object.set_color(unit,"mul+add",255,255,255,255)
                                        end
                                        PlaySound("kira02",0.1,self.x/256,false)
                                        _del(self,true)
                                    end)
                                ang2=ang2+_d_ang2 end end
                                _del(self,true)
                            end)
                            _del(self,true)
                        ang=ang+_d_ang end end
                        _del(self,true)
                    end)
                    task._Wait(6)
                end
            end)
            task._Wait(60*11)
        end
    end)
end
function _tmp_sc:del()
    scoredata.clearCount[1][2] = scoredata.clearCount[1][2] + 1
end
_tmp_sc.perform=false
table.insert(_editor_class["Eternity"].cards,_tmp_sc)
table.insert(_sc_table,{"Eternity","Scatter Sign \"Scattering Metamorphosis\"",_tmp_sc,#_editor_class["Eternity"].cards,false})
_editor_class["Isaki"]=Class(boss)
_editor_class["Isaki"].cards={}
_editor_class["Isaki"].name="Isaki Kikushi"
_editor_class["Isaki"].bgm=""
_editor_class["Isaki"]._bg=nil
_editor_class["Isaki"].difficulty="All"
_editor_class["Isaki"].init=function(self,cards)
    boss.init(self,240,384,_editor_class["Isaki"].name,cards,New(_editor_class["IsakiBG"]),_editor_class["Isaki"].difficulty)
    self._wisys = BossWalkImageSystem(self)
    self._wisys:SetImage("Isaki_Boss.png",3,4,{4,4,4},{1,2},6,16,16)
    self.hscale, self.vscale = 1/2.25, 1/2.25
end
_tmp_sc=boss.dialog.New(true)
function _tmp_sc:init()
    lstg.player.dialog=true
    _dialog_can_skip=true
    self.dialog_displayer=New(dialog_displayer)
    lasttask=task.New(self,function()
        boss.dialog.sentence(self,"image:Marisa_1","left",[===[Crazy to think that shrubs like these haven't
popped up in Gensokyo before, not like this.]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Marisa_6","left",[===[To be fair, it's just a novelty factor reminiscent
of a similar incident from way back then.]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Marisa_4","left",[===[Oh, that seems like a familiar face.]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        task.MoveTo(0,120,60,MOVE_DECEL)
        last=New(_editor_class["CharacterTitle"],540, 100,"Isaki")
        boss.dialog.sentence(self,"image:Isaki_2","right",[===[Hey, you're the one that showed up at
the Hakurei shrine some time ago, right?]===],600,0.15, 0.15,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Isaki_1","right",[===[I was wondering if you knew what to do about
these weird plants that are showing up recently.]===],600,0.15, 0.15,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Isaki_3","right",[===[My crops are all slowly waning,
I don't know what to do!]===],600,0.15, 0.15,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Marisa_3","left",[===[Uh, I'm not sure.
Tried cropping them up?]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Isaki_3","right",[===[That won't work, and I can't even do anything
with the shrubs because they fade right away!]===],600,0.15, 0.15,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Marisa_1","left",[===[I've got a fellow not far from here who's taking care
of studying these plants, you should seek her.]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Isaki_1","right",[===[Really? Where is she?]===],600,0.15, 0.15,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Marisa_2","left",[===[Hang on there, won't you put up some
battle for me to try out these new toys?]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Isaki_3","right",[===[I don't really have time for that, please tell me where to go...]===],600,0.15, 0.15,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
        _stop_music()
        boss.dialog.sentence(self,"image:Marisa_2","left",[===[C'mon, it'll be quick! I want an excuse to try out these
shrubs with someone at least somewhat formidable!]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        LoadMusicRecord("bgm:Act1BossTheme")
        _play_music("bgm:Act1BossTheme")
        last=New(_editor_class["SongDisplayer"],self.x,self.y,true)
        boss.dialog.sentence(self,"image:Isaki_3","right",[===[Ugh... how do you even handle these things?!]===],600,0.15, 0.15,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
    end)
end
table.insert(_editor_class["Isaki"].cards,_tmp_sc)
_tmp_sc=boss.card.New("",2,4,40,1200,{0,40,15},false)
function _tmp_sc:before()
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        for _=1,_infinite do
            task.MoveTo(-200,120,60,MOVE_DECEL)
            New(boss_cast_ef,self.x,self.y,360,255,125,0,60,2,false)
            task._Wait(60)
            lasttask=task.New(self,function()
                for _=1,15 do
                    PlaySound("kira02",0.1,self.x/256,false)
                    last_list=_create_bullet_group(water_drop,COLOR_ORANGE,self.x, self.y - 30,10,0,3,4,90,0,false,0,true,true,0,false,self)
                    for _,unit in ipairs(last_list) do
                        _set_g(unit,0.05)
                        unit.navi = true
                    end
                    task._Wait(2)
                end
            end)
            task.MoveTo(200, 120,30,MOVE_ACC_DEC)
            New(boss_cast_ef,self.x,self.y,360,255,125,0,60,2,false)
            task._Wait(60)
            lasttask=task.New(self,function()
                for _=1,15 do
                    PlaySound("kira02",0.1,self.x/256,false)
                    last_list=_create_bullet_group(water_drop,COLOR_ORANGE,self.x, self.y - 30,10,0,3,4,90,0,false,0,true,true,0,false,self)
                    for _,unit in ipairs(last_list) do
                        _set_g(unit,0.05)
                        unit.navi = true
                    end
                    task._Wait(2)
                end
            end)
            task.MoveTo(-200, 120,30,MOVE_ACC_DEC)
            task.MoveTo(0,120,60,MOVE_DECEL)
            New(boss_cast_ef,self.x,self.y,360,255,125,0,60,2,false)
            task._Wait(60)
            PlaySound("enep02",0.1,self.x/256,false)
            for _=1,15 do
                PlaySound("kira00",0.1,self.x/256,false)
                local ranPosX=(ran:Int(-30, 30))
                local ranPosY=(ran:Int(-30, 30))
                last=New(EnemySimple,7,25,self.x + ranPosX,self.y + ranPosY,{0,3,0},1,false,true,false,function(self)
                    task.New(self,function()
                        self.navi = false
                        SetV2(self,2,0,false,true)
                        _set_a(self,0.05,0,true)
                        for _=1,_infinite do
                            PlaySound("kira01",0.1,self.x/256,false)
                            last_list=_create_bullet_group(water_drop,COLOR_ORANGE,self.x,self.y,3,0,ran:Float(2.6, 4),ran:Float(2.6, 4),Angle(self.x, self.y, self.dx, self.dy) - 180 + ran:Int(-10, 10),ran:Int(-2, 2),false,0,true,true,0,false,self)
                            for _,unit in ipairs(last_list) do
                                _set_g(unit,0.05)
                                unit.navi = true
                            end
                            task._Wait(15)
                        end
                    end)
                end)
                _connect(self,last,0.8,true)
                last_list=_create_bullet_group(ball_mid,ran:Int(12, 14),self.x + ranPosX,self.y + ranPosY,3,0,3,3,ran:Int(0, 360),360,false,0,true,true,0,false,self)
                task._Wait(6)
            end
            task._Wait(60*3)
        end
    end)
end
function _tmp_sc:del()
end
_tmp_sc.perform=false
table.insert(_editor_class["Isaki"].cards,_tmp_sc)

_tmp_sc=boss.card.New("Bakery Technique \"Convection Oven\"",2,5,60,1800,{0,40,15},false)

    _editor_tasks["IsakiSpell1BulletBehavior1"]=function(t1,t2)
        return function()
            local self=task.GetSelf()
            self.bound = false
            self.navi = true
            local speed=(GetV(self))
            task._Wait(t1 or 60)
            do
                local _beg_spd=speed local spd=_beg_spd local _end_spd=0 local _w_spd=0 local _d_w_spd=1/(t2 or 30)
                for _=1,t2 or 30 do
                    SetV2(self,spd,self.rot,true,false)
                    task._Wait(1)
                    _w_spd=_w_spd+_d_w_spd spd=(_beg_spd-_end_spd)*(_w_spd-1)^2+_end_spd
                end
            end
        end
    end

function _tmp_sc:before()
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        last=New(_editor_class["Spell_Cutin"],self.x,self.y,"Isaki")
        task.MoveTo(0,120,60,MOVE_DECEL)
        local sign=(1)
        New(boss_cast_ef,self.x,self.y,360,255,125,0,60,2,false)
        task._Wait(60)
        for _=1,_infinite do
            lasttask=task.New(self,function()
                do
                    local _beg_spd1=3 local spd1=_beg_spd1 local _end_spd1=2 local _d_spd1=(_end_spd1-_beg_spd1)/(180/3)
                    local _beg_spd2=4 local spd2=_beg_spd2 local _end_spd2=3 local _d_spd2=(_end_spd2-_beg_spd2)/(180/3)
                    for _=1,180/3 do
                        PlaySound("tan00",0.1,self.x/256,false)
                        last_list=_create_bullet_group(water_drop,COLOR_RED,self.x,self.y,3,0,spd1,spd1,self.timer * 5+180,360,false,0,true,false,0,false,self)
                        for _,unit in ipairs(last_list) do
                            lasttask=task.New(unit,_editor_tasks["IsakiSpell1BulletBehavior1"]())
                        end
                        last_list=_create_bullet_group(water_drop,COLOR_ORANGE,self.x,self.y,3,0,spd2,spd2,self.timer * 7,360,false,0,true,false,0,false,self)
                        for _,unit in ipairs(last_list) do
                            lasttask=task.New(unit,_editor_tasks["IsakiSpell1BulletBehavior1"]())
                        end
                        task._Wait(3)
                        spd1=spd1+_d_spd1
                        spd2=spd2+_d_spd2
                    end
                end
            end)
            task.BezierMoveTo(180,MOVE_ACC_DEC,51.5*sign, 152, 152.5*sign, 125, 103.5*sign, 0, -100.5*sign, -53, -147.5*sign, 83, -100.5*sign, 181, 0, 120)
            task._Wait(120)
            for _=1,5 do
                local ang=(Angle(self,player))
                for _,unit in ObjList(GROUP_INDES) do
                    lasttask=task.New(unit,function()
                        local self=task.GetSelf()
                        task._Wait(ran:Int(0,10))
                        PlaySound("don00",0.1,self.x/256,false)
                        local distance=(ran:Float(64,150))
                        task.MoveToEx(distance*cos(ang), distance*sin(ang),90,MOVE_ACC_DEC)
                    end)
                end
                task._Wait(90)
            end
            task._Wait(60)
            for _,unit in ObjList(GROUP_INDES) do
                lasttask=task.New(unit,function()
                    local self=task.GetSelf()
                    self.navi = false
                    task._Wait(ran:Int(0,60))
                    PlaySound("kira00",0.1,self.x/256,false)
                    last=New(_straight,heart,COLOR_RED,unit.x,unit.y,0,0,false,0,true,true,0,false,0.02,Angle(unit,player),4,false)
                    last.navi = true
                    _object.set_color(last,"mul+add",255,255,255,255)
                    _del(unit,true)
                end)
            end
            task._Wait(210)
            sign=(-sign)
        end
    end)
end
function _tmp_sc:del()
end
_tmp_sc.perform=false
table.insert(_editor_class["Isaki"].cards,_tmp_sc)
table.insert(_sc_table,{"Isaki","Bakery Technique \"Convection Oven\"",_tmp_sc,#_editor_class["Isaki"].cards,false})
_tmp_sc=boss.card.New("Sure-Fire Vanquishing \"Optically-precise Cleansing\"",2,20,60,1800,{0,40,15},false)
function _tmp_sc:before()
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        last=New(_editor_class["Spell_Cutin"],self.x,self.y,"Isaki")
        task.MoveTo(0, 0,60,MOVE_DECEL)
        New(boss_cast_ef,self.x,self.y,360,255,125,0,60,2,false)
        task._Wait(60)
        last=New(_straight,ball_huge,COLOR_ORANGE,self.x, self.y,0,0,false,0,true,false,0,false,0,0,0,false)
        lasttask=task.New(last,function()
            local self=task.GetSelf()
            self.navi = true
            lasttask=task.New(self,function()
                task._Wait(60)
                for _=1,_infinite do
                    PlaySound("tan00",0.1,self.x/256,false)
                    last_list=_create_bullet_group(water_drop,COLOR_ORANGE,self.x,self.y,15,0,2,4,self.rot - 180,0,false,0,true,true,0,false,self)
                    task._Wait(4)
                end
            end)
            for _=1,_infinite do
                task.CRMoveTo(60*3,MOVE_ACC_DEC,0, 120, -100, 60, -200, -20)
                task.CRMoveTo(60*3,MOVE_ACC_DEC,-40, -200, 20, -220, 180, -60)
                task.CRMoveTo(60*3,MOVE_ACC_DEC,20, 80, 90, 120, -80, 200)
            end
        end)
        last=New(_straight,ball_huge,COLOR_ORANGE,self.x, self.y,0,0,false,0,true,false,0,false,0,0,0,false)
        lasttask=task.New(last,function()
            local self=task.GetSelf()
            self.navi = true
            lasttask=task.New(self,function()
                task._Wait(60)
                for _=1,_infinite do
                    PlaySound("tan00",0.1,self.x/256,false)
                    last_list=_create_bullet_group(water_drop,COLOR_ORANGE,self.x,self.y,15,0,2,4,self.rot - 180,0,false,0,true,true,0,false,self)
                    task._Wait(4)
                end
            end)
            for _=1,_infinite do
                task.CRMoveTo(60*3,MOVE_ACC_DEC,0, 120, 100, 60, 200, -20)
                task.CRMoveTo(60*3,MOVE_ACC_DEC,40, -200, -20, -220, -180, -60)
                task.CRMoveTo(60*3,MOVE_ACC_DEC,-20, 80, -90, 120, 80, 200)
            end
        end)
        task._Wait(60*3)
        New(boss_cast_ef,self.x,self.y,360,255,125,0,60,2,false)
        task._Wait(60)
        last=New(_straight,ball_huge,COLOR_RED,self.x, self.y,0,0,false,0,true,false,0,false,0,0,0,false)
        lasttask=task.New(last,function()
            local self=task.GetSelf()
            self.navi = true
            lasttask=task.New(self,function()
                task._Wait(8)
                for _=1,_infinite do
                    PlaySound("tan00",0.1,self.x/256,false)
                    last_list=_create_bullet_group(water_drop,COLOR_RED,self.x,self.y,8,0,2,4,self.rot - 180,0,false,0,true,true,0,false,self)
                    task._Wait(8)
                end
            end)
            for _=1,_infinite do
                task.CRMoveTo(60*3,MOVE_ACC_DEC,200, -120, -180, 180, -40, -120)
                task.CRMoveTo(60*3,MOVE_ACC_DEC,-120, -100, -50, -140, 90, -80)
                task.CRMoveTo(60*3,MOVE_ACC_DEC,-100, 20, 180, 20, -180, 100)
            end
        end)
        last=New(_straight,ball_huge,COLOR_RED,self.x, self.y,0,0,false,0,true,false,0,false,0,0,0,false)
        lasttask=task.New(last,function()
            local self=task.GetSelf()
            self.navi = true
            lasttask=task.New(self,function()
                task._Wait(8)
                for _=1,_infinite do
                    PlaySound("tan00",0.1,self.x/256,false)
                    last_list=_create_bullet_group(water_drop,COLOR_RED,self.x,self.y,8,0,2,4,self.rot - 180,0,false,0,true,true,0,false,self)
                    task._Wait(8)
                end
            end)
            for _=1,_infinite do
                task.CRMoveTo(60*3,MOVE_ACC_DEC,-200, -120, 180, 180, 40, -120)
                task.CRMoveTo(60*3,MOVE_ACC_DEC,120, -100, 50, -140, -90, -80)
                task.CRMoveTo(60*3,MOVE_ACC_DEC,100, 20, -180, 20, 180, 100)
            end
        end)
        task._Wait(60*3)
        New(boss_cast_ef,self.x,self.y,360,255,125,0,60,2,false)
        task._Wait(60)
        last=New(_straight,ball_huge,COLOR_YELLOW,self.x, self.y,0,0,false,0,true,false,0,false,0,0,0,false)
        lasttask=task.New(last,function()
            local self=task.GetSelf()
            self.navi = true
            lasttask=task.New(self,function()
                task._Wait(10)
                for _=1,_infinite do
                    PlaySound("tan00",0.1,self.x/256,false)
                    last_list=_create_bullet_group(water_drop,COLOR_YELLOW,self.x,self.y,10,0,2,4,self.rot - 180,0,false,0,true,true,0,false,self)
                    task._Wait(10)
                end
            end)
            for _=1,_infinite do
                task.CRMoveTo(60*3,MOVE_ACC_DEC,140, 100, 40, -100, 80, 0)
                task.CRMoveTo(60*3,MOVE_ACC_DEC,180, -200, 20, 120, 200, 180)
                task.CRMoveTo(60*3,MOVE_ACC_DEC,20, 20, 180, 200, 100, -200)
            end
        end)
        last=New(_straight,ball_huge,COLOR_YELLOW,self.x, self.y,0,0,false,0,true,false,0,false,0,0,0,false)
        lasttask=task.New(last,function()
            local self=task.GetSelf()
            self.navi = true
            lasttask=task.New(self,function()
                task._Wait(10)
                for _=1,_infinite do
                    PlaySound("tan00",0.1,self.x/256,false)
                    last_list=_create_bullet_group(water_drop,COLOR_YELLOW,self.x,self.y,10,0,2,4,self.rot - 180,0,false,0,true,true,0,false,self)
                    task._Wait(10)
                end
            end)
            for _=1,_infinite do
                task.CRMoveTo(60*3,MOVE_ACC_DEC,-140, 100, -40, -100, -80, 0)
                task.CRMoveTo(60*3,MOVE_ACC_DEC,-180, -200, -20, 120, -200, 180)
                task.CRMoveTo(60*3,MOVE_ACC_DEC,-20, 20, -180, 200, -100, -200)
            end
        end)
        task._Wait(60*3)
        New(boss_cast_ef,self.x,self.y,360,255,125,0,60,2,false)
        task._Wait(60)
        for _=1,_infinite do
            last_list=_create_bullet_group(arrow_big,COLOR_ORANGE,self.x,self.y,15,0,1,1,0,360,true,0,true,true,0,false,self)
            PlaySound("kira00",0.1,self.x/256,false)
            task._Wait(30)
        end
    end)
end
function _tmp_sc:del()
    scoredata.clearCount[1][1] = scoredata.clearCount[1][1] + 1
end
_tmp_sc.perform=false
table.insert(_editor_class["Isaki"].cards,_tmp_sc)
table.insert(_sc_table,{"Isaki","Sure-Fire Vanquishing \"Optically-precise Cleansing\"",_tmp_sc,#_editor_class["Isaki"].cards,false})
_editor_class["Karen"]=Class(boss)
_editor_class["Karen"].cards={}
_editor_class["Karen"].name="Karen Yawata"
_editor_class["Karen"].bgm=""
_editor_class["Karen"]._bg=nil
_editor_class["Karen"].difficulty="All"
_editor_class["Karen"].init=function(self,cards)
    boss.init(self,240,384,_editor_class["Karen"].name,cards,New(_editor_class["KarenBG"]),_editor_class["Karen"].difficulty)
    self._wisys = BossWalkImageSystem(self)
    self._wisys:SetImage("Karen_Boss.png",3,4,{4,4,4},{1,2},6,16,16)
    self.hscale, self.vscale = 1/2.25, 1/2.25
end
_tmp_sc=boss.dialog.New(true)
function _tmp_sc:init()
    lstg.player.dialog=true
    _dialog_can_skip=true
    self.dialog_displayer=New(dialog_displayer)
    lasttask=task.New(self,function()
        boss.dialog.sentence(self,"image:Marisa_4","left",[===[Damn, they really are all over the place. I've gotta get
back to Reimu to tell her about what I've found so far.]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Marisa_4","left",[===[Though... what's actually that in the distance...?]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        task.MoveTo(0,120,60,MOVE_DECEL)
        boss.dialog.sentence(self,"image:Karen_2","right",[===[Ahah! Look at that! Isn't that the lovely Marisa Kirisame,
wandering around with the weirdest UFO I've seen around!]===],600,0.15, 0.15,1,1,(550 - -1 * 150),150,(550 - -1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Marisa_2","left",[===[UFO? That's quite the funny description.]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Karen_1","right",[===[Yeah, Unidentified Floral Object!]===],600,0.15, 0.15,1,1,(550 - -1 * 150),150,(550 - -1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Marisa_2","left",[===[That kind of does make sense.
Who're you again?]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Karen_1","right",[===[The mind of purification hidden by
purple clouds of the good omen,]===],600,0.15, 0.15,1,1,(550 - -1 * 150),150,(550 - -1 * 100),230,1,false)
        last=New(_editor_class["CharacterTitle"],540, 100,"Karen")
        boss.dialog.sentence(self,"image:Karen_2","right",[===[An utopia of fantastic orbit, the flower of
starry nirvana... Does Karen ring a bell?]===],600,0.15, 0.15,1,1,(550 - -1 * 150),150,(550 - -1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Karen_3","right",[===[Don't you remember me around those
weird UFOs back in the day?]===],600,0.15, 0.15,1,1,(550 - -1 * 150),150,(550 - -1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Marisa_2","left",[===[Wow, that's a lot of fancy words. Not really... I guess I was
just too enthralled by coming back to Makai after so much time.]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Karen_1","right",[===[Sure, sure. Care to tell me what
these things are about?]===],600,0.15, 0.15,1,1,(550 - -1 * 150),150,(550 - -1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Marisa_1","left",[===[Just some nifty shrubs that seem to be growing
all over the place. Pretty powerful, I'd say.]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        _stop_music()
        boss.dialog.sentence(self,"image:Marisa_2","left",[===[How about I show you them first-hand?]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        LoadMusicRecord("bgm:Act2BossTheme")
        _play_music("bgm:Act2BossTheme")
        last=New(_editor_class["SongDisplayer"],self.x,self.y,true)
        boss.dialog.sentence(self,"image:Karen_2","right",[===[Sounds thrilling! Show me what you've got!]===],600,0.15, 0.15,1,1,(550 - -1 * 150),150,(550 - -1 * 100),230,1,false)
    end)
end
table.insert(_editor_class["Karen"].cards,_tmp_sc)
_tmp_sc=boss.card.New("",2,5,60,1400,{0,45,5},false)

    _editor_class["KarenNonspellUFO"]=Class(_object)
    _editor_class["KarenNonspellUFO"].init=function(self,_x,_y,angle)
        self.x,self.y=_x,_y
        self.img="ani:UFO"
        self.layer=LAYER_ENEMY
        self.group=GROUP_NONTJT
        self.hide=false
        self.bound=false
        self.navi=false
        self.hp=9999999
        self.maxhp=9999999
        self.colli=true
        self._servants={}
        self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
        self.timing = 0
        self.a, self.b, self.rect = 32,16,false
        SetV2(self,1,angle,false,false)
        self.navi = false
        lasttask=task.New(self,function()
            do local offsetx,_d_offsetx,offsety,_d_offsety=(0),(1),(10),(2) for _=1,200 do
                last=New(_straight,square,COLOR_PURPLE,self.x + ran:Int(-20, 20) + offsetx * ran:Sign(),self.y + ran:Int(10, -10) - offsety,0,ran:Int(0, 360),false,0,true,true,0,false,0,0,0,false)
                _connect(self,last,0,true)
                last.bound = false
                last.navi = true
                lasttask=task.New(last,function()
                    local self=task.GetSelf()
                    lasttask=task.New(self,function()
                        for _=1,_infinite do
                            if self.y < -236 then
                                _del(self,true)
                            end
                            task._Wait(1)
                        end
                    end)
                    self.object = self._master
                    for _=1,_infinite do
                        if self.object ~= nil and self._master then
                            if Dist(self, self._master) > 45 then
                                _set_a(self,0.05,Angle(self, self.object),false)
                            end
                        end
                        task._Wait(1)
                    end
                end)
                PlaySound("kira00",0.1,self.x/256,false)
                self.timing = self.timing + 1
                if self.timing % 8 == 0 then
                    task._Wait(1)
                end
            offsetx=offsetx+_d_offsetx offsety=offsety+_d_offsety end end
        end)
        lasttask=task.New(self,function()
            for _=1,_infinite do
                if lstg.var.karenKill == true then
                    _del(self,true)
                end
                if self.x < -400 or self.x > 400 then
                    _del(self,true)
                end
                task._Wait(1)
            end
        end)
    end
    _editor_class["KarenNonspellUFO"].colli=function(self,other)
        if other.plantShot then return end
        self.class.base.colli(self,other)
    end
    _editor_class["KarenNonspellUFO2"]=Class(_object)
    _editor_class["KarenNonspellUFO2"].init=function(self,_x,_y,_)
        self.x,self.y=_x,_y
        self.img="ani:UFO"
        self.layer=LAYER_ENEMY
        self.group=GROUP_NONTJT
        self.hide=false
        self.bound=false
        self.navi=false
        self.hp=9999999
        self.maxhp=9999999
        self.colli=true
        self._servants={}
        self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
        SetV2(self,1.5,0,false,true)
        self.navi = false
        self.a, self.b, self.rect = 32,16,false
        lasttask=task.New(self,function()
            for _=1,_infinite do
                for _,unit in ObjList(GROUP_ENEMY_BULLET) do
                    if Dist(self, unit) < 90 then
                        unit.object = self
                        ChangeBulletImage(unit,square,COLOR_PURPLE)
                        _object.set_color(unit,"mul+add",255,255,255,255)
                        unit.hscale = LerpDecel(unit.hscale, 2, 0.1)
                        unit.vscale = LerpDecel(unit.vscale, 2, 0.1)
                        unit.a = LerpDecel(unit.a, 3*2, 0.1)
                        unit.b = LerpDecel(unit.b, 3*2, 0.1)
                    else
                        unit.object = unit._master
                        ChangeBulletImage(unit,square,COLOR_DEEP_PURPLE)
                        _object.set_color(unit,"",255,255,255,255)
                        unit.hscale = LerpDecel(unit.hscale, 1, 0.1)
                        unit.vscale = LerpDecel(unit.vscale, 1, 0.1)
                        unit.a = LerpDecel(unit.a, 3, 0.1)
                        unit.b = LerpDecel(unit.b, 3, 0.1)
                    end
                end
                if lstg.var.karenKill == true then
                    _del(self,true)
                end
                task._Wait(1)
            end
        end)
    end
    _editor_class["KarenNonspellUFO2"].colli=function(self,other)
        if other.plantShot then return end
        self.class.base.colli(self,other)
    end
    _editor_class["KarenNonspellUFO2"].render=function(self)
        _object.set_color(self,"mul+add",100,255,255,255)
        self.hscale, self.vscale = 1.5, 1.5
        self.class.base.render(self)
        _object.set_color(self,"",255,255,255,255)
        self.hscale, self.vscale = 1, 1
        self.class.base.render(self)
    end

function _tmp_sc:before()
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        lstg.var.karenKill = false
        task.MoveTo(0,120,60,MOVE_DECEL)
        boss.cast(self,60)
        New(boss_cast_ef,self.x,self.y,360,255,75,195,60,2,false)
        task._Wait(60)
        lasttask=task.New(self,function()
            for _=1,_infinite do
                last=New(_editor_class["KarenNonspellUFO"],300,self.y + ran:Int(10, -40),ran:Int(10, -10) + 180)
                task._Wait(120)
                last=New(_editor_class["KarenNonspellUFO"],-300,self.y + ran:Int(10, -40),ran:Int(10, -10))
                task._Wait(120)
            end
        end)
        task._Wait(60*2)
        for _=1,_infinite do
            New(boss_cast_ef,self.x,self.y,360,255,75,195,60,2,false)
            boss.cast(self,60)
            task._Wait(60)
            PlaySound("boon01",0.1,self.x/256,false)
            last=New(_editor_class["KarenNonspellUFO2"],self.x,self.y,_)
            _connect(self,last,0.8,true)
            task._Wait(60*4)
        end
    end)
end
function _tmp_sc:del()
    for _,unit in ObjList(GROUP_NONTJT) do
        if unit ~= _boss then
            _kill(self,true)
        end
    end
    lstg.var.karenKill = true
end
_tmp_sc.perform=false
table.insert(_editor_class["Karen"].cards,_tmp_sc)

_tmp_sc=boss.card.New("Bodhisattva\'s Banner \"One Dot Six Enclosure\"",2,5,60,1400,{0,45,5},false)

    _editor_class["KarenUFORadiusTooltip"]=Class(_object)
    _editor_class["KarenUFORadiusTooltip"].init=function(self,_x,_y,master)
        self.x,self.y=_x,_y
        self.img="image:KarenRadius"
        self.layer=LAYER_ENEMY_BULLET_EF+5
        self.group=GROUP_GHOST
        self.hide=false
        self.bound=false
        self.navi=false
        self.hp=10
        self.maxhp=10
        self.colli=true
        self._servants={}
        self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
        self.master = master
        _connect(master,self,0,false)
        _object.set_color(self,"",45,0,213,255)
        self.hscale, self.vscale = 1/2.25, 1/2.25
    end
    _editor_class["KarenUFORadiusTooltip"].frame=function(self)
        self.x, self.y = self.master.x, self.master.y
        local scale = (self.master.radius or 0)/400
        self.hscale, self.vscale = scale, scale
        if lstg.var.karenKill == true then
            _del(self,true)
        end
        self.class.base.frame(self)
    end
    _editor_class["KarenYawataUFOSpell1"]=Class(_object)
    _editor_class["KarenYawataUFOSpell1"].init=function(self,_x,_y,master,rad,ang,sign,radius)
        self.x,self.y=_x,_y
        self.img="ani:UFO"
        self.layer=LAYER_ENEMY
        self.group=GROUP_GHOST
        self.hide=false
        self.bound=false
        self.navi=false
        self.hp=10
        self.maxhp=10
        self.colli=true
        self._servants={}
        self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
        last=New(_editor_class["KarenUFORadiusTooltip"],self.x,self.y,self)
        self.radius = 0
        self.master = master
        
        self.rad = rad
        self.ang = ang
        self.sign = sign
        self._a = 0
        self.hscale, self.vscale = 0,0
lasttask=task.New(self,function () ex.SmoothSetValueTo("radius",radius,60,MOVE_NORMAL,nil,0,MODE_SET) end )
lasttask=task.New(self,function () ex.SmoothSetValueTo("_a",255,60,MOVE_DECEL,nil,0,MODE_SET) end )
lasttask=task.New(self,function () ex.SmoothSetValueTo("hscale",1,60,MOVE_DECEL,nil,0,MODE_SET) end )
lasttask=task.New(self,function () ex.SmoothSetValueTo("vscale",1,60,MOVE_DECEL,nil,0,MODE_SET) end )
    end
    _editor_class["KarenYawataUFOSpell1"].frame=function(self)
        task.Do(self)
        local ang = self.ang + self.master.timer * 0.2* self.sign
        self.x, self.y = self.master.x + self.rad * cos(ang), self.master.y + self.rad * sin(ang)
        if lstg.var.karenKill == true then
            _del(self,true)
        end
        self.class.base.frame(self)
    end

function _tmp_sc:before()
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        last=New(_editor_class["Spell_Cutin"],self.x,self.y,"Karen")
        task.MoveTo(0,120,60,MOVE_DECEL)
        lstg.var.karenKill = false
        New(boss_cast_ef,self.x,self.y,360,255,75,195,60,2,false)
        boss.cast(self,60)
        task._Wait(60)
        local sign=(1)
        check_objs = {}
        PlaySound("boon01",0.1,self.x/256,false)
        do
            local radius=64 local _d_radius=(64)
            local _beg_count=3 local count=_beg_count local _end_count=8 local _d_count=(_end_count-_beg_count)/(5)
            for _=1,5 do
                do
                    local _beg_ang=0 local ang=_beg_ang local _end_ang=360 local _d_ang=(_end_ang-_beg_ang)/(int(count))
                    for _=1,int(count) do
                        last=New(_editor_class["KarenYawataUFOSpell1"],self.x,self.y,self, radius, ang, sign,40)
                        table.insert(check_objs, last)
                        ang=ang+_d_ang
                    end
                end
                sign=(-sign)
                radius=radius+_d_radius
                count=count+_d_count
            end
        end
        lasttask=task.New(self,function()
            for _=1,_infinite do
                for _,unit in ObjList(GROUP_INDES) do
                    unit.count_hit = 0
                end
                for _,unit in ipairs(check_objs) do
                    local check_obj = unit
                    for _,unit in ObjList(GROUP_INDES) do
                        if Dist(check_obj,unit) < (check_obj.radius + 6) then
                        	unit.count_hit = unit.count_hit +1
                        end
                    end
                end
                for _,unit in ObjList(GROUP_INDES) do
                    if (unit.count_hit or 0) > 0 then
                    	unit.colli = false
                    	unit._a = math.lerp(unit._a,0,0.3)
                    else
                    	unit.colli = true
                    	unit._a = math.lerp(unit._a,64,0.3)
                    end
                end
                task._Wait(1)
            end
        end)
        lasttask=task.New(self,function()
            for _=1,_infinite do
                last_list=_create_bullet_group(ball_big,COLOR_CYAN,self.x,self.y,90,0,1,1,ran:Float(0,360),360,false,0,true,false,0,false,self)
                PlaySound("kira00",0.1,self.x/256,false)
                for _,unit in ipairs(last_list) do
                    _object.set_color(unit,"mul+add",153,218,242,255)
                end
                task._Wait(30)
            end
        end)
        lasttask=task.New(self,function()
            for _=1,_infinite do
                PlaySound("kira01",0.1,self.x/256,false)
                do
                    local _beg_ang=0 local ang=_beg_ang local _end_ang=360 local _d_ang=(_end_ang-_beg_ang)/(3)
                    for _=1,3 do
                        last_list=_create_bullet_group(arrow_mid,COLOR_DEEP_PURPLE,self.x,self.y,5,0,1.1,1,ang - self.timer *1,0,false,0,true,true,0,false,self)
                        ang=ang+_d_ang
                    end
                end
                task._Wait(15)
            end
        end)
    end)
end
function _tmp_sc:del()
    lstg.var.karenKill = true
end
_tmp_sc.perform=false
table.insert(_editor_class["Karen"].cards,_tmp_sc)
table.insert(_sc_table,{"Karen","Bodhisattva\'s Banner \"One Dot Six Enclosure\"",_tmp_sc,#_editor_class["Karen"].cards,false})
_tmp_sc=boss.card.New("Tottema\'s Lotus Flower \"Nirvana Utopia\"",2,5,60,1500,{0,45,5},false)

    _editor_class["KarenSpell2UFO"]=Class(_object)
    _editor_class["KarenSpell2UFO"].init=function(self,_x,_y,endposy)
        self.x,self.y=_x,_y
        self.img="ani:UFO"
        self.layer=LAYER_ENEMY
        self.group=GROUP_NONTJT
        self.hide=false
        self.bound=false
        self.navi=false
        self.hp=999999
        self.maxhp=999999
        self.colli=false
        self._servants={}
        self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
        self.x,self.y=self.x,-240
        self.hscale, self.vscale = 2, 2
        PlaySound("se:se_ufo",0.7,self.x/256,false)
        lasttask=task.New(self,function()
            for _=1,_infinite do
                if lstg.var.karenKill == true then
                    _del(self,true)
                end
                task._Wait(1)
            end
        end)
        lasttask=task.New(self,function()
            do
                local _beg_posy=-240 local posy=_beg_posy  local _w_posy=-90 local _end_posy=-200 local _d_w_posy=180/(30-1)
                for _=1,30 do
                    self.x,self.y=self.x,posy
                    task._Wait(1)
                    _w_posy=_w_posy+_d_w_posy posy=(_end_posy-_beg_posy)/2*sin(_w_posy)+((_end_posy+_beg_posy)/2)
                end
            end
            New(boss_cast_ef,self.x,self.y,360,255,75,195,60,2,false)
            task._Wait(60)
            PlaySound("gun00",0.3,self.x/256,false)
            PlaySound("enep02",0.3,self.x/256,false)
            lasttask=task.New(self,function()
                if self.x > 0 then
                    self.offset = 25
                else
                    self.offset = -25
                end
                do
                    local _h_wave=(20-(-20))/2 local _t_wave=(20+(-20))/2 local wave=_h_wave*sin(-20)+_t_wave local _w_wave=-20 local _d_w_wave=8
                    local _h_wave2=(20-(-20))/2 local _t_wave2=(20+(-20))/2 local wave2=_h_wave2*sin(0)+_t_wave2 local _w_wave2=0 local _d_w_wave2=8
                    local _h_wave3=(20-(-20))/2 local _t_wave3=(20+(-20))/2 local wave3=_h_wave3*sin(25)+_t_wave3 local _w_wave3=25 local _d_w_wave3=8
                    for _=1,_infinite do
                        last=New(_straight,ellipse,COLOR_PURPLE,self.x + wave*2,self.y - 24,2,-90 + wave + self.offset,false,0,true,true,0,false,0.08,-90 + wave + self.offset,10,false)
                        _object.set_color(last,"mul+add",255,255,255,255)
                        last=New(_straight,ellipse,COLOR_PURPLE,self.x + wave2*2,self.y - 24,2,-90 + wave2 + self.offset,false,0,true,true,0,false,0.08,-90 + wave2 + self.offset,10,false)
                        _object.set_color(last,"mul+add",255,255,255,255)
                        last=New(_straight,ellipse,COLOR_PURPLE,self.x + wave3*2,self.y - 24,2,-90 + wave3 + self.offset,false,0,true,true,0,false,0.08,-90 + wave3 + self.offset,10,false)
                        _object.set_color(last,"mul+add",255,255,255,255)
                        PlaySound("kira00",0.1,self.x/256,false)
                        task._Wait(3)
                        _w_wave=_w_wave+_d_w_wave wave=_h_wave*sin(_w_wave)+_t_wave
                        _w_wave2=_w_wave2+_d_w_wave2 wave2=_h_wave2*sin(_w_wave2)+_t_wave2
                        _w_wave3=_w_wave3+_d_w_wave3 wave3=_h_wave3*sin(_w_wave3)+_t_wave3
                    end
                end
            end)
            task.MoveTo(self.x, endposy,60,MOVE_DECEL)
            do
                local _h_posy=(15-(-15))/2 local _t_posy=(15+(-15))/2 local posy=_h_posy*sin(0)+_t_posy local _w_posy=0 local _d_w_posy=1
                for _=1,_infinite do
                    self.y = LerpDecel(self.y, posy + endposy, 0.2) 
                    task._Wait(1)
                    _w_posy=_w_posy+_d_w_posy posy=_h_posy*sin(_w_posy)+_t_posy
                end
            end
        end)
    end
    _editor_class["KarenSpell2UFO"].colli=function(self,other)
        if other.plantShot then return end
        self.class.base.colli(self,other)
    end
    _editor_class["KarenSpell2UFO2"]=Class(_object)
    _editor_class["KarenSpell2UFO2"].init=function(self,_x,_y,addon, dir)
        self.x,self.y=_x,_y
        self.img="ani:UFO"
        self.layer=LAYER_ENEMY
        self.group=GROUP_NONTJT
        self.hide=false
        self.bound=false
        self.navi=false
        self.hp=999999
        self.maxhp=999999
        self.colli=false
        self._servants={}
        self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
        self.hscale, self.vscale = 0,0
        PlaySound("se:se_ufo",0.7,self.x/256,false)
        self.addspeed = 1
        lasttask=task.New(self,function()
            do
                local _beg_scale=0 local scale=_beg_scale  local _w_scale=-90 local _end_scale=1 local _d_w_scale=180/(30-1)
                local _beg_addspeed=2 local addspeed=_beg_addspeed  local _w_addspeed=-90 local _end_addspeed=1 local _d_w_addspeed=180/(30-1)
                for _=1,30 do
                    self.hscale, self.vscale = scale, scale
                    self.addspeed = addspeed
                    self.timer = self.timer + addspeed
                    task._Wait(1)
                    _w_scale=_w_scale+_d_w_scale scale=(_end_scale-_beg_scale)/2*sin(_w_scale)+((_end_scale+_beg_scale)/2)
                    _w_addspeed=_w_addspeed+_d_w_addspeed addspeed=(_end_addspeed-_beg_addspeed)/2*sin(_w_addspeed)+((_end_addspeed+_beg_addspeed)/2)
                end
            end
        end)
        lasttask=task.New(self,function()
            for _=1,_infinite do
                if dir % 2 == 0 then
                	self.x = 0 + self.timer * cos(self.timer + addon)
                	self.y = 120 + self.timer * sin(self.timer + addon)
                else
                	self.x = 0 + self.timer * cos(-self.timer - addon)
                	self.y = 120 + self.timer * sin(-self.timer - addon)
                end
                
                if lstg.var.karenKill == true then
                    _del(self,true)
                end
                task._Wait(1)
            end
        end)
        lasttask=task.New(self,function()
            for _=1,_infinite do
                last_list=_create_bullet_group(square,COLOR_PURPLE,self.x,self.y,3,0,2,2,-90,30,false,0,true,true,0,false,self)
                PlaySound("kira01",0.1,self.x/256,false)
                task._Wait(30)
            end
        end)
    end
    _editor_class["KarenSpell2UFO2"].colli=function(self,other)
        if other.plantShot then return end
        self.class.base.colli(self,other)
    end
    _editor_class["KarenSpell2UFO3"]=Class(_object)
    _editor_class["KarenSpell2UFO3"].init=function(self,_x,_y,posadd)
        self.x,self.y=_x,_y
        self.img="ani:UFO"
        self.layer=LAYER_ENEMY
        self.group=GROUP_NONTJT
        self.hide=false
        self.bound=false
        self.navi=false
        self.hp=999999
        self.maxhp=999999
        self.colli=false
        self._servants={}
        self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
        PlaySound("se:se_ufo",0.7,self.x/256,false)
        lasttask=task.New(self,function()
            do
                local _beg_scale=0 local scale=_beg_scale  local _w_scale=-90 local _end_scale=1 local _d_w_scale=180/(30-1)
                for _=1,30 do
                    self.hscale, self.vscale = scale, scale
                    task._Wait(1)
                    _w_scale=_w_scale+_d_w_scale scale=(_end_scale-_beg_scale)/2*sin(_w_scale)+((_end_scale+_beg_scale)/2)
                end
            end
            for _=1,_infinite do
                PlaySound("kira02",0.1,self.x/256,false)
                last_list=_create_bullet_group(square,COLOR_DEEP_PURPLE,self.x,self.y,5,0,3,4,-90,0,false,0,true,true,0,false,self)
                task._Wait(20)
            end
        end)
        lasttask=task.New(self,function()
            do
                local _h_posx=(200-(-200))/2 local _t_posx=(200+(-200))/2 local posx=_h_posx*sin(posadd)+_t_posx local _w_posx=posadd local _d_w_posx=1
                local _h_posy=(10-(-10))/2 local _t_posy=(10+(-10))/2 local posy=_h_posy*sin(0)+_t_posy local _w_posy=0 local _d_w_posy=3
                for _=1,_infinite do
                    self.x = LerpDecel(self.x, posx, 0.1)
                    self.y = LerpDecel(self.y, 180 + posy, 0.1)
                    if lstg.var.karenKill == true then
                        _del(self,true)
                    end
                    task._Wait(1)
                    _w_posx=_w_posx+_d_w_posx posx=_h_posx*sin(_w_posx)+_t_posx
                    _w_posy=_w_posy+_d_w_posy posy=_h_posy*sin(_w_posy)+_t_posy
                end
            end
        end)
    end
    _editor_class["KarenSpell2UFO3"].colli=function(self,other)
        if other.plantShot then return end
        self.class.base.colli(self,other)
    end

function _tmp_sc:before()
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        last=New(_editor_class["Spell_Cutin"],self.x,self.y,"Karen")
        task.MoveTo(0,120,60,MOVE_DECEL)
        lstg.var.karenKill = false
        New(boss_cast_ef,self.x,self.y,360,255,75,195,60,2,false)
        boss.cast(self,60)
        task._Wait(60)
        last=New(_editor_class["KarenSpell2UFO"],-160, -240,100-15)
        last=New(_editor_class["KarenSpell2UFO"],-80, -240,180-15)
        last=New(_editor_class["KarenSpell2UFO"],160, -240,100-15)
        last=New(_editor_class["KarenSpell2UFO"],80, -240,180-15)
        task._Wait(60*3)
        lasttask=task.New(self,function()
            do local i,_d_i=(0),(1) for _=1,_infinite do
                New(boss_cast_ef,self.x,self.y,360,255,75,195,60,2,false)
                task._Wait(60)
                do local a,_d_a=(0),(360/3) for _=1,3 do
                    last=New(_editor_class["KarenSpell2UFO2"],self.x,self.y,a, i)
                a=a+_d_a end end
                task._Wait(60*3)
            i=i+_d_i end end
        end)
        task._Wait(60*3)
        New(boss_cast_ef,self.x,self.y,360,255,75,195,60,2,false)
        boss.cast(self,60)
        task._Wait(60)
        last=New(_editor_class["KarenSpell2UFO3"],self.x,self.y,-200)
        last=New(_editor_class["KarenSpell2UFO3"],self.x,self.y,0)
        last=New(_editor_class["KarenSpell2UFO3"],self.x,self.y,200)
    end)
end
function _tmp_sc:del()
    for _,unit in ObjList(GROUP_NONTJT) do
        if unit ~= _boss then
            _kill(self,true)
        end
    end
    lstg.var.karenKill = true
    scoredata.clearCount[2][2] = scoredata.clearCount[2][2] + 1
end
_tmp_sc.perform=false
table.insert(_editor_class["Karen"].cards,_tmp_sc)
table.insert(_sc_table,{"Karen","Tottema\'s Lotus Flower \"Nirvana Utopia\"",_tmp_sc,#_editor_class["Karen"].cards,false})
_editor_class["Reimu"]=Class(boss)
_editor_class["Reimu"].cards={}
_editor_class["Reimu"].name="Reimu Hakurei"
_editor_class["Reimu"].bgm=""
_editor_class["Reimu"]._bg=nil
_editor_class["Reimu"].difficulty="All"
_editor_class["Reimu"].init=function(self,cards)
    boss.init(self,240,384,_editor_class["Reimu"].name,cards,New(_editor_class["ReimuBG"]),_editor_class["Reimu"].difficulty)
    self._wisys = BossWalkImageSystem(self)
    self._wisys:SetImage("Reimu_Boss.png",3,4,{4,4,4},{1,2},6,16,16)
    self.hscale, self.vscale = 1/2.25, 1/2.25
end
_tmp_sc=boss.dialog.New(true)
function _tmp_sc:init()
    lstg.player.dialog=true
    _dialog_can_skip=true
    self.dialog_displayer=New(dialog_displayer)
    lasttask=task.New(self,function()
        boss.dialog.sentence(self,"image:Marisa_3","left",[===[I wish I could just take off these shrubs from the ground and
use them as I go, but it's a shame they just... wick away.]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Marisa_6","left",[===[I'm very curious to know how Yuuka makes it so that they
survive off the floor for a while. I gotta talk to her later.]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Marisa_1","left",[===[For now, I gotta get to Rei-]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        task.MoveTo(0,120,60,MOVE_DECEL)
        last=New(_editor_class["CharacterTitle"],540, 100,"Reimu")
        boss.dialog.sentence(self,"image:Reimu_2","right",[===[There you are. Marisa,
I've got an issue back at the shrine.]===],600,0.15, 0.15,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Marisa_4","left",[===[Oh, what's up?]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Reimu_4","right",[===[There's this weird tree that's been on
the back of the shrine for a while now.]===],600,0.15, 0.15,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Reimu_3","right",[===[And it kind of is glowing and all...
and a bunch of fairies are coming around.]===],600,0.15, 0.15,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Reimu_1","right",[===[Not to mention this weird youkai that I just can't tackle. I was wondering
if you ended up figuring out what these weird shrubs around are?]===],600,0.15, 0.15,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Marisa_1","left",[===[Ah, right. Ain't gonna be a problem
for me, leave it to me.]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Reimu_3","right",[===[Huh, that's all?]===],600,0.15, 0.15,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
        _stop_music()
        boss.dialog.sentence(self,"image:Marisa_2","left",[===[Actually, why don't I show you?
You can taste it yourself! It's been so fun!]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        LoadMusicRecord("bgm:Act2BossTheme")
        _play_music("bgm:Act2BossTheme")
        last=New(_editor_class["SongDisplayer"],self.x,self.y,true)
        boss.dialog.sentence(self,"image:Reimu_4","right",[===[...What are you planning...?]===],600,0.15, 0.15,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
    end)
end
table.insert(_editor_class["Reimu"].cards,_tmp_sc)
_tmp_sc=boss.card.New("",2,5,60,1000,{0,45,5},false)
function _tmp_sc:before()
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task.MoveTo(0,120,60,MOVE_DECEL)
        for _=1,_infinite do
            New(boss_cast_ef,self.x,self.y,360,255,0,0,60,2,false)
            task._Wait(60)
            lasttask=task.New(self,function()
                for _=1,150/16 do
                    PlaySound("tan00",0.1,self.x/256,false)
                    last_list=_create_bullet_group(ball_mid_c,COLOR_RED,self.x,self.y,10,0,4,4,0,360,true,0,true,true,0,false,self)
                    last_list=_create_bullet_group(ball_mid,COLOR_RED,self.x,self.y,20,0,3,3,0,360,true,0,true,true,0,false,self)
                    do
                        local _beg_spd=0.8 local spd=_beg_spd local _end_spd=0.1 local _d_spd=(_end_spd-_beg_spd)/(5-1)
                        for _=1,5 do
                            last_list=_create_bullet_group(square,COLOR_RED,self.x,self.y,5,0,spd,spd,0,360,true,0,true,true,0,false,self)
                            for _,unit in ipairs(last_list) do
                                lasttask=task.New(unit,function()
                                    local self=task.GetSelf()
                                    lasttask=task.New(self,function()
                                        local w = lstg.world
                                        self.tshuttle, self.tshuttlemax = 0, 1
                                        for _=1, _infinite do
                                            if self.y >= w.t + 16 or self.y <= w.b - 16 then
                                                self.y = self.y * -1
                                                self.tshuttle = self.tshuttle + 1
                                            end
                                            if self.x >= w.r + 16 or self.x <= w.l - 16 then
                                                self.x = self.x * -1
                                                self.tshuttle = self.tshuttle + 1
                                            end
                                            if self.tshuttle >= self.tshuttlemax then break end
                                            task._Wait(1)
                                        end
                                    end)
                                end)
                            end
                            spd=spd+_d_spd
                        end
                    end
                    task._Wait(1*16)
                end
            end)
            task.MoveTo(260, 120 + ran:Int(-15, 15),20,MOVE_ACCEL)
            for _=1,3 do
                self.x,self.y=-260,self.y
                task.MoveTo(260, self.y,20,MOVE_NORMAL)
            end
            self.x,self.y=-260,self.y
            task.MoveTo(ran:Int(-70, 70),self.y,30,MOVE_DECEL)
            task._Wait(60*4)
        end
    end)
end
function _tmp_sc:del()
end
_tmp_sc.perform=false
table.insert(_editor_class["Reimu"].cards,_tmp_sc)

_tmp_sc=boss.card.New("Fantasy Grid \"Tai Chi Shooting\"",2,5,60,1800,{0,45,5},false)

    _editor_class["ReimuYang"]=Class(_object)
    _editor_class["ReimuYang"].init=function(self,_x,_y,_)
        self.x,self.y=_x,_y
        self.img="image:ReimuBall"
        self.layer=LAYER_ENEMY-5
        self.group=GROUP_NONTJT
        self.hide=false
        self.bound=true
        self.navi=false
        self.hp=999999
        self.maxhp=999999
        self.colli=true
        self._servants={}
        self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
        SetV2(self,3,ran:Int(-45, 45) + 90,true,false)
        _set_g(self,0.05)
        self.hscale, self.vscale = 1*0.15, 1*0.15
        self.a, self.b, self.rect = 32, 32,false
        self.omiga = 2 * ran:Sign()
        _object.set_color(self,"mul+add",255,255,255,255)
    end
    _editor_class["ReimuYang"].colli=function(self,other)
        if other.plantShot then return end
        self.class.base.colli(self,other)
    end

function _tmp_sc:before()
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        last=New(_editor_class["Spell_Cutin"],self.x,self.y,"Reimu")
        task.MoveTo(0,120,60,MOVE_DECEL)
        New(boss_cast_ef,self.x,self.y,360,255,0,0,60,2,false)
        boss.cast(self,60)
        task._Wait(60)
        lasttask=task.New(self,function()
            for _=1,_infinite do
                last=New(_editor_class["ReimuYang"],self.x,self.y,_)
                _connect(self,last,0.8,true)
                PlaySound("tan00",0.1,self.x/256,false)
                task._Wait(60)
            end
        end)
        for _=1,_infinite do
            do
                local _beg_posx=-180 local posx=_beg_posx local _end_posx=180 local _d_posx=(_end_posx-_beg_posx)/(4-1)
                for _=1,4 do
                    task.MoveTo(posx, 120,30,MOVE_DECEL)
                    last=New(_straight,ball_light,COLOR_RED,self.x,self.y,2,90,false,0,true,true,0,false,0,0,0,false)
                    last=New(_straight,ball_light,COLOR_RED,self.x,self.y,2,-90,false,0,true,true,0,false,0,0,0,false)
                    PlaySound("kira00",0.1,self.x/256,false)
                    do
                        local _beg_posy=-220 local posy=_beg_posy  local _w_posy=-90 local _end_posy=220 local _d_w_posy=180/(20-1)
                        local _beg_xoff=0 local xoff=_beg_xoff local _end_xoff=10 * ran:Sign() local _d_xoff=(_end_xoff-_beg_xoff)/(20-1)
                        for _=1,20 do
                            last=New(_straight,square,COLOR_RED,self.x + 30 + xoff,posy,1,90,false,0,true,true,0,false,0,0,0,false)
                            if Dist(last, player) < 48 then
                                _del(last,true)
                            end
                            last=New(_straight,square,COLOR_RED,self.x + 30 + xoff,posy,1,-90,false,0,true,true,0,false,0,0,0,false)
                            if Dist(last, player) < 48 then
                                _del(last,true)
                            end
                            last=New(_straight,square,COLOR_RED,self.x - 30 + xoff,posy,1,90,false,0,true,true,0,false,0,0,0,false)
                            if Dist(last, player) < 48 then
                                _del(last,true)
                            end
                            last=New(_straight,square,COLOR_RED,self.x - 30 + xoff,posy,1,-90,false,0,true,true,0,false,0,0,0,false)
                            if Dist(last, player) < 48 then
                                _del(last,true)
                            end
                            _w_posy=_w_posy+_d_w_posy posy=(_end_posy-_beg_posy)/2*sin(_w_posy)+((_end_posy+_beg_posy)/2)
                            xoff=xoff+_d_xoff
                        end
                    end
                    task._Wait(25)
                    posx=posx+_d_posx
                end
            end
            do
                local angP=(Angle(self, player))
                PlaySound("kira01",0.1,self.x/256,false)
                last_list=_create_bullet_group(ball_mid_c,COLOR_GRAY,self.x,self.y,25,0,3,3,0,360,true,0,true,true,0,false,self)
                last_list=_create_bullet_group(ball_mid_c,COLOR_GRAY,self.x,self.y,24,0,2,2,0,360,true,0,true,true,0,false,self)
                last_list=_create_bullet_group(ball_big,COLOR_RED,self.x,self.y,8,0,1,4,-5,15,true,0,true,true,0,false,self)
                last_list=_create_bullet_group(ball_big,COLOR_RED,self.x,self.y,8,0,4,1,5,15,true,0,true,true,0,false,self)
                lasttask=task.New(self,function()
                    do
                        local _beg_ang=90+45 local ang=_beg_ang local _end_ang=0 local _w_ang=0  local _d_w_ang=1/(15-1)
                        for _=1,15 do
                            last_list=_create_bullet_group(square,COLOR_RED,self.x,self.y,3,0,3,4,angP + ang,0,false,0,true,true,0,false,self)
                            last_list=_create_bullet_group(square,COLOR_RED,self.x,self.y,3,0,3,4,angP - ang,0,false,0,true,true,0,false,self)
                            PlaySound("kira00",0.1,self.x/256,false)
                            task._Wait(3)
                            _w_ang=_w_ang+_d_w_ang ang=(_end_ang-_beg_ang)*_w_ang^2+_beg_ang
                        end
                    end
                end)
            end
            do
                local _beg_posx=180 local posx=_beg_posx local _end_posx=-180 local _d_posx=(_end_posx-_beg_posx)/(4-1)
                for _=1,4 do
                    task.MoveTo(posx, 120,30,MOVE_DECEL)
                    last=New(_straight,ball_light,COLOR_RED,self.x,self.y,2,90,false,0,true,true,0,false,0,0,0,false)
                    last=New(_straight,ball_light,COLOR_RED,self.x,self.y,2,-90,false,0,true,true,0,false,0,0,0,false)
                    PlaySound("kira00",0.1,self.x/256,false)
                    do
                        local _beg_posy=-220 local posy=_beg_posy  local _w_posy=-90 local _end_posy=220 local _d_w_posy=180/(20-1)
                        local _beg_xoff=0 local xoff=_beg_xoff local _end_xoff=10 * ran:Sign() local _d_xoff=(_end_xoff-_beg_xoff)/(20-1)
                        for _=1,20 do
                            last=New(_straight,square,COLOR_RED,self.x + 30 + xoff,posy,1,90,false,0,true,true,0,false,0,0,0,false)
                            if Dist(last, player) < 48 then
                                _del(last,true)
                            end
                            last=New(_straight,square,COLOR_RED,self.x + 30 + xoff,posy,1,-90,false,0,true,true,0,false,0,0,0,false)
                            if Dist(last, player) < 48 then
                                _del(last,true)
                            end
                            last=New(_straight,square,COLOR_RED,self.x - 30 + xoff,posy,1,90,false,0,true,true,0,false,0,0,0,false)
                            if Dist(last, player) < 48 then
                                _del(last,true)
                            end
                            last=New(_straight,square,COLOR_RED,self.x - 30 + xoff,posy,1,-90,false,0,true,true,0,false,0,0,0,false)
                            if Dist(last, player) < 48 then
                                _del(last,true)
                            end
                            _w_posy=_w_posy+_d_w_posy posy=(_end_posy-_beg_posy)/2*sin(_w_posy)+((_end_posy+_beg_posy)/2)
                            xoff=xoff+_d_xoff
                        end
                    end
                    task._Wait(25)
                    posx=posx+_d_posx
                end
            end
            do
                local angP=(Angle(self, player))
                PlaySound("kira01",0.1,self.x/256,false)
                last_list=_create_bullet_group(ball_mid_c,COLOR_GRAY,self.x,self.y,25,0,3,3,0,360,true,0,true,true,0,false,self)
                last_list=_create_bullet_group(ball_mid_c,COLOR_GRAY,self.x,self.y,24,0,2,2,0,360,true,0,true,true,0,false,self)
                last_list=_create_bullet_group(ball_big,COLOR_RED,self.x,self.y,8,0,1,4,-5,15,true,0,true,true,0,false,self)
                last_list=_create_bullet_group(ball_big,COLOR_RED,self.x,self.y,8,0,4,1,5,15,true,0,true,true,0,false,self)
                lasttask=task.New(self,function()
                    do
                        local _beg_ang=90+45 local ang=_beg_ang local _end_ang=0 local _w_ang=0  local _d_w_ang=1/(15-1)
                        for _=1,15 do
                            last_list=_create_bullet_group(square,COLOR_RED,self.x,self.y,3,0,3,4,angP + ang,0,false,0,true,true,0,false,self)
                            last_list=_create_bullet_group(square,COLOR_RED,self.x,self.y,3,0,3,4,angP - ang,0,false,0,true,true,0,false,self)
                            PlaySound("kira00",0.1,self.x/256,false)
                            task._Wait(3)
                            _w_ang=_w_ang+_d_w_ang ang=(_end_ang-_beg_ang)*_w_ang^2+_beg_ang
                        end
                    end
                end)
            end
            task._Wait(60)
        end
    end)
end
function _tmp_sc:del()
    for _,unit in ObjList(GROUP_NONTJT) do
        if unit ~= _boss then
            _kill(self,true)
        end
    end
end
_tmp_sc.perform=false
table.insert(_editor_class["Reimu"].cards,_tmp_sc)
table.insert(_sc_table,{"Reimu","Fantasy Grid \"Tai Chi Shooting\"",_tmp_sc,#_editor_class["Reimu"].cards,false})
_tmp_sc=boss.card.New("Red Boundary \"Expand Boundary\"",2,11,60,1800,{0,45,5},false)
function _tmp_sc:before()
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        last=New(_editor_class["Spell_Cutin"],self.x,self.y,"Reimu")
        task.MoveTo(0, 0,60,MOVE_DECEL)
        New(boss_cast_ef,self.x,self.y,360,255,0,0,60,2,false)
        boss.cast(self,60)
        task._Wait(60)
        PlaySound("tan00",0.1,self.x/256,false)
        lasttask=task.New(self,function()
            do
                local _beg_ang=45 local ang=_beg_ang local _end_ang=90*3 + 45 local _d_ang=(_end_ang-_beg_ang)/(4-1)
                for _=1,4 do
                    last=New(_straight,ball_huge,COLOR_RED,self.x,self.y,2,ang,false,0,true,false,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        lasttask=task.New(self,function()
                            local w = lstg.world
                            self.tshuttle, self.tshuttlemax = 0, _infinite
                            for _=1, _infinite do
                                if self.y >= w.t + 16 or self.y <= w.b - 16 then
                                    self.y = self.y * -1
                                    self.tshuttle = self.tshuttle + 1
                                end
                                if self.x >= w.r + 16 or self.x <= w.l - 16 then
                                    self.x = self.x * -1
                                    self.tshuttle = self.tshuttle + 1
                                end
                                if self.tshuttle >= self.tshuttlemax then break end
                                task._Wait(1)
                            end
                        end)
                        task._Wait(30)
                        PlaySound("kira00",0.1,self.x/256,false)
                        last_list=_create_bullet_group(square,COLOR_RED,self.x,self.y,10,0,0.5,1.5,self.rot-180,0,false,0,true,false,0,false,self)
                        task._Wait(60)
                        PlaySound("kira00",0.1,self.x/256,false)
                        last_list=_create_bullet_group(square,COLOR_RED,self.x,self.y,10,0,0.5,1.5,self.rot-90,0,false,0,true,false,0,false,self)
                        last_list=_create_bullet_group(square,COLOR_RED,self.x,self.y,10,0,0.5,1.5,self.rot+90,0,false,0,true,false,0,false,self)
                        task._Wait(60*1.5)
                        PlaySound("kira00",0.1,self.x/256,false)
                        last_list=_create_bullet_group(square,COLOR_RED,self.x,self.y,10,0,0.5,1.5,self.rot,0,false,0,true,false,0,false,self)
                        last_list=_create_bullet_group(square,COLOR_RED,self.x,self.y,10,0,0.5,1.5,self.rot-45,0,false,0,true,false,0,false,self)
                        last_list=_create_bullet_group(square,COLOR_RED,self.x,self.y,10,0,0.5,1.5,self.rot+45,0,false,0,true,false,0,false,self)
                        task._Wait(60*1.5)
                        PlaySound("kira00",0.1,self.x/256,false)
                        last_list=_create_bullet_group(square,COLOR_RED,self.x,self.y,10,0,0.5,1.5,self.rot-10,0,false,0,true,false,0,false,self)
                        last_list=_create_bullet_group(square,COLOR_RED,self.x,self.y,10,0,0.5,1.5,self.rot+10,0,false,0,true,false,0,false,self)
                        last_list=_create_bullet_group(square,COLOR_RED,self.x,self.y,10,0,0.5,1.5,self.rot-20,0,false,0,true,false,0,false,self)
                        last_list=_create_bullet_group(square,COLOR_RED,self.x,self.y,10,0,0.5,1.5,self.rot+20,0,false,0,true,false,0,false,self)
                        task._Wait(60*2)
                        PlaySound("kira00",0.1,self.x/256,false)
                        last_list=_create_bullet_group(square,COLOR_RED,self.x,self.y,10,0,0.5,1.5,self.rot-10,0,false,0,true,false,0,false,self)
                        last_list=_create_bullet_group(square,COLOR_RED,self.x,self.y,10,0,0.5,1.5,self.rot+10,0,false,0,true,false,0,false,self)
                        last_list=_create_bullet_group(square,COLOR_RED,self.x,self.y,10,0,0.5,1.5,self.rot-50,0,false,0,true,false,0,false,self)
                        last_list=_create_bullet_group(square,COLOR_RED,self.x,self.y,10,0,0.5,1.5,self.rot+50,0,false,0,true,false,0,false,self)
                        last_list=_create_bullet_group(square,COLOR_RED,self.x,self.y,10,0,0.5,1.5,self.rot,0,false,0,true,false,0,false,self)
                        lasttask=task.New(self,function()
                            for _=1,_infinite do
                                PlaySound("kira01",0.1,self.x/256,false)
                                last_list=_create_bullet_group(square,COLOR_RED,self.x,self.y,8,0,1,1,self.rot,360,false,0,true,false,0,false,self)
                                task._Wait(35)
                            end
                        end)
                        task._Wait(60*2)
                        PlaySound("kira00",0.1,self.x/256,false)
                        last_list=_create_bullet_group(square,COLOR_RED,self.x,self.y,10,0,0.5,1.5,self.rot-15,0,false,0,true,false,0,false,self)
                        last_list=_create_bullet_group(square,COLOR_RED,self.x,self.y,10,0,0.5,1.5,self.rot+15,0,false,0,true,false,0,false,self)
                        last_list=_create_bullet_group(square,COLOR_RED,self.x,self.y,10,0,0.5,1.5,self.rot-80,0,false,0,true,false,0,false,self)
                        last_list=_create_bullet_group(square,COLOR_RED,self.x,self.y,10,0,0.5,1.5,self.rot+80,0,false,0,true,false,0,false,self)
                    end)
                    ang=ang+_d_ang
                end
            end
        end)
        task._Wait(60*5)
        do local ang,_d_ang=(0),(5) for _=1,_infinite do
            last_list=_create_bullet_group(square,COLOR_GRAY,self.x,self.y,3,0,3,3,ang - 90,360,false,0,true,true,0,false,self)
            last_list=_create_bullet_group(square,COLOR_GRAY,self.x,self.y,3,0,3,3,-ang - 90,360,false,0,true,true,0,false,self)
            PlaySound("kira02",0.1,self.x/256,false)
            task._Wait(10)
        ang=ang+_d_ang end end
    end)
end
function _tmp_sc:del()
    scoredata.clearCount[2][1] = scoredata.clearCount[2][1] + 1
end
_tmp_sc.perform=false
table.insert(_editor_class["Reimu"].cards,_tmp_sc)
table.insert(_sc_table,{"Reimu","Red Boundary \"Expand Boundary\"",_tmp_sc,#_editor_class["Reimu"].cards,false})
_editor_class["Kichi"]=Class(boss)
_editor_class["Kichi"].cards={}
_editor_class["Kichi"].name="Kichi Suzuki"
_editor_class["Kichi"].bgm=""
_editor_class["Kichi"]._bg=nil
_editor_class["Kichi"].difficulty="All"
_editor_class["Kichi"].init=function(self,cards)
    boss.init(self,240,384,_editor_class["Kichi"].name,cards,New(_editor_class["KichiBG"]),_editor_class["Kichi"].difficulty)
    self._wisys = BossWalkImageSystem(self)
    self._wisys:SetImage("Kichi_Boss.png",3,4,{4,4,4},{1,2},6,16,16)
    self.hscale, self.vscale = 1/2.25, 1/2.25
end
_tmp_sc=boss.dialog.New(true)
function _tmp_sc:init()
    lstg.player.dialog=true
    _dialog_can_skip=true
    self.dialog_displayer=New(dialog_displayer)
    lasttask=task.New(self,function()
        boss.show_aura(self,false)
        boss.dialog.sentence(self,"image:Marisa_1","left",[===[I've never seen the shrine this colorful before.
Mostly green, but still colorful overall.]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Marisa_3","left",[===[Honestly, if it weren't for everything else kind of getting stale,
I wouldn't really mind having a few of these shrubs around.]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Marisa_3","left",[===[Though I do wonder what kind of
culprit this incident could have.]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        boss.dialog.sentence(self,"img_void","right",[===[Ahh, you've got a bunch of them!]===],600,0.15, 0.15,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
        New(boss_cast_darkball,0, 120,60,80,360,3,300,64,255,156,1.5)
        New(boss_cast_ef,0, 120,360,56,255,177,60,2,false)
        task._Wait(60)
        task.MoveTo(0,120,1,MOVE_ACCEL)
        boss.show_aura(self,true)
        boss.dialog.sentence(self,"image:Marisa_4","left",[===[Ehh, whuzzat?]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        last=New(_editor_class["CharacterTitle"],540, 100,"Kichi")
        boss.dialog.sentence(self,"image:Kichi_4","right",[===[Please, I've gotta eat them!]===],600,0.15, 0.15,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Marisa_4","left",[===[That doesn't sound too healthy, why's that?]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Kichi_4","right",[===[I just feel like I'll wither at any
moment when I don't get enough of these!]===],600,0.15, 0.15,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Marisa_4","left",[===[But eating? Like, of everything you
could do with them?]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Kichi_4","right",[===[Well, I guess that just bringing
them back to my tree works too.]===],600,0.15, 0.15,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Marisa_2","left",[===[Your tree? Are you like a
squirrel or something?]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Kichi_1","right",[===[Noo! It's just that ever since a while ago, the tree where I
grew up started to break and expel a bunch of seeds to the wind!]===],600,0.15, 0.15,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Kichi_2","right",[===[So now that the shrubs are starting to grow, they're taking all of
the nutrients on the ground, so I've gotta gather them back to my tree!]===],600,0.15, 0.15,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Kichi_3","right",[===[That's the only way to keep it alive!
And me by extension!]===],600,0.15, 0.15,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Marisa_6","left",[===[Hold on there, I don't think that's how it works.
You're connected to your tree?]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Kichi_4","right",[===[Yeah, sort of... Whenever I don't eat them, my
belly starts to growl... And my tree shakes too...]===],600,0.15, 0.15,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Marisa_6","left",[===[And when you bring back these shrubs to
your tree, that doesn't happen to you?]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Kichi_2","right",[===[Yes! While I'm doing that, I eat them too.]===],600,0.15, 0.15,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Marisa_6","left",[===[That's kind of just called hunger, y'know...
You kind of need to eat. I'm confused.]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Marisa_2","left",[===[But if you want these shrubs so much,
you gotta deserve them! I paid for these!]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Kichi_2","right",[===[Ah, what do I have to do?]===],600,0.15, 0.15,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
        _stop_music()
        boss.dialog.sentence(self,"image:Marisa_2","left",[===[Oh, just. Go all out, I guess. Get creative!
Danmaku rules 'round these parts!]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
        boss.dialog.sentence(self,"image:Kichi_2","right",[===[That sounds... fun. Never tried that before!]===],600,0.15, 0.15,1,1,(550 - -1 * 150),116,(550 - -1 * 100),230,1,false)
        last=New(_editor_class["SongDisplayer"],self.x,self.y,true)
        LoadMusicRecord("bgm:Act3BossTheme")
        _play_music("bgm:Act3BossTheme")
        boss.dialog.sentence(self,"image:Marisa_2","left",[===[Now's a great time to figure that out. Have at ya!]===],600,0.15, 0.15,1,1,(325 - 1 * 150),128,(325 - 1 * 100),230,1,false)
    end)
end
table.insert(_editor_class["Kichi"].cards,_tmp_sc)
_tmp_sc=boss.card.New("",2,5,60,1200,{0,65,5},false)
function _tmp_sc:before()
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task.MoveTo(0,120,60,MOVE_DECEL)
        do
            local posx=-120 local _n_posx=(-120)+(120)
            for _=1,_infinite do
                New(boss_cast_ef,self.x,self.y,360,125,255,191,60,2,false)
                task._Wait(60)
                task.MoveTo(posx,120,30,MOVE_DECEL)
                boss.cast(self,60)
                for _=1,6 do
                    PlaySound("kira00",0.1,self.x/256,false)
                    if posx < 0 then
                        last=New(_straight,ball_huge,COLOR_CYAN,self.x,self.y,4,45 + ran:Int(-10, 50),false,0,true,true,0,false,0.08,-90,0,false)
                    else
                        last=New(_straight,ball_huge,COLOR_CYAN,self.x,self.y,4,180 - 45 - ran:Int(-10, 50),false,0,true,true,0,false,0.08,-90,0,false)
                    end
                    last.navi = true
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        task._Wait(60)
                        PlaySound("old_enep00",0.6,self.x/256,false)
                        do local ang,_d_ang=(Angle(self, player)),(360/55) for _=1,55 do
                            last=New(_straight,heart,COLOR_CYAN,self.x + 25 * cos(ang),self.y + 25 * sin(ang),4,ang,false,0,true,true,0,false,0.05,-90,0,false)
                            last.navi = true
                            lasttask=task.New(last,function()
                                local self=task.GetSelf()
                                task._Wait(30)
                                PlaySound("old_enep00",0.6,self.x/256,false)
                                last_list=_create_bullet_group(ball_small,COLOR_CYAN,self.x,self.y,3,0,1,1,0,360,true,0,true,true,0,false,self)
                                for _,unit in ipairs(last_list) do
                                    unit.navi = true
                                end
                                _del(self,true)
                            end)
                        ang=ang+_d_ang end end
                        _del(self,true)
                    end)
                    task._Wait(30)
                end
                task._Wait(60)
                posx=-(posx)+_n_posx
            end
        end
    end)
end
function _tmp_sc:del()
end
_tmp_sc.perform=false
table.insert(_editor_class["Kichi"].cards,_tmp_sc)

_tmp_sc=boss.card.New("Nature Strike \"Embellish Root\"",2,5,60,1800,{0,65,5},false)
function _tmp_sc:before()
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        last=New(_editor_class["Spell_Cutin"],self.x,self.y,"Kichi")
        task.MoveTo(0,120,60,MOVE_DECEL)
        for _=1,_infinite do
            New(boss_cast_ef,self.x,self.y,360,125,255,191,60,2,false)
            task._Wait(60)
            for _=1,_infinite do
                New(boss_cast_ef,self.x,self.y,360,125,255,191,60,2,false)
                task._Wait(60)
                PlaySound("tan00",0.1,self.x/256,false)
                last=New(_straight,ball_huge,COLOR_ROYAL_BLUE,self.x,self.y,3,ran:Int(0, 180),false,0,true,true,0,false,0.08,-90,0,false)
                last.navi = true
                lasttask=task.New(last,function()
                    local self=task.GetSelf()
                    task._Wait(30)
                    PlaySound("kira00",0.1,self.x/256,false)
                    PlaySound("old_enep00",0.7,self.x/256,false)
                    do local ang,_d_ang=(Angle(self, player)),(360/15) for _=1,15 do
                        last=New(_straight,heart,COLOR_ROYAL_BLUE,self.x,self.y,0,ang,false,0,true,true,0,false,0,0,0,false)
                        last.navi = true
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            do
                                local _beg_offset=0 local offset=_beg_offset  local _w_offset=-90 local _end_offset=4 local _d_w_offset=180/(30-1)
                                for _=1,30 do
                                    SetV2(self,offset,self.rot,true,false)
                                    task._Wait(1)
                                    _w_offset=_w_offset+_d_w_offset offset=(_end_offset-_beg_offset)/2*sin(_w_offset)+((_end_offset+_beg_offset)/2)
                                end
                            end
                            do
                                local _beg_offset=4 local offset=_beg_offset  local _w_offset=-90 local _end_offset=-4 local _d_w_offset=180/(75-1)
                                local _beg_ang=self.rot local ang=_beg_ang  local _w_ang=-90 local _end_ang=self.rot - 45 local _d_w_ang=180/(75-1)
                                for _=1,75 do
                                    SetV2(self,offset,ang,true,false)
                                    if self.timer % 6 == 0 then
                                        PlaySound("kira01",0.1,self.x/256,false)
                                        last=New(_straight,grain_b,COLOR_ROYAL_BLUE,self.x,self.y,1,self.rot - 45,false,0,true,true,0,false,0,0,0,false)
                                        _object.set_color(last,"mul+add",255,255,255,255)
                                    end
                                    task._Wait(1)
                                    _w_offset=_w_offset+_d_w_offset offset=(_end_offset-_beg_offset)/2*sin(_w_offset)+((_end_offset+_beg_offset)/2)
                                    _w_ang=_w_ang+_d_w_ang ang=(_end_ang-_beg_ang)/2*sin(_w_ang)+((_end_ang+_beg_ang)/2)
                                end
                            end
                            do
                                local _beg_offset=-4 local offset=_beg_offset  local _w_offset=-90 local _end_offset=3 local _d_w_offset=180/(75-1)
                                for _=1,75 do
                                    SetV2(self,offset,self.rot,true,false)
                                    if self.timer % 8 == 0 then
                                        PlaySound("kira02",0.1,self.x/256,false)
                                        last=New(_straight,kite,COLOR_CYAN,self.x,self.y,2,self.rot,false,0,true,true,0,false,0,0,0,false)
                                        _object.set_color(last,"mul+add",255,255,255,255)
                                    end
                                    task._Wait(1)
                                    _w_offset=_w_offset+_d_w_offset offset=(_end_offset-_beg_offset)/2*sin(_w_offset)+((_end_offset+_beg_offset)/2)
                                end
                            end
                        end)
                        last=New(_straight,heart,COLOR_ROYAL_BLUE,self.x,self.y,0,ang,false,0,true,true,0,false,0,0,0,false)
                        last.navi = true
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            do
                                local _beg_offset=0 local offset=_beg_offset  local _w_offset=-90 local _end_offset=4 local _d_w_offset=180/(30-1)
                                for _=1,30 do
                                    SetV2(self,offset,self.rot,true,false)
                                    task._Wait(1)
                                    _w_offset=_w_offset+_d_w_offset offset=(_end_offset-_beg_offset)/2*sin(_w_offset)+((_end_offset+_beg_offset)/2)
                                end
                            end
                            do
                                local _beg_offset=4 local offset=_beg_offset  local _w_offset=-90 local _end_offset=-4 local _d_w_offset=180/(75-1)
                                local _beg_ang=self.rot local ang=_beg_ang  local _w_ang=-90 local _end_ang=self.rot + 45 local _d_w_ang=180/(75-1)
                                for _=1,75 do
                                    SetV2(self,offset,ang,true,false)
                                    if self.timer % 6 == 0 then
                                        PlaySound("kira01",0.1,self.x/256,false)
                                        last=New(_straight,grain_b,COLOR_ROYAL_BLUE,self.x,self.y,1,self.rot + 45,false,0,true,true,0,false,0,0,0,false)
                                        _object.set_color(last,"mul+add",255,255,255,255)
                                    end
                                    task._Wait(1)
                                    _w_offset=_w_offset+_d_w_offset offset=(_end_offset-_beg_offset)/2*sin(_w_offset)+((_end_offset+_beg_offset)/2)
                                    _w_ang=_w_ang+_d_w_ang ang=(_end_ang-_beg_ang)/2*sin(_w_ang)+((_end_ang+_beg_ang)/2)
                                end
                            end
                            do
                                local _beg_offset=-4 local offset=_beg_offset  local _w_offset=-90 local _end_offset=3 local _d_w_offset=180/(75-1)
                                for _=1,75 do
                                    SetV2(self,offset,self.rot,true,false)
                                    if self.timer % 8 == 0 then
                                        PlaySound("kira02",0.1,self.x/256,false)
                                        last=New(_straight,kite,COLOR_CYAN,self.x,self.y,2,self.rot,false,0,true,true,0,false,0,0,0,false)
                                        _object.set_color(last,"mul+add",255,255,255,255)
                                    end
                                    task._Wait(1)
                                    _w_offset=_w_offset+_d_w_offset offset=(_end_offset-_beg_offset)/2*sin(_w_offset)+((_end_offset+_beg_offset)/2)
                                end
                            end
                        end)
                    ang=ang+_d_ang end end
                    _del(self,true)
                end)
                task._Wait(60*2.5)
            end
        end
    end)
end
function _tmp_sc:del()
end
_tmp_sc.perform=false
table.insert(_editor_class["Kichi"].cards,_tmp_sc)
table.insert(_sc_table,{"Kichi","Nature Strike \"Embellish Root\"",_tmp_sc,#_editor_class["Kichi"].cards,false})
_tmp_sc=boss.card.New("",2,5,60,1200,{0,65,5},false)
function _tmp_sc:before()
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task.MoveTo(0,120,60,MOVE_DECEL)
        do
            local posx=-120 local _n_posx=(-120)+(120)
            for _=1,_infinite do
                New(boss_cast_ef,self.x,self.y,360,125,255,191,60,2,false)
                task._Wait(60)
                task.MoveTo(posx,120,60,MOVE_DECEL)
                boss.cast(self,60)
                for _=1,10 do
                    PlaySound("kira00",0.1,self.x/256,false)
                    last=New(_straight,heart,COLOR_ROYAL_BLUE,self.x,self.y,3,ran:Int(0 - 45, -180 + 45),false,0,true,true,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        self.ang = self.rot
                        lasttask=task.New(self,function()
                            for _=1,_infinite do
                                PlaySound("kira00",0.1,self.x/256,false)
                                last=New(_straight,arrow_big,COLOR_ROYAL_BLUE,self.x,self.y,0.1,self.rot - 180,false,0,true,true,0,false,0.03,self.rot - 180,8,false)
                                _object.set_color(self,"mul+add",255,255,255,255)
                                task._Wait(5)
                            end
                        end)
                        do
                            local _h_ang=(15-(-15))/2 local _t_ang=(15+(-15))/2 local ang=_h_ang*sin(0)+_t_ang local _w_ang=0 local _d_w_ang=6
                            for _=1,_infinite do
                                SetV2(self,2,ang + self.ang,true,false)
                                if self.x > 224 or self.x < -224 or self.y > 224 or self.y < -224 then break end
                                task._Wait(1)
                                _w_ang=_w_ang+_d_w_ang ang=_h_ang*sin(_w_ang)+_t_ang
                            end
                        end
                        SetV2(self,0,self.rot,true,false)
                        last_list=_create_bullet_group(ball_mid_c,COLOR_ROYAL_BLUE,self.x,self.y,29,0,1,1,0,360,true,0,true,true,0,false,self)
                        PlaySound("kira02",0.1,self.x/256,false)
                        task._Wait(60)
                        SetV2(self,1,self.rot,true,false)
                    end)
                    task._Wait(20)
                end
                task._Wait(60*3)
                posx=-(posx)+_n_posx
            end
        end
    end)
end
function _tmp_sc:del()
end
_tmp_sc.perform=false
table.insert(_editor_class["Kichi"].cards,_tmp_sc)

_tmp_sc=boss.card.New("Vineyard Scramble \"Overgrown Connections\"",2,5,60,1800,{0,65,5},false)
function _tmp_sc:before()
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        last=New(_editor_class["Spell_Cutin"],self.x,self.y,"Kichi")
        task.MoveTo(0,120,60,MOVE_DECEL)
        lasttask=task.New(self,function()
            for _=1,_infinite do
                New(boss_cast_ef,self.x,self.y,360,125,255,191,60,2,false)
                task._Wait(60)
                PlaySound("boon01",0.6,self.x/256,false)
                task.MoveTo(0,-120,60*3,MOVE_ACC_DEC)
                task._Wait(60)
                New(boss_cast_ef,self.x,self.y,360,125,255,191,60,2,false)
                task._Wait(60)
                PlaySound("boon01",0.6,self.x/256,false)
                task.MoveTo(0,120,60*3,MOVE_ACC_DEC)
                task._Wait(60*3)
            end
        end)
        task._Wait(60)
        do local ang,_d_ang=(0),(25) for _=1,_infinite do
            PlaySound("kira00",0.1,self.x/256,false)
            last=New(_straight,heart,COLOR_DEEP_GREEN,self.x,self.y,3,ang,false,0,true,true,0,false,0,0,0,false)
            lasttask=task.New(last,function()
                local self=task.GetSelf()
                self.ang = self.rot
                lasttask=task.New(self,function()
                    for _=1,_infinite do
                        PlaySound("kira00",0.1,self.x/256,false)
                        last=New(_straight,arrow_big,COLOR_ROYAL_BLUE,self.x,self.y,0.1,self.rot - 180,false,0,true,true,0,false,0.03,self.rot - 180,4,false)
                        _object.set_color(self,"mul+add",255,255,255,255)
                        task._Wait(8)
                    end
                end)
                do
                    local _h_ang=(15-(-15))/2 local _t_ang=(15+(-15))/2 local ang=_h_ang*sin(0)+_t_ang local _w_ang=0 local _d_w_ang=6
                    for _=1,_infinite do
                        SetV2(self,2,ang + self.ang,true,false)
                        if self.x > 224 or self.x < -224 or self.y > 224 or self.y < -224 then break end
                        task._Wait(1)
                        _w_ang=_w_ang+_d_w_ang ang=_h_ang*sin(_w_ang)+_t_ang
                    end
                end
                SetV2(self,0,self.rot,true,false)
                last_list=_create_bullet_group(ball_mid_c,COLOR_ROYAL_BLUE,self.x,self.y,9,0,1,1,0,360,true,0,true,true,0,false,self)
                PlaySound("kira02",0.1,self.x/256,false)
                task._Wait(60)
                SetV2(self,1,self.rot,true,false)
            end)
            last=New(_straight,heart,COLOR_DEEP_GREEN,self.x,self.y,3,180 - ang,false,0,true,true,0,false,0,0,0,false)
            lasttask=task.New(last,function()
                local self=task.GetSelf()
                self.ang = self.rot
                lasttask=task.New(self,function()
                    for _=1,_infinite do
                        PlaySound("kira00",0.1,self.x/256,false)
                        last=New(_straight,arrow_big,COLOR_ROYAL_BLUE,self.x,self.y,0.1,self.rot - 180,false,0,true,true,0,false,0.03,self.rot - 180,4,false)
                        _object.set_color(self,"mul+add",255,255,255,255)
                        task._Wait(8)
                    end
                end)
                do
                    local _h_ang=(-15-(15))/2 local _t_ang=(-15+(15))/2 local ang=_h_ang*sin(0)+_t_ang local _w_ang=0 local _d_w_ang=6
                    for _=1,_infinite do
                        SetV2(self,2,ang + self.ang,true,false)
                        if self.x > 224 or self.x < -224 or self.y > 224 or self.y < -224 then break end
                        task._Wait(1)
                        _w_ang=_w_ang+_d_w_ang ang=_h_ang*sin(_w_ang)+_t_ang
                    end
                end
                SetV2(self,0,self.rot,true,false)
                last_list=_create_bullet_group(ball_mid_c,COLOR_ROYAL_BLUE,self.x,self.y,9,0,1,1,0,360,true,0,true,true,0,false,self)
                PlaySound("kira02",0.1,self.x/256,false)
                task._Wait(60)
                SetV2(self,1,self.rot,true,false)
            end)
            task._Wait(60)
        ang=ang+_d_ang end end
    end)
end
function _tmp_sc:del()
end
_tmp_sc.perform=false
table.insert(_editor_class["Kichi"].cards,_tmp_sc)
table.insert(_sc_table,{"Kichi","Vineyard Scramble \"Overgrown Connections\"",_tmp_sc,#_editor_class["Kichi"].cards,false})
_tmp_sc=boss.card.New("Enchanting Flower \"Crystallize Entanglement\"",40,40,40,1800,{0,65,5},false)
function _tmp_sc:before()
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        last=New(_editor_class["Spell_Cutin"],self.x,self.y,"Kichi")
        task.MoveTo(0,450,140,MOVE_ACC_DEC)
        PlaySound("kira01",0.1,self.x/256,false)
        last=New(_straight,heart,COLOR_CYAN,100, 224,0,-90,false,0,true,false,0,false,0,0,0,false)
        last.navi = true
        lasttask=task.New(last,function()
            local self=task.GetSelf()
            lasttask=task.New(self,function()
                task.CRMoveTo(60*3,MOVE_ACC_DEC,100, 100, 20, 0, 100, -100, 100, -240)
                _del(self,true)
            end)
            for _=1,_infinite do
                PlaySound("tan00",0.1,self.x/256,false)
                last=New(_straight,ellipse,COLOR_CYAN,self.x,self.y,0,self.rot- 180,false,0,true,false,0,false,0,0,0,false)
                lasttask=task.New(last,function()
                    local self=task.GetSelf()
                    ex.WaitForSignal("bulletSpin",true)
                    self.dist = Dist(self.x, self.y, 0, 0)
                    do
                        local _beg_spd=0 local spd=_beg_spd local _end_spd=3000 local _w_spd=0  local _d_w_spd=1/(3600-1)
                        local ang=Angle(0, 0, self.x, self.y) local _d_ang=(spd)
                        for _=1,3600 do
                            self.x = self.dist * cos(ang + spd)
                            self.y = self.dist * sin(ang + spd)
                            task._Wait(1)
                            _w_spd=_w_spd+_d_w_spd spd=(_end_spd-_beg_spd)*_w_spd^2+_beg_spd
                            ang=ang+_d_ang
                        end
                    end
                end)
                _object.set_color(last,"mul+add",255,255,255,255)
                last.navi = true
                task._Wait(10)
            end
        end)
        last=New(_straight,heart,COLOR_CYAN,-100, 224,0,-90,false,0,true,false,0,false,0,0,0,false)
        last.navi = true
        lasttask=task.New(last,function()
            local self=task.GetSelf()
            lasttask=task.New(self,function()
                task.CRMoveTo(60*3,MOVE_ACC_DEC,-100, 100, -20, 0, -100, -100, -100, -240)
                _del(self,true)
            end)
            for _=1,_infinite do
                PlaySound("tan00",0.1,self.x/256,false)
                last=New(_straight,ellipse,COLOR_CYAN,self.x,self.y,0,self.rot- 180,false,0,true,false,0,false,0,0,0,false)
                lasttask=task.New(last,function()
                    local self=task.GetSelf()
                    ex.WaitForSignal("bulletSpin",true)
                    self.dist = Dist(self.x, self.y, 0, 0)
                    do
                        local _beg_spd=0 local spd=_beg_spd local _end_spd=3000 local _w_spd=0  local _d_w_spd=1/(3600-1)
                        local ang=Angle(0, 0, self.x, self.y) local _d_ang=(spd)
                        for _=1,3600 do
                            self.x = self.dist * cos(ang + spd)
                            self.y = self.dist * sin(ang + spd)
                            task._Wait(1)
                            _w_spd=_w_spd+_d_w_spd spd=(_end_spd-_beg_spd)*_w_spd^2+_beg_spd
                            ang=ang+_d_ang
                        end
                    end
                end)
                _object.set_color(last,"mul+add",255,255,255,255)
                last.navi = true
                task._Wait(10)
            end
        end)
        --[[ ]]
        
        last=New(_straight,heart,COLOR_CYAN,100, -224,0,-90,false,0,true,false,0,false,0,0,0,false)
        last.navi = true
        lasttask=task.New(last,function()
            local self=task.GetSelf()
            lasttask=task.New(self,function()
                task.CRMoveTo(60*3,MOVE_ACC_DEC,100, -100, 20, 0, 100, 100, 100, 240)
                _del(self,true)
            end)
            for _=1,_infinite do
                PlaySound("tan00",0.1,self.x/256,false)
                last=New(_straight,ellipse,COLOR_CYAN,self.x,self.y,0,self.rot- 180,false,0,true,false,0,false,0,0,0,false)
                lasttask=task.New(last,function()
                    local self=task.GetSelf()
                    ex.WaitForSignal("bulletSpin",true)
                    self.dist = Dist(self.x, self.y, 0, 0)
                    do
                        local _beg_spd=0 local spd=_beg_spd local _end_spd=-3000 local _w_spd=0  local _d_w_spd=1/(3600-1)
                        local ang=Angle(0, 0, self.x, self.y) local _d_ang=(spd)
                        for _=1,3600 do
                            self.x = self.dist * cos(ang + spd)
                            self.y = self.dist * sin(ang + spd)
                            task._Wait(1)
                            _w_spd=_w_spd+_d_w_spd spd=(_end_spd-_beg_spd)*_w_spd^2+_beg_spd
                            ang=ang+_d_ang
                        end
                    end
                end)
                _object.set_color(last,"mul+add",255,255,255,255)
                last.navi = true
                task._Wait(10)
            end
        end)
        last=New(_straight,heart,COLOR_CYAN,-100, -224,0,-90,false,0,true,false,0,false,0,0,0,false)
        last.navi = true
        lasttask=task.New(last,function()
            local self=task.GetSelf()
            lasttask=task.New(self,function()
                task.CRMoveTo(60*3,MOVE_ACC_DEC,-100, -100, -20, 0, -100, 100, -100, 240)
                _del(self,true)
            end)
            for _=1,_infinite do
                PlaySound("tan00",0.1,self.x/256,false)
                last=New(_straight,ellipse,COLOR_CYAN,self.x,self.y,0,self.rot- 180,false,0,true,false,0,false,0,0,0,false)
                lasttask=task.New(last,function()
                    local self=task.GetSelf()
                    ex.WaitForSignal("bulletSpin",true)
                    self.dist = Dist(self.x, self.y, 0, 0)
                    do
                        local _beg_spd=0 local spd=_beg_spd local _end_spd=-3000 local _w_spd=0  local _d_w_spd=1/(3600-1)
                        local ang=Angle(0, 0, self.x, self.y) local _d_ang=(spd)
                        for _=1,3600 do
                            self.x = self.dist * cos(ang + spd)
                            self.y = self.dist * sin(ang + spd)
                            task._Wait(1)
                            _w_spd=_w_spd+_d_w_spd spd=(_end_spd-_beg_spd)*_w_spd^2+_beg_spd
                            ang=ang+_d_ang
                        end
                    end
                end)
                _object.set_color(last,"mul+add",255,255,255,255)
                last.navi = true
                task._Wait(10)
            end
        end)
        task._Wait(60)
        PlaySound("kira01",0.1,self.x/256,false)
        last=New(_straight,heart,COLOR_CYAN,224, 100,0,-90,false,0,true,false,0,false,0,0,0,false)
        last.navi = true
        lasttask=task.New(last,function()
            local self=task.GetSelf()
            lasttask=task.New(self,function()
                task.CRMoveTo(60*3,MOVE_ACC_DEC,100, 100, 0, 20, -100, 100, -240, 100)
                _del(self,true)
            end)
            for _=1,_infinite do
                PlaySound("tan00",0.1,self.x/256,false)
                last=New(_straight,ellipse,COLOR_CYAN,self.x,self.y,0,self.rot- 180,false,0,true,false,0,false,0,0,0,false)
                lasttask=task.New(last,function()
                    local self=task.GetSelf()
                    ex.WaitForSignal("bulletSpin",true)
                    self.dist = Dist(self.x, self.y, 0, 0)
                    do
                        local _beg_spd=0 local spd=_beg_spd local _end_spd=3000 local _w_spd=0  local _d_w_spd=1/(3600-1)
                        local ang=Angle(0, 0, self.x, self.y) local _d_ang=(spd)
                        for _=1,3600 do
                            self.x = self.dist * cos(ang + spd)
                            self.y = self.dist * sin(ang + spd)
                            task._Wait(1)
                            _w_spd=_w_spd+_d_w_spd spd=(_end_spd-_beg_spd)*_w_spd^2+_beg_spd
                            ang=ang+_d_ang
                        end
                    end
                end)
                _object.set_color(last,"mul+add",255,255,255,255)
                last.navi = true
                task._Wait(10)
            end
        end)
        last=New(_straight,heart,COLOR_CYAN,224, -100,0,-90,false,0,true,false,0,false,0,0,0,false)
        last.navi = true
        lasttask=task.New(last,function()
            local self=task.GetSelf()
            lasttask=task.New(self,function()
                task.CRMoveTo(60*3,MOVE_ACC_DEC,100, -100, 0, -20, -100, -100, -240, -100)
                _del(self,true)
            end)
            for _=1,_infinite do
                PlaySound("tan00",0.1,self.x/256,false)
                last=New(_straight,ellipse,COLOR_CYAN,self.x,self.y,0,self.rot- 180,false,0,true,false,0,false,0,0,0,false)
                lasttask=task.New(last,function()
                    local self=task.GetSelf()
                    ex.WaitForSignal("bulletSpin",true)
                    self.dist = Dist(self.x, self.y, 0, 0)
                    do
                        local _beg_spd=0 local spd=_beg_spd local _end_spd=3000 local _w_spd=0  local _d_w_spd=1/(3600-1)
                        local ang=Angle(0, 0, self.x, self.y) local _d_ang=(spd)
                        for _=1,3600 do
                            self.x = self.dist * cos(ang + spd)
                            self.y = self.dist * sin(ang + spd)
                            task._Wait(1)
                            _w_spd=_w_spd+_d_w_spd spd=(_end_spd-_beg_spd)*_w_spd^2+_beg_spd
                            ang=ang+_d_ang
                        end
                    end
                end)
                _object.set_color(last,"mul+add",255,255,255,255)
                last.navi = true
                task._Wait(10)
            end
        end)
        --[[ ]]
        
        last=New(_straight,heart,COLOR_CYAN,-224, 100,0,-90,false,0,true,false,0,false,0,0,0,false)
        last.navi = true
        lasttask=task.New(last,function()
            local self=task.GetSelf()
            lasttask=task.New(self,function()
                task.CRMoveTo(60*3,MOVE_ACC_DEC,-100, 100, 0, 20, 100, 100, 240, 100)
                _del(self,true)
            end)
            for _=1,_infinite do
                PlaySound("tan00",0.1,self.x/256,false)
                last=New(_straight,ellipse,COLOR_CYAN,self.x,self.y,0,self.rot- 180,false,0,true,false,0,false,0,0,0,false)
                lasttask=task.New(last,function()
                    local self=task.GetSelf()
                    ex.WaitForSignal("bulletSpin",true)
                    self.dist = Dist(self.x, self.y, 0, 0)
                    do
                        local _beg_spd=0 local spd=_beg_spd local _end_spd=-3000 local _w_spd=0  local _d_w_spd=1/(3600-1)
                        local ang=Angle(0, 0, self.x, self.y) local _d_ang=(spd)
                        for _=1,3600 do
                            self.x = self.dist * cos(ang + spd)
                            self.y = self.dist * sin(ang + spd)
                            task._Wait(1)
                            _w_spd=_w_spd+_d_w_spd spd=(_end_spd-_beg_spd)*_w_spd^2+_beg_spd
                            ang=ang+_d_ang
                        end
                    end
                end)
                _object.set_color(last,"mul+add",255,255,255,255)
                last.navi = true
                task._Wait(10)
            end
        end)
        last=New(_straight,heart,COLOR_CYAN,-224, -100,0,-90,false,0,true,false,0,false,0,0,0,false)
        last.navi = true
        lasttask=task.New(last,function()
            local self=task.GetSelf()
            lasttask=task.New(self,function()
                task.CRMoveTo(60*3,MOVE_ACC_DEC,-100, -100, 0, -20, 100, -100, 240, -100)
                _del(self,true)
            end)
            for _=1,_infinite do
                PlaySound("tan00",0.1,self.x/256,false)
                last=New(_straight,ellipse,COLOR_CYAN,self.x,self.y,0,self.rot- 180,false,0,true,false,0,false,0,0,0,false)
                lasttask=task.New(last,function()
                    local self=task.GetSelf()
                    ex.WaitForSignal("bulletSpin",true)
                    self.dist = Dist(self.x, self.y, 0, 0)
                    do
                        local _beg_spd=0 local spd=_beg_spd local _end_spd=-3000 local _w_spd=0  local _d_w_spd=1/(3600-1)
                        local ang=Angle(0, 0, self.x, self.y) local _d_ang=(spd)
                        for _=1,3600 do
                            self.x = self.dist * cos(ang + spd)
                            self.y = self.dist * sin(ang + spd)
                            task._Wait(1)
                            _w_spd=_w_spd+_d_w_spd spd=(_end_spd-_beg_spd)*_w_spd^2+_beg_spd
                            ang=ang+_d_ang
                        end
                    end
                end)
                _object.set_color(last,"mul+add",255,255,255,255)
                last.navi = true
                task._Wait(10)
            end
        end)
        task._Wait(60*2)
        New(boss_cast_ef,0, 0,360,125,255,191,60,2,false)
        task._Wait(60)
        PlaySound("boon01",0.1,self.x/256,false)
        ex.SetSignal("bulletSpin",true)
        task._Wait(60*2)
        New(boss_cast_ef,0, 0,360,125,255,191,60,2,false)
        task._Wait(60)
        lasttask=task.New(self,function()
            do local ang,_d_ang=(0),(8) for _=1,_infinite do
                PlaySound("kira00",0.1,self.x/256,false)
                last_list=_create_bullet_group(arrow_big,COLOR_GREEN,0,0,4,0,2,2,ang - 90,360,false,0,true,true,0,false,self)
                last_list=_create_bullet_group(arrow_big,COLOR_GREEN,0,0,4,0,2,2,-ang - 90,360,false,0,true,true,0,false,self)
                task._Wait(20)
            ang=ang+_d_ang end end
        end)
        task._Wait(60*6)
        New(boss_cast_ef,0, 0,360,125,255,191,60,2,false)
        task._Wait(60)
        lasttask=task.New(self,function()
            do local ang,_d_ang=(0),(5) for _=1,_infinite do
                PlaySound("kira00",0.1,self.x/256,false)
                last_list=_create_bullet_group(arrow_big,COLOR_ROYAL_BLUE,0,0,4,0,1,1,ang - 90,360,false,0,true,true,0,false,self)
                last_list=_create_bullet_group(arrow_big,COLOR_ROYAL_BLUE,0,0,4,0,1,1,-ang - 90,360,false,0,true,true,0,false,self)
                task._Wait(25)
            ang=ang+_d_ang end end
        end)
        task._Wait(60*6)
        New(boss_cast_ef,0, 0,360,125,255,191,60,2,false)
        task._Wait(60)
        lasttask=task.New(self,function()
            do local ang,_d_ang=(0),(3) for _=1,_infinite do
                PlaySound("kira00",0.1,self.x/256,false)
                last_list=_create_bullet_group(ball_mid_c,COLOR_CYAN,0,0,4,0,1,1,ang - 90,360,false,0,true,true,0,false,self)
                last_list=_create_bullet_group(ball_mid_c,COLOR_CYAN,0,0,4,0,1,1,-ang - 90,360,false,0,true,true,0,false,self)
                task._Wait(35)
            ang=ang+_d_ang end end
        end)
        task._Wait(60*6)
        New(boss_cast_ef,0, 0,360,125,255,191,60,2,false)
        task._Wait(60)
        lasttask=task.New(self,function()
            do local ang,_d_ang=(0),(3) for _=1,_infinite do
                PlaySound("kira00",0.1,self.x/256,false)
                last_list=_create_bullet_group(ball_light,COLOR_GREEN,0,0,4,0,0.5,0.5,ang - 90,360,false,0,true,true,0,false,self)
                last_list=_create_bullet_group(ball_light,COLOR_GREEN,0,0,4,0,0.5,0.5,-ang - 90,360,false,0,true,true,0,false,self)
                task._Wait(50)
            ang=ang+_d_ang end end
        end)
    end)
end
function _tmp_sc:del()
end
_tmp_sc.perform=false
table.insert(_editor_class["Kichi"].cards,_tmp_sc)
table.insert(_sc_table,{"Kichi","Enchanting Flower \"Crystallize Entanglement\"",_tmp_sc,#_editor_class["Kichi"].cards,false})
_tmp_sc=boss.card.New("\"Leafwhisper Ode to Blooming\"",7,20,60,1800,{0,65,5},false)
function _tmp_sc:before()
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        last=New(_editor_class["Spell_Cutin"],self.x,self.y,"Kichi")
        task.MoveTo(0,120,60,MOVE_DECEL)
        New(boss_cast_ef,self.x, self.y,360,125,255,191,60,2,false)
        task._Wait(60)
        last=New(_straight,ball_light,COLOR_ROYAL_BLUE,self.x,self.y,0,0,false,0,true,false,0,false,0,0,0,false)
        PlaySound("kira01",0.1,self.x/256,false)
        lasttask=task.New(last,function()
            local self=task.GetSelf()
            lasttask=task.New(self,function()
                task.CRMoveTo(60*4.5,MOVE_ACC_DEC,0, 75, 60, 40, 100, 160, 120, 120)
            end)
            do
                local r=Angle(self, player) local _d_r=(360/8)
                local nEdges=5 local _d_nEdges=(1)
                local _beg_waitTime=45 local waitTime=_beg_waitTime  local _w_waitTime=-90 local _end_waitTime=10 local _d_w_waitTime=180/(14-1)
                local _beg_speed=1.5 local speed=_beg_speed  local _w_speed=-90 local _end_speed=0.4 local _d_w_speed=180/(14)
                for _=1,14 do
                    --[[ increment of angle for different polygons]]
                    
                    --[[ nEdges]]
                    
                    do
                        local _beg_jr=0 local jr=_beg_jr local _end_jr=360 local _d_jr=(_end_jr-_beg_jr)/(nEdges)
                        for _=1,nEdges do
                            --[[ iterate a circle and give it nEdges chops, store angles into jr]]
                            
                            --[[ nBullets per edge - 1 (because vertices should be counted only once)]]
                            
                            do
                                local _beg_kvx=cos(r+jr) local kvx=_beg_kvx local _end_kvx=cos(r+jr+_d_jr) local _d_kvx=(_end_kvx-_beg_kvx)/(2)
                                local _beg_kvy=sin(r+jr) local kvy=_beg_kvy local _end_kvy=sin(r+jr+_d_jr) local _d_kvy=(_end_kvy-_beg_kvy)/(2)
                                for _=1,2 do
                                    --[[ iterate in the edge.]]
                                    
                                    last=New(_straight,arrow_big,COLOR_ROYAL_BLUE,self.x,self.y,speed,0,false,0,true,true,0,false,0,0,0,false)
                                    last.navi = true
                                    last.vx, last.vy = speed*kvx, speed*kvy
                                    _object.set_color(last,"mul+add",255,255,255,255)
                                    kvx=kvx+_d_kvx
                                    kvy=kvy+_d_kvy
                                end
                            end
                            jr=jr+_d_jr
                        end
                    end
                    PlaySound("tan00",0.1,self.x/256,false)
                    task._Wait(waitTime)
                    r=r+_d_r
                    nEdges=nEdges+_d_nEdges
                    _w_waitTime=_w_waitTime+_d_w_waitTime waitTime=(_end_waitTime-_beg_waitTime)/2*sin(_w_waitTime)+((_end_waitTime+_beg_waitTime)/2)
                    _w_speed=_w_speed+_d_w_speed speed=(_end_speed-_beg_speed)/2*sin(_w_speed)+((_end_speed+_beg_speed)/2)
                end
            end
            PlaySound("old_enep00",0.7,self.x/256,false)
            PlaySound("kira00",0.1,self.x/256,false)
            last_list=_create_bullet_group(ball_big,COLOR_ROYAL_BLUE,self.x,self.y,18,0,1,1,0,360,true,0,true,true,0,false,self)
            ex.WaitForSignal("shootBullet",true)
            do
                local _beg_waitTime=8 local waitTime=_beg_waitTime  local _w_waitTime=-90 local _end_waitTime=4 local _d_w_waitTime=180/(60*8.5-1)
                local _beg_spd=1 local spd=_beg_spd  local _w_spd=-90 local _end_spd=12 local _d_w_spd=180/(60*8.5-1)
                for _=1,60*8.5 do
                    PlaySound("kira00",0.1,self.x/256,false)
                    last=New(_straight,arrow_big,COLOR_CYAN,self.x,self.y,spd,Angle(self.x, self.y, 0, 0) + ran:Int(-5, 5),false,0,true,true,0,false,0,0,0,false)
                    _object.set_color(last,"mul+add",255,255,255,255)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        for _=1,_infinite do
                            if Dist(self.x, self.y, 0, 0) < 16 then
                                PlaySound("kira02",0.1,self.x/256,false)
                                last_list=_create_bullet_group(kite,COLOR_GRAY,self.x + ran:Int(-3, 3),self.y + ran:Int(-3, 3),3,0,spd,spd,0,360,true,0,true,true,0,false,self)
                                for _,unit in ipairs(last_list) do
                                    _object.set_color(unit,"mul+add",255,255,255,255)
                                end
                                _del(self,true)
                            end
                            task._Wait(1)
                        end
                    end)
                    task._Wait(waitTime)
                    _w_waitTime=_w_waitTime+_d_w_waitTime waitTime=(_end_waitTime-_beg_waitTime)/2*sin(_w_waitTime)+((_end_waitTime+_beg_waitTime)/2)
                    _w_spd=_w_spd+_d_w_spd spd=(_end_spd-_beg_spd)/2*sin(_w_spd)+((_end_spd+_beg_spd)/2)
                end
            end
        end)
        last=New(_straight,ball_light,COLOR_ROYAL_BLUE,self.x,self.y,0,0,false,0,true,false,0,false,0,0,0,false)
        lasttask=task.New(last,function()
            local self=task.GetSelf()
            lasttask=task.New(self,function()
                task.CRMoveTo(60*4.5,MOVE_ACC_DEC,0, 75, -60, 40, -100, 160, -120, 120)
            end)
            do
                local r=Angle(self, player) local _d_r=(-360/8)
                local nEdges=5 local _d_nEdges=(1)
                local _beg_waitTime=45 local waitTime=_beg_waitTime  local _w_waitTime=-90 local _end_waitTime=10 local _d_w_waitTime=180/(14-1)
                local _beg_speed=1.5 local speed=_beg_speed  local _w_speed=-90 local _end_speed=0.4 local _d_w_speed=180/(14)
                for _=1,14 do
                    --[[ increment of angle for different polygons]]
                    
                    --[[ nEdges]]
                    
                    do
                        local _beg_jr=0 local jr=_beg_jr local _end_jr=-360 local _d_jr=(_end_jr-_beg_jr)/(nEdges)
                        for _=1,nEdges do
                            --[[ iterate a circle and give it nEdges chops, store angles into jr]]
                            
                            --[[ nBullets per edge - 1 (because vertices should be counted only once)]]
                            
                            do
                                local _beg_kvx=cos(r+jr) local kvx=_beg_kvx local _end_kvx=cos(r+jr+_d_jr) local _d_kvx=(_end_kvx-_beg_kvx)/(2)
                                local _beg_kvy=sin(r+jr) local kvy=_beg_kvy local _end_kvy=sin(r+jr+_d_jr) local _d_kvy=(_end_kvy-_beg_kvy)/(2)
                                for _=1,2 do
                                    --[[ iterate in the edge.]]
                                    
                                    last=New(_straight,arrow_big,COLOR_ROYAL_BLUE,self.x,self.y,speed,0,false,0,true,true,0,false,0,0,0,false)
                                    last.navi = true
                                    last.vx, last.vy = speed*kvx, speed*kvy
                                    _object.set_color(last,"mul+add",255,255,255,255)
                                    kvx=kvx+_d_kvx
                                    kvy=kvy+_d_kvy
                                end
                            end
                            jr=jr+_d_jr
                        end
                    end
                    PlaySound("tan00",0.1,self.x/256,false)
                    task._Wait(waitTime)
                    r=r+_d_r
                    nEdges=nEdges+_d_nEdges
                    _w_waitTime=_w_waitTime+_d_w_waitTime waitTime=(_end_waitTime-_beg_waitTime)/2*sin(_w_waitTime)+((_end_waitTime+_beg_waitTime)/2)
                    _w_speed=_w_speed+_d_w_speed speed=(_end_speed-_beg_speed)/2*sin(_w_speed)+((_end_speed+_beg_speed)/2)
                end
            end
            PlaySound("old_enep00",0.7,self.x/256,false)
            PlaySound("kira00",0.1,self.x/256,false)
            last_list=_create_bullet_group(ball_big,COLOR_ROYAL_BLUE,self.x,self.y,18,0,1,1,0,360,true,0,true,true,0,false,self)
            ex.WaitForSignal("shootBullet",true)
            do
                local _beg_waitTime=8 local waitTime=_beg_waitTime  local _w_waitTime=-90 local _end_waitTime=4 local _d_w_waitTime=180/(60*8.5-1)
                local _beg_spd=1 local spd=_beg_spd  local _w_spd=-90 local _end_spd=12 local _d_w_spd=180/(60*8.5-1)
                for _=1,60*8.5 do
                    PlaySound("kira00",0.1,self.x/256,false)
                    last=New(_straight,arrow_big,COLOR_CYAN,self.x,self.y,spd,Angle(self.x, self.y, 0, 0) + ran:Int(-5, 5),false,0,true,true,0,false,0,0,0,false)
                    _object.set_color(last,"mul+add",255,255,255,255)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        for _=1,_infinite do
                            if Dist(self.x, self.y, 0, 0) < 16 then
                                PlaySound("kira02",0.1,self.x/256,false)
                                last_list=_create_bullet_group(kite,COLOR_GRAY,self.x + ran:Int(-3, 3),self.y + ran:Int(-3, 3),3,0,spd,spd,0,360,true,0,true,true,0,false,self)
                                for _,unit in ipairs(last_list) do
                                    _object.set_color(unit,"mul+add",255,255,255,255)
                                end
                                _del(self,true)
                            end
                            task._Wait(1)
                        end
                    end)
                    task._Wait(waitTime)
                    _w_waitTime=_w_waitTime+_d_w_waitTime waitTime=(_end_waitTime-_beg_waitTime)/2*sin(_w_waitTime)+((_end_waitTime+_beg_waitTime)/2)
                    _w_spd=_w_spd+_d_w_spd spd=(_end_spd-_beg_spd)/2*sin(_w_spd)+((_end_spd+_beg_spd)/2)
                end
            end
        end)
        task._Wait(60*4)
        New(boss_cast_ef,self.x, self.y,360,125,255,191,60,2,false)
        task._Wait(60)
        last=New(_straight,ball_light,COLOR_GREEN,self.x,self.y,0,0,false,0,true,false,0,false,0,0,0,false)
        lasttask=task.New(last,function()
            local self=task.GetSelf()
            lasttask=task.New(self,function()
                task.CRMoveTo(60*5,MOVE_ACC_DEC,120, 50, 200, -50, 180, -100, 120, -120)
            end)
            do
                local r=Angle(self, player) local _d_r=(360/8)
                local nEdges=5 local _d_nEdges=(1)
                local _beg_waitTime=50 local waitTime=_beg_waitTime  local _w_waitTime=-90 local _end_waitTime=15 local _d_w_waitTime=180/(12-1)
                local _beg_speed=1.5 local speed=_beg_speed  local _w_speed=-90 local _end_speed=0.4 local _d_w_speed=180/(12)
                for _=1,12 do
                    --[[ increment of angle for different polygons]]
                    
                    --[[ nEdges]]
                    
                    do
                        local _beg_jr=0 local jr=_beg_jr local _end_jr=360 local _d_jr=(_end_jr-_beg_jr)/(nEdges)
                        for _=1,nEdges do
                            --[[ iterate a circle and give it nEdges chops, store angles into jr]]
                            
                            --[[ nBullets per edge - 1 (because vertices should be counted only once)]]
                            
                            do
                                local _beg_kvx=cos(r+jr) local kvx=_beg_kvx local _end_kvx=cos(r+jr+_d_jr) local _d_kvx=(_end_kvx-_beg_kvx)/(2)
                                local _beg_kvy=sin(r+jr) local kvy=_beg_kvy local _end_kvy=sin(r+jr+_d_jr) local _d_kvy=(_end_kvy-_beg_kvy)/(2)
                                for _=1,2 do
                                    --[[ iterate in the edge.]]
                                    
                                    last=New(_straight,arrow_big,COLOR_GREEN,self.x,self.y,speed,0,false,0,true,true,0,false,0,0,0,false)
                                    last.navi = true
                                    last.vx, last.vy = speed*kvx, speed*kvy
                                    _object.set_color(last,"mul+add",255,255,255,255)
                                    kvx=kvx+_d_kvx
                                    kvy=kvy+_d_kvy
                                end
                            end
                            jr=jr+_d_jr
                        end
                    end
                    PlaySound("tan00",0.1,self.x/256,false)
                    task._Wait(waitTime)
                    r=r+_d_r
                    nEdges=nEdges+_d_nEdges
                    _w_waitTime=_w_waitTime+_d_w_waitTime waitTime=(_end_waitTime-_beg_waitTime)/2*sin(_w_waitTime)+((_end_waitTime+_beg_waitTime)/2)
                    _w_speed=_w_speed+_d_w_speed speed=(_end_speed-_beg_speed)/2*sin(_w_speed)+((_end_speed+_beg_speed)/2)
                end
            end
            PlaySound("old_enep00",0.7,self.x/256,false)
            PlaySound("kira00",0.1,self.x/256,false)
            last_list=_create_bullet_group(ball_big,COLOR_GREEN,self.x,self.y,12,0,1,1,0,360,true,0,true,true,0,false,self)
            ex.WaitForSignal("shootBullet",true)
            do
                local _beg_waitTime=8 local waitTime=_beg_waitTime  local _w_waitTime=-90 local _end_waitTime=4 local _d_w_waitTime=180/(60*8.5-1)
                local _beg_spd=1 local spd=_beg_spd  local _w_spd=-90 local _end_spd=12 local _d_w_spd=180/(60*8.5-1)
                for _=1,60*8.5 do
                    PlaySound("kira00",0.1,self.x/256,false)
                    last=New(_straight,arrow_big,COLOR_GREEN,self.x,self.y,spd,Angle(self.x, self.y, 0, 0) + ran:Int(-5, 5),false,0,true,true,0,false,0,0,0,false)
                    _object.set_color(last,"mul+add",255,255,255,255)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        for _=1,_infinite do
                            if Dist(self.x, self.y, 0, 0) < 16 then
                                PlaySound("kira02",0.1,self.x/256,false)
                                last_list=_create_bullet_group(kite,COLOR_GRAY,self.x + ran:Int(-3, 3),self.y + ran:Int(-3, 3),3,0,spd,spd,0,360,true,0,true,true,0,false,self)
                                for _,unit in ipairs(last_list) do
                                    _object.set_color(unit,"mul+add",255,255,255,255)
                                end
                                _del(self,true)
                            end
                            task._Wait(1)
                        end
                    end)
                    task._Wait(waitTime)
                    _w_waitTime=_w_waitTime+_d_w_waitTime waitTime=(_end_waitTime-_beg_waitTime)/2*sin(_w_waitTime)+((_end_waitTime+_beg_waitTime)/2)
                    _w_spd=_w_spd+_d_w_spd spd=(_end_spd-_beg_spd)/2*sin(_w_spd)+((_end_spd+_beg_spd)/2)
                end
            end
        end)
        last=New(_straight,ball_light,COLOR_GREEN,self.x,self.y,0,0,false,0,true,false,0,false,0,0,0,false)
        lasttask=task.New(last,function()
            local self=task.GetSelf()
            lasttask=task.New(self,function()
                task.CRMoveTo(60*5,MOVE_ACC_DEC,-120, 50, -200, -50, -180, -100, -120, -120)
            end)
            do
                local r=Angle(self, player) local _d_r=(-360/8)
                local nEdges=5 local _d_nEdges=(1)
                local _beg_waitTime=50 local waitTime=_beg_waitTime  local _w_waitTime=-90 local _end_waitTime=15 local _d_w_waitTime=180/(12-1)
                local _beg_speed=1.5 local speed=_beg_speed  local _w_speed=-90 local _end_speed=0.4 local _d_w_speed=180/(12)
                for _=1,12 do
                    --[[ increment of angle for different polygons]]
                    
                    --[[ nEdges]]
                    
                    do
                        local _beg_jr=0 local jr=_beg_jr local _end_jr=-360 local _d_jr=(_end_jr-_beg_jr)/(nEdges)
                        for _=1,nEdges do
                            --[[ iterate a circle and give it nEdges chops, store angles into jr]]
                            
                            --[[ nBullets per edge - 1 (because vertices should be counted only once)]]
                            
                            do
                                local _beg_kvx=cos(r+jr) local kvx=_beg_kvx local _end_kvx=cos(r+jr+_d_jr) local _d_kvx=(_end_kvx-_beg_kvx)/(2)
                                local _beg_kvy=sin(r+jr) local kvy=_beg_kvy local _end_kvy=sin(r+jr+_d_jr) local _d_kvy=(_end_kvy-_beg_kvy)/(2)
                                for _=1,2 do
                                    --[[ iterate in the edge.]]
                                    
                                    last=New(_straight,arrow_big,COLOR_GREEN,self.x,self.y,speed,0,false,0,true,true,0,false,0,0,0,false)
                                    last.navi = true
                                    last.vx, last.vy = speed*kvx, speed*kvy
                                    _object.set_color(last,"mul+add",255,255,255,255)
                                    kvx=kvx+_d_kvx
                                    kvy=kvy+_d_kvy
                                end
                            end
                            jr=jr+_d_jr
                        end
                    end
                    PlaySound("tan00",0.1,self.x/256,false)
                    task._Wait(waitTime)
                    r=r+_d_r
                    nEdges=nEdges+_d_nEdges
                    _w_waitTime=_w_waitTime+_d_w_waitTime waitTime=(_end_waitTime-_beg_waitTime)/2*sin(_w_waitTime)+((_end_waitTime+_beg_waitTime)/2)
                    _w_speed=_w_speed+_d_w_speed speed=(_end_speed-_beg_speed)/2*sin(_w_speed)+((_end_speed+_beg_speed)/2)
                end
            end
            PlaySound("old_enep00",0.7,self.x/256,false)
            PlaySound("kira00",0.1,self.x/256,false)
            last_list=_create_bullet_group(ball_big,COLOR_GREEN,self.x,self.y,12,0,1,1,0,360,true,0,true,true,0,false,self)
            ex.WaitForSignal("shootBullet",true)
            do
                local _beg_waitTime=8 local waitTime=_beg_waitTime  local _w_waitTime=-90 local _end_waitTime=4 local _d_w_waitTime=180/(60*8.5-1)
                local _beg_spd=1 local spd=_beg_spd  local _w_spd=-90 local _end_spd=12 local _d_w_spd=180/(60*8.5-1)
                for _=1,60*8.5 do
                    PlaySound("kira00",0.1,self.x/256,false)
                    last=New(_straight,arrow_big,COLOR_GREEN,self.x,self.y,spd,Angle(self.x, self.y, 0, 0) + ran:Int(-5, 5),false,0,true,true,0,false,0,0,0,false)
                    _object.set_color(last,"mul+add",255,255,255,255)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        for _=1,_infinite do
                            if Dist(self.x, self.y, 0, 0) < 16 then
                                PlaySound("kira02",0.1,self.x/256,false)
                                last_list=_create_bullet_group(kite,COLOR_GRAY,self.x + ran:Int(-3, 3),self.y + ran:Int(-3, 3),3,0,spd,spd,0,360,true,0,true,true,0,false,self)
                                for _,unit in ipairs(last_list) do
                                    _object.set_color(unit,"mul+add",255,255,255,255)
                                end
                                _del(self,true)
                            end
                            task._Wait(1)
                        end
                    end)
                    task._Wait(waitTime)
                    _w_waitTime=_w_waitTime+_d_w_waitTime waitTime=(_end_waitTime-_beg_waitTime)/2*sin(_w_waitTime)+((_end_waitTime+_beg_waitTime)/2)
                    _w_spd=_w_spd+_d_w_spd spd=(_end_spd-_beg_spd)/2*sin(_w_spd)+((_end_spd+_beg_spd)/2)
                end
            end
        end)
        task._Wait(60*8)
        New(boss_cast_ef,self.x, self.y,360,125,255,191,60,2,false)
        task._Wait(60)
        ex.SetSignal("shootBullet",true)
        task._Wait(60*4)
        New(boss_cast_ef,self.x, self.y,360,125,255,191,60,2,false)
        task._Wait(60)
        task.MoveTo(0,0,60,MOVE_DECEL)
        lasttask=task.New(self,function()
            local _x = 0
            local ang = -90
            for _=1,_infinite do
                _x = _x + 1
                ang = ang + _x
                PlaySound("kira00",0.1,self.x/256,false)
                last_list=_create_bullet_group(heart,COLOR_ROYAL_BLUE,self.x,self.y,3,0,1.5,1.5,ang,360,false,0,true,true,0,false,self)
                for k, unit in ipairs(last_list) do
                    _object.set_color(unit,"mul+add",255,255,255,255)
                    unit.hscale, unit.vscale = 0.8, 0.8
                    unit.a, unit.b, unit.rect = unit.a * 0.8, unit.b * 0.8,false
                end
                task._Wait(8)
            end
        end)
    end)
end
function _tmp_sc:del()
    scoredata.clearCount[3][1] = scoredata.clearCount[3][1] + 1
end
_tmp_sc.perform=false
table.insert(_editor_class["Kichi"].cards,_tmp_sc)
table.insert(_sc_table,{"Kichi","\"Leafwhisper Ode to Blooming\"",_tmp_sc,#_editor_class["Kichi"].cards,false})
-- Title Screen
    stage_init = stage.New("menu", true, true)
    function stage_init:init()
        checker_up = coroutine.create(MenuInputChecker)
        checker_down = coroutine.create(MenuInputChecker)
        checker_left = coroutine.create(MenuInputChecker)
        checker_right = coroutine.create(MenuInputChecker)
        checker_c = coroutine.create(MenuInputChecker)
        lstg.var.rep_player = "Marisa"
        lstg.var.player_name = "Marisa"
        last=New(_editor_class["Base_Drop"],853, 0,_)
    end
    function stage_init:frame()
        _, is_up_held = coroutine.resume(checker_up, "up")
        _, is_down_held = coroutine.resume(checker_down, "down")
        _, is_left_held = coroutine.resume(checker_left, "left")
        _, is_right_held = coroutine.resume(checker_right, "right")
        _, is_c_held = coroutine.resume(checker_c, "special")
        if is_debug then
        	if GetKeyState(KEY.U) then scoredata.tutoriallock = false end
        	if GetKeyState(KEY.L) then scoredata.tutoriallock = true end
        end
        task.Do(self)
    end

stage.group.New('menu',{},"Act0",{lifeleft=7,power=400,faith=50000,bomb=3},true,1)
stage.group.AddStage('Act0','Scene@Act0',{lifeleft=7,power=400,faith=50000,bomb=3},true)
stage.group.DefStageFunc('Scene@Act0','init',function(self)
    _init_item(self)
    difficulty=self.group.difficulty
    New(mask_fader,'open')
    if jstg then jstg.CreatePlayers() else New(_G[lstg.var.player_name]) end
    lasttask=task.New(self,function()
        SetWorldUEX(screen.width/2, screen.height/2, 448, 448, 32, 32)
        lstg.var.lifeleft = 2
        New(_editor_class["gensokyosora_background"] or gensokyosora_background)
        last=New(_editor_class["Plant_Manager"],self.x,self.y,_)
        last=New(_editor_class["UI_Manager"],self.x,self.y,_)
        task._Wait(60)
        last=New(_editor_class["SongDisplayer"],self.x,self.y,false)
        LoadMusicRecord("bgm:Act0Theme")
        _play_music("bgm:Act0Theme")
        do local i,_d_i=(1),(1) for _=1,4 do
            last=New(_editor_class["TutorialHandler"],self.x,self.y,i)
            if i == 1 then
                task._Wait(60*5)
            elseif i == 2 then
                task._Wait(60*11)
            elseif i == 3 then
                task._Wait(60*16)
            elseif i == 4 then
                task._Wait(60*17)
            else
            end
        i=i+_d_i end end
        last=New(_editor_class["Stage_Sections"],self.x,self.y,3, 1)
        while lstg.var.finishStage == false do
            task._Wait(1)
        end
        task._Wait(60)
        last=New(_editor_class["StageClearDisplayer"],self.x,self.y,_)
        task._Wait(9999999)
    end)
    task.New(self,function()
        while coroutine.status(self.task[1])~='dead' do task.Wait() end
        stage.group.FinishReplay()
        New(mask_fader,'close')
        task.New(self,function()
            local _,bgm=EnumRes('bgm')
            for i=1,30 do
                for _,v in pairs(bgm) do
                    if GetMusicState(v)=='playing' then
                        SetBGMVolume(v,1-i/30)
                    end
                end
                task.Wait()
            end
        end)
        task.Wait(30)
        stage.group.FinishStage()
    end)
end)
stage.group.New('menu',{},"Act1",{lifeleft=7,power=400,faith=50000,bomb=3},true,1)
stage.group.AddStage('Act1','Scene@Act1',{lifeleft=7,power=400,faith=50000,bomb=3},true)
stage.group.DefStageFunc('Scene@Act1','init',function(self)
    _init_item(self)
    difficulty=self.group.difficulty
    New(mask_fader,'open')
    if jstg then jstg.CreatePlayers() else New(_G[lstg.var.player_name]) end
    lasttask=task.New(self,function()
        SetWorldUEX(screen.width/2, screen.height/2, 448, 448, 32, 32)
        lstg.var.lifeleft = 2
        New(_editor_class["magic_forest_background"] or magic_forest_background)
        last=New(_editor_class["Plant_Manager"],self.x,self.y,_)
        last=New(_editor_class["UI_Manager"],self.x,self.y,_)
        task._Wait(60)
        LoadMusicRecord("bgm:Act1Theme")
        _play_music("bgm:Act1Theme")
        last=New(_editor_class["SongDisplayer"],self.x,self.y,false)
        last=New(_editor_class["Stage_Sections"],self.x,self.y,7, 2)
        while lstg.var.finishStage == false do
            task._Wait(1)
        end
        task._Wait(60)
        _clear_bullet(true,true)
        for _,unit in ObjList(GROUP_NONTJT) do
            _kill(unit,true)
        end
        for _,unit in ObjList(GROUP_ENEMY) do
            _kill(unit,true)
        end
        if scoredata.clearCount[1][1] <= 0 then
            local _boss_wait=true
            local _ref=New(_editor_class["Isaki"],_editor_class["Isaki"].cards)
            last=_ref
            if _boss_wait then while IsValid(_ref) do task.Wait() end end
        else
            if scoredata.clearCount[1][2] <= 0 then
                local _boss_wait=true
                local _ref=New(_editor_class["Eternity"],_editor_class["Eternity"].cards)
                last=_ref
                if _boss_wait then while IsValid(_ref) do task.Wait() end end
            else
                local bossSel=(ran:Int(1, 2))
                if bossSel == 1 then
                    local _boss_wait=true
                    local _ref=New(_editor_class["Isaki"],_editor_class["Isaki"].cards)
                    last=_ref
                    if _boss_wait then while IsValid(_ref) do task.Wait() end end
                else
                    local _boss_wait=true
                    local _ref=New(_editor_class["Eternity"],_editor_class["Eternity"].cards)
                    last=_ref
                    if _boss_wait then while IsValid(_ref) do task.Wait() end end
                end
            end
        end
        task._Wait(60)
        last=New(_editor_class["StageClearDisplayer"],self.x,self.y,_)
        task._Wait(9999999)
    end)
    task.New(self,function()
        while coroutine.status(self.task[1])~='dead' do task.Wait() end
        stage.group.FinishReplay()
        New(mask_fader,'close')
        task.New(self,function()
            local _,bgm=EnumRes('bgm')
            for i=1,30 do
                for _,v in pairs(bgm) do
                    if GetMusicState(v)=='playing' then
                        SetBGMVolume(v,1-i/30)
                    end
                end
                task.Wait()
            end
        end)
        task.Wait(30)
        stage.group.FinishStage()
    end)
end)
stage.group.New('menu',{},"Act2",{lifeleft=7,power=400,faith=50000,bomb=3},true,1)
stage.group.AddStage('Act2','Scene@Act2',{lifeleft=7,power=400,faith=50000,bomb=3},true)
stage.group.DefStageFunc('Scene@Act2','init',function(self)
    _init_item(self)
    difficulty=self.group.difficulty
    New(mask_fader,'open')
    if jstg then jstg.CreatePlayers() else New(_G[lstg.var.player_name]) end
    lasttask=task.New(self,function()
        SetWorldUEX(screen.width/2, screen.height/2, 448, 448, 32, 32)
        lstg.var.lifeleft = 2
        New(_editor_class["tkz_stage3_bg"] or tkz_stage3_bg)
        last=New(_editor_class["Plant_Manager"],self.x,self.y,_)
        last=New(_editor_class["UI_Manager"],self.x,self.y,_)
        task._Wait(60)
        LoadMusicRecord("bgm:Act2Theme")
        _play_music("bgm:Act2Theme")
        last=New(_editor_class["SongDisplayer"],self.x,self.y,false)
        last=New(_editor_class["Stage_Sections"],self.x,self.y,9, 3)
        while lstg.var.finishStage == false do
            task._Wait(1)
        end
        task._Wait(60)
        _clear_bullet(true,true)
        for _,unit in ObjList(GROUP_NONTJT) do
            _kill(unit,true)
        end
        for _,unit in ObjList(GROUP_ENEMY) do
            _kill(unit,true)
        end
        if scoredata.clearCount[2][2] <= 0 then
            local _boss_wait=true
            local _ref=New(_editor_class["Karen"],_editor_class["Karen"].cards)
            last=_ref
            if _boss_wait then while IsValid(_ref) do task.Wait() end end
        else
            if scoredata.clearCount[2][1] <= 0 then
                local _boss_wait=true
                local _ref=New(_editor_class["Reimu"],_editor_class["Reimu"].cards)
                last=_ref
                if _boss_wait then while IsValid(_ref) do task.Wait() end end
            else
                local bossSel=(ran:Int(1, 2))
                if bossSel == 1 then
                    local _boss_wait=true
                    local _ref=New(_editor_class["Karen"],_editor_class["Karen"].cards)
                    last=_ref
                    if _boss_wait then while IsValid(_ref) do task.Wait() end end
                else
                    local _boss_wait=true
                    local _ref=New(_editor_class["Reimu"],_editor_class["Reimu"].cards)
                    last=_ref
                    if _boss_wait then while IsValid(_ref) do task.Wait() end end
                end
            end
        end
        task._Wait(60)
        last=New(_editor_class["StageClearDisplayer"],self.x,self.y,_)
        task._Wait(9999999)
    end)
    task.New(self,function()
        while coroutine.status(self.task[1])~='dead' do task.Wait() end
        stage.group.FinishReplay()
        New(mask_fader,'close')
        task.New(self,function()
            local _,bgm=EnumRes('bgm')
            for i=1,30 do
                for _,v in pairs(bgm) do
                    if GetMusicState(v)=='playing' then
                        SetBGMVolume(v,1-i/30)
                    end
                end
                task.Wait()
            end
        end)
        task.Wait(30)
        stage.group.FinishStage()
    end)
end)
stage.group.New('menu',{},"Act3",{lifeleft=7,power=400,faith=50000,bomb=3},true,1)
stage.group.AddStage('Act3','Scene@Act3',{lifeleft=7,power=400,faith=50000,bomb=3},true)
stage.group.DefStageFunc('Scene@Act3','init',function(self)
    _init_item(self)
    difficulty=self.group.difficulty
    New(mask_fader,'open')
    if jstg then jstg.CreatePlayers() else New(_G[lstg.var.player_name]) end
    lasttask=task.New(self,function()
        SetWorldUEX(screen.width/2, screen.height/2, 448, 448, 32, 32)
        lstg.var.lifeleft = 2
        New(_editor_class["temple_background"] or temple_background)
        last=New(_editor_class["Plant_Manager"],self.x,self.y,_)
        last=New(_editor_class["UI_Manager"],self.x,self.y,_)
        task._Wait(60)
        LoadMusicRecord("bgm:Act3Theme")
        _play_music("bgm:Act3Theme")
        last=New(_editor_class["SongDisplayer"],self.x,self.y,false)
        last=New(_editor_class["Stage_Sections"],self.x,self.y,10, 4)
        while lstg.var.finishStage == false do
            task._Wait(1)
        end
        task._Wait(60)
        _clear_bullet(true,true)
        for _,unit in ObjList(GROUP_NONTJT) do
            _kill(unit,true)
        end
        for _,unit in ObjList(GROUP_ENEMY) do
            _kill(unit,true)
        end
        local _boss_wait=true
        local _ref=New(_editor_class["Kichi"],_editor_class["Kichi"].cards)
        last=_ref
        if _boss_wait then while IsValid(_ref) do task.Wait() end end
        task._Wait(60)
        last=New(_editor_class["StageClearDisplayer"],self.x,self.y,_)
        task._Wait(9999999)
    end)
    task.New(self,function()
        while coroutine.status(self.task[1])~='dead' do task.Wait() end
        stage.group.FinishReplay()
        New(mask_fader,'close')
        task.New(self,function()
            local _,bgm=EnumRes('bgm')
            for i=1,30 do
                for _,v in pairs(bgm) do
                    if GetMusicState(v)=='playing' then
                        SetBGMVolume(v,1-i/30)
                    end
                end
                task.Wait()
            end
        end)
        task.Wait(30)
        stage.group.FinishStage()
    end)
end)
stage.group.New('menu',{},"ActJudge",{lifeleft=7,power=400,faith=50000,bomb=3},true,1)
stage.group.AddStage('ActJudge','Scene@ActJudge',{lifeleft=7,power=400,faith=50000,bomb=3},true)
stage.group.DefStageFunc('Scene@ActJudge','init',function(self)
    _init_item(self)
    difficulty=self.group.difficulty
    New(mask_fader,'open')
    if jstg then jstg.CreatePlayers() else New(_G[lstg.var.player_name]) end
    lasttask=task.New(self,function()
        SetWorldUEX(screen.width/2, screen.height/2, 448, 448, 32, 32)
        lstg.var.lifeleft = 9
        New(_editor_class["tkz_stage3_bg"] or tkz_stage3_bg)
        last=New(_editor_class["Plant_Manager"],self.x,self.y,_)
        last=New(_editor_class["UI_Manager"],self.x,self.y,_)
        task._Wait(60)
        LoadMusicRecord("bgm:Act1Theme")
        _play_music("bgm:Act1Theme")
        last=New(_editor_class["SongDisplayer"],self.x,self.y,false)
        local _boss_wait=true
        local _ref=New(_editor_class["Isaki"],_editor_class["Isaki"].cards)
        last=_ref
        if _boss_wait then while IsValid(_ref) do task.Wait() end end
        local _boss_wait=true
        local _ref=New(_editor_class["Eternity"],_editor_class["Eternity"].cards)
        last=_ref
        if _boss_wait then while IsValid(_ref) do task.Wait() end end
        local _boss_wait=true
        local _ref=New(_editor_class["Karen"],_editor_class["Karen"].cards)
        last=_ref
        if _boss_wait then while IsValid(_ref) do task.Wait() end end
        local _boss_wait=true
        local _ref=New(_editor_class["Reimu"],_editor_class["Reimu"].cards)
        last=_ref
        if _boss_wait then while IsValid(_ref) do task.Wait() end end
        local _boss_wait=true
        local _ref=New(_editor_class["Kichi"],_editor_class["Kichi"].cards)
        last=_ref
        if _boss_wait then while IsValid(_ref) do task.Wait() end end
        task._Wait(60)
        last=New(_editor_class["StageClearDisplayer"],self.x,self.y,_)
        task._Wait(9999999)
    end)
    task.New(self,function()
        while coroutine.status(self.task[1])~='dead' do task.Wait() end
        stage.group.FinishReplay()
        New(mask_fader,'close')
        task.New(self,function()
            local _,bgm=EnumRes('bgm')
            for i=1,30 do
                for _,v in pairs(bgm) do
                    if GetMusicState(v)=='playing' then
                        SetBGMVolume(v,1-i/30)
                    end
                end
                task.Wait()
            end
        end)
        task.Wait(30)
        stage.group.FinishStage()
    end)
end)
stage.group.New('menu',{},"StaffRoll",{lifeleft=7,power=400,faith=50000,bomb=3},true,1)
stage.group.AddStage('StaffRoll','SceneStaff@StaffRoll',{lifeleft=7,power=400,faith=50000,bomb=3},true)
stage.group.DefStageFunc('SceneStaff@StaffRoll','init',function(self)
    _init_item(self)
    difficulty=self.group.difficulty
    New(mask_fader,'open')
    if jstg then jstg.CreatePlayers() else New(_G[lstg.var.player_name]) end
    lasttask=task.New(self,function()
        SetWorldUEX(screen.width/2, screen.height/2, 448, 448, 32, 32)
        lstg.var.lifeleft = 2
        lstg.var.equipCard = {0, 0}
        lstg.var.plantCard = {0,0,0,0,0,0}
        LoadMusicRecord("bgm:StaffRollTheme")
        _play_music("bgm:StaffRollTheme")
        last=New(_editor_class["StaffRollManager"],screen.width/2, 0,_)
        task._Wait(9999999)
    end)
    task.New(self,function()
        while coroutine.status(self.task[1])~='dead' do task.Wait() end
        stage.group.FinishReplay()
        New(mask_fader,'close')
        task.New(self,function()
            local _,bgm=EnumRes('bgm')
            for i=1,30 do
                for _,v in pairs(bgm) do
                    if GetMusicState(v)=='playing' then
                        SetBGMVolume(v,1-i/30)
                    end
                end
                task.Wait()
            end
        end)
        task.Wait(30)
        stage.group.FinishStage()
    end)
end)
